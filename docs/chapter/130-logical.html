<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2023" name="citation_date" />
<meta content="2023" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages for data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth. It is aimed at ambitious students, professionals, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages for data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth. It is aimed at ambitious students, professionals, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages for data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth. It is aimed at ambitious students, professionals, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="4. Lists and attributes" href="140-list.html" /><link rel="prev" title="2. Numeric vectors" href="120-numeric.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/130-logical.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 6.2.1 and Furo 2023.03.27 -->
        <title>3. Logical vectors - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com' style="display: contents">Marek Gagolewski</a><br />
v0.9.1.9006 (draft)
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr/issues/" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="logical-vectors">
<span id="chap-logical"></span><h1><span class="section-number">3. </span>Logical vectors<a class="headerlink" href="#logical-vectors" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p><em>The open-access textbook</em> Deep R Programming <em>by
<a class="reference external" href="https://www.gagolewski.com/">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr/issues">bug/typo reports/fixes</a>
are appreciated.
Make sure to check out the author’s other book,
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2022).  Minimalist Data Wrangling with Python. Zenodo. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">26</a>]</span>.</em></p>
</div></blockquote>
<section id="creating-logical-vectors">
<h2><span class="section-number">3.1. </span>Creating logical vectors<a class="headerlink" href="#creating-logical-vectors" title="Permalink to this heading">#</a></h2>
<p>R defines three(!) logical constants:
<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, and <code class="docutils literal notranslate"><span class="pre">NA</span></code>, which represent
“yes”, “no”, and “???”, respectively.
Each of them, when instantiated, is an atomic vector of length one.</p>
<p>Some of the functions we introduced in the previous chapter can be used
to generate logical vectors as well:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">## [1]  TRUE FALSE FALSE    NA  TRUE FALSE</span>
<span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [1]  TRUE  TRUE FALSE FALSE    NA    NA</span>
<span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span>
<span class="c1">##  [1]  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">T</span></code> is a synonym for <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">F</span></code> stands for <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.
However, these are not reserved keywords and can be reassigned
to any other values. Therefore, we advise against relying on them:
they are not used throughout the course of this course.</p>
<p>Also, notice that the logical missing value is spelled simply
as <code class="docutils literal notranslate"><span class="pre">NA</span></code>, and not <code class="docutils literal notranslate"><span class="pre">NA_logical_</span></code>. Both the logical <code class="docutils literal notranslate"><span class="pre">NA</span></code>
and the numeric <code class="docutils literal notranslate"><span class="pre">NA_real_</span></code>
are, for the sake of our widely-conceived wellbeing,
both <em>printed</em>  as “<code class="docutils literal notranslate"><span class="pre">NA</span></code>” on the R console.
This, however, does not mean they are identical;
see <a class="reference internal" href="140-list.html#sec-type-hierarchy"><span class="std std-numref">Section 4.1</span></a> for discussion.</p>
</div>
</section>
<section id="comparing-elements">
<h2><span class="section-number">3.2. </span>Comparing elements<a class="headerlink" href="#comparing-elements" title="Permalink to this heading">#</a></h2>
<section id="vectorised-relational-operators">
<h3><span class="section-number">3.2.1. </span>Vectorised relational operators<a class="headerlink" href="#vectorised-relational-operators" title="Permalink to this heading">#</a></h3>
<p>Logical vectors frequently come into being
as a result of various <em>testing</em> activities.
In particular, the binary operators:</p>
<ul class="simple">
<li><p>`<strong class="command">&lt;</strong>` (less than),</p></li>
<li><p>`<strong class="command">&lt;=</strong>` (less than or equal),</p></li>
<li><p>`<strong class="command">&gt;</strong>` (greater than),</p></li>
<li><p>`<strong class="command">&gt;=</strong>` (greater than or equal)</p></li>
<li><p>`<strong class="command">==</strong>` (equal),</p></li>
<li><p>`<strong class="command">!=</strong>` (not equal),</p></li>
</ul>
<p>compare the <em>corresponding</em> elements of two numeric vectors
and output a logical vector.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span>
<span class="c1">## [1] TRUE</span>
<span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>
<span class="c1">## [1] FALSE  TRUE  TRUE FALSE</span>
<span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">1</span>
<span class="c1">##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE</span>
</pre></div>
</div>
<p>Thus, they operate in an elementwise manner. Moreover,
the recycling rule is applied if necessary:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="w">  </span><span class="c1"># c(3, 3, 3, 3, 3) &lt; c(1, 2, 3, 4, 5)</span>
<span class="c1">## [1] FALSE FALSE FALSE  TRUE  TRUE</span>
<span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">  </span><span class="c1"># c(1, 4, 1, 4) == c(1, 2, 3, 4)</span>
<span class="c1">## [1]  TRUE FALSE FALSE  TRUE</span>
</pre></div>
</div>
<p>Therefore, we can say that they are vectorised in the same manner
as the arithmetic operators `<strong class="command">+</strong>`, `<strong class="command">*</strong>`, etc.;
compare <a class="reference internal" href="120-numeric.html#sec-op-arith"><span class="std std-numref">Section 2.4.1</span></a>.</p>
</section>
<section id="testing-for-na-nan-and-inf">
<h3><span class="section-number">3.2.2. </span>Testing for <code class="docutils literal notranslate"><span class="pre">NA</span></code>, <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, and <code class="docutils literal notranslate"><span class="pre">Inf</span></code><a class="headerlink" href="#testing-for-na-nan-and-inf" title="Permalink to this heading">#</a></h3>
<p>Comparisons against missing values and not-numbers yield <code class="docutils literal notranslate"><span class="pre">NA</span></code>s.
Instead of the <em>incorrect</em> “<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">NA_real_</span></code>”,
testing for missingness should rather be performed via a call
to the vectorised <strong class="command">is.na</strong> function.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">is.na</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1]  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE</span>
<span class="nf">is.na</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">  </span><span class="c1"># works for logical vectors too</span>
<span class="c1">## [1] FALSE FALSE  TRUE FALSE</span>
</pre></div>
</div>
<p>Moreover, <strong class="command">is.finite</strong> is noteworthy
since it returns <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> on <code class="docutils literal notranslate"><span class="pre">Inf</span></code>s, <code class="docutils literal notranslate"><span class="pre">NA_real_</span></code>s and <code class="docutils literal notranslate"><span class="pre">NaN</span></code>s.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">is.finite</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</span>
</pre></div>
</div>
<p>See also the more specific
<strong class="command">is.nan</strong> and <strong class="command">is.infinite</strong>.</p>
</section>
<section id="dealing-with-round-off-errors">
<span id="sec-fp"></span><h3><span class="section-number">3.2.3. </span>Dealing with round-off errors (*)<a class="headerlink" href="#dealing-with-round-off-errors" title="Permalink to this heading">#</a></h3>
<p>In mathematics, real numbers are merely an idealisation.
In practice, however, it is impossible to store them with
infinite precision (think <span class="math">\(\pi=3.141592653589793...\)</span>):
computer memory is limited, and our time is precious.</p>
<p>Therefore, a consensus had to be reached. In R, we rely on
the <em>double-precision floating point format</em>. The <em>floating point</em>
part means that the numbers can be both small (close to zero
like <span class="math">\(\pm 2.23\times 10^{-308}\)</span>)
and large (e.g., <span class="math">\(\pm 1.79\times 10^{308}\)</span>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mf">2.23e-308</span> <span class="o">==</span> <span class="mf">0.00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">0000000223</span>

<span class="mf">1.79e308</span>  <span class="o">==</span>                                            <span class="mi">179000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
               <span class="mi">00000000000000000000000000000000000000000000000000</span>
</pre></div>
</div>
<p>These two are quite distant.</p>
</div>
<p>Every numeric value takes 8 bytes (or, equivalently, 64 bits) of memory.
We are, however, able to store only <em>about</em> 15-17 decimal digits:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="m">0.12345678901234567890123456789012345678901234</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="m">22</span><span class="p">)</span><span class="w">  </span><span class="c1"># 22 is max</span>
<span class="c1">## [1] 0.1234567890123456773699</span>
</pre></div>
</div>
<p>which limits the precision of our computations.
The <em>about</em> part is, unfortunately, due to the numbers’
being written in the computer-friendly <em>binary</em>, not the human-aligned
<em>decimal</em> base. This can lead to some unexpected outcomes.</p>
<p>In particular:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0.1</span></code> cannot be represented exactly for it cannot be written
as a finite series of reciprocals of powers of 2
(it holds <span class="math">\(0.1=2^{-4}+2^{-5}+2^{-8}+2^{-9}+\dots\)</span>).
This leads to surprising results such as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0.3</span>
<span></span><span class="c1">## [1] FALSE</span>
</pre></div>
</div>
<p>Quite strikingly, what follows does not <em>show</em> anything
suspicious:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span>
<span></span><span class="c1">## [1] 0.1 0.3 0.3</span>
</pre></div>
</div>
<p>Printing involves rounding. In the above context, it is misleading.
Actually, we experience something more like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">),</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="m">22</span><span class="p">)</span>
<span></span><span class="c1">## [1] 0.1000000000000000055511 0.3000000000000000444089</span>
<span class="c1">## [3] 0.2999999999999999888978</span>
</pre></div>
</div>
</li>
<li><p>All integers between <span class="math">\(-2^{53}\)</span> and <span class="math">\(2^{53}\)</span> all stored
<em>exactly</em>. This is good news.
However, the next integer is beyond the representable range:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">^</span><span class="m">53</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="m">53</span>
<span></span><span class="c1">## [1] TRUE</span>
</pre></div>
</div>
</li>
<li><p>The above suggests that the order of
operations might matter. In particular, the associativity
property may be violated when dealing with numbers of contrasting orders
of magnitude:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">^</span><span class="m">53</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="m">-53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="m">53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="m">-53</span><span class="w">  </span><span class="c1"># should be == 0.0</span>
<span></span><span class="c1">## [1] -1.1102e-16</span>
</pre></div>
</div>
</li>
<li><p>Some numbers may just be too large, too small, or too close to zero
to be represented exactly:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="p">((</span><span class="m">1023-52</span><span class="p">)</span><span class="o">:</span><span class="m">1023</span><span class="p">)),</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="p">((</span><span class="m">1023-53</span><span class="p">)</span><span class="o">:</span><span class="m">1023</span><span class="p">)))</span>
<span></span><span class="c1">## [1] 1.7977e+308         Inf</span>
<span></span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="p">(</span><span class="m">-1022-52</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="p">(</span><span class="m">-1022-53</span><span class="p">))</span>
<span></span><span class="c1">## [1] 4.9407e-324  0.0000e+00</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The double-precision floating point format (IEEE 754)
is not specific to R. It is used by most other computing environments,
including Python and C++.</p>
<p>For discussion, see <span id="id2">[<a class="reference internal" href="999-bibliography.html#id39" title="Goldberg, D. (1991).  What every computer scientist should know about floating-point arithmetic. ACM Computing Surveys, 21(1):5–48. URL: https://perso.ens-lyon.fr/jean-michel.muller/goldberg.pdf.">32</a>, <a class="reference internal" href="999-bibliography.html#id38" title="Higham, N.J. (2002).  Accuracy and Stability of Numerical Algorithms. SIAM. DOI: 10.1137/1.9780898718027.">35</a>, <a class="reference internal" href="999-bibliography.html#id33" title="Knuth, D.E. (1997).  The Art of Computer Programming II: Seminumerical Algorithms. Addison-Wesley.">42</a>]</span>.
Also, <span id="id3">[<a class="reference internal" href="999-bibliography.html#id41" title="Gentle, J.E. (2009).  Computational Statistics. Springer.">31</a>]</span> can be of particular interest
to the general statistical/data analysis audience.</p>
</div>
<p>Can we do anything about these issues?</p>
<p>Firstly, dealing with <em>integers</em> of a <em>reasonable</em> order of magnitude
(e.g., various resource or case IDs in our datasets)
is <em>safe</em>. Their comparison, addition,
subtraction, and multiplication are always precise.</p>
<p>In all other cases (including applying other operations on integers,
e.g., division or <strong class="command">sqrt</strong>), we need to be very
careful with comparisons, especially involving testing for
equality via `<strong class="command">==</strong>`.
The sole fact that <span class="math">\(\sin \pi = 0\)</span>, mathematically speaking,
does not mean that we should expect that:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sin</span><span class="p">(</span><span class="kc">pi</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>
<span class="c1">## [1] FALSE</span>
</pre></div>
</div>
<p>Instead, they are so close that we can
<em>treat the difference between them as negligible</em>.
Thus, in practice, instead of testing if <span class="math">\(x = y\)</span>,
we will be considering:</p>
<ul class="simple">
<li><p><span class="math">\(|x-y|\)</span> (absolute error), or</p></li>
<li><p><span class="math">\(\frac{|x-y|}{|y|}\)</span> (relative error; which takes the order of
magnitude of the numbers into account
but obviously cannot be applied if <span class="math">\(y\)</span> is very close to <span class="math">\(0\)</span>),</p></li>
</ul>
<p>and determining if these are less than some assumed error margin,
<span class="math">\(\varepsilon&gt;0\)</span>, say, <span class="math">\(10^{-8}\)</span> or <span class="math">\(2^{-26}\)</span>.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">abs</span><span class="p">(</span><span class="nf">sin</span><span class="p">(</span><span class="kc">pi</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="m">-26</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rounding can sometimes have a similar effect as testing for
almost equality in terms of the absolute error.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round</span><span class="p">(</span><span class="nf">sin</span><span class="p">(</span><span class="kc">pi</span><span class="p">),</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The above recommendations are valid for the most popular
applications of R, i.e., statistical and, more generally,
scientific computing<a class="footnote-reference brackets" href="#footfpapps" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
Our datasets usually do not represent accurate measurements.
Bah, the world itself is far from ideal!
Therefore, we do not have to lose sleep over our not being able to precisely
pinpoint the <em>exact</em> solutions.</p>
</div>
</section>
</section>
<section id="logical-operations">
<h2><span class="section-number">3.3. </span>Logical operations<a class="headerlink" href="#logical-operations" title="Permalink to this heading">#</a></h2>
<section id="vectorised-logical-operators">
<h3><span class="section-number">3.3.1. </span>Vectorised logical operators<a class="headerlink" href="#vectorised-logical-operators" title="Permalink to this heading">#</a></h3>
<p>The relational operators such as `<strong class="command">==</strong>` and `<strong class="command">&gt;</strong>`
accept only <em>two</em> arguments. Their chaining is forbidden.
A test that we would mathematically write
as <span class="math">\(0 \le x \le 1\)</span> (or <span class="math">\(x\in[0, 1]\)</span>) <em>cannot</em> be expressed
as “<code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">1</span></code>” in R.
Therefore, we need a way to combine two logical conditions
so as to be able to state that “<span class="math">\(x\ge 0\)</span> <em>and, at the same time</em>, <span class="math">\(x\le 1\)</span>”.</p>
<p>In such situations, the following logical operators
and functions come in handy:</p>
<ul class="simple">
<li><p>`<strong class="command">!</strong>` (not, negation; unary),</p></li>
<li><p>`<strong class="command">&amp;</strong>` (and, conjunction; are both predicates true?),</p></li>
<li><p>`<strong class="command">|</strong>` (or, alternation; is at least one true?),</p></li>
<li><p><strong class="command">xor</strong> (exclusive-or, exclusive disjunction, either-or;
is one and only one of the predicates true?).</p></li>
</ul>
<p>They again act elementwisely and implement the recycling rule if necessary
(and applicable).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">-0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span>
<span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE</span>
<span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE  TRUE  TRUE</span>
<span class="o">!</span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE</span>
<span class="nf">xor</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1]  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The vectorised `<strong class="command">&amp;</strong>` and `<strong class="command">|</strong>` operators
should not be confused with their scalar, short-circuit
counterparts, `<strong class="command">&amp;&amp;</strong>` and `<strong class="command">||</strong>`;
see <a class="reference internal" href="180-flow.html#sec-short-circuit-ops"><span class="std std-numref">Section 8.1.4</span></a>.</p>
</div>
</section>
<section id="operator-precedence-revisited">
<h3><span class="section-number">3.3.2. </span>Operator precedence revisited<a class="headerlink" href="#operator-precedence-revisited" title="Permalink to this heading">#</a></h3>
<p>The operators introduced in this chapter have lower precedence than the
arithmetic ones, including the binary `<strong class="command">+</strong>`
and `<strong class="command">-</strong>`. Calling <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Syntax&quot;)</span></code> reveals
that we can extend our listing from <a class="reference internal" href="120-numeric.html#sec-precedence-numeric"><span class="std std-numref">Section 2.4.3</span></a>
as follows:</p>
<ol class="arabic simple">
<li><p><em>`<strong class="command">&lt;-</strong>` (right to left; least binding),</em></p></li>
<li><p>`<strong class="command">|</strong>`,</p></li>
<li><p>`<strong class="command">&amp;</strong>`,</p></li>
<li><p>`<strong class="command">!</strong>` (unary),</p></li>
<li><p>`<strong class="command">&lt;</strong>`, `<strong class="command">&gt;</strong>`, `<strong class="command">&lt;=</strong>`, `<strong class="command">&gt;=</strong>`,
`<strong class="command">==</strong>`, and `<strong class="command">!=</strong>`,</p></li>
<li><p><em>`<strong class="command">+</strong>` and `<strong class="command">-</strong>` (binary),</em></p></li>
<li><p><em>`<strong class="command">*</strong>` and `<strong class="command">/</strong>`,</em></p></li>
<li><p>…</p></li>
</ol>
<p>The order of precedence is quite intuitive,
e.g., “<code class="docutils literal notranslate"><span class="pre">x+1</span> <span class="pre">&lt;=</span> <span class="pre">y</span> <span class="pre">&amp;</span> <span class="pre">y</span> <span class="pre">&lt;=</span> <span class="pre">z-1</span> <span class="pre">|</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">z</span></code>”
means “<code class="docutils literal notranslate"><span class="pre">(((x+1)</span> <span class="pre">&lt;=</span> <span class="pre">y)</span> <span class="pre">&amp;</span> <span class="pre">(y</span> <span class="pre">&lt;=</span> <span class="pre">(z-1)))</span> <span class="pre">|</span> <span class="pre">(x</span> <span class="pre">&lt;=</span> <span class="pre">z)</span></code>”.</p>
</section>
<section id="dealing-with-missingness">
<h3><span class="section-number">3.3.3. </span>Dealing with missingness<a class="headerlink" href="#dealing-with-missingness" title="Permalink to this heading">#</a></h3>
<p>Operations involving missing values follow the principles
of Łukasiewicz’s three-valued logic, which is based on common sense.
For instance, “<code class="docutils literal notranslate"><span class="pre">NA</span> <span class="pre">|</span> <span class="pre">TRUE</span></code>” is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> because
the alternative (<em>or</em>) needs <em>at least one</em>
argument to be <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> to generate a positive result.
On the other hand, “<code class="docutils literal notranslate"><span class="pre">NA</span> <span class="pre">|</span> <span class="pre">FALSE</span></code>” is <code class="docutils literal notranslate"><span class="pre">NA</span></code> since
the outcome would be different depending on what we substituted <code class="docutils literal notranslate"><span class="pre">NA</span></code> for.</p>
<p>Let us take a moment to contemplate the logical operations’ <em>truth tables</em>
for all the possible combinations of inputs:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w">  </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">  </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w">    </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span>
<span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w">   </span><span class="kc">NA</span><span class="p">,</span><span class="w">    </span><span class="kc">NA</span><span class="p">)</span>
<span class="o">!</span><span class="n">u</span>
<span class="c1">## [1] FALSE  TRUE    NA FALSE  TRUE    NA FALSE  TRUE    NA</span>
<span class="n">u</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">v</span>
<span class="c1">## [1]  TRUE FALSE    NA FALSE FALSE FALSE    NA FALSE    NA</span>
<span class="n">u</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">v</span>
<span class="c1">## [1]  TRUE  TRUE  TRUE  TRUE FALSE    NA  TRUE    NA    NA</span>
<span class="nf">xor</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="c1">## [1] FALSE  TRUE    NA  TRUE FALSE    NA    NA    NA    NA</span>
</pre></div>
</div>
</section>
<section id="aggregating-with-all-any-and-sum">
<h3><span class="section-number">3.3.4. </span>Aggregating with <strong class="command">all</strong>, <strong class="command">any</strong>, and <strong class="command">sum</strong><a class="headerlink" href="#aggregating-with-all-any-and-sum" title="Permalink to this heading">#</a></h3>
<p>Just like in the case of numeric vectors,
we can summarise the contents of logical sequences.
<strong class="command">all</strong> tests whether <em>every</em> element in a logical vector
is equal to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. <strong class="command">any</strong> determines if there <em>exists</em>
an element that is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">10000</span><span class="p">)</span>
<span class="nf">all</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">  </span><span class="c1"># are all values in x &lt;= 0.2?</span>
<span class="c1">## [1] FALSE</span>
<span class="nf">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">  </span><span class="c1"># is there at least one element in x that is &lt;= 0.2?</span>
<span class="c1">## [1] TRUE</span>
<span class="nf">any</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">## [1] TRUE</span>
<span class="nf">all</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">))</span>
<span class="c1">## [1] NA</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong class="command">all</strong> will frequently be used in conjunction
with `<strong class="command">==</strong>`. This is because the latter, as we have said above,
is itself <em>vectorised</em>: it does <em>not</em> test whether a vector <em>as a whole</em>
is equal to another one.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">z</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="w">  </span><span class="c1"># elementwise equal</span>
<span class="c1">## [1] TRUE TRUE TRUE</span>
<span class="nf">all</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w">  </span><span class="c1"># elementwise equal summarised</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
<p>However, let us keep in mind the warning about the testing for <em>exact</em>
equality of floating-point numbers stated in <a class="reference internal" href="#sec-fp"><span class="std std-numref">Section 3.2.3</span></a>.
Sometimes, considering absolute or relative errors might be more appropriate.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sin</span><span class="p">((</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="o">*</span><span class="kc">pi</span><span class="p">)</span><span class="w">  </span><span class="c1"># sin(0), sin(pi), sin(2*pi), ..., sin(10*pi)</span>
<span class="nf">all</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0.0</span><span class="p">)</span><span class="w">  </span><span class="c1"># danger zone! please don&#39;t...</span>
<span class="c1">## [1] FALSE</span>
<span class="nf">all</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1e-8</span><span class="p">)</span><span class="w">  </span><span class="c1"># are the absolute errors negligible?</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
</div>
<p>We can also call <strong class="command">sum</strong> on a logical vector.
Taking into account that it interprets <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> as numeric <code class="docutils literal notranslate"><span class="pre">1</span></code>
and <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> as <code class="docutils literal notranslate"><span class="pre">0</span></code> (more on this in <a class="reference internal" href="140-list.html#sec-type-hierarchy"><span class="std std-numref">Section 4.1</span></a>),
it will give us the number of elements equal to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">  </span><span class="c1"># how many elements in x are &lt;= 0.2?</span>
<span class="c1">## [1] 1998</span>
</pre></div>
</div>
<p>Also, by computing <strong class="command">sum</strong><code class="code docutils literal notranslate"><span class="pre">(x)/</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>,
we can obtain the proportion (fraction) of values equal to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> in <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Equivalently:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">  </span><span class="c1"># proportion of elements &lt;= 0.2</span>
<span class="c1">## [1] 0.1998</span>
</pre></div>
</div>
<p>Naturally, we <em>expect</em>
<strong class="command">mean</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">runif</strong><code class="code docutils literal notranslate"><span class="pre">(n)</span> <span class="pre">&lt;=</span> <span class="pre">0.2)</span></code> to be equal to
0.2 (20%), but with randomness, we can never be sure.</p>
</section>
<section id="simplifying-predicates">
<h3><span class="section-number">3.3.5. </span>Simplifying predicates<a class="headerlink" href="#simplifying-predicates" title="Permalink to this heading">#</a></h3>
<p>Each aspiring programmer needs to become fluent with the rules
governing the transformations of logical conditions,
e.g., that the negation of “<code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&gt;=</span> <span class="pre">0)</span> <span class="pre">&amp;</span> <span class="pre">(x</span> <span class="pre">&lt;</span> <span class="pre">1)</span></code>”
is equivalent to “<code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&lt;</span> <span class="pre">0)</span> <span class="pre">|</span> <span class="pre">(x</span> <span class="pre">&gt;=</span> <span class="pre">1)</span></code>”.
Such rules are called <em>tautologies</em>. Here are some of them:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">!(!p)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">p</span></code> (double negation),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!(p</span> <span class="pre">&amp;</span> <span class="pre">q)</span></code> holds if and only if <code class="docutils literal notranslate"><span class="pre">!p</span> <span class="pre">|</span> <span class="pre">!q</span></code> (De Morgan’s law),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!(p</span> <span class="pre">|</span> <span class="pre">q)</span></code> is  <code class="docutils literal notranslate"><span class="pre">!p</span> <span class="pre">&amp;</span> <span class="pre">!q</span></code> (another De Morgan’s law),</p></li>
<li><p><strong class="command">all</strong><code class="code docutils literal notranslate"><span class="pre">(p)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">!</span></code><strong class="command">any</strong><code class="code docutils literal notranslate"><span class="pre">(!p)</span></code>.</p></li>
</ul>
<p>Various combinations thereof are, of course, possible.
Some further simplifications are enabled by
other properties of the binary operations:</p>
<ul class="simple">
<li><p>commutativity (symmetry), e.g., <span class="math">\(a+b = b+a\)</span>, <span class="math">\(a*b=b*a\)</span>,</p></li>
<li><p>associativity, e.g.,
<span class="math">\((a+b)+c = a+(b+c)\)</span>, <span class="math">\(\max(\max(a, b), c)=\max(a, \max(b, c))\)</span>,</p></li>
<li><p>distributivity, e.g.,
<span class="math">\(a*b+a*c = a*(b+c)\)</span>, <span class="math">\(\min(\max(a,b), \max(a,c))=\max(a, \min(b, c))\)</span>,</p></li>
</ul>
<p>and relations, including:</p>
<ul class="simple">
<li><p>transitivity, e.g., if <span class="math">\(a\le b\)</span> and <span class="math">\(b\le c\)</span>, then surely <span class="math">\(a \le c\)</span>.</p></li>
</ul>
<div class="proof proof-type-exercise" id="id6">

    <div class="proof-title">
        <span class="proof-type">Exercise 3.1</span>
        
    </div><div class="proof-content">
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code> are numeric vectors,
simplify the following expressions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">!(b&gt;a</span> <span class="pre">&amp;</span> <span class="pre">b&lt;c)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!(a&gt;=b</span> <span class="pre">&amp;</span> <span class="pre">b&gt;=c</span> <span class="pre">&amp;</span> <span class="pre">a&gt;=c)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a&gt;b</span> <span class="pre">&amp;</span> <span class="pre">a&lt;c</span> <span class="pre">|</span> <span class="pre">a&lt;c</span> <span class="pre">&amp;</span> <span class="pre">a&gt;d</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a&gt;b</span> <span class="pre">|</span> <span class="pre">a&lt;=b</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a&lt;=b</span> <span class="pre">&amp;</span> <span class="pre">a&gt;c</span> <span class="pre">|</span> <span class="pre">a&gt;b</span> <span class="pre">&amp;</span> <span class="pre">a&lt;=c</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a&lt;=b</span> <span class="pre">&amp;</span> <span class="pre">(a&gt;c</span> <span class="pre">|</span> <span class="pre">a&gt;b)</span> <span class="pre">&amp;</span> <span class="pre">a&lt;=c</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!</span></code><strong class="command">all</strong><code class="code docutils literal notranslate"><span class="pre">(a</span> <span class="pre">&gt;</span> <span class="pre">b</span> <span class="pre">&amp;</span> <span class="pre">b</span> <span class="pre">&lt;</span> <span class="pre">c)</span></code>.</p></li>
</ul>
</div></div></section>
</section>
<section id="choosing-elements-with-ifelse">
<h2><span class="section-number">3.4. </span>Choosing elements with <strong class="command">ifelse</strong><a class="headerlink" href="#choosing-elements-with-ifelse" title="Permalink to this heading">#</a></h2>
<p>The <strong class="command">ifelse</strong> function is a vectorised version
of the scalar <strong class="command">if</strong>…<strong class="command">else</strong> conditional statement,
which we will forgo for as long as until <a class="reference internal" href="180-flow.html#chap-flow"><span class="std std-numref">Chapter 8</span></a>.
It permits us to select an element from one of two vectors
based on some logical condition.</p>
<p>A call to <strong class="command">ifelse</strong><code class="code docutils literal notranslate"><span class="pre">(l,</span> <span class="pre">t,</span> <span class="pre">f)</span></code>, where <code class="docutils literal notranslate"><span class="pre">l</span></code> is a logical vector,
returns a vector <code class="docutils literal notranslate"><span class="pre">y</span></code> such that:</p>
<div class="math-wrapper docutils container">
<div class="math">
\[
y_i = \left\{
\begin{array}{ll}
t_i & \text{if } l_i \text{ is TRUE }, \\
f_i & \text{if } l_i \text{ is FALSE }. \\
\end{array}
\right.
\]</div>
</div>
<p>In other words, the <span class="math">\(i\)</span>-th element of the result vector
is equal to <span class="math">\(t_i\)</span> if <span class="math">\(l_i\)</span> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> and to <span class="math">\(f_i\)</span> otherwise.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">6</span><span class="p">))</span><span class="w">  </span><span class="c1"># example vector</span>
<span class="c1">## [1] -0.560476 -0.230177  1.558708  0.070508  0.129288  1.715065</span>
<span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># like abs(z)</span>
<span class="c1">## [1] 0.560476 0.230177 1.558708 0.070508 0.129288 1.715065</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">6</span><span class="p">))</span><span class="w">  </span><span class="c1"># example vector</span>
<span class="c1">## [1]  0.46092 -1.26506 -0.68685 -0.44566  1.22408  0.35981</span>
<span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">6</span><span class="p">))</span><span class="w">  </span><span class="c1"># example vector</span>
<span class="c1">## [1]  0.40077  0.11068 -0.55584  1.78691  0.49785 -1.96662</span>
<span class="nf">ifelse</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">   </span><span class="c1"># like pmax(x, y)</span>
<span class="c1">## [1]  0.46092  0.11068 -0.55584  1.78691  1.22408  0.35981</span>
</pre></div>
</div>
<p>By now, we should not be surprised that the recycling rule is fired up
if necessary:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ifelse</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">  </span><span class="c1"># squares of positive xs and 0 otherwise</span>
<span class="c1">## [1] 0.21244 0.00000 0.00000 0.00000 1.49838 0.12947</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All arguments are evaluated in their entirety before deciding
on which elements are selected.
Therefore, the following call generates a warning:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">)</span>
<span class="c1">## Warning in log(z): NaNs produced</span>
<span class="c1">## [1]       NA       NA  0.44386 -2.65202 -2.04571  0.53945</span>
</pre></div>
</div>
<p>This is because, with <strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(z)</span></code>,
we compute the logarithms of negative values
anyway. To fix this, we can write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">log</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">))</span>
<span class="c1">## [1]       NA       NA  0.44386 -2.65202 -2.04571  0.53945</span>
</pre></div>
</div>
</div>
<p>In case we yearn for
an <strong class="command">if</strong>…<strong class="command">else if</strong>…<strong class="command">else</strong>-type expression,
the calls to <strong class="command">ifelse</strong> can naturally be nested.</p>
<div class="proof proof-type-example" id="id7">

    <div class="proof-title">
        <span class="proof-type">Example 3.2</span>
        
    </div><div class="proof-content">
<p>A version of
<strong class="command">pmax</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">pmax</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y),</span> <span class="pre">z)</span></code> can be written as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ifelse</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">    </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<span class="w">    </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1">## [1] 0.46092 0.11068 1.55871 1.78691 1.22408 1.71506</span>
</pre></div>
</div>
<p>However, determining three intermediate logical vectors is not necessary.
We can save one call to `<strong class="command">&gt;=</strong>` by introducing an auxiliary
variable:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">xy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="nf">ifelse</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">xy</span><span class="p">)</span>
<span class="c1">## [1] 0.46092 0.11068 1.55871 1.78691 1.22408 1.71506</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 3.3</span>
        
    </div><div class="proof-content">
<p><a class="reference internal" href="#fig-ex-mixture"><span class="std std-numref">Figure 3.1</span></a>  depicts a realisation
of the mixture <span class="math">\(Z=0.2 X + 0.8 Y\)</span>
of two normal distributions <span class="math">\(X\sim\mathrm{N}(-2, 0.5)\)</span>
and <span class="math">\(Y\sim\mathrm{N}(3, 1)\)</span>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100000</span>
<span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">101</span><span class="p">,</span><span class="w"> </span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id9">
<span id="fig-ex-mixture"></span><img alt="../_images/ex-mixture-1.png" src="../_images/ex-mixture-1.png" />
<figcaption>
<p><span class="caption-number">Figure 3.1 </span><span class="caption-text">A mixture of two Gaussians generated with <strong class="command">ifelse</strong>.</span><a class="headerlink" href="#id9" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In other words, we generated a variate from
the normal distribution that has the expected value of <span class="math">\(-2\)</span> with probability
<span class="math">\(20\%\)</span>, and from the one with the expectation of <span class="math">\(3\)</span> otherwise.</p>
<p>Inspired by the above, generate the following Gaussian mixtures:</p>
<ul class="simple">
<li><p><span class="math">\(\frac{2}{3} X + \frac{1}{3} Y\)</span>, where <span class="math">\(X\sim\mathrm{N}(100, 16)\)</span>
and <span class="math">\(Y\sim\mathrm{N}(116, 8)\)</span>,</p></li>
<li><p><span class="math">\(0.3 X + 0.4 Y + 0.3 Z\)</span>, where <span class="math">\(X\sim\mathrm{N}(-10, 2)\)</span>,
<span class="math">\(Y\sim\mathrm{N}(0, 2)\)</span>, and <span class="math">\(Z\sim\mathrm{N}(10, 2)\)</span>.</p></li>
</ul>
<p>(*) On a side note, knowing that if <span class="math">\(X\)</span> follows <span class="math">\(\mathrm{N}(0, 1)\)</span>,
then the scaled-shifted <span class="math">\(\sigma X+\mu\)</span> is distributed
<span class="math">\(\mathrm{N}(\mu, \sigma)\)</span>,
the above can be equivalently written as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span>
<span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">*</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div></div></section>
<section id="exercises">
<h2><span class="section-number">3.5. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 3.4</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>Why the statement “The Earth is flat or the smallpox
vaccine is proven effective” is obviously true?</p></li>
<li><p>What is the difference between <code class="docutils literal notranslate"><span class="pre">NA</span></code> and <code class="docutils literal notranslate"><span class="pre">NA_real_</span></code>?</p></li>
<li><p>Why is “<code class="docutils literal notranslate"><span class="pre">FALSE</span> <span class="pre">&amp;</span> <span class="pre">NA</span></code>” equal to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, but “<code class="docutils literal notranslate"><span class="pre">TRUE</span> <span class="pre">&amp;</span> <span class="pre">NA</span></code>” is <code class="docutils literal notranslate"><span class="pre">NA</span></code>?</p></li>
<li><p>Why has
<strong class="command">ifelse</strong><code class="code docutils literal notranslate"><span class="pre">(x&gt;=0,</span> </code><strong class="command">sqrt</strong><code class="code docutils literal notranslate"><span class="pre">(x),</span> <span class="pre">NA_real_)</span></code>
a tendency to generate warnings and how to rewrite it so as to
prevent that from happening?</p></li>
<li><p>What is the interpretation of <strong class="command">mean</strong><code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&gt;=</span> <span class="pre">0</span> <span class="pre">&amp;</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">1)</span></code>?</p></li>
<li><p>For some integer <span class="math">\(x\)</span> and <span class="math">\(y\)</span>, how to verify whether <span class="math">\(0 &lt; x &lt; 100\)</span>,
<span class="math">\(0 &lt; y &lt; 100\)</span>, and <span class="math">\(x &lt; y\)</span>, all at the same time?</p></li>
<li><p>Mathematically, for all real <span class="math">\(x, y &gt; 0\)</span>,
it holds <span class="math">\(\log xy = \log x + \log y\)</span>. Why then
<strong class="command">all</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(x*y)</span> <span class="pre">==</span> </code><strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(x)+</span></code><strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(y))</span></code> can sometimes return <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>?
How to fix this?</p></li>
<li><p>Is <code class="docutils literal notranslate"><span class="pre">x/y/z</span></code> always equal to <code class="docutils literal notranslate"><span class="pre">x/(y/z)</span></code>? How to fix this?</p></li>
<li><p>What is the purpose of very specific functions such as
<strong class="command">log1p</strong> and <strong class="command">expm1</strong> (see their
help page) and many others listed in, e.g., the GNU GSL library
<span id="id5">[<a class="reference internal" href="999-bibliography.html#id30" title="Galassi, M., Theiler, J., and others. (2021).  GNU Scientific Library Reference Manual. URL: https://www.gnu.org/software/gsl.">28</a>]</span>?
Is our referring to them a violation of the beloved
“do not multiply entities without necessity” rule?</p></li>
<li><p>If we know that <span class="math">\(x\)</span> may be subject to error,
how to test whether <span class="math">\(x&gt;0\)</span> in a robust manner?</p></li>
<li><p>Is “<code class="docutils literal notranslate"><span class="pre">y&lt;-5</span></code>” the same as “<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&lt;-</span> <span class="pre">5</span></code>” or rather “<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&lt;</span> <span class="pre">-5</span></code>”?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 3.5</span>
        
    </div><div class="proof-content">
<p>What is the difference between <strong class="command">all</strong> and <strong class="command">isTRUE</strong>?
What about `<strong class="command">==</strong>`, <strong class="command">identical</strong>,
and <strong class="command">all.equal</strong>? Is the last one properly vectorised?</p>
</div></div><div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 3.6</span>
        
    </div><div class="proof-content">
<p>Compute the cross-entropy loss between a numeric vector <span class="math">\(\boldsymbol{p}\)</span> with values in the interval <span class="math">\((0, 1)\)</span>
and a logical vector <span class="math">\(\boldsymbol{y}\)</span>, both of length <span class="math">\(n\)</span>
(you can generate them randomly or manually, it does not matter,
it is just an exercise):</p>
<div class="math-wrapper docutils container">
<div class="math">
\[
\mathcal{L}(\boldsymbol{p}, \boldsymbol{y}) = \frac{1}{n} \sum_{i=1}^n \ell_i,
\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math">
\[
\ell_i =
\left\{
\begin{array}{ll}
-\log p_i     & \text{if } y_i \text{ is TRUE }, \\
-\log (1-p_i) & \text{if } y_i \text{ is FALSE }. \\
\end{array}
\right.
\]</div>
</div>
<p>Interpretation: in classification problems,
<span class="math">\(y_i\in\{\text{FALSE}, \text{TRUE}\}\)</span>
denotes the true class of the <span class="math">\(i\)</span>-th object
(say, whether the <span class="math">\(i\)</span>-th hospital patient is symptomatic)
and <span class="math">\(p_i\in(0, 1)\)</span> is a machine learning algorithm’s
<em>confidence</em> that <span class="math">\(i\)</span> belongs to class <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>
(e.g., how sure a decision tree model is that the corresponding
person is unwell). Ideally, if <span class="math">\(y_i\)</span> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <span class="math">\(p_i\)</span> should be close to 1
and to <span class="math">\(0\)</span> otherwise. The cross-entropy loss quantifies by how much
a classifier differs from the omniscient one.
The use of the logarithm penalises strong beliefs in the wrong answer.</p>
</div></div><div style="margin-top: 1em"></div><p>By the way, if we have solved any of the exercises encountered so far
by referring to <strong class="command">if</strong> statements, <strong class="command">for</strong> loops,
vector indexing like <code class="docutils literal notranslate"><span class="pre">x[...]</span></code>,
or any external R package, we recommend to go back and rewrite our code.
Let us keep things simple (effective, readable)
by only using <em>base</em> R’s vectorised operations that
we have introduced.</p>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footfpapps" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">1</a><span class="fn-bracket">]</span></span>
<p>However, in financial applications, we had rather rely on
base-10 numbers (compare the problem with 0.1 above).
There are some libraries implementing
higher precision floating-point numbers
or even interval arithmetic that keeps track of error propagation
in operation chains.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="140-list.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">4. </span>Lists and attributes</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="120-numeric.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">2. </span>Numeric vectors</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2023 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2023-06-26T19:56:18+1000.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">3. Logical vectors</a><ul>
<li><a class="reference internal" href="#creating-logical-vectors">3.1. Creating logical vectors</a></li>
<li><a class="reference internal" href="#comparing-elements">3.2. Comparing elements</a><ul>
<li><a class="reference internal" href="#vectorised-relational-operators">3.2.1. Vectorised relational operators</a></li>
<li><a class="reference internal" href="#testing-for-na-nan-and-inf">3.2.2. Testing for <code class="docutils literal notranslate"><span class="pre">NA</span></code>, <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, and <code class="docutils literal notranslate"><span class="pre">Inf</span></code></a></li>
<li><a class="reference internal" href="#dealing-with-round-off-errors">3.2.3. Dealing with round-off errors (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logical-operations">3.3. Logical operations</a><ul>
<li><a class="reference internal" href="#vectorised-logical-operators">3.3.1. Vectorised logical operators</a></li>
<li><a class="reference internal" href="#operator-precedence-revisited">3.3.2. Operator precedence revisited</a></li>
<li><a class="reference internal" href="#dealing-with-missingness">3.3.3. Dealing with missingness</a></li>
<li><a class="reference internal" href="#aggregating-with-all-any-and-sum">3.3.4. Aggregating with <strong class="command">all</strong>, <strong class="command">any</strong>, and <strong class="command">sum</strong></a></li>
<li><a class="reference internal" href="#simplifying-predicates">3.3.5. Simplifying predicates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#choosing-elements-with-ifelse">3.4. Choosing elements with <strong class="command">ifelse</strong></a></li>
<li><a class="reference internal" href="#exercises">3.5. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js"></script>
    <script src="../_static/auto-render.min.js"></script>
    <script src="../_static/katex_autorenderer.js"></script>
    </body>
</html>