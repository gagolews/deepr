<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="13. Graphics" href="250-graphics.html" /><link rel="prev" title="11. Matrices and other arrays" href="230-matrix.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/240-data-frame.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/deepr.png"/><!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>12. Data frames - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/deepr.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.0.9004
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="data-frames">
<span id="chap-data-frame"></span><h1><span class="section-number">12. </span>Data frames<a class="headerlink" href="#data-frames" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2024).  Minimalist Data Wrangling with Python. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">27</a>]</span> too.</em></p>
</div></blockquote>
<p>Most matrices are built on top of atomic vectors. Hence, only
items of the same type can be arranged into rows and columns.
On the other hand, <em>data frames</em> (objects of the S3 class <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>,
first introduced in <span id="id2">[<a class="reference internal" href="999-bibliography.html#id52" title="Chambers, J.M. and Hastie, T.J. (1991).  Statistical Models in S. Chapman &amp; Hall.">13</a>]</span>)
are <em>collections</em> of vectors of the same lengths or matrices with identical
row counts. Hence, they represent structured<a class="footnote-reference brackets" href="#footstructured" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
data of possibly <em>heterogeneous</em> types. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w">  </span><span class="c1"># `iris` is an example data frame</span>
<span class="c1">## [1] &quot;data.frame&quot;</span>
<span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># three chosen rows from `iris`</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2     setosa</span>
<span class="c1">## 51           7.0         3.2          4.7         1.4 versicolor</span>
<span class="c1">## 101          6.3         3.3          6.0         2.5  virginica</span>
</pre></div>
</div>
<p>It is a mix of numeric and factor-type data.</p>
<p>The good news is that not only are data frames built on
<em>named lists</em> (e.g., to extract a column, we can refer to `<strong class="command">[[</strong>`),
but also many functions consider them <em>matrix-like</em>
(e.g., to select specific rows and columns, two indexes
can be passed to `<strong class="command">[</strong>` like in the preceding example).
Hence, it will soon turn out that we already know a lot about
performing basic data wrangling activities, even if we do not
fully realise it now.</p>
<section id="creating-data-frames">
<h2><span class="section-number">12.1. </span>Creating data frames<a class="headerlink" href="#creating-data-frames" title="Link to this heading">#</a></h2>
<section id="data-frame-and-as-data-frame">
<h3><span class="section-number">12.1.1. </span><strong class="command">data.frame</strong> and <strong class="command">as.data.frame</strong><a class="headerlink" href="#data-frame-and-as-data-frame" title="Link to this heading">#</a></h3>
<p>Most frequently, we create data frames based on a series of logical,
numeric, or character vectors of identical lengths.
In such a scenario, the <strong class="command">data.frame</strong> function is particularly
worthwhile.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span>
<span class="w">    </span><span class="n">c</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">d</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##       a b       c    d</span>
<span class="c1">## 1  TRUE 1 0.77437 spam</span>
<span class="c1">## 2 FALSE 2 0.19722 spam</span>
<span class="c1">## 3  TRUE 3 0.97801 eggs</span>
<span class="c1">## 4 FALSE 4 0.20133 spam</span>
<span class="c1">## 5  TRUE 5 0.36124 spam</span>
<span class="c1">## 6 FALSE 6 0.74261 eggs</span>
</pre></div>
</div>
<p>The shorter vectors were recycled.
We can verify that the diverse column types were retained and no coercion
was made by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;data.frame&#39;:	6 obs. of  4 variables:</span>
<span class="c1">##  $ a: logi  TRUE FALSE TRUE FALSE TRUE FALSE</span>
<span class="c1">##  $ b: int  1 2 3 4 5 6</span>
<span class="c1">##  $ c: num  0.774 0.197 0.978 0.201 0.361 ...</span>
<span class="c1">##  $ d: chr  &quot;spam&quot; &quot;spam&quot; &quot;eggs&quot; &quot;spam&quot; ...</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For many reasons (see, e.g., <a class="reference internal" href="#sec-stringsasfactors"><span class="std std-numref">Section 12.1.5</span></a>
and <a class="reference internal" href="#sec-df-representation"><span class="std std-numref">Section 12.1.6</span></a>), we recommend having
the type of each column always checked, e.g.,
by calling the <strong class="command">str</strong> function.</p>
</div>
<div style="margin-top: 1em"></div><p>Many objects, such as matrices, can easily be coerced to data frames
using particular <strong class="command">as.data.frame</strong> methods.
Here is an example matrix:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span>
<span class="w">        </span><span class="kc">NULL</span><span class="p">,</span><span class="w">        </span><span class="c1"># no row labels</span>
<span class="w">        </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># some column labels</span>
<span class="p">)))</span>
<span class="c1">##      u v</span>
<span class="c1">## [1,] 1 4</span>
<span class="c1">## [2,] 2 5</span>
<span class="c1">## [3,] 3 6</span>
</pre></div>
</div>
<p>Let’s convert it to a data frame:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w">  </span><span class="c1"># as.data.frame.matrix</span>
<span class="c1">##   u v</span>
<span class="c1">## 1 1 4</span>
<span class="c1">## 2 2 5</span>
<span class="c1">## 3 3 6</span>
</pre></div>
</div>
<p>Note that a matrix with no row labels is printed slightly differently
than a data frame with (as it will soon turn out) the default
<code class="docutils literal notranslate"><span class="pre">row.names</span></code>.</p>
<div style="margin-top: 1em"></div><p>Named lists are amongst other aspirants to a meaningful conversion.
Consider an example list where all elements are vectors
of the same length:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Map</span><span class="p">(</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Median</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]])</span>
<span class="p">))</span>
<span class="c1">## $setosa</span>
<span class="c1">##    Min Median   Mean    Max</span>
<span class="c1">##  4.300  5.000  5.006  5.800</span>
<span class="c1">##</span>
<span class="c1">## $versicolor</span>
<span class="c1">##    Min Median   Mean    Max</span>
<span class="c1">##  4.900  5.900  5.936  7.000</span>
<span class="c1">##</span>
<span class="c1">## $virginica</span>
<span class="c1">##    Min Median   Mean    Max</span>
<span class="c1">##  4.900  6.500  6.588  7.900</span>
</pre></div>
</div>
<p>Each list element will be turned into a separate column:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">  </span><span class="c1"># as.data.frame.list</span>
<span class="c1">##        setosa versicolor virginica</span>
<span class="c1">## Min     4.300      4.900     4.900</span>
<span class="c1">## Median  5.000      5.900     6.500</span>
<span class="c1">## Mean    5.006      5.936     6.588</span>
<span class="c1">## Max     5.800      7.000     7.900</span>
</pre></div>
</div>
<p>Sadly, <strong class="command">as.data.frame.list</strong> is not particularly
fond of lists of vectors of incompatible lengths:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">))</span>
<span class="c1">## Error in (function (..., row.names = NULL, check.rows = FALSE, check.names</span>
<span class="c1">##     = TRUE, : arguments imply differing number of rows: 1, 2, 3</span>
</pre></div>
</div>
<p>These vectors could have been recycled with a warning.
But they were not.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">21</span><span class="p">))</span><span class="w">  </span><span class="c1"># recycling rule okay</span>
<span class="c1">##   a  b  c</span>
<span class="c1">## 1 1 11 21</span>
<span class="c1">## 2 2 12 21</span>
<span class="c1">## 3 3 11 21</span>
<span class="c1">## 4 4 12 21</span>
</pre></div>
</div>
<p>The method for the S3 class <code class="docutils literal notranslate"><span class="pre">table</span></code> (mentioned in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>)
can be helpful as well. Here is an example contingency table together
with its <em>unstacked</em> (wide) version.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="s">&quot;vs&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">mtcars</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]]))</span>
<span class="c1">##</span>
<span class="c1">##      4  6  8</span>
<span class="c1">##   0  1  3 14</span>
<span class="c1">##   1 10  4  0</span>
<span class="nf">as.data.frame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w">  </span><span class="c1"># as.data.frame.table; see the stringsAsFactors note below!</span>
<span class="c1">##   Var1 Var2 Freq</span>
<span class="c1">## 1    0    4    1</span>
<span class="c1">## 2    1    4   10</span>
<span class="c1">## 3    0    6    3</span>
<span class="c1">## 4    1    6    4</span>
<span class="c1">## 5    0    8   14</span>
<span class="c1">## 6    1    8    0</span>
</pre></div>
</div>
<p><strong class="command">as.data.frame.table</strong> is so handy that
we might want to call it directly on any array.
This way, we can convert it from the wide format
to the long (tall) one; see <a class="reference internal" href="#sec-reshape"><span class="std std-numref">Section 12.3.6</span></a> for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The aforementioned method is based on <strong class="command">expand.grid</strong>,
which determines all combinations of a given series of vectors.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">expand.grid</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span><span class="w">  </span><span class="c1"># see the stringsAsFactors note below!</span>
<span class="c1">##   Var1 Var2</span>
<span class="c1">## 1    1    a</span>
<span class="c1">## 2    2    a</span>
<span class="c1">## 3    1    b</span>
<span class="c1">## 4    2    b</span>
<span class="c1">## 5    1    c</span>
<span class="c1">## 6    2    c</span>
</pre></div>
</div>
</div>
<p>Overall, many classes of objects can be included<a class="footnote-reference brackets" href="#footcolattr" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>
in a data frame. The popular choices include
<code class="docutils literal notranslate"><span class="pre">Date</span></code>, <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code>, and <code class="docutils literal notranslate"><span class="pre">factor</span></code>.</p>
<div class="proof proof-type-example" id="id17">

    <div class="proof-title">
        <span class="proof-type">Example 12.1</span>
        
    </div><div class="proof-content">
<p>It is worth noting that <strong class="command">format</strong> is used whilst printing
the columns. Here is its custom method for what we would like to
call from now on the S3 class <code class="docutils literal notranslate"><span class="pre">spam</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">format.spam</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Testing data frame printing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lovely&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yummy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delicious&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;spam&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">c</span><span class="o">=</span><span class="nf">Sys.Date</span><span class="p">()</span><span class="m">+1</span><span class="o">:</span><span class="m">3</span>
<span class="p">)</span>
<span class="c1">##             a     b          c</span>
<span class="c1">## 1    &lt;lovely&gt;  spam 2024-01-29</span>
<span class="c1">## 2     &lt;yummy&gt; bacon 2024-01-30</span>
<span class="c1">## 3 &lt;delicious&gt;  spam 2024-01-31</span>
</pre></div>
</div>
</div></div></section>
<section id="cbind-data-frame-and-rbind-data-frame">
<span id="sec-cbind-data-frame"></span><h3><span class="section-number">12.1.2. </span><strong class="command">cbind.data.frame</strong> and <strong class="command">rbind.data.frame</strong><a class="headerlink" href="#cbind-data-frame-and-rbind-data-frame" title="Link to this heading">#</a></h3>
<p>There are data frame-specific versions of
<strong class="command">cbind</strong> or <strong class="command">rbind</strong> (which we discussed
in the context of stacking matrices; <a class="reference internal" href="230-matrix.html#sec-cbind-matrix"><span class="std std-numref">Section 11.1.2</span></a>).
They are used quite eagerly: <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;cbind&quot;)</span></code> states that
they will be referred to if at least<a class="footnote-reference brackets" href="#footcbinddf" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>
one of its arguments is a data frame, and the other arguments
are atomic vectors or lists (possibly with the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute).
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">)]</span><span class="w">  </span><span class="c1"># whatever</span>
<span class="nf">cbind</span><span class="p">(</span><span class="n">Yummy</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="c1">##     Yummy Sepal.Length    Species</span>
<span class="c1">## 1    TRUE          5.1     setosa</span>
<span class="c1">## 51  FALSE          7.0 versicolor</span>
<span class="c1">## 101  TRUE          6.3  virginica</span>
</pre></div>
</div>
<p>It added a new column to a data frame <code class="docutils literal notranslate"><span class="pre">x</span></code>. Moreover:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;virginica&quot;</span><span class="p">))</span>
<span class="c1">##     Sepal.Length    Species</span>
<span class="c1">## 1            5.1     setosa</span>
<span class="c1">## 51           7.0 versicolor</span>
<span class="c1">## 101          6.3  virginica</span>
<span class="c1">## 11          42.0  virginica</span>
</pre></div>
</div>
<p>It added a new row. Note that columns are of different types.
Hence, the values to row-bind had to be provided as a list.</p>
<p>The generic vector used as a new row specifier can also be named.
It can consist of sequences of length greater than one that are
given in any order:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="n">Species</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;virginica&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;setosa&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Sepal.Length</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##     Sepal.Length    Species</span>
<span class="c1">## 1            5.1     setosa</span>
<span class="c1">## 51           7.0 versicolor</span>
<span class="c1">## 101          6.3  virginica</span>
<span class="c1">## 11          42.0  virginica</span>
<span class="c1">## 2            7.0     setosa</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>A direct referral to <strong class="command">cbind.data.frame</strong>
and <strong class="command">rbind.data.frame</strong> will sometimes be necessary.
Consider an example list of atomic vectors:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we call the generic, which dispatches to the default method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="c1">##      a  b  c</span>
<span class="c1">## [1,] 1 11 21</span>
<span class="c1">## [2,] 2 12 22</span>
<span class="c1">## [3,] 3 13 23</span>
</pre></div>
</div>
<p>It created a matrix. If we want to ensure we garner a data frame,
we need to write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">cbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="c1">##   a  b  c</span>
<span class="c1">## 1 1 11 21</span>
<span class="c1">## 2 2 12 22</span>
<span class="c1">## 3 3 13 23</span>
</pre></div>
</div>
<p>This is useful for fetching outputs from <strong class="command">Map</strong> et al., as they are
wrapped inside a list. Here is a fancy way to obtain an illustrative list:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unname</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">  </span><span class="c1"># objects are of different types, hence a list</span>
<span class="w">        </span><span class="n">Sepal.Length</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">]]),</span>
<span class="w">        </span><span class="n">Sepal.Width</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">]]),</span>
<span class="w">        </span><span class="n">Species</span><span class="o">=</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]][</span><span class="m">1</span><span class="p">]</span><span class="w">  </span><span class="c1"># all are the same, so the first will do</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]])</span><span class="w">  </span><span class="c1"># split.data.frame; see below</span>
<span class="p">))</span>
<span class="nf">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="c1">## List of 3</span>
<span class="c1">##  $ :List of 3</span>
<span class="c1">##   ..$ Sepal.Length: num 5.01</span>
<span class="c1">##   ..$ Sepal.Width : num 3.43</span>
<span class="c1">##   ..$ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1</span>
<span class="c1">##  $ :List of 3</span>
<span class="c1">##   ..$ Sepal.Length: num 5.94</span>
<span class="c1">##   ..$ Sepal.Width : num 2.77</span>
<span class="c1">##   ..$ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 2</span>
<span class="c1">##  $ :List of 3</span>
<span class="c1">##   ..$ Sepal.Length: num 6.59</span>
<span class="c1">##   ..$ Sepal.Width : num 2.97</span>
<span class="c1">##   ..$ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 3</span>
</pre></div>
</div>
<p>We may now turn it into a data frame by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span>
<span class="c1">##   Sepal.Length Sepal.Width    Species</span>
<span class="c1">## 1        5.006       3.428     setosa</span>
<span class="c1">## 2        5.936       2.770 versicolor</span>
<span class="c1">## 3        6.588       2.974  virginica</span>
</pre></div>
</div>
<p>On the other hand, <strong class="command">do.call</strong><code class="code docutils literal notranslate"><span class="pre">(rbind,</span> <span class="pre">l)</span></code> does not return
an amiable object type:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span>
<span class="c1">##      Sepal.Length Sepal.Width Species</span>
<span class="c1">## [1,] 5.006        3.428       setosa</span>
<span class="c1">## [2,] 5.936        2.77        versicolor</span>
<span class="c1">## [3,] 6.588        2.974       virginica</span>
</pre></div>
</div>
<p>Despite the pretty face, it is a matrix… over a list:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">))</span>
<span class="c1">## List of 9</span>
<span class="c1">##  $ : num 5.01</span>
<span class="c1">##  $ : num 5.94</span>
<span class="c1">##  $ : num 6.59</span>
<span class="c1">##  $ : num 3.43</span>
<span class="c1">##  $ : num 2.77</span>
<span class="c1">##  $ : num 2.97</span>
<span class="c1">##  $ : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1</span>
<span class="c1">##  $ : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 2</span>
<span class="c1">##  $ : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 3</span>
<span class="c1">##  - attr(*, &quot;dim&quot;)= int [1:2] 3 3</span>
<span class="c1">##  - attr(*, &quot;dimnames&quot;)=List of 2</span>
<span class="c1">##   ..$ : NULL</span>
<span class="c1">##   ..$ : chr [1:3] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot; &quot;Species&quot;</span>
</pre></div>
</div>
</section>
<section id="reading-data-frames">
<h3><span class="section-number">12.1.3. </span>Reading data frames<a class="headerlink" href="#reading-data-frames" title="Link to this heading">#</a></h3>
<p>Structured data can be imported from external sources, such as CSV/TSV
(comma/tab-separated values) or HDF5 files,
relational databases supporting SQL (see <a class="reference internal" href="#sec-sql"><span class="std std-numref">Section 12.1.4</span></a>),
web APIs (e.g., through the <strong class="program">curl</strong> and <strong class="program">jsonlite</strong>
packages), spreadsheets <span id="id6">[<a class="reference internal" href="999-bibliography.html#id14" title="R Development Core Team. (2023).  R Data Import/Export. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-data.html.">66</a>]</span>, and so on.</p>
<p>In particular, <strong class="command">read.csv</strong> and the like
fetch data from plain text files
consisting of records, where commas, semicolons, tabs, etc. separate
the fields.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">  </span><span class="c1"># example data frame</span>
<span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tempfile</span><span class="p">()</span><span class="w">  </span><span class="c1"># temporary file name</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span><span class="c1"># export</span>
</pre></div>
</div>
<p>It created a CSV file that looks like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cat</span><span class="p">(</span><span class="nf">readLines</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># print file contents</span>
<span class="c1">## &quot;a&quot;,&quot;b&quot;</span>
<span class="c1">## 0.287577520124614,TRUE</span>
<span class="c1">## 0.788305135443807,FALSE</span>
<span class="c1">## 0.4089769218117,TRUE</span>
</pre></div>
</div>
<p>which can be read by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">read.csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">##         a     b</span>
<span class="c1">## 1 0.28758  TRUE</span>
<span class="c1">## 2 0.78831 FALSE</span>
<span class="c1">## 3 0.40898  TRUE</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.2</span>
        
    </div><div class="proof-content">
<p>Check out <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;read.table&quot;)</span></code> for a long list of tunable parameters,
especially: <code class="docutils literal notranslate"><span class="pre">sep</span></code>, <code class="docutils literal notranslate"><span class="pre">dec</span></code>, <code class="docutils literal notranslate"><span class="pre">quote</span></code>, <code class="docutils literal notranslate"><span class="pre">header</span></code>, <code class="docutils literal notranslate"><span class="pre">comment.char</span></code>,
and <code class="docutils literal notranslate"><span class="pre">row.names</span></code>. Further, note that reading from compressed files
and interned URLs is supported directly.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>CSV is the most portable and user-friendly format for exchanging
matrix-like objects between different programs and computing languages
(Python, Julia, LibreOffice Calc, etc.).
Such files can be opened in any text editor.</p>
<p>Also, as mentioned in <a class="reference internal" href="180-flow.html#sec-time-complexity"><span class="std std-numref">Section 8.3.5</span></a>,
we can process data frames chunk by chunk.
This is beneficial especially when data do not fit into memory
(compare the <code class="docutils literal notranslate"><span class="pre">nrows</span></code> argument to <strong class="command">read.csv</strong>).</p>
</div>
</section>
<section id="interfacing-relational-databases-and-querying-with-sql">
<span id="sec-sql"></span><h3><span class="section-number">12.1.4. </span>Interfacing relational databases and querying with SQL (*)<a class="headerlink" href="#interfacing-relational-databases-and-querying-with-sql" title="Link to this heading">#</a></h3>
<p>The <strong class="program">DBI</strong> package provides a universal interface
for many database management systems
whose drivers are implemented in add-ons such as
<strong class="program">RSQLite</strong>, <strong class="program">RMariaDB</strong>, <strong class="program">RPostgreSQL</strong>,
etc., or, more generally,
<strong class="program">RODBC</strong> or <strong class="program">odbc</strong>. For more details,
see Section 4 of <span id="id7">[<a class="reference internal" href="999-bibliography.html#id14" title="R Development Core Team. (2023).  R Data Import/Export. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-data.html.">66</a>]</span>.</p>
<div class="proof proof-type-example" id="id19">

    <div class="proof-title">
        <span class="proof-type">Example 12.3</span>
        
    </div><div class="proof-content">
<p>Let’s play with an in-memory (volatile) instance of an SQLite database.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;DBI&quot;</span><span class="p">)</span>
<span class="n">con</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dbConnect</span><span class="p">(</span><span class="n">RSQLite</span><span class="o">::</span><span class="nf">SQLite</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;:memory:&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It returned an object representing a database connection
which we can refer to in further communication.
An easy way to create a database table is to call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">dbWriteTable</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mtcars&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mtcars</span><span class="p">)</span><span class="w">  </span><span class="c1"># `mtcars` is a toy data frame</span>
</pre></div>
</div>
<p>Alternatively, we could have called <strong class="command">dbExecute</strong>
to send SQL statements such as “<code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">...</span></code>” followed by a series
of “<code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">...</span></code>”.</p>
<p>We can now retrieve some data:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span>
<span class="s">    SELECT cyl, vs, AVG(mpg) AS mpg_ave, AVG(hp) AS hp_ave</span>
<span class="s">    FROM mtcars</span>
<span class="s">    GROUP BY cyl, vs</span>
<span class="s">&quot;</span><span class="p">)</span>
<span class="c1">##   cyl vs mpg_ave hp_ave</span>
<span class="c1">## 1   4  0  26.000  91.00</span>
<span class="c1">## 2   4  1  26.730  81.80</span>
<span class="c1">## 3   6  0  20.567 131.67</span>
<span class="c1">## 4   6  1  19.125 115.25</span>
<span class="c1">## 5   8  0  15.100 209.21</span>
</pre></div>
</div>
<p>It gave us an ordinary R data frame. We can process it in the same
fashion as any other object of this kind.</p>
<p>At the end, the database connection must be closed.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">dbDisconnect</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.4</span>
        
    </div><div class="proof-content">
<p>Database passwords must never be stored in plain text files,
let alone in R scripts in version-controlled repositories.
Consider a few ways to fetch credentials programmatically:</p>
<ul class="simple">
<li><p>using environment variables (see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Sys.getenv&quot;)</span></code>),</p></li>
<li><p>using the <strong class="program">keyring</strong> package,</p></li>
<li><p>calling <strong class="command">system2</strong> (<a class="reference internal" href="170-function.html#sec-external-programs"><span class="std std-numref">Section 7.3.2</span></a>)
to retrieve it from the system keyring
(e.g., the <strong class="program">keyring</strong> package for Python provides
a platform-independent command-line utility).</p></li>
</ul>
</div></div></section>
<section id="strings-as-factors">
<span id="sec-stringsasfactors"></span><h3><span class="section-number">12.1.5. </span>Strings as factors?<a class="headerlink" href="#strings-as-factors" title="Link to this heading">#</a></h3>
<p>Some functions related to data frames automatically convert character
vectors to factors. This behaviour is frequently controlled by
and argument named <code class="docutils literal notranslate"><span class="pre">stringsAsFactors</span></code>.
It can be particularly problematic because, when printed,
factor and character columns look identical:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;U&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;V&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;U&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;V&quot;</span><span class="p">)))</span>
<span class="c1">##   a b</span>
<span class="c1">## 1 U U</span>
<span class="c1">## 2 V V</span>
</pre></div>
</div>
<p>We recall from <a class="reference internal" href="220-s3.html#sec-factor"><span class="std std-numref">Section 10.3.2</span></a> that factors can be nasty.
For example, passing factors as indexers in `<strong class="command">[</strong>`
or converting them with <strong class="command">as.numeric</strong> might give counterintuitive
results. Also, when we want to extend factors by previously unobserved data,
new levels must be added manually. This can cause unexpected behaviour
in contexts such as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;W&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;W&quot;</span><span class="p">))</span>
<span class="c1">## Warning in `[&lt;-.factor`(`*tmp*`, ri, value = &quot;W&quot;): invalid factor level,</span>
<span class="c1">##     NA generated</span>
<span class="c1">##      a b</span>
<span class="c1">## 1    U U</span>
<span class="c1">## 2    V V</span>
<span class="c1">## 3 &lt;NA&gt; W</span>
</pre></div>
</div>
<p>Therefore, always having the data types checked is a praiseworthy habit.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &#39;data.frame&#39;:	2 obs. of  2 variables:</span>
<span class="c1">##  $ a: Factor w/ 2 levels &quot;U&quot;,&quot;V&quot;: 1 2</span>
<span class="c1">##  $ b: chr  &quot;U&quot; &quot;V&quot;</span>
</pre></div>
</div>
<p>Before R 4.0, certain functions,
including <strong class="command">data.frame</strong> and <strong class="command">read.csv</strong>
had the <code class="docutils literal notranslate"><span class="pre">stringsAsFactors</span></code> argument defaulting to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.
It is no longer the case.
However, exceptions to this rule still exist, e.g.,
including <strong class="command">as.data.frame.table</strong> and <strong class="command">expand.grid</strong>.
Besides, some example data frames continue to enjoy factor-typed columns, e.g.:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]])</span>
<span class="c1">## [1] &quot;factor&quot;</span>
</pre></div>
</div>
<p>In particular, adding a new flower variety might be oblique:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">iris2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># example subset</span>
<span class="nf">rbind</span><span class="p">(</span><span class="n">iris2</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;croatica&quot;</span><span class="p">))</span>
<span class="c1">## Warning in `[&lt;-.factor`(`*tmp*`, ri, value = &quot;croatica&quot;): invalid factor</span>
<span class="c1">##     level, NA generated</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2    setosa</span>
<span class="c1">## 101          6.3         3.3            6         2.5 virginica</span>
<span class="c1">## 3              6           3            3           2      &lt;NA&gt;</span>
</pre></div>
</div>
<p>Compare it to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">levels</span><span class="p">(</span><span class="n">iris2</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]])[</span><span class="nf">nlevels</span><span class="p">(</span><span class="n">iris2</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]])</span><span class="m">+1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;croatica&quot;</span>
<span class="nf">rbind</span><span class="p">(</span><span class="n">iris2</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;croatica&quot;</span><span class="p">))</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2    setosa</span>
<span class="c1">## 101          6.3         3.3            6         2.5 virginica</span>
<span class="c1">## 3              6           3            3           2  croatica</span>
</pre></div>
</div>
</section>
<section id="internal-representation">
<span id="sec-df-representation"></span><h3><span class="section-number">12.1.6. </span>Internal representation<a class="headerlink" href="#internal-representation" title="Link to this heading">#</a></h3>
<p>Objects of the S3 class <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> are erected on lists
of vectors of the same length or matrices with identical row counts.
Each list element defines a column or column group.</p>
<p>Apart from <code class="docutils literal notranslate"><span class="pre">class</span></code>, data frames must be equipped with the following
special attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code> – a character vector (as usual in any named list)
that gives the column labels,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">row.names</span></code> – a character or integer vector
with no duplicates nor missing values, doing what is advertised.</p></li>
</ul>
<p>Therefore, a data frame can be created from scratch by
calling, for example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">structure</span><span class="p">(</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">),</span><span class="w">  </span><span class="c1"># sets the `names` attribute</span>
<span class="w">    </span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;data.frame&quot;</span>
<span class="p">)</span>
<span class="c1">##    a  b</span>
<span class="c1">## 1 11 21</span>
<span class="c1">## 2 12 22</span>
<span class="c1">## 3 13 23</span>
</pre></div>
</div>
<p>Here is a data frame based on a list of length five,
a matrix with five rows, and a numeric vector with five items.
We added some fancy row names on top:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">structure</span><span class="p">(</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span>
<span class="w">        </span><span class="n">a</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="nf">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">1</span><span class="p">)),</span>
<span class="w">        </span><span class="n">b</span><span class="o">=</span><span class="nf">cbind</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="m">21</span><span class="o">:</span><span class="m">25</span><span class="p">),</span>
<span class="w">        </span><span class="n">c</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">row.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ham&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aubergine&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;data.frame&quot;</span>
<span class="p">)</span>
<span class="c1">##                        a b.u b.v       c</span>
<span class="c1">## spam                   1  11  21 0.28758</span>
<span class="c1">## bacon               1, 2  12  22 0.78831</span>
<span class="c1">## eggs             1, 2, 3  13  23 0.40898</span>
<span class="c1">## ham                       14  24 0.88302</span>
<span class="c1">## aubergine -4, -3, -2, -1  15  25 0.94047</span>
</pre></div>
</div>
<p>In general, the columns of the type <code class="docutils literal notranslate"><span class="pre">list</span></code> can contain anything, e.g., other
lists or R functions. Including atomic vectors of varying lengths, just like
above, permits us to create something à la <em>ragged arrays</em>.</p>
<p>The issue with matrix entries, on the other hand,
is that they appear as if they were
many columns. Still, as it will turn out in the sequel,
they are often treated as a single complex column, e.g.,
by the index operator (see <a class="reference internal" href="#sec-df-idx"><span class="std std-numref">Section 12.2</span></a>).
Therefore, from this perspective, the aforementioned data frame has three columns,
not four. Such compound columns can be output by <strong class="command">aggregate</strong>
(see <a class="reference internal" href="#sec-df-ops"><span class="std std-numref">Section 12.3</span></a>), amongst others.
They are valuable in certain contexts:
the <em>column groups</em> can be easily accessed as a whole
and batch-processed in the same way.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Alas, data frames with list or matrix columns cannot be
created with the <strong class="command">data.frame</strong> nor <strong class="command">cbind</strong>
functions. This might explain why they are less popular.
This behaviour is dictated by the underlying
<strong class="command">as.data.frame</strong> methods, which they both call.
As a curiosity, see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;I&quot;)</span></code>, though.</p>
</div>
<div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.5</span>
        
    </div><div class="proof-content">
<p>Verify that if a data frame carries a matrix column,
this matrix does not need to have any column names (the second
element of <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>).</p>
</div></div><div style="margin-top: 1em"></div><p>The <code class="docutils literal notranslate"><span class="pre">names</span></code> and <code class="docutils literal notranslate"><span class="pre">row.names</span></code> attributes are special in the sense
of <a class="reference internal" href="140-list.html#sec-special-attributes"><span class="std std-numref">Section 4.4.3</span></a>. In particular, they
can be accessed or modified via the dedicated functions.</p>
<p>It is worth noting that <strong class="command">row.names</strong><code class="code docutils literal notranslate"><span class="pre">(df)</span></code> always returns
a character vector, even when <strong class="command">attr</strong><code class="code docutils literal notranslate"><span class="pre">(df,</span> <span class="pre">&quot;row.names&quot;)</span></code>
is integer.
Further, calling “<strong class="command">row.names</strong><code class="code docutils literal notranslate"><span class="pre">(df)</span> <span class="pre">&lt;-</span> <span class="pre">NULL</span></code>” will
reset<a class="footnote-reference brackets" href="#footrownamesrepl" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> this attribute to the most commonly desired case
of consecutive natural numbers. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="p">])</span><span class="w">  </span><span class="c1"># comes with some sad row names</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2     setosa</span>
<span class="c1">## 51           7.0         3.2          4.7         1.4 versicolor</span>
<span class="c1">## 101          6.3         3.3          6.0         2.5  virginica</span>
<span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">  </span><span class="c1"># reset to seq_len(NROW(x))</span>
<span class="c1">##   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="c1">## 1          5.1         3.5          1.4         0.2     setosa</span>
<span class="c1">## 2          7.0         3.2          4.7         1.4 versicolor</span>
<span class="c1">## 3          6.3         3.3          6.0         2.5  virginica</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.6</span>
        
    </div><div class="proof-content">
<p>Implement your version of <strong class="command">expand.grid</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.7</span>
        
    </div><div class="proof-content">
<p>Write a version of <strong class="command">xtabs</strong> that does not rely on a formula interface
(compare <a class="reference internal" href="220-s3.html#sec-formula-intro"><span class="std std-numref">Section 10.3.4</span></a>). Allow three parameters: a data frame,
the name of the “counts” column, and the names of the cross-classifying
factors. Hence,
<strong class="command">my_xtabs</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">&quot;Freq&quot;,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Var1&quot;,</span> <span class="pre">&quot;Var2&quot;))</span></code>
should be equivalent to
<strong class="command">xtabs</strong><code class="code docutils literal notranslate"><span class="pre">(Freq~Var1+Var2,</span> <span class="pre">x)</span></code>.</p>
</div></div></section>
</section>
<section id="data-frame-subsetting">
<span id="sec-df-idx"></span><h2><span class="section-number">12.2. </span>Data frame subsetting<a class="headerlink" href="#data-frame-subsetting" title="Link to this heading">#</a></h2>
<section id="data-frames-are-lists">
<h3><span class="section-number">12.2.1. </span>Data frames are lists<a class="headerlink" href="#data-frames-are-lists" title="Link to this heading">#</a></h3>
<p>A data frame is a named list whose elements represent individual
columns. Therefore<a class="footnote-reference brackets" href="#footnotedflist" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>, <strong class="command">length</strong> yields the number of
columns and <strong class="command">names</strong> gives their respective labels.</p>
<p>Let’s play around with a data frame:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">c</span><span class="o">=</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">],</span>
<span class="w">    </span><span class="n">d1</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">    </span><span class="n">d2</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##          a         b c    d1    d2</span>
<span class="c1">## 1 0.287578  0.070508 A FALSE FALSE</span>
<span class="c1">## 2 0.788305  0.129288 B  TRUE  TRUE</span>
<span class="c1">## 3 0.408977  1.715065 C FALSE FALSE</span>
<span class="c1">## 4 0.883017  0.460916 D    NA  TRUE</span>
<span class="c1">## 5 0.940467 -1.265061 E FALSE FALSE</span>
<span class="c1">## 6 0.045556 -0.686853 F    NA  TRUE</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># each data frame is a list</span>
<span class="c1">## [1] &quot;list&quot;</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># the number of columns</span>
<span class="c1">## [1] 5</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">   </span><span class="c1"># column labels</span>
<span class="c1">## [1] &quot;a&quot;  &quot;b&quot;  &quot;c&quot;  &quot;d1&quot; &quot;d2&quot;</span>
</pre></div>
</div>
<p>The one-argument versions of extract and index
operators behave as expected. `<strong class="command">[[</strong>` fetches
(looks inside) the contents of a given column:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="w">  </span><span class="c1"># or x[[1]]</span>
<span class="c1">## [1] 0.287578 0.788305 0.408977 0.883017 0.940467 0.045556</span>
</pre></div>
</div>
<p>`<strong class="command">[</strong>` returns a data frame (a list with extras):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="w">  </span><span class="c1"># or x[1]; a data frame with one column</span>
<span class="c1">##          a</span>
<span class="c1">## 1 0.287578</span>
<span class="c1">## 2 0.788305</span>
<span class="c1">## 3 0.408977</span>
<span class="c1">## 4 0.883017</span>
<span class="c1">## 5 0.940467</span>
<span class="c1">## 6 0.045556</span>
<span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)]</span>
<span class="c1">##          a         b    d1</span>
<span class="c1">## 1 0.287578  0.070508 FALSE</span>
<span class="c1">## 2 0.788305  0.129288  TRUE</span>
<span class="c1">## 3 0.408977  1.715065 FALSE</span>
<span class="c1">## 4 0.883017  0.460916    NA</span>
<span class="c1">## 5 0.940467 -1.265061 FALSE</span>
<span class="c1">## 6 0.045556 -0.686853    NA</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Just like with lists, the replacement versions of these
operators can add new columns or modify existing ones.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">  </span><span class="c1"># example data frame</span>
<span class="c1">##         a        b c    d1    d2</span>
<span class="c1">## 1 0.28758 0.070508 A FALSE FALSE</span>
<span class="n">y</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">y</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]],</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># replaces the column with new content</span>
<span class="n">y</span><span class="p">[[</span><span class="s">&quot;b&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">  </span><span class="c1"># removes the column, like, totally</span>
<span class="n">y</span><span class="p">[[</span><span class="s">&quot;e&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="o">*</span><span class="n">y</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="o">^</span><span class="m">2</span><span class="w">  </span><span class="c1"># adds a new column at the end</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">##     a c    d1    d2   e</span>
<span class="c1">## 1 0.3 A FALSE FALSE 0.9</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id24">

    <div class="proof-title">
        <span class="proof-type">Example 12.8</span>
        
    </div><div class="proof-content">
<p>Some spam for thought to show how much we already know. Here are a few common
scenarios involving indexing.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">  </span><span class="c1"># example data frame</span>
<span class="c1">##         a        b c    d1    d2</span>
<span class="c1">## 1 0.28758 0.070508 A FALSE FALSE</span>
</pre></div>
</div>
<p>Move the column <code class="docutils literal notranslate"><span class="pre">a</span></code> to the end:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="nf">unique</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">fromLast</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)]</span>
<span class="c1">##          b c    d1    d2       a</span>
<span class="c1">## 1 0.070508 A FALSE FALSE 0.28758</span>
</pre></div>
</div>
<p>Remove the columns <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="nf">match</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span><span class="w">  </span><span class="c1"># or y[setdiff(names(y), c(&quot;a&quot;, &quot;c&quot;))]</span>
<span class="c1">##          b    d1    d2</span>
<span class="c1">## 1 0.070508 FALSE FALSE</span>
</pre></div>
</div>
<p>Select all columns between <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="nf">match</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">:</span><span class="nf">match</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
<span class="c1">##         a        b c</span>
<span class="c1">## 1 0.28758 0.070508 A</span>
</pre></div>
</div>
<p>Fetch the columns with names starting with <code class="docutils literal notranslate"><span class="pre">d</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="nf">grep</span><span class="p">(</span><span class="s">&quot;^d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">perl</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)]</span>
<span class="c1">##      d1    d2</span>
<span class="c1">## 1 FALSE FALSE</span>
</pre></div>
</div>
<p>Change the name of column <code class="docutils literal notranslate"><span class="pre">c</span></code> to <code class="docutils literal notranslate"><span class="pre">z</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;z&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1"># `names&lt;-`(y, `[&lt;-`(names(y), names(y) == &quot;c&quot;, &quot;z&quot;))</span>
<span class="c1">##         a        b z    d1    d2</span>
<span class="c1">## 1 0.28758 0.070508 A FALSE FALSE</span>
</pre></div>
</div>
<p>Change names: <code class="docutils literal notranslate"><span class="pre">d2</span></code> to <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">d1</span></code> to <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="nf">match</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;d2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;d1&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;u&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">##         a        b z     u     v</span>
<span class="c1">## 1 0.28758 0.070508 A FALSE FALSE</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some users prefer the `<strong class="command">$</strong>` operator
over  `<strong class="command">[[</strong>`, but we do not.
By default, the former supports partial matching of column names
which might be appealing when R is used interactively.
Nonetheless, it does not work on matrices nor it
allows for programmatically generated names. It is also
trickier to use on not syntactically valid labels;
compare <a class="reference internal" href="210-design.html#sec-backtick"><span class="std std-numref">Section 9.3.1</span></a>.</p>
</div>
<div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.9</span>
        
    </div><div class="proof-content">
<p>Write a function <strong class="command">rename</strong> that changes
the names of columns based on a translation table
given in a <code class="docutils literal notranslate"><span class="pre">from=to</span></code> fashion (we have already solved a similar exercise
in <a class="reference internal" href="210-design.html#chap-design"><span class="std std-numref">Chapter 9</span></a>). For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">rename</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="s">&quot;new_c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="s">&quot;new_a&quot;</span><span class="p">)</span>
<span class="c1">##     new_a        b new_c    d1    d2</span>
<span class="c1">## 1 0.28758 0.070508     A FALSE FALSE</span>
</pre></div>
</div>
</div></div></section>
<section id="data-frames-are-matrix-like">
<h3><span class="section-number">12.2.2. </span>Data frames are matrix-like<a class="headerlink" href="#data-frames-are-matrix-like" title="Link to this heading">#</a></h3>
<p>Data frames can be considered “generalised” matrices. They store data
of any kind (possibly mixed) organised in a <em>tabular</em> fashion.
A few functions mentioned in the previous chapter are overloaded for
the data frame case. They include: <strong class="command">dim</strong> (despite the lack of the
<code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute), <strong class="command">NROW</strong>, <strong class="command">NCOL</strong>, and
<strong class="command">dimnames</strong> (which is, of course, based on <code class="docutils literal notranslate"><span class="pre">row.names</span></code>
and <code class="docutils literal notranslate"><span class="pre">names</span></code>). For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">c</span><span class="o">=</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">],</span>
<span class="w">    </span><span class="n">d1</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">    </span><span class="n">d2</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##          a         b c    d1    d2</span>
<span class="c1">## 1 0.287578  0.070508 A FALSE FALSE</span>
<span class="c1">## 2 0.788305  0.129288 B  TRUE  TRUE</span>
<span class="c1">## 3 0.408977  1.715065 C FALSE FALSE</span>
<span class="c1">## 4 0.883017  0.460916 D    NA  TRUE</span>
<span class="c1">## 5 0.940467 -1.265061 E FALSE FALSE</span>
<span class="c1">## 6 0.045556 -0.686853 F    NA  TRUE</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># the number of rows and columns</span>
<span class="c1">## [1] 6 5</span>
<span class="nf">dimnames</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># row and column labels</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] &quot;a&quot;  &quot;b&quot;  &quot;c&quot;  &quot;d1&quot; &quot;d2&quot;</span>
</pre></div>
</div>
<p>In addition to the list-like behaviour, which only allows for
dealing with particular columns or their groups,
the `<strong class="command">[</strong>` operator can also take two indexers:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># first two rows</span>
<span class="c1">##         a        b c    d1    d2</span>
<span class="c1">## 1 0.28758 0.070508 A FALSE FALSE</span>
<span class="c1">## 2 0.78831 0.129288 B  TRUE  TRUE</span>
<span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.3</span><span class="w">  </span><span class="o">&amp;</span><span class="w">  </span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">]</span><span class="w">  </span><span class="c1"># or use x[, &quot;a&quot;]</span>
<span class="c1">##         a c    d1    d2</span>
<span class="c1">## 2 0.78831 B  TRUE  TRUE</span>
<span class="c1">## 3 0.40898 C FALSE FALSE</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Recall the <code class="docutils literal notranslate"><span class="pre">drop</span></code> argument to `<strong class="command">[</strong>` and its effects
on matrix indexing (<a class="reference internal" href="230-matrix.html#sec-index-matrix-drop"><span class="std std-numref">Section 11.2.4</span></a>). In the current case,
its behaviour will be similar with regard to the
operations on individual columns:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">              </span><span class="c1"># synonym: x[[1]] because drop=TRUE</span>
<span class="c1">## [1] 0.287578 0.788305 0.408977 0.883017 0.940467 0.045556</span>
<span class="n">x</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span><span class="w">  </span><span class="c1"># synonym: x[1]</span>
<span class="c1">##          a</span>
<span class="c1">## 1 0.287578</span>
<span class="c1">## 2 0.788305</span>
<span class="c1">## 3 0.408977</span>
<span class="c1">## 4 0.883017</span>
<span class="c1">## 5 0.940467</span>
<span class="c1">## 6 0.045556</span>
</pre></div>
</div>
<p>When we extract a single row and more than one column,
<code class="docutils literal notranslate"><span class="pre">drop</span></code> does not apply. It is because columns (unlike in matrices)
can potentially be of different types:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w">  </span><span class="c1"># two numeric columns but the result is still a numeric</span>
<span class="c1">##         a        b</span>
<span class="c1">## 1 0.28758 0.070508</span>
</pre></div>
</div>
<p>However:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">  </span><span class="c1"># a single value</span>
<span class="c1">## [1] 0.28758</span>
<span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span><span class="w">  </span><span class="c1"># a data frame with one row and one column</span>
<span class="c1">##         a</span>
<span class="c1">## 1 0.28758</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once again, let’s take note of logical indexing in the presence of
missing values:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;d1&quot;</span><span class="p">]],</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># `d1` is of the type logical</span>
<span class="c1">##            a       b    c   d1   d2</span>
<span class="c1">## 2    0.78831 0.12929    B TRUE TRUE</span>
<span class="c1">## NA        NA      NA &lt;NA&gt;   NA   NA</span>
<span class="c1">## NA.1      NA      NA &lt;NA&gt;   NA   NA</span>
<span class="n">x</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;d1&quot;</span><span class="p">]]),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># `which` drops missing values</span>
<span class="c1">##         a       b c   d1   d2</span>
<span class="c1">## 2 0.78831 0.12929 B TRUE TRUE</span>
</pre></div>
</div>
<p>The default behaviour is consistent with many other R functions.
It explicitly indicates that something is missing.
After all, when we select a “don’t know”, the result is unknown as well.
Regretfully, this comes with no warning.
As we seldom check missing values in the outputs manually,
our absent-mindedness can lead to code bugs.</p>
</div>
<p>By far, we might have already noted that
the index operator adjusts (not: resets) the <code class="docutils literal notranslate"><span class="pre">row.names</span></code>
attribute. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">xs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="p">])</span>
<span class="c1">##         a        b c    d1    d2</span>
<span class="c1">## 5 0.94047 -1.26506 E FALSE FALSE</span>
<span class="c1">## 4 0.88302  0.46092 D    NA  TRUE</span>
<span class="c1">## 2 0.78831  0.12929 B  TRUE  TRUE</span>
</pre></div>
</div>
<p>It is a version of <code class="docutils literal notranslate"><span class="pre">x</span></code> comprised of the top three values in
the <code class="docutils literal notranslate"><span class="pre">a</span></code> column. Indexing by means of character vectors will refer to
<code class="docutils literal notranslate"><span class="pre">row.names</span></code> and <code class="docutils literal notranslate"><span class="pre">names</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="p">[</span><span class="s">&quot;5&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">)]</span>
<span class="c1">##         a       b</span>
<span class="c1">## 5 0.94047 -1.2651</span>
</pre></div>
</div>
<p>It is not the same as <code class="docutils literal notranslate"><span class="pre">xs[5,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;)]</span></code>,
even though <code class="docutils literal notranslate"><span class="pre">row.names</span></code> is formally an integer vector here.</p>
<p>Regarding the replacement version of the two-indexer variant
of the `<strong class="command">[</strong>` operator, it is a flexible tool.
It permits the new content to be a vector, a data frame, a list,
or even a matrix. Verifying this is left as an exercise.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a data frame carries a matrix, to access a specific sub-column,
we need to use the index/extract operator twice:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
<span class="c1">##      Species Sepal.Length.Min Sepal.Length.Max</span>
<span class="c1">## 1     setosa              4.3              5.8</span>
<span class="c1">## 2 versicolor              4.9              7.0</span>
<span class="c1">## 3  virginica              4.9              7.9</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">]][,</span><span class="w"> </span><span class="s">&quot;Min&quot;</span><span class="p">]</span>
<span class="c1">## [1] 4.3 4.9 4.9</span>
</pre></div>
</div>
<p>In other words, neither <code class="docutils literal notranslate"><span class="pre">x[[&quot;Sepal.Length.Min&quot;]]</span></code>
nor <code class="docutils literal notranslate"><span class="pre">x[,</span> <span class="pre">&quot;Sepal.Length.Min&quot;]</span></code> works.</p>
</div>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.10</span>
        
    </div><div class="proof-content">
<p>Write two replacement functions<a class="footnote-reference brackets" href="#footpandassetindex" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.
First, author
<strong class="command">set_row_names</strong> which replaces the <code class="docutils literal notranslate"><span class="pre">row.names</span></code> of a data frame
with the contents of a specific column. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span><span class="w">  </span><span class="c1"># an example data frame</span>
<span class="c1">##      Species Sepal.Length</span>
<span class="c1">## 1     setosa        5.006</span>
<span class="c1">## 2 versicolor        5.936</span>
<span class="c1">## 3  virginica        6.588</span>
<span class="nf">set_row_names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Species&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##            Sepal.Length</span>
<span class="c1">## setosa            5.006</span>
<span class="c1">## versicolor        5.936</span>
<span class="c1">## virginica         6.588</span>
</pre></div>
</div>
<p>Second, implement <strong class="command">reset_row_names</strong> which converts <code class="docutils literal notranslate"><span class="pre">row.names</span></code> to
a standalone column of a given name. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">reset_row_names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Type&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##   Sepal.Length       Type</span>
<span class="c1">## 1        5.006     setosa</span>
<span class="c1">## 2        5.936 versicolor</span>
<span class="c1">## 3        6.588  virginica</span>
</pre></div>
</div>
<p>These two functions may be handy for they enable writing
<code class="docutils literal notranslate"><span class="pre">x[something,</span> <span class="pre">]</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">x[x[[&quot;column&quot;]]</span> </code><strong class="command">%in%</strong><code class="code docutils literal notranslate"> <span class="pre">something,</span> <span class="pre">]</span></code>.</p>
</div></div></section>
</section>
<section id="common-operations">
<span id="sec-df-ops"></span><h2><span class="section-number">12.3. </span>Common operations<a class="headerlink" href="#common-operations" title="Link to this heading">#</a></h2>
<p>Below we review the most commonly applied operations
related to data frame wrangling. We have a few dedicated functions
or methods overloaded for the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> class. However,
we have already mastered most skills to deal with such objects effectively.
Let’s repeat: data frames are just lists exhibiting matrix-like behaviour.</p>
<section id="ordering-rows">
<span id="sec-df-order"></span><h3><span class="section-number">12.3.1. </span>Ordering rows<a class="headerlink" href="#ordering-rows" title="Link to this heading">#</a></h3>
<p>Ordering rows in a data frame with respect to different
criteria can be easily achieved through the <strong class="command">order</strong> function
and the two-indexer version of `<strong class="command">[</strong>`.</p>
<p>For instance, here are the six fastest cars from <code class="docutils literal notranslate"><span class="pre">mtcars</span></code> in terms of the
time (in seconds) to complete a 402-metre race:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars</span><span class="p">[[</span><span class="s">&quot;qsec&quot;</span><span class="p">]])[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">],</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;qsec&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cyl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gear&quot;</span><span class="p">)]</span>
<span class="p">(</span><span class="n">mtcars6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="nf">row.names</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">),</span><span class="w"> </span><span class="n">mtcars6</span><span class="p">),</span><span class="w"> </span><span class="kc">NULL</span><span class="p">))</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
</pre></div>
</div>
<p><strong class="command">order</strong> uses a stable sorting algorithm. Therefore,
any sorting with respect to a different criterion will not break
the <em>relative</em> ordering of <code class="docutils literal notranslate"><span class="pre">qsec</span></code> in row groups with ties:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]]),</span><span class="w"> </span><span class="p">]</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">qsec</span></code> is still increasing in each of the two <code class="docutils literal notranslate"><span class="pre">cyl</span></code> groups.</p>
<div class="proof proof-type-example" id="id27">

    <div class="proof-title">
        <span class="proof-type">Example 12.11</span>
        
    </div><div class="proof-content">
<p>Notice the difference between ordering by
<code class="docutils literal notranslate"><span class="pre">cyl</span></code> and <code class="docutils literal notranslate"><span class="pre">gear</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;gear&quot;</span><span class="p">]]),</span><span class="w"> </span><span class="p">]</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
</pre></div>
</div>
<p>vs <code class="docutils literal notranslate"><span class="pre">gear</span></code> and <code class="docutils literal notranslate"><span class="pre">cyl</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;gear&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]]),</span><span class="w"> </span><span class="p">]</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mixing increasing and decreasing ordering is tricky
as the <code class="docutils literal notranslate"><span class="pre">decreasing</span></code> argument to <strong class="command">order</strong>
currently does not accept multiple flags
in all the contexts. Perhaps the easiest way to change the ordering
direction is to use the unary minus operator on the column(s)
to be sorted decreasingly.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;gear&quot;</span><span class="p">]],</span><span class="w"> </span><span class="o">-</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]]),</span><span class="w"> </span><span class="p">]</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
</pre></div>
</div>
<p>For factor and character columns, <strong class="command">xtfrm</strong>
can convert them to sort keys first.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars6</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;cyl&quot;</span><span class="p">]],</span><span class="w"> </span><span class="o">-</span><span class="nf">xtfrm</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">[[</span><span class="s">&quot;model&quot;</span><span class="p">]])),</span><span class="w"> </span><span class="p">]</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
</pre></div>
</div>
<p>Both statements act <em>like</em> the unsupported
<code class="docutils literal notranslate"><span class="pre">decreasing=</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(FALSE,</span> <span class="pre">TRUE)</span></code>.</p>
</div>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.12</span>
        
    </div><div class="proof-content">
<p>Write a method <strong class="command">sort.data.frame</strong>
that orders a data frame with respect to a given
set of columns.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sort.data.frame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">sort</span><span class="p">(</span><span class="n">mtcars6</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;cyl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;model&quot;</span><span class="p">))</span>
<span class="c1">##            model  qsec cyl gear</span>
<span class="c1">## 4   Ferrari Dino 15.50   6    5</span>
<span class="c1">## 6      Mazda RX4 16.46   6    4</span>
<span class="c1">## 3     Camaro Z28 15.41   8    3</span>
<span class="c1">## 5     Duster 360 15.84   8    3</span>
<span class="c1">## 1 Ford Pantera L 14.50   8    5</span>
<span class="c1">## 2  Maserati Bora 14.60   8    5</span>
</pre></div>
</div>
<p>Unfortunately, that <code class="docutils literal notranslate"><span class="pre">decreasing</span></code> must be of length one and
be placed as the second argument is imposed by the
<strong class="command">sort</strong> S3 generic.</p>
</div></div></section>
<section id="handling-duplicated-rows">
<h3><span class="section-number">12.3.2. </span>Handling duplicated rows<a class="headerlink" href="#handling-duplicated-rows" title="Link to this heading">#</a></h3>
<p><strong class="command">duplicated</strong>, <strong class="command">anyDuplicated</strong>, and <strong class="command">unique</strong>
have methods overloaded for the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> class.
They can be used to indicate, get rid of, or replace
the repeating rows.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">iris</span><span class="p">))</span><span class="w">  </span><span class="c1"># how many duplicated rows are there?</span>
<span class="c1">## [1] 1</span>
<span class="n">iris</span><span class="p">[</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">iris</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># show the duplicated rows</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span>
<span class="c1">## 143          5.8         2.7          5.1         1.9 virginica</span>
</pre></div>
</div>
</section>
<section id="joining-merging-data-frames">
<h3><span class="section-number">12.3.3. </span>Joining (merging) data frames<a class="headerlink" href="#joining-merging-data-frames" title="Link to this heading">#</a></h3>
<p>The <strong class="command">merge</strong> function can perform the <em>join</em> operation
that some readers might know from SQL<a class="footnote-reference brackets" href="#footjoin" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>. It matches the items in
the columns that two given data frames somewhat share. Then,
it returns the combination of the corresponding rows.</p>
<div class="proof proof-type-example" id="id29">

    <div class="proof-title">
        <span class="proof-type">Example 12.13</span>
        
    </div><div class="proof-content">
<p>Two calls to <strong class="command">merge</strong> could be used to
match data on programmers (each identified by <code class="docutils literal notranslate"><span class="pre">developer_id</span></code>
and giving such details as their name, location, main skill, etc.)
with the information about the open-source projects
(each identified by <code class="docutils literal notranslate"><span class="pre">project_id</span></code> and informing us about
its title, scope, website, and so forth) they are engaged in
(based on a third data frame defining <code class="docutils literal notranslate"><span class="pre">developer_id</span></code> and <code class="docutils literal notranslate"><span class="pre">project_id</span></code>
pairs).</p>
</div></div><p>As a simple illustration, consider two objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">u</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;b0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b3&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a3&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">B</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a4&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">w</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;c0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c3&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The two <em>common</em> columns, i.e., storing
data of similar nature  (<code class="docutils literal notranslate"><span class="pre">a</span></code>-something strings), are both named <code class="docutils literal notranslate"><span class="pre">v</span></code>.</p>
<p>First is the <em>inner (natural) join</em>,
where we list only the matching pairs:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w">  </span><span class="c1"># x=A, y=B, by=&quot;v&quot;, all.x=FALSE, all.y=FALSE</span>
<span class="c1">##    v  u  w</span>
<span class="c1">## 1 a0 b0 c0</span>
<span class="c1">## 2 a2 b2 c1</span>
<span class="c1">## 3 a2 b2 c2</span>
</pre></div>
</div>
<p>The common column is included in the result only once.</p>
<p>Next, the <em>left join</em> guarantees that all elements in the first
data frame will be included in the result:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">all.x</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1"># by=&quot;v&quot;, all.y=FALSE</span>
<span class="c1">##    v  u    w</span>
<span class="c1">## 1 a0 b0   c0</span>
<span class="c1">## 2 a1 b1 &lt;NA&gt;</span>
<span class="c1">## 3 a2 b2   c1</span>
<span class="c1">## 4 a2 b2   c2</span>
<span class="c1">## 5 a3 b3 &lt;NA&gt;</span>
</pre></div>
</div>
<p>The <em>right join</em> includes all records in the second argument:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">all.y</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1"># by=&quot;v&quot;, all.x=FALSE</span>
<span class="c1">##    v    u  w</span>
<span class="c1">## 1 a0   b0 c0</span>
<span class="c1">## 2 a2   b2 c1</span>
<span class="c1">## 3 a2   b2 c2</span>
<span class="c1">## 4 a4 &lt;NA&gt; c3</span>
</pre></div>
</div>
<p>Lastly, the <em>full outer join</em> is their set-theoretic union:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">merge</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">all.x</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">all.y</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1"># by=&quot;v&quot;</span>
<span class="c1">##    v    u    w</span>
<span class="c1">## 1 a0   b0   c0</span>
<span class="c1">## 2 a1   b1 &lt;NA&gt;</span>
<span class="c1">## 3 a2   b2   c1</span>
<span class="c1">## 4 a2   b2   c2</span>
<span class="c1">## 5 a3   b3 &lt;NA&gt;</span>
<span class="c1">## 6 a4 &lt;NA&gt;   c3</span>
</pre></div>
</div>
<p>Joining on more than one common column is also supported.</p>
<div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.14</span>
        
    </div><div class="proof-content">
<p>Show how <strong class="command">match</strong> (<a class="reference internal" href="150-indexing.html#sec-match"><span class="std std-numref">Section 5.4.1</span></a>) can help
author a very basic version of <strong class="command">merge</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.15</span>
        
    </div><div class="proof-content">
<p>Implement a version of <strong class="command">match</strong> that allows the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">table</span></code>
arguments to be data frames with the same number of columns
so that also the matching of pairs, triples, etc. is possible.</p>
</div></div></section>
<section id="aggregating-and-transforming-columns">
<h3><span class="section-number">12.3.4. </span>Aggregating and transforming columns<a class="headerlink" href="#aggregating-and-transforming-columns" title="Link to this heading">#</a></h3>
<p>It might be tempting to try aggregating data frames with
<strong class="command">apply</strong>. Sadly, currently, this function coerces its
argument to a matrix. Hence, we should refrain from applying it on
data frames whose columns are of mixed types.
However, taking into account that data frames are special lists,
we can always call <strong class="command">Map</strong> and its relatives.</p>
<div class="proof proof-type-example" id="id32">

    <div class="proof-title">
        <span class="proof-type">Example 12.16</span>
        
    </div><div class="proof-content">
<p>Consider an example data frame:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">iris_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">iris</span><span class="p">),</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="p">])</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="c1">## 28           5.2         3.5          1.5         0.2     setosa</span>
<span class="c1">## 80           5.7         2.6          3.5         1.0 versicolor</span>
<span class="c1">## 101          6.3         3.3          6.0         2.5  virginica</span>
<span class="c1">## 111          6.5         3.2          5.1         2.0  virginica</span>
<span class="c1">## 137          6.3         3.4          5.6         2.4  virginica</span>
<span class="c1">## 133          6.4         2.8          5.6         2.2  virginica</span>
</pre></div>
</div>
<p>To get the class of each column, we can call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sapply</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="p">)</span><span class="w">  </span><span class="c1"># or unlist(Map(class, iris))</span>
<span class="c1">## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species</span>
<span class="c1">##    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;     &quot;factor&quot;</span>
</pre></div>
</div>
<p>Next, here is a way to compute some aggregates of the numeric columns:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="nf">Filter</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="n">iris_sample</span><span class="p">)))</span>
<span class="c1">## Sepal.Length  Sepal.Width Petal.Length  Petal.Width</span>
<span class="c1">##       6.0667       3.1333       4.5500       1.7167</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sapply</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">[</span><span class="nf">sapply</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">,</span><span class="w"> </span><span class="n">is.numeric</span><span class="p">)],</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="c1">## Sepal.Length  Sepal.Width Petal.Length  Petal.Width</span>
<span class="c1">##       6.0667       3.1333       4.5500       1.7167</span>
</pre></div>
</div>
<p>We can also fetch more than a single summary of each column:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
<span class="w">    </span><span class="nf">Filter</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="n">iris_sample</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## Min          5.2         2.6          1.5         0.2</span>
<span class="c1">## Max          6.5         3.5          6.0         2.5</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sapply</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">[</span><span class="nf">sapply</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">,</span><span class="w"> </span><span class="n">is.numeric</span><span class="p">)],</span><span class="w"> </span><span class="n">quantile</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">##      Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## 0%            5.2         2.6          1.5         0.2</span>
<span class="c1">## 100%          6.5         3.5          6.0         2.5</span>
</pre></div>
</div>
<p>The latter called <strong class="command">simplify2array</strong> automatically.
Thus, the result is a matrix.</p>
<p>On the other hand, the standardisation of all numeric features
can be performed, e.g., via a call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">iris_sample</span><span class="p">[]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Map</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="nf">else </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">},</span><span class="w"> </span><span class="n">iris_sample</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">iris_sample</span><span class="p">)</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="c1">## 28      -1.70405     1.03024     -1.76004    -1.65318     setosa</span>
<span class="c1">## 80      -0.72094    -1.49854     -0.60591    -0.78117 versicolor</span>
<span class="c1">## 101      0.45878     0.46829      0.83674     0.85384  virginica</span>
<span class="c1">## 111      0.85202     0.18732      0.31738     0.30884  virginica</span>
<span class="c1">## 137      0.45878     0.74927      0.60591     0.74484  virginica</span>
<span class="c1">## 133      0.65540    -0.93659      0.60591     0.52684  virginica</span>
</pre></div>
</div>
</div></div></section>
<section id="handling-missing-values">
<h3><span class="section-number">12.3.5. </span>Handling missing values<a class="headerlink" href="#handling-missing-values" title="Link to this heading">#</a></h3>
<p>The <strong class="command">is.na</strong> method for objects of the class <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>
returns a logical matrix of the same dimensionality<a class="footnote-reference brackets" href="#footnotmatrix" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>,
indicating whether the corresponding items are missing or not.
Of course, the default method can still be called on individual columns.</p>
<p>Further, <strong class="command">na.omit</strong> gets rid of <em>rows</em> with missing values.</p>
<div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.17</span>
        
    </div><div class="proof-content">
<p>Given a data frame, use <strong class="command">is.na</strong> and other functions such
as <strong class="command">apply</strong> or <strong class="command">approx</strong> to:</p>
<ol class="arabic simple">
<li><p>remove all rows that bear at least one missing value,</p></li>
<li><p>remove all rows that only consist of missing values,</p></li>
<li><p>remove all columns that carry at least one missing value,</p></li>
<li><p>for each column, replace all missing values with the column
averages,</p></li>
<li><p>for each column, replace all missing values
with values that linearly interpolate
between the preceding and succeeding well-defined
observations (which is of use in time series processing), e.g.,
the blanks in <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(0.60,</span> <span class="pre">0.62,</span> <span class="pre">NA,</span> <span class="pre">0.64,</span> <span class="pre">NA,</span> <span class="pre">NA,</span> <span class="pre">0.58)</span></code>
should be filled to obtain
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(0.60,</span> <span class="pre">0.62,</span> <span class="pre">0.63,</span> <span class="pre">0.64,</span> <span class="pre">0.62,</span> <span class="pre">0.60,</span> <span class="pre">0.58)</span></code>.</p></li>
</ol>
</div></div></section>
<section id="reshaping-data-frames">
<span id="sec-reshape"></span><h3><span class="section-number">12.3.6. </span>Reshaping data frames<a class="headerlink" href="#reshaping-data-frames" title="Link to this heading">#</a></h3>
<p>Consider an example matrix:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span>
<span class="w">        </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Z&quot;</span><span class="p">),</span><span class="w">  </span><span class="c1"># row labels</span>
<span class="w">        </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">)</span><span class="w">        </span><span class="c1"># column labels</span>
<span class="p">))</span>
<span class="nf">names</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Row&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Col&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="c1">##    Col</span>
<span class="c1">## Row    u    v</span>
<span class="c1">##   X 0.29 0.88</span>
<span class="c1">##   Y 0.79 0.94</span>
<span class="c1">##   Z 0.41 0.05</span>
</pre></div>
</div>
<p>The <strong class="command">as.data.frame</strong> method for the <code class="docutils literal notranslate"><span class="pre">table</span></code>
class can be called directly on any array-like object:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame.table</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">responseName</span><span class="o">=</span><span class="s">&quot;Val&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">##   Row Col  Val</span>
<span class="c1">## 1   X   u 0.29</span>
<span class="c1">## 2   Y   u 0.79</span>
<span class="c1">## 3   Z   u 0.41</span>
<span class="c1">## 4   X   v 0.88</span>
<span class="c1">## 5   Y   v 0.94</span>
<span class="c1">## 6   Z   v 0.05</span>
</pre></div>
</div>
<p>It is an instance of array <em>reshaping</em>. More precisely, we call
it <em>stacking</em>. We converted from a <em>wide</em> (okay, in this example,
not so wide, as we only have two columns) to a <em>long</em> (tall) format.</p>
<p>The above can also be achieved by means of the <strong class="command">reshape</strong> function
which is more flexible and operates directly on data frames
(but is harder to use):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`names&lt;-`</span><span class="p">(</span>
<span class="w">    </span><span class="nf">data.frame</span><span class="p">(</span><span class="nf">row.names</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">),</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Row&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Col.u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Col.v&quot;</span><span class="p">)))</span>
<span class="c1">##   Row Col.u Col.v</span>
<span class="c1">## 1   X  0.29  0.88</span>
<span class="c1">## 2   Y  0.79  0.94</span>
<span class="c1">## 3   Z  0.41  0.05</span>
<span class="p">(</span><span class="n">stacked</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">varying</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="o">=</span><span class="s">&quot;long&quot;</span><span class="p">))</span>
<span class="c1">##     Row time  Col id</span>
<span class="c1">## 1.u   X    u 0.29  1</span>
<span class="c1">## 2.u   Y    u 0.79  2</span>
<span class="c1">## 3.u   Z    u 0.41  3</span>
<span class="c1">## 1.v   X    v 0.88  1</span>
<span class="c1">## 2.v   Y    v 0.94  2</span>
<span class="c1">## 3.v   Z    v 0.05  3</span>
</pre></div>
</div>
<p>Maybe the default column names are not superb, but we can
adjust them manually afterwards.</p>
<p>The reverse operation is called <em>unstacking</em>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">reshape</span><span class="p">(</span><span class="n">stacked</span><span class="p">,</span><span class="w"> </span><span class="n">idvar</span><span class="o">=</span><span class="s">&quot;Row&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">timevar</span><span class="o">=</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="o">=</span><span class="s">&quot;wide&quot;</span><span class="p">)</span>
<span class="c1">##     Row Col.u Col.v</span>
<span class="c1">## 1.u   X  0.29  0.88</span>
<span class="c1">## 2.u   Y  0.79  0.94</span>
<span class="c1">## 3.u   Z  0.41  0.05</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.18</span>
        
    </div><div class="proof-content">
<p>Given a named numeric vector, convert it to a data frame
with two columns. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">convert</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="n">eggs</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">bacon</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">convert</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##     key value</span>
<span class="c1">## 1  spam    42</span>
<span class="c1">## 2  eggs     7</span>
<span class="c1">## 3 bacon     3</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.19</span>
        
    </div><div class="proof-content">
<p>Stack the <code class="docutils literal notranslate"><span class="pre">WorldPhones</span></code> dataset. Then, unstack it back.
Furthermore, unstack the stacked set after removing<a class="footnote-reference brackets" href="#footcrosseddesign" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>
five random rows from it and randomly permuting all the remaining rows.
Fill in the missing entries with <code class="docutils literal notranslate"><span class="pre">NA</span></code>s.</p>
</div></div><div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.20</span>
        
    </div><div class="proof-content">
<p>Implement a basic version of <strong class="command">as.data.frame.table</strong> manually
(using <strong class="command">rep</strong> etc.). Also, write a function
<strong class="command">as.table.data.frame</strong> that computes its reverse.
Make sure both functions are compatible with each other.</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.21</span>
        
    </div><div class="proof-content">
<p><code class="docutils literal notranslate"><span class="pre">Titanic</span></code> is a four-dimensional array. Convert it to a long data frame.</p>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.22</span>
        
    </div><div class="proof-content">
<p>Perform what follows on the undermentioned data frame:</p>
<ol class="arabic simple">
<li><p>convert the second column to a list of
character vectors (split at <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code>);</p></li>
<li><p>extract the first elements from each of such vectors;</p></li>
<li><p>extract the last elements;</p></li>
<li><p>(*) unstack the split data frame;</p></li>
<li><p>(*) stack it back to a data frame that carries a list;</p></li>
<li><p>convert the list back to a character column
(concatenate with <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code> as separator).</p></li>
</ol>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">name</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Kat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ron&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">food</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;buckwheat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam,bacon,spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs,spam,spam,lollipops&quot;</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##   name                     food</span>
<span class="c1">## 1  Kat                buckwheat</span>
<span class="c1">## 2  Ron          spam,bacon,spam</span>
<span class="c1">## 3   Jo</span>
<span class="c1">## 4 Mary eggs,spam,spam,lollipops</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.23</span>
        
    </div><div class="proof-content">
<p>Write a function that converts all matrix-based columns in a given
data frame to separate atomic columns. Furthermore, author a function
that does the opposite, i.e., groups all columns with similar prefixes and
turns them into matrices.</p>
</div></div></section>
<section id="aggregating-data-in-groups">
<span id="sec-df-group-by"></span><h3><span class="section-number">12.3.7. </span>Aggregating data in groups<a class="headerlink" href="#aggregating-data-in-groups" title="Link to this heading">#</a></h3>
<p>We can straightforwardly apply various transforms on data groups determined
by a factor-like variable or their combination thanks to the
<strong class="command">split.data.frame</strong> method, which returns a list of data frames.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="w">    </span><span class="m">10</span><span class="p">,</span><span class="w">     </span><span class="m">20</span><span class="p">,</span><span class="w">     </span><span class="m">30</span><span class="p">,</span><span class="w">     </span><span class="m">40</span><span class="p">,</span><span class="w">     </span><span class="m">50</span><span class="p">),</span>
<span class="w">    </span><span class="n">u</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="w">     </span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="m">2</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="m">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s">&quot;u&quot;</span><span class="p">])</span><span class="w">  </span><span class="c1"># i.e., split.data.frame(x, x[&quot;u&quot;]) or x[[&quot;u&quot;]]</span>
<span class="c1">## $eggs</span>
<span class="c1">##    a    u v</span>
<span class="c1">## 3 30 eggs 1</span>
<span class="c1">## 5 50 eggs 1</span>
<span class="c1">##</span>
<span class="c1">## $spam</span>
<span class="c1">##    a    u v</span>
<span class="c1">## 1 10 spam 1</span>
<span class="c1">## 2 20 spam 2</span>
<span class="c1">## 4 40 spam 1</span>
</pre></div>
</div>
<p>It split <code class="docutils literal notranslate"><span class="pre">x</span></code> with respect to the <code class="docutils literal notranslate"><span class="pre">u</span></code> column, which served as the grouping
variable. On the other hand:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">)])</span><span class="w">  </span><span class="c1"># sep=&quot;.&quot;</span>
<span class="c1">## $eggs.1</span>
<span class="c1">##    a    u v</span>
<span class="c1">## 3 30 eggs 1</span>
<span class="c1">## 5 50 eggs 1</span>
<span class="c1">##</span>
<span class="c1">## $spam.1</span>
<span class="c1">##    a    u v</span>
<span class="c1">## 1 10 spam 1</span>
<span class="c1">## 4 40 spam 1</span>
<span class="c1">##</span>
<span class="c1">## $eggs.2</span>
<span class="c1">## [1] a u v</span>
<span class="c1">## &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="c1">##</span>
<span class="c1">## $spam.2</span>
<span class="c1">##    a    u v</span>
<span class="c1">## 2 20 spam 2</span>
</pre></div>
</div>
<p>It partitioned with respect to a combination of two factor-like
sequences. A nonexistent level pair <code class="docutils literal notranslate"><span class="pre">(eggs,</span> <span class="pre">2)</span></code>
resulted in an empty data frame.</p>
<div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.24</span>
        
    </div><div class="proof-content">
<p><strong class="command">split.data.frame</strong> (when called directly) can also
be used to break a matrix into a list of matrices (rowwisely).
Given a matrix, perform its train-test split: allocate, say,
70% of the rows at random into one matrix and the remaining 30%
into another.</p>
</div></div><p><strong class="command">sapply</strong> is convenient if we need to aggregate grouped
numeric data. To recall, it is a combination of
<strong class="command">lapply</strong> (one-vector version of <strong class="command">Map</strong>) and
<strong class="command">simplify2array</strong> (<a class="reference internal" href="230-matrix.html#sec-simplify2array"><span class="std std-numref">Section 11.1.3</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">]),</span><span class="w"> </span><span class="n">sapply</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="c1">##              setosa versicolor virginica</span>
<span class="c1">## Sepal.Length  5.006      5.936     6.588</span>
<span class="c1">## Sepal.Width   3.428      2.770     2.974</span>
</pre></div>
</div>
<p>If the function to apply returns more than a single value,
<strong class="command">sapply</strong> will not return too informative a result.
The list of matrices converted to a matrix will not have the <code class="docutils literal notranslate"><span class="pre">row.names</span></code>
argument set:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">MinMax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">]),</span><span class="w"> </span><span class="n">sapply</span><span class="p">,</span><span class="w"> </span><span class="n">MinMax</span><span class="p">)</span>
<span class="c1">##      setosa versicolor virginica</span>
<span class="c1">## [1,]    4.3        4.9       4.9</span>
<span class="c1">## [2,]    5.8        7.0       7.9</span>
<span class="c1">## [3,]    2.3        2.0       2.2</span>
<span class="c1">## [4,]    4.4        3.4       3.8</span>
</pre></div>
</div>
<p>As a workaround, we either call <strong class="command">simplify2array</strong>
explicitly, or pass <code class="docutils literal notranslate"><span class="pre">simplify=&quot;array&quot;</span></code> to <strong class="command">sapply</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">]),</span>
<span class="w">    </span><span class="n">sapply</span><span class="p">,</span>
<span class="w">    </span><span class="n">MinMax</span><span class="p">,</span>
<span class="w">    </span><span class="n">simplify</span><span class="o">=</span><span class="s">&quot;array&quot;</span>
<span class="p">))</span><span class="w">  </span><span class="c1"># or simplify2array(lapply(...) or Map(...) etc.)</span>
<span class="c1">## , , setosa</span>
<span class="c1">##</span>
<span class="c1">##     Sepal.Length Sepal.Width</span>
<span class="c1">## Min          4.3         2.3</span>
<span class="c1">## Max          5.8         4.4</span>
<span class="c1">##</span>
<span class="c1">## , , versicolor</span>
<span class="c1">##</span>
<span class="c1">##     Sepal.Length Sepal.Width</span>
<span class="c1">## Min          4.9         2.0</span>
<span class="c1">## Max          7.0         3.4</span>
<span class="c1">##</span>
<span class="c1">## , , virginica</span>
<span class="c1">##</span>
<span class="c1">##     Sepal.Length Sepal.Width</span>
<span class="c1">## Min          4.9         2.2</span>
<span class="c1">## Max          7.9         3.8</span>
</pre></div>
</div>
<p>It produced a three-dimensional array, which is particularly handy if we
now wish to access specific results by name:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="p">[,</span><span class="w"> </span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;setosa&quot;</span><span class="p">]</span>
<span class="c1">## Min Max</span>
<span class="c1">## 4.3 5.8</span>
</pre></div>
</div>
<p>The previously mentioned <strong class="command">as.data.frame.table</strong> method
will work on it like a charm (up to the column names, which we can change):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame.table</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">##    Var1         Var2       Var3 Freq</span>
<span class="c1">## 1   Min Sepal.Length     setosa  4.3</span>
<span class="c1">## 2   Max Sepal.Length     setosa  5.8</span>
<span class="c1">## 3   Min  Sepal.Width     setosa  2.3</span>
<span class="c1">## 4   Max  Sepal.Width     setosa  4.4</span>
<span class="c1">## 5   Min Sepal.Length versicolor  4.9</span>
<span class="c1">## 6   Max Sepal.Length versicolor  7.0</span>
<span class="c1">## 7   Min  Sepal.Width versicolor  2.0</span>
<span class="c1">## 8   Max  Sepal.Width versicolor  3.4</span>
<span class="c1">## 9   Min Sepal.Length  virginica  4.9</span>
<span class="c1">## 10  Max Sepal.Length  virginica  7.9</span>
<span class="c1">## 11  Min  Sepal.Width  virginica  2.2</span>
<span class="c1">## 12  Max  Sepal.Width  virginica  3.8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the grouping (<code class="docutils literal notranslate"><span class="pre">by</span></code>) variable is a list of two or more factors,
the combined levels will be concatenated to a single string.
This behaviour yields a result that may be deemed convenient
in some contexts but not necessarily so in other ones.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.data.frame.table</span><span class="p">(</span><span class="nf">as.array</span><span class="p">(</span><span class="nf">sapply</span><span class="p">(</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">[</span><span class="s">&quot;len&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">sapply</span><span class="p">,</span><span class="w">  </span><span class="c1"># but check also: function(...) as.matrix(sapply(...)),</span>
<span class="w">    </span><span class="n">mean</span>
<span class="p">)),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">##         Var1  Freq</span>
<span class="c1">## 1 OJ_0.5.len 13.23</span>
<span class="c1">## 2 VC_0.5.len  7.98</span>
<span class="c1">## 3   OJ_1.len 22.70</span>
<span class="c1">## 4   VC_1.len 16.77</span>
<span class="c1">## 5   OJ_2.len 26.06</span>
<span class="c1">## 6   VC_2.len 26.14</span>
</pre></div>
</div>
<p>The name of the aggregated column (<code class="docutils literal notranslate"><span class="pre">len</span></code>) has been included,
because <strong class="command">sapply</strong> simplifies the result to a flat vector
too eagerly.</p>
</div>
<p><strong class="command">aggregate</strong> can assist us when a single function is to be
applied on all columns in a data frame.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">aggregate</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">-5</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">  </span><span class="c1"># neither iris[[5]] nor iris[, 5]</span>
<span class="c1">##      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## 1     setosa        5.006       3.428        1.462       0.246</span>
<span class="c1">## 2 versicolor        5.936       2.770        4.260       1.326</span>
<span class="c1">## 3  virginica        6.588       2.974        5.552       2.026</span>
<span class="nf">aggregate</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">[</span><span class="s">&quot;len&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="c1">##   supp dose   len</span>
<span class="c1">## 1   OJ  0.5 13.23</span>
<span class="c1">## 2   VC  0.5  7.98</span>
<span class="c1">## 3   OJ  1.0 22.70</span>
<span class="c1">## 4   VC  1.0 16.77</span>
<span class="c1">## 5   OJ  2.0 26.06</span>
<span class="c1">## 6   VC  2.0 26.14</span>
</pre></div>
</div>
<p>The second argument, <code class="docutils literal notranslate"><span class="pre">by</span></code>, must be list-like (this includes data frames).
Neither a factor nor an atomic vector is acceptable.
Also, if the function being applied returns many values, they
will be wrapped into a matrix column:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
<span class="c1">##      Species Sepal.Width.Min Sepal.Width.Max</span>
<span class="c1">## 1     setosa             2.3             4.4</span>
<span class="c1">## 2 versicolor             2.0             3.4</span>
<span class="c1">## 3  virginica             2.2             3.8</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">]])</span>
<span class="c1">## [1] &quot;matrix&quot; &quot;array&quot;</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">]]</span><span class="w">  </span><span class="c1"># not: Sepal.Width.Max, etc.</span>
<span class="c1">##      Min Max</span>
<span class="c1">## [1,] 2.3 4.4</span>
<span class="c1">## [2,] 2.0 3.4</span>
<span class="c1">## [3,] 2.2 3.8</span>
</pre></div>
</div>
<p>It is actually handy: by referring to
<code class="docutils literal notranslate"><span class="pre">x[[&quot;Sepal.Width&quot;]]</span></code>, we access all the stats for this column.
Further, if many columns are being aggregated simultaneously,
we can process all the summaries in the same way.</p>
<div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.25</span>
        
    </div><div class="proof-content">
<p>Check out the <strong class="command">by</strong> function,
which supports basic split-apply-bind use cases.
Note the particularly odd behaviour of the
<strong class="command">print</strong> method for the <code class="docutils literal notranslate"><span class="pre">by</span></code> class.</p>
</div></div><p>The most flexible scenario involves applying a custom function
returning any set of aggregates in the form of a list
and then row-binding the results to obtain a data frame.</p>
<div class="proof proof-type-example" id="id42">

    <div class="proof-title">
        <span class="proof-type">Example 12.26</span>
        
    </div><div class="proof-content">
<p>The following implements an R version of what we would express
in SQL as:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ave_len</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ToothGrowth</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span>
</pre></div>
</div>
<p>Ad rem:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)]),</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">        </span><span class="n">supp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;supp&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="n">dose</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="n">ave_len</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;len&quot;</span><span class="p">]]),</span>
<span class="w">        </span><span class="n">count</span><span class="o">=</span><span class="nf">NROW</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##        supp dose ave_len count</span>
<span class="c1">## OJ.0.5   OJ  0.5   13.23    10</span>
<span class="c1">## VC.0.5   VC  0.5    7.98    10</span>
<span class="c1">## OJ.1     OJ  1.0   22.70    10</span>
<span class="c1">## VC.1     VC  1.0   16.77    10</span>
<span class="c1">## OJ.2     OJ  2.0   26.06    10</span>
<span class="c1">## VC.2     VC  2.0   26.14    10</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id43">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.27</span>
        
    </div><div class="proof-content">
<p>Many aggregation functions are idempotent, which means
that when they are fed with a vector with all the elements
being identical, the result is exactly that unique element:
<strong class="command">min</strong>, <strong class="command">mean</strong>, <strong class="command">median</strong>, and <strong class="command">max</strong>
behave this way.</p>
<p>Overload the <strong class="command">mean</strong> and <strong class="command">median</strong> methods
for character vectors and factors. They should return <code class="docutils literal notranslate"><span class="pre">NA</span></code>
and give a warning for sequences where not all elements are the same.
Otherwise, they are expected to output the unique value.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mean.character</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="n">mean.factor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
</pre></div>
</div>
<p>This way, we can also aggregate the grouping variables conveniently:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span>
<span class="w">    </span><span class="nf">lapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)]),</span><span class="w"> </span><span class="n">lapply</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span>
<span class="c1">##          len supp dose</span>
<span class="c1">## OJ.0.5 13.23   OJ  0.5</span>
<span class="c1">## VC.0.5  7.98   VC  0.5</span>
<span class="c1">## OJ.1   22.70   OJ  1.0</span>
<span class="c1">## VC.1   16.77   VC  1.0</span>
<span class="c1">## OJ.2   26.06   OJ  2.0</span>
<span class="c1">## VC.2   26.14   VC  2.0</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id44">

    <div class="proof-title">
        <span class="proof-type">Example 12.28</span>
        
    </div><div class="proof-content">
<p>Let’s study a function that takes a named list <code class="docutils literal notranslate"><span class="pre">x</span></code>
(can be a data frame) and a sequence of <code class="docutils literal notranslate"><span class="pre">col=f</span></code> pairs, and applies
the function <code class="docutils literal notranslate"><span class="pre">f</span></code> (or each function from a list of functions <code class="docutils literal notranslate"><span class="pre">f</span></code>)
on the element named <code class="docutils literal notranslate"><span class="pre">col</span></code> in <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">napply</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">fs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<span class="w">    </span><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">is.list</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">do.call</span><span class="p">(</span>
<span class="w">        </span><span class="n">c</span><span class="p">,</span><span class="w">  </span><span class="c1"># concatenates lists</span>
<span class="w">        </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">            </span><span class="nf">structure</span><span class="p">(</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span><span class="w"> </span><span class="n">names</span><span class="o">=</span><span class="n">cols</span><span class="p">),</span>
<span class="w">            </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span><span class="w">   </span><span class="c1"># always returns a list</span>
<span class="w">                </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[[</span><span class="w"> </span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">]]</span>
<span class="w">                </span><span class="nf">if </span><span class="p">(</span><span class="nf">is.function</span><span class="p">(</span><span class="n">fs</span><span class="p">[[</span><span class="n">i</span><span class="p">]]))</span>
<span class="w">                    </span><span class="nf">list</span><span class="p">(</span><span class="n">fs</span><span class="p">[[</span><span class="n">i</span><span class="p">]](</span><span class="n">y</span><span class="p">))</span>
<span class="w">                </span><span class="n">else</span>
<span class="w">                    </span><span class="nf">lapply</span><span class="p">(</span><span class="n">fs</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">first</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w">  </span><span class="c1"># helper function</span>
<span class="nf">napply</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span>
<span class="w">    </span><span class="n">supp</span><span class="o">=</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="o">=</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">ave</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1">## $supp</span>
<span class="c1">## [1] VC</span>
<span class="c1">## Levels: OJ VC</span>
<span class="c1">##</span>
<span class="c1">## $dose</span>
<span class="c1">## [1] 0.5</span>
<span class="c1">##</span>
<span class="c1">## $len.ave</span>
<span class="c1">## [1] 18.813</span>
<span class="c1">##</span>
<span class="c1">## $len.count</span>
<span class="c1">## [1] 60</span>
</pre></div>
</div>
<p>It applied <strong class="command">first</strong> on both
<code class="docutils literal notranslate"><span class="pre">ToothGrowth[[&quot;supp&quot;]]</span></code> and <code class="docutils literal notranslate"><span class="pre">ToothGrowth[[&quot;dose&quot;]]</span></code>
as well as <strong class="command">mean</strong> and <strong class="command">length</strong> on
<code class="docutils literal notranslate"><span class="pre">ToothGrowth[[&quot;len&quot;]]</span></code>. We included list names for a more dramatic effect.
And now:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span>
<span class="w">    </span><span class="n">rbind.data.frame</span><span class="p">,</span>
<span class="w">    </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">        </span><span class="nf">split</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)]),</span>
<span class="w">        </span><span class="n">napply</span><span class="p">,</span>
<span class="w">        </span><span class="n">supp</span><span class="o">=</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="o">=</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">ave</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
<span class="c1">##        supp dose len.ave len.count</span>
<span class="c1">## OJ.0.5   OJ  0.5   13.23        10</span>
<span class="c1">## VC.0.5   VC  0.5    7.98        10</span>
<span class="c1">## OJ.1     OJ  1.0   22.70        10</span>
<span class="c1">## VC.1     VC  1.0   16.77        10</span>
<span class="c1">## OJ.2     OJ  2.0   26.06        10</span>
<span class="c1">## VC.2     VC  2.0   26.14        10</span>
</pre></div>
</div>
<p>or even:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gapply</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">        </span><span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">by</span><span class="p">]),</span>
<span class="w">        </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">            </span><span class="nf">do.call</span><span class="p">(</span><span class="n">napply</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">  </span><span class="c1"># add all by=first calls</span>
<span class="w">                </span><span class="n">x</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
<span class="w">                </span><span class="nf">`names&lt;-`</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">by</span><span class="p">)),</span><span class="w"> </span><span class="n">by</span><span class="p">),</span>
<span class="w">                </span><span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
<span class="w">            </span><span class="p">)),</span>
<span class="w">        </span><span class="kc">...</span>
<span class="w">    </span><span class="p">))</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">gapply</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Width</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">min</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">))</span>
<span class="c1">##               Species Sepal.Length Sepal.Width1 Sepal.Width2</span>
<span class="c1">## setosa         setosa        5.006          2.3          4.4</span>
<span class="c1">## versicolor versicolor        5.936          2.0          3.4</span>
<span class="c1">## virginica   virginica        6.588          2.2          3.8</span>
<span class="nf">gapply</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">ave</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="n">length</span><span class="p">))</span>
<span class="c1">##        supp dose len.ave len.count</span>
<span class="c1">## OJ.0.5   OJ  0.5   13.23        10</span>
<span class="c1">## VC.0.5   VC  0.5    7.98        10</span>
<span class="c1">## OJ.1     OJ  1.0   22.70        10</span>
<span class="c1">## VC.1     VC  1.0   16.77        10</span>
<span class="c1">## OJ.2     OJ  2.0   26.06        10</span>
<span class="c1">## VC.2     VC  2.0   26.14        10</span>
</pre></div>
</div>
<p>This brings fun back to R programming in the sad times when
many things are given to us on a plate (the thorough testing of the
above is left as an exercise).</p>
</div></div><div class="proof proof-type-example" id="id45">

    <div class="proof-title">
        <span class="proof-type">Example 12.29</span>
        
    </div><div class="proof-content">
<p>In <a class="reference internal" href="220-s3.html#sec-pipe"><span class="std std-numref">Section 10.4</span></a>, we mentioned (without giving the implementation)
the <strong class="command">group_by</strong> function returning a list of the class <code class="docutils literal notranslate"><span class="pre">list_dfs</span></code>.
It splits a data frame into a list of data frames with respect to
a combination of levels in given named columns:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">group_by</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">is.character</span><span class="p">(</span><span class="n">by</span><span class="p">),</span><span class="w"> </span><span class="nf">is.data.frame</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">droplevels</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">  </span><span class="c1"># factors may have unused levels</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="nf">split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">by</span><span class="p">]),</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;list_dfs&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">by</span><span class="o">=</span><span class="n">by</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The next function applies a set of aggregates
on every column of each data frame in a given list
(two nested <strong class="command">lapply</strong>s plus cosmetic additions):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aggregate.list_dfs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">aggregates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">is_by</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;by&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">is_by</span><span class="p">],</span><span class="w"> </span><span class="n">FUN</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">        </span><span class="n">res_mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">res_mat</span><span class="p">)[[</span><span class="m">2</span><span class="p">]]))</span>
<span class="w">            </span><span class="nf">dimnames</span><span class="p">(</span><span class="n">res_mat</span><span class="p">)[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="nf">NCOL</span><span class="p">(</span><span class="n">res_mat</span><span class="p">)))</span>
<span class="w">        </span><span class="nf">cbind</span><span class="p">(</span>
<span class="w">            </span><span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">is_by</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">],</span><span class="w"> </span><span class="kc">NULL</span><span class="p">),</span>
<span class="w">            </span><span class="n">x</span><span class="o">=</span><span class="nf">row.names</span><span class="p">(</span><span class="n">res_mat</span><span class="p">),</span>
<span class="w">            </span><span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="n">res_mat</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="n">combined_aggregates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="n">aggregates</span><span class="p">)</span>
<span class="w">    </span><span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="n">combined_aggregates</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">aggregate</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;supp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dose&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">range</span><span class="p">)</span>
<span class="c1">##   supp dose   x   f1   f2</span>
<span class="c1">## 1   OJ  0.5 len  8.2 21.5</span>
<span class="c1">## 2   VC  0.5 len  4.2 11.5</span>
<span class="c1">## 3   OJ  1.0 len 14.5 27.3</span>
<span class="c1">## 4   VC  1.0 len 13.6 22.5</span>
<span class="c1">## 5   OJ  2.0 len 22.4 30.9</span>
<span class="c1">## 6   VC  2.0 len 18.5 33.9</span>
</pre></div>
</div>
<p>We really want our API to be bloated, so let’s introduce a <em>convenience</em>
function, which is a specialised version of the above:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mean.list_dfs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">aggregate.list_dfs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)))</span>
<span class="nf">mean</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">51</span><span class="o">:</span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)],</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">))</span>
<span class="c1">##      Species            x  Mean</span>
<span class="c1">## 1 versicolor  Sepal.Width 2.770</span>
<span class="c1">## 2 versicolor Petal.Length 4.260</span>
<span class="c1">## 3  virginica  Sepal.Width 2.974</span>
<span class="c1">## 4  virginica Petal.Length 5.552</span>
</pre></div>
</div>
</div></div></section>
<section id="transforming-data-in-groups">
<span id="sec-df-group-by-transform"></span><h3><span class="section-number">12.3.8. </span>Transforming data in groups<a class="headerlink" href="#transforming-data-in-groups" title="Link to this heading">#</a></h3>
<p>Variables will sometimes need to be transformed relative to what is
happening in a dataset’s subsets. This is the case, e.g., where we decide
that missing values should be replaced by the corresponding
within-group averages or want to compute the relative ranks or z-scores.</p>
<p>If the loss of the original ordering of rows is not an issue, the
standard split-apply-bind will suffice.
Here is an example data frame:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">   </span><span class="m">1</span><span class="p">,</span><span class="w">  </span><span class="kc">NA</span><span class="p">,</span><span class="w">  </span><span class="kc">NA</span><span class="p">,</span><span class="w">  </span><span class="kc">NA</span><span class="p">,</span><span class="w">   </span><span class="m">4</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w">  </span><span class="m">10</span><span class="p">,</span><span class="w">  </span><span class="m">40</span><span class="p">,</span><span class="w">  </span><span class="m">30</span><span class="p">,</span><span class="w">   </span><span class="m">1</span><span class="p">,</span><span class="w">  </span><span class="m">20</span><span class="p">),</span>
<span class="w">    </span><span class="n">c</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span>
<span class="w">    </span><span class="n">d</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;u&quot;</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##    a  b       c d</span>
<span class="c1">## 1 10 -1 0.52811 v</span>
<span class="c1">## 2  1 10 0.89242 u</span>
<span class="c1">## 3 NA 40 0.55144 u</span>
<span class="c1">## 4 NA 30 0.45661 u</span>
<span class="c1">## 5 NA  1 0.95683 v</span>
<span class="c1">## 6  4 20 0.45333 u</span>
</pre></div>
</div>
<p>Some operations:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fill_na</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)]))</span>
<span class="n">standardise</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x_groups</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">]),</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fill_na</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]])</span>
<span class="w">        </span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;b&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;b&quot;</span><span class="p">]])</span>
<span class="w">        </span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;c&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">standardise</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;c&quot;</span><span class="p">]])</span>
<span class="w">        </span><span class="n">df</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
<span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="n">x_groups</span><span class="p">)</span>
<span class="c1">##        a b        c d</span>
<span class="c1">## u.2  1.0 1  1.46357 u</span>
<span class="c1">## u.3  2.5 4 -0.17823 u</span>
<span class="c1">## u.4  2.5 3 -0.63478 u</span>
<span class="c1">## u.6  4.0 2 -0.65057 u</span>
<span class="c1">## v.1 10.0 1 -0.70711 v</span>
<span class="c1">## v.5 10.0 2  0.70711 v</span>
</pre></div>
</div>
<p>Only the <em>relative</em> ordering of rows within groups
has been retained. Overall, the rows are in a different order.
If this is an issue, we can use the <strong class="command">unsplit</strong> function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unsplit</span><span class="p">(</span><span class="n">x_groups</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">])</span>
<span class="c1">##      a b        c d</span>
<span class="c1">## 1 10.0 1 -0.70711 v</span>
<span class="c1">## 2  1.0 1  1.46357 u</span>
<span class="c1">## 3  2.5 4 -0.17823 u</span>
<span class="c1">## 4  2.5 3 -0.63478 u</span>
<span class="c1">## 5 10.0 2  0.70711 v</span>
<span class="c1">## 6  4.0 2 -0.65057 u</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id46">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.30</span>
        
    </div><div class="proof-content">
<p>Show how we can perform the above also via the replacement
version of <strong class="command">split</strong>.</p>
</div></div><div class="proof proof-type-example" id="id47">

    <div class="proof-title">
        <span class="proof-type">Example 12.31</span>
        
    </div><div class="proof-content">
<p>(*) Recreating the previous ordering can be done manually too.
It is because the split operation behaves as if we first ordered the data
frame with respect to the grouping variable(s) (using a stable sorting
algorithm). Here is a transformation of an example data frame split by
a combination of two factors:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`row.names&lt;-`</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">),</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="kc">NULL</span><span class="p">))</span>
<span class="c1">##     len supp dose</span>
<span class="c1">## 1  23.0   OJ  2.0</span>
<span class="c1">## 2  23.3   OJ  1.0</span>
<span class="c1">## 3  29.4   OJ  2.0</span>
<span class="c1">## 4  14.5   OJ  1.0</span>
<span class="c1">## 5  11.2   VC  0.5</span>
<span class="c1">## 6  20.0   OJ  1.0</span>
<span class="c1">## 7  24.5   OJ  2.0</span>
<span class="c1">## 8  10.0   OJ  0.5</span>
<span class="c1">## 9   9.4   OJ  0.5</span>
<span class="c1">## 10  7.0   VC  0.5</span>
<span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">    </span><span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;dose&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;supp&quot;</span><span class="p">)]),</span><span class="w">  </span><span class="c1"># two grouping variables</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;len&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;len&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="o">^</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;dose&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="c1"># whatever</span>
<span class="w">            </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;supp&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;OJ&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">          </span><span class="c1"># do not overthink it</span>
<span class="w">        </span><span class="n">df</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)))</span>
<span class="c1">##               len supp dose</span>
<span class="c1">## 0.5.OJ.8     -100   OJ  0.5</span>
<span class="c1">## 0.5.OJ.9      -94   OJ  0.5</span>
<span class="c1">## 1.OJ.2      -2330   OJ  1.0</span>
<span class="c1">## 1.OJ.4      -1450   OJ  1.0</span>
<span class="c1">## 1.OJ.6      -2000   OJ  1.0</span>
<span class="c1">## 2.OJ.1    -230000   OJ  2.0</span>
<span class="c1">## 2.OJ.3    -294000   OJ  2.0</span>
<span class="c1">## 2.OJ.7    -245000   OJ  2.0</span>
<span class="c1">## 0.5.VC.5      112   VC  0.5</span>
<span class="c1">## 0.5.VC.10      70   VC  0.5</span>
</pre></div>
</div>
<p><a class="reference internal" href="150-indexing.html#sec-order"><span class="std std-numref">Section 5.4.4</span></a> mentioned that by calling <strong class="command">order</strong>,
we can determine the inverse of a given permutation. Hence, we can call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="nf">order</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;supp&quot;</span><span class="p">]],</span><span class="w"> </span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;dose&quot;</span><span class="p">]])),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># not: dose, supp</span>
<span class="c1">##               len supp dose</span>
<span class="c1">## 2.OJ.1    -230000   OJ  2.0</span>
<span class="c1">## 1.OJ.2      -2330   OJ  1.0</span>
<span class="c1">## 2.OJ.3    -294000   OJ  2.0</span>
<span class="c1">## 1.OJ.4      -1450   OJ  1.0</span>
<span class="c1">## 0.5.VC.5      112   VC  0.5</span>
<span class="c1">## 1.OJ.6      -2000   OJ  1.0</span>
<span class="c1">## 2.OJ.7    -245000   OJ  2.0</span>
<span class="c1">## 0.5.OJ.8     -100   OJ  0.5</span>
<span class="c1">## 0.5.OJ.9      -94   OJ  0.5</span>
<span class="c1">## 0.5.VC.10      70   VC  0.5</span>
</pre></div>
</div>
<p>Additionally, we can manually restore the original <code class="docutils literal notranslate"><span class="pre">row.names</span></code>,
et voilà.</p>
</div></div></section>
<section id="metaprogramming-based-techniques">
<span id="sec-metaprogramming-df"></span><h3><span class="section-number">12.3.9. </span>Metaprogramming-based techniques (*)<a class="headerlink" href="#metaprogramming-based-techniques" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="210-design.html#sec-metaprogramming-intro"><span class="std std-numref">Section 9.4.7</span></a> mentioned a few functions
that provide <em>convenient</em> interfaces to some common data frame operations.
These include <strong class="command">transform</strong>, <strong class="command">subset</strong>, <strong class="command">with</strong>,
and basically every procedure accepting a formula.
The popular <strong class="program">data.table</strong> and <strong class="program">dplyr</strong> packages
also belong to this class (<a class="reference internal" href="#sec-tidyverse"><span class="std std-numref">Section 12.3.10</span></a>).</p>
<p>Unfortunately, each method relying on metaprogramming must be studied
separately because it is free to interpret the <em>form</em> of the passed
arguments arbitrarily, without taking into account their <em>real</em> meaning.
As we are concerned with developing a more universal skill set,
we avoid<a class="footnote-reference brackets" href="#footbaseavoid" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a> them in this course. They do not offer
anything more than what we have learnt so far.</p>
<p>Withal, they are thought-provoking on their own.
Furthermore, they are popular in other users’ code.
Thus, after all, they deserve the honourable mention.</p>
<div class="proof proof-type-example" id="id48">

    <div class="proof-title">
        <span class="proof-type">Example 12.32</span>
        
    </div><div class="proof-content">
<p>Consider an example call to the <strong class="command">subset</strong> function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">subset</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="o">&lt;</span><span class="m">4.5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="o">:</span><span class="n">Petal.Width</span><span class="p">))</span>
<span class="c1">##    Sepal.Length Species</span>
<span class="c1">## 9           4.4  setosa</span>
<span class="c1">## 14          4.3  setosa</span>
<span class="c1">## 39          4.4  setosa</span>
<span class="c1">## 43          4.4  setosa</span>
</pre></div>
</div>
<p>Neither the second nor the third argument makes sense
as a standalone R expression. We have not defined
the named variables used there:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Sepal.Length</span><span class="o">&lt;</span><span class="m">4.5</span><span class="w">            </span><span class="c1"># utter nonsense</span>
<span class="c1">## Error in eval(expr, envir, enclos): object &#39;Sepal.Length&#39; not found</span>
<span class="o">-</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="o">:</span><span class="n">Petal.Width</span><span class="p">)</span><span class="w">  </span><span class="c1"># gibberish</span>
<span class="c1">## Error in eval(expr, envir, enclos): object &#39;Sepal.Width&#39; not found</span>
</pre></div>
</div>
<p>Only from <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;subset&quot;)</span></code> we can learn that this tool <em>assumes</em>
that the expression passed as the second argument
plays the role of a row selector. Moreover, the third one is meant
to remove all the columns between the two given ones.</p>
<p>In our course, we pay attention to developing <em>transferable</em> skills.
We believe that R is not the only language we will learn during
our long and happy lives. It is much more likely that in the next
environment, we will become used to writing something
of the more basic form:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">between</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">)</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">:</span><span class="nf">match</span><span class="p">(</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="n">iris</span><span class="p">[</span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">]]</span><span class="o">&lt;</span><span class="m">4.5</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="nf">between</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">iris</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Petal.Width&quot;</span><span class="p">)]</span>
<span class="c1">##    Sepal.Length Species</span>
<span class="c1">## 9           4.4  setosa</span>
<span class="c1">## 14          4.3  setosa</span>
<span class="c1">## 39          4.4  setosa</span>
<span class="c1">## 43          4.4  setosa</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id49">

    <div class="proof-title">
        <span class="proof-type">Example 12.33</span>
        
    </div><div class="proof-content">
<p>With <strong class="command">transform</strong>, we can add, modify, and remove
columns in a data frame. Existing features can be referred to
as if they were ordinary variables:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">mtcars4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)),</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;hp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;am&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mpg&quot;</span><span class="p">)])</span>
<span class="c1">##                     hp am  mpg</span>
<span class="c1">## Maserati Bora      335  1 15.0</span>
<span class="c1">## Cadillac Fleetwood 205  0 10.4</span>
<span class="c1">## Honda Civic         52  1 30.4</span>
<span class="c1">## Merc 450SLC        180  0 15.2</span>
<span class="nf">transform</span><span class="p">(</span><span class="n">mtcars4</span><span class="p">,</span><span class="w"> </span><span class="n">log_hp</span><span class="o">=</span><span class="nf">log</span><span class="p">(</span><span class="n">hp</span><span class="p">),</span><span class="w"> </span><span class="n">am</span><span class="o">=</span><span class="m">2</span><span class="o">*</span><span class="n">am</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">hp</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">fcon</span><span class="o">=</span><span class="m">235</span><span class="o">/</span><span class="n">mpg</span><span class="p">)</span>
<span class="c1">##                    am  mpg log_hp    fcon</span>
<span class="c1">## Maserati Bora       1 15.0 5.8141 15.6667</span>
<span class="c1">## Cadillac Fleetwood -1 10.4 5.3230 22.5962</span>
<span class="c1">## Honda Civic         1 30.4 3.9512  7.7303</span>
<span class="c1">## Merc 450SLC        -1 15.2 5.1930 15.4605</span>
</pre></div>
</div>
<p>Similarly, <strong class="command">attach</strong> adds any named list to the search path
(see <a class="reference internal" href="330-environment.html#sec-attach"><span class="std std-numref">Section 16.2.6</span></a>) but it does not support altering their contents.
As an alternative, <strong class="command">within</strong> may be called:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">within</span><span class="p">(</span><span class="n">mtcars4</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">log_hp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">hp</span><span class="p">)</span>
<span class="w">    </span><span class="n">fcon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">235</span><span class="o">/</span><span class="n">mpg</span>
<span class="w">    </span><span class="n">am</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;no&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">hp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
<span class="p">})</span>
<span class="c1">##                     am  mpg    fcon log_hp</span>
<span class="c1">## Maserati Bora      yes 15.0 15.6667 5.8141</span>
<span class="c1">## Cadillac Fleetwood  no 10.4 22.5962 5.3230</span>
<span class="c1">## Honda Civic        yes 30.4  7.7303 3.9512</span>
<span class="c1">## Merc 450SLC         no 15.2 15.4605 5.1930</span>
</pre></div>
</div>
<p>Those who find writing <code class="docutils literal notranslate"><span class="pre">mtcars4[[&quot;name&quot;]]</span></code> instead of <code class="docutils literal notranslate"><span class="pre">name</span></code> too exhausting,
can save a few keystrokes.</p>
</div></div><div class="proof proof-type-example" id="id50">

    <div class="proof-title">
        <span class="proof-type">Example 12.34</span>
        
    </div><div class="proof-content">
<p>As mentioned in <a class="reference internal" href="220-s3.html#sec-formula-intro"><span class="std std-numref">Section 10.3.4</span></a> (see <a class="reference internal" href="340-lazy.html#sec-formula"><span class="std std-numref">Section 17.6</span></a>
for more details), formulae are special objects that consist of two
unevaluated expressions separated by a tilde, `<strong class="command">~</strong>`.
Functions can support formulae and do what they please with them.
However, a popular approach is to allow them to express
“something grouped by something else”
or “one thing as a function of other things”.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind.data.frame</span><span class="p">,</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">supp</span><span class="o">+</span><span class="n">dose</span><span class="p">),</span><span class="w"> </span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">##         len supp dose</span>
<span class="c1">## OJ.0.5 15.2   OJ  0.5</span>
<span class="c1">## VC.0.5  4.2   VC  0.5</span>
<span class="c1">## OJ.1   19.7   OJ  1.0</span>
<span class="c1">## VC.1   16.5   VC  1.0</span>
<span class="c1">## OJ.2   25.5   OJ  2.0</span>
<span class="c1">## VC.2   23.6   VC  2.0</span>
<span class="nf">aggregate</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">log_hp</span><span class="o">=</span><span class="nf">log</span><span class="p">(</span><span class="n">hp</span><span class="p">))</span><span class="o">~</span><span class="n">am</span><span class="o">:</span><span class="n">cyl</span><span class="p">,</span><span class="w"> </span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="c1">##   am cyl    mpg log_hp</span>
<span class="c1">## 1  0   4 22.900 4.4186</span>
<span class="c1">## 2  1   4 28.075 4.3709</span>
<span class="c1">## 3  0   6 19.125 4.7447</span>
<span class="c1">## 4  1   6 20.567 4.8552</span>
<span class="c1">## 5  0   8 15.050 5.2553</span>
<span class="c1">## 6  1   8 15.400 5.6950</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">model.frame</span><span class="p">(</span><span class="n">mpg</span><span class="o">+</span><span class="n">hp</span><span class="o">~</span><span class="nf">log</span><span class="p">(</span><span class="n">hp</span><span class="p">)</span><span class="o">+</span><span class="nf">I</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">qsec</span><span class="p">),</span><span class="w"> </span><span class="n">mtcars</span><span class="p">))</span>
<span class="c1">##                   mpg + hp log(hp)    I(1/qsec)</span>
<span class="c1">## Mazda RX4            131.0  4.7005 0.060753....</span>
<span class="c1">## Mazda RX4 Wag        131.0  4.7005 0.058754....</span>
<span class="c1">## Datsun 710           115.8  4.5326 0.053734....</span>
<span class="c1">## Hornet 4 Drive       131.4  4.7005 0.051440....</span>
<span class="c1">## Hornet Sportabout    193.7  5.1648 0.058754....</span>
<span class="c1">## Valiant              123.1  4.6540 0.049455....</span>
</pre></div>
</div>
<p>If these examples seem esoteric, it is because it is precisely the case.
We need to consult the corresponding functions’ manuals to discover what
they do. And, as we do not recommend their use to beginner programmers,
we will not explain them here. Don’t trip.</p>
</div></div><div class="proof proof-type-exercise" id="id51">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.35</span>
        
    </div><div class="proof-content">
<p>In the last example, the peculiar printing of the last column
is due to which method’s being overloaded?</p>
</div></div><p>In the third part of this book, we will return to these functions
for they will serve as an amusing illustration of how to indite
our own procedures that rely on metaprogramming techniques.</p>
</section>
<section id="a-note-on-the-dplyr-tidyverse-and-data-table-packages">
<span id="sec-tidyverse"></span><h3><span class="section-number">12.3.10. </span>A note on the <strong class="program">dplyr</strong> (<strong class="program">tidyverse</strong>) and <strong class="program">data.table</strong> packages (*)<a class="headerlink" href="#a-note-on-the-dplyr-tidyverse-and-data-table-packages" title="Link to this heading">#</a></h3>
<p><strong class="program">data.table</strong> and <strong class="program">dplyr</strong> are very popular packages
that implement common data frame transformations. In particular,
the latter is part of an immerse system of interdependent extensions
called <strong class="command">tidyverse</strong> which became quite invasive over the last
few years. They both heavily rely on metaprogramming.</p>
<p>They introduce entirely new APIs featuring hundreds of functions
for the operations we already know well how to perform
(the calamity of superabundance). Still, their users must remember
that they will <em>need</em> to rely on base functions when
the processing of other prominent data structures is required,
e.g., of fancy lists and matrices.</p>
<p>Base R (and its predecessor, S) has long ago proven
to be a versatile tool for rapid prototyping, calling specialised procedures
written in C or Java, and wrangling data that <em>fit into memory</em>.
Even though some operations from the mentioned packages
may be much faster for larger datasets, the speed is less often an issue
in practice than what most users might think.</p>
<p>For larger problems, techniques for working with batches of data, sampling
methods, or aggregating data stored elsewhere are often the way to go,
especially when building machine learning models or
visualisation<a class="footnote-reference brackets" href="#footlargeplot" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a> is required. Usually, the most recent data
will be stored in external, normalised databases, and we will need to
join a few tables to fetch something valuable from the perspective
of the current task’s context.</p>
<p>Thus, we cannot stress enough that, in many situations, SQL, not the other
tools, is the most powerful interface to more considerable amounts of data.
Learning it will give us the skills we can use later in other
programming environments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Of course, certain functions from <strong class="command">tidyverse</strong> and related packages
we will find very helpful after all. Quite annoyingly,
they tend to return objects of the class <code class="docutils literal notranslate"><span class="pre">tibble</span></code> (<code class="docutils literal notranslate"><span class="pre">tbl_df</span></code>)
(e.g., <strong class="program">haven</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">read.xpt</strong> that
reads <code class="docutils literal notranslate"><span class="pre">SAS</span></code> data files).
Luckily, they are subclasses of <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>;
we can always use <strong class="command">as.data.frame</strong> to get our
favourite objects back.</p>
</div>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">12.4. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<div class="proof proof-type-exercise" id="id52">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.36</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>What attributes a data frame is equipped with?</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">row.names</span></code> is an integer vector, how to access rows
labelled <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">7</span></code>, and <code class="docutils literal notranslate"><span class="pre">42</span></code>?</p></li>
<li><p>How to create a data frame that carries a column that is
a list of character vectors of different lengths?</p></li>
<li><p>How to create a data frame that includes a matrix column?</p></li>
<li><p>How to convert all numeric columns in a data frame to a numeric matrix?</p></li>
<li><p>Assuming that <code class="docutils literal notranslate"><span class="pre">x</span></code> is an atomic vector,
what is the difference between
<strong class="command">as.data.frame</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>,
<strong class="command">as.data.frame</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">as.list</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>,
<strong class="command">as.data.frame</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(a=x))</span></code>, and
<strong class="command">data.frame</strong><code class="code docutils literal notranslate"><span class="pre">(a=x)</span></code>?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id53">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.37</span>
        
    </div><div class="proof-content">
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">x</span></code> is a data frame, what is the meaning of/difference between
the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x[&quot;u&quot;]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[[&quot;u&quot;]]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[,</span> <span class="pre">&quot;u&quot;]</span></code>?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[&quot;u&quot;][1]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[[&quot;u&quot;]][1]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[1,</span> <span class="pre">&quot;u&quot;]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[1,</span> <span class="pre">&quot;u&quot;,</span> <span class="pre">drop=FALSE]</span></code>?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">which</strong><code class="code docutils literal notranslate"><span class="pre">(x[[1]]</span> <span class="pre">&gt;</span> <span class="pre">0),</span> <span class="pre">]</span></code> vs <code class="docutils literal notranslate"><span class="pre">x[x[[1]]</span> <span class="pre">&gt;</span> <span class="pre">0,</span> <span class="pre">]</span></code>?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">grep</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;^foo&quot;,</span> </code><strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(x))]</span></code>?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id54">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.38</span>
        
    </div><div class="proof-content">
<p>We have a data frame with columns named like:
<code class="docutils literal notranslate"><span class="pre">ID</span></code> (character),
<code class="docutils literal notranslate"><span class="pre">checked</span></code> (logical, possibly with missing values),
<code class="docutils literal notranslate"><span class="pre">category</span></code> (factor),
<code class="docutils literal notranslate"><span class="pre">x0</span></code>, …, <code class="docutils literal notranslate"><span class="pre">x9</span></code> (ten separate numeric columns),
<code class="docutils literal notranslate"><span class="pre">y0</span></code>, …, <code class="docutils literal notranslate"><span class="pre">y9</span></code> (ten separate numeric columns),
<code class="docutils literal notranslate"><span class="pre">coords</span></code> (numeric matrix with two columns named <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">long</span></code>),
and
<code class="docutils literal notranslate"><span class="pre">features</span></code> (list of character vectors of different lengths).</p>
<ul class="simple">
<li><p>How to extract the rows where <code class="docutils literal notranslate"><span class="pre">checked</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>?</p></li>
<li><p>How to extract the rows for which <code class="docutils literal notranslate"><span class="pre">ID</span></code> is like three letters
and then five digits (e.g., <code class="docutils literal notranslate"><span class="pre">XYZ12345</span></code>)?</p></li>
<li><p>How to select all the numeric columns in one go?</p></li>
<li><p>How to extract a subset comprised only of the <code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code>-something
columns?</p></li>
<li><p>How to get rid of all the columns between <code class="docutils literal notranslate"><span class="pre">x3</span></code> and <code class="docutils literal notranslate"><span class="pre">y7</span></code>?</p></li>
<li><p>Assuming that the <code class="docutils literal notranslate"><span class="pre">ID</span></code>s are like three letters and then five digits,
how to add two columns: <code class="docutils literal notranslate"><span class="pre">ID3</span></code> (the letters) and <code class="docutils literal notranslate"><span class="pre">ID5</span></code> (the five digits)?</p></li>
<li><p>How to check where both <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">long</span></code> in <code class="docutils literal notranslate"><span class="pre">coords</span></code> are negative?</p></li>
<li><p>How to add the column indicating the number of <code class="docutils literal notranslate"><span class="pre">features</span></code>?</p></li>
<li><p>How to extract the rows where <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code> is amongst the <code class="docutils literal notranslate"><span class="pre">features</span></code>?</p></li>
<li><p>How to convert it to a long data frame with two columns:
<code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">feature</span></code> (individual strings)?</p></li>
<li><p>How to change the name of the <code class="docutils literal notranslate"><span class="pre">ID</span></code> column to <code class="docutils literal notranslate"><span class="pre">id</span></code>?</p></li>
<li><p>How to make the <code class="docutils literal notranslate"><span class="pre">y</span></code>-foo columns appear before the <code class="docutils literal notranslate"><span class="pre">x</span></code>-bar ones?</p></li>
<li><p>How to order the rows with respect to <code class="docutils literal notranslate"><span class="pre">checked</span></code> (<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>
first, then <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>) and <code class="docutils literal notranslate"><span class="pre">ID</span></code>s (decreasingly)?</p></li>
<li><p>How to remove rows with duplicate IDs?</p></li>
<li><p>How to determine how many entries correspond to each <code class="docutils literal notranslate"><span class="pre">category</span></code>?</p></li>
<li><p>How to compute the average <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">long</span></code> in each <code class="docutils literal notranslate"><span class="pre">category</span></code>?</p></li>
<li><p>How to compute the average <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">long</span></code> for each <code class="docutils literal notranslate"><span class="pre">category</span></code> and
<code class="docutils literal notranslate"><span class="pre">checked</span></code> combined?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id55">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.39</span>
        
    </div><div class="proof-content">
<p>Consider the <a class="reference external" href="https://github.com/gagolews/teaching-data/blob/master/other/flights.csv"><code class="docutils literal notranslate"><span class="pre">flights</span></code></a> dataset.
Give some ways to select all rows between March and October
(regardless of the year).</p>
</div></div><div class="proof proof-type-exercise" id="id56">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.40</span>
        
    </div><div class="proof-content">
<p>In this task, you will be working with a version of a
dataset on 70k+ Melbourne trees (<a class="reference external" href="https://github.com/gagolews/teaching-data/raw/master/marek/urban_forest.csv.gz"><code class="docutils literal notranslate"><span class="pre">urban_forest</span></code></a>).</p>
<ol class="arabic simple">
<li><p>Load the downloaded dataset by calling the <strong class="command">read.csv</strong> function.</p></li>
<li><p>Fetch the IDs (<code class="docutils literal notranslate"><span class="pre">CoM.ID</span></code>)
and trunk diameters (<code class="docutils literal notranslate"><span class="pre">Diameter.Breast.Height</span></code>)
of the horse chestnuts with five smallest diameters at breast height.
The output data frame must be sorted with respect to
<code class="docutils literal notranslate"><span class="pre">Diameter.Breast.Height</span></code>, decreasingly.</p></li>
<li><p>Create a new data frame that gives the number of trees planted
in each year.</p></li>
<li><p>Compute the average age (in years, based on <code class="docutils literal notranslate"><span class="pre">Year.Planted</span></code>)
of the trees of genera (each genus separately):
Eucalyptus, Platanus, Ficus, Acer, and Quercus.</p></li>
</ol>
</div></div><div class="proof proof-type-exercise" id="id57">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.41</span>
        
    </div><div class="proof-content">
<p>(*)
Consider the historic data dumps of
<a class="reference external" href="https://travel.stackexchange.com/">Stack Exchange</a>
available <a class="reference external" href="https://github.com/gagolews/teaching-data/tree/master/travel_stackexchange_com_2017">here</a>.
Export these CSV files to an SQLite database.
Then, write some R code that corresponds to the following SQL queries.
Use <strong class="command">dbGetQuery</strong> to verify your results.</p>
<p>First:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">Age</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="k">Location</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Posts</span><span class="p">.</span><span class="n">FavoriteCount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FavoriteTotal</span><span class="p">,</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MostFavoriteQuestion</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">Posts</span><span class="p">.</span><span class="n">FavoriteCount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MostFavoriteQuestionLikes</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Users</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">Posts</span><span class="p">.</span><span class="n">OwnerUserId</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">PostTypeId</span><span class="o">=</span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OwnerUserId</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FavoriteTotal</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
<p>Second:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">    </span><span class="n">Posts2</span><span class="p">.</span><span class="n">PositiveAnswerCount</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">Posts</span><span class="p">.</span><span class="n">ParentID</span><span class="p">,</span>
<span class="w">            </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PositiveAnswerCount</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">PostTypeID</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">Score</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">ParentID</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Posts2</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">Posts2</span><span class="p">.</span><span class="n">ParentID</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Posts2</span><span class="p">.</span><span class="n">PositiveAnswerCount</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
<p>Third:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">    </span><span class="n">UpVotesPerYear</span><span class="p">.</span><span class="k">Year</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">UpVotesPerYear</span><span class="p">.</span><span class="k">Count</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Count</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">PostId</span><span class="p">,</span>
<span class="w">            </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Count</span><span class="p">,</span>
<span class="w">            </span><span class="n">STRFTIME</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Votes</span><span class="p">.</span><span class="n">CreationDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Year</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Votes</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">VoteTypeId</span><span class="o">=</span><span class="mi">2</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PostId</span><span class="p">,</span><span class="w"> </span><span class="k">Year</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UpVotesPerYear</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">Posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">UpVotesPerYear</span><span class="p">.</span><span class="n">PostId</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">PostTypeId</span><span class="o">=</span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">Year</span>
</pre></div>
</div>
<p>Fourth:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Questions</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">    </span><span class="n">Questions</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">    </span><span class="n">BestAnswers</span><span class="p">.</span><span class="n">MaxScore</span><span class="p">,</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Score</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AcceptedScore</span><span class="p">,</span>
<span class="w">    </span><span class="n">BestAnswers</span><span class="p">.</span><span class="n">MaxScore</span><span class="o">-</span><span class="n">Posts</span><span class="p">.</span><span class="n">Score</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Difference</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">ParentId</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MaxScore</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">PostTypeId</span><span class="o">==</span><span class="mi">2</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ParentId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BestAnswers</span>
<span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">PostTypeId</span><span class="o">==</span><span class="mi">1</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Questions</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">Questions</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">BestAnswers</span><span class="p">.</span><span class="n">ParentId</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">Posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Questions</span><span class="p">.</span><span class="n">AcceptedAnswerId</span><span class="o">=</span><span class="n">Posts</span><span class="p">.</span><span class="n">Id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Difference</span><span class="o">&gt;</span><span class="mi">50</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Difference</span><span class="w"> </span><span class="k">DESC</span>
</pre></div>
</div>
<p>Fifth:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">    </span><span class="n">CmtTotScr</span><span class="p">.</span><span class="n">CommentsTotalScore</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">PostID</span><span class="p">,</span>
<span class="w">            </span><span class="n">UserID</span><span class="p">,</span>
<span class="w">            </span><span class="k">SUM</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CommentsTotalScore</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Comments</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PostID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CmtTotScr</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">Posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">CmtTotScr</span><span class="p">.</span><span class="n">PostID</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">OwnerUserId</span><span class="o">=</span><span class="n">CmtTotScr</span><span class="p">.</span><span class="n">UserID</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">PostTypeId</span><span class="o">=</span><span class="mi">1</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CmtTotScr</span><span class="p">.</span><span class="n">CommentsTotalScore</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
<p>Sixth:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">Reputation</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="n">Age</span><span class="p">,</span>
<span class="w">    </span><span class="n">Users</span><span class="p">.</span><span class="k">Location</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Badges</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">Name</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">Badges</span>
<span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="k">Class</span><span class="o">=</span><span class="mi">1</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Name</span>
<span class="w">            </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="k">Class</span><span class="o">=</span><span class="mi">1</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ValuableBadges</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ValuableBadges</span><span class="p">.</span><span class="n">UserId</span><span class="o">=</span><span class="n">Users</span><span class="p">.</span><span class="n">Id</span>
</pre></div>
</div>
<p>Seventh:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Posts</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">    </span><span class="n">VotesByAge2</span><span class="p">.</span><span class="n">OldVotes</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Posts</span>
<span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">PostId</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">VoteDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;new&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="n">NewVotes</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">VoteDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;old&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="n">OldVotes</span><span class="p">,</span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Total</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Votes</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">PostId</span><span class="p">,</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="n">STRFTIME</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">CreationDate</span><span class="p">)</span>
<span class="w">                </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;2017&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;new&#39;</span>
<span class="w">                </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;2016&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;new&#39;</span>
<span class="w">                </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;old&#39;</span>
<span class="w">                </span><span class="k">END</span><span class="w"> </span><span class="n">VoteDate</span><span class="p">,</span>
<span class="w">            </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Votes</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">VoteTypeId</span><span class="o">=</span><span class="mi">2</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PostId</span><span class="p">,</span><span class="w"> </span><span class="n">VoteDate</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VotesByAge</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">VotesByAge</span><span class="p">.</span><span class="n">PostId</span>
<span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="n">NewVotes</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VotesByAge2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">VotesByAge2</span><span class="p">.</span><span class="n">PostId</span><span class="o">=</span><span class="n">Posts</span><span class="p">.</span><span class="n">ID</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">Posts</span><span class="p">.</span><span class="n">PostTypeId</span><span class="o">=</span><span class="mi">1</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">VotesByAge2</span><span class="p">.</span><span class="n">OldVotes</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id58">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.42</span>
        
    </div><div class="proof-content">
<p>(*)
Generate a CSV file that stores some random data arranged in
a few columns of a size at least two times larger than your available RAM.
Then, export the CSV file to an SQLite database.
Use file connections (<a class="reference internal" href="180-flow.html#sec-time-complexity"><span class="std std-numref">Section 8.3.5</span></a>) and the
<code class="docutils literal notranslate"><span class="pre">nrow</span></code> argument to <strong class="command">read.table</strong> to process it chunk by chunk.
Determine whether setting <code class="docutils literal notranslate"><span class="pre">colClasses</span></code> in <strong class="command">read.table</strong>
speeds up the reading of large CSV files significantly or not.</p>
</div></div><div class="proof proof-type-exercise" id="id59">

    <div class="proof-title">
        <span class="proof-type">Exercise 12.43</span>
        
    </div><div class="proof-content">
<p>(*) Export the whole XML data dump of
<a class="reference external" href="https://stackoverflow.com/">StackOverflow</a> published
at <a class="reference external" href="https://archive.org/details/stackexchange">https://archive.org/details/stackexchange</a>
(see also <a class="reference external" href="https://data.stackexchange.com/">https://data.stackexchange.com/</a>)
to an SQLite database.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footstructured" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>We are already highly skilled in dealing with
unstructured data and turning them into something that is much
more regular. The numerous functions, which
we have covered in the first part of this book,
allow us to extract meaningful data from text,
handle missing values, engineer features, and so forth.</p>
</aside>
<aside class="footnote brackets" id="footcolattr" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>The attributes of objects stored as columns will
generally be preserved (even if they are not displayed
by <strong class="command">print</strong>; see <strong class="command">str</strong> though).</p>
</aside>
<aside class="footnote brackets" id="footcbinddf" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">3</a><span class="fn-bracket">]</span></span>
<p>This is a clear violation of the rule that an S3 generic
dispatches on the type of only one argument (usually: the first).
It is an exception made for the sake of the questionable user
<em>convenience</em>. Also, note that there is no <strong class="command">cbind.default</strong>
method available: it is hardcoded at the C language level.</p>
</aside>
<aside class="footnote brackets" id="footrownamesrepl" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">4</a><span class="fn-bracket">]</span></span>
<p>`<strong class="command">attr&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(df,</span> <span class="pre">&quot;row.names&quot;,</span> <span class="pre">value)</span></code>
does not run the same sanity checks as
`<strong class="command">row.names&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(df,</span> <span class="pre">value)</span></code>.
For instance, it is easy to corrupt a data frame
by setting too short a <code class="docutils literal notranslate"><span class="pre">row.names</span></code> attribute.</p>
</aside>
<aside class="footnote brackets" id="footnotedflist" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">5</a><span class="fn-bracket">]</span></span>
<p>This is a strong word.
This implication relies on an implicit assumption
that the primitive functions <strong class="command">length</strong> and <strong class="command">names</strong>
have not been contaminated by treating data frames differently from
named lists. Luckily, that is indeed not the case.
Even though we have the index operators specially
overloaded for the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> class, they behave
reasonably. As we will see, they support a mix of
list- and matrix-like behaviours.</p>
</aside>
<aside class="footnote brackets" id="footpandassetindex" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">6</a><span class="fn-bracket">]</span></span>
<p>(*) Compare <strong class="command">pandas.DataFrame.set_index</strong>
and <strong class="command">pandas.DataFrame.reset_index</strong> in Python.</p>
</aside>
<aside class="footnote brackets" id="footjoin" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">7</a><span class="fn-bracket">]</span></span>
<p>Join is the reverse operation to data normalisation from
relational database theory. It reduces data redundancy and increases
their integrity. What data scientists need  in data analysis,
visualisation, and processing activities is sometimes the opposite
of what the art of data management focuses on, i.e., efficient
collection and storage of information. The readers are encouraged
to learn about various normalisation forms from, e.g., <span id="id16">[<a class="reference internal" href="999-bibliography.html#id71" title="Date, C.J. (2003).  An Introduction to Database Systems. Pearson.">16</a>]</span>
or any other course covering this topic.</p>
</aside>
<aside class="footnote brackets" id="footnotmatrix" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">8</a><span class="fn-bracket">]</span></span>
<p>Provided that a data frame does not carry
a matrix column.</p>
</aside>
<aside class="footnote brackets" id="footcrosseddesign" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">9</a><span class="fn-bracket">]</span></span>
<p>The original dataset can be thought of as
representing a fully crossed design experiment
(all combinations of two grouping variables are present).
Its truncated version is like an incomplete crossed design.</p>
</aside>
<aside class="footnote brackets" id="footbaseavoid" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">10</a><span class="fn-bracket">]</span></span>
<p>We are not alone in our calling to refrain
from using them. <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;subset&quot;)</span></code>  (and <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;transform&quot;)</span></code>
similarly) warns: <em>This is a convenience function intended for use
interactively. For programming, it is better to use the standard
subsetting functions like `<strong class="command">[</strong>`, and in particular the
nonstandard evaluation of argument <strong class="command">subset</strong> can have
unanticipated consequences.</em>
The same in <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;with&quot;)</span></code>:
<em>For</em> interactive <em>use, this is very effective and nice to read.
For programming however, i.e., in one’s functions, more care is needed,
and typically one should refrain from using <strong class="command">with</strong>,
as, e.g., variables in data may accidentally override local variables.</em></p>
</aside>
<aside class="footnote brackets" id="footlargeplot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">11</a><span class="fn-bracket">]</span></span>
<p>For example, drawing scatter plots
of billions of points makes little sense as they may result
in unreadable images of large file sizes. The points
need to be sampled or summarised somehow (e.g., binned);
see <a class="reference internal" href="250-graphics.html#chap-graphics"><span class="std std-numref">Chapter 13</span></a>.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="250-graphics.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">13. </span>Graphics</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="230-matrix.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">11. </span>Matrices and other arrays</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2024 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2024-06-10T11:28:18+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">12. Data frames</a><ul>
<li><a class="reference internal" href="#creating-data-frames">12.1. Creating data frames</a><ul>
<li><a class="reference internal" href="#data-frame-and-as-data-frame">12.1.1. <strong class="command">data.frame</strong> and <strong class="command">as.data.frame</strong></a></li>
<li><a class="reference internal" href="#cbind-data-frame-and-rbind-data-frame">12.1.2. <strong class="command">cbind.data.frame</strong> and <strong class="command">rbind.data.frame</strong></a></li>
<li><a class="reference internal" href="#reading-data-frames">12.1.3. Reading data frames</a></li>
<li><a class="reference internal" href="#interfacing-relational-databases-and-querying-with-sql">12.1.4. Interfacing relational databases and querying with SQL (*)</a></li>
<li><a class="reference internal" href="#strings-as-factors">12.1.5. Strings as factors?</a></li>
<li><a class="reference internal" href="#internal-representation">12.1.6. Internal representation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-frame-subsetting">12.2. Data frame subsetting</a><ul>
<li><a class="reference internal" href="#data-frames-are-lists">12.2.1. Data frames are lists</a></li>
<li><a class="reference internal" href="#data-frames-are-matrix-like">12.2.2. Data frames are matrix-like</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-operations">12.3. Common operations</a><ul>
<li><a class="reference internal" href="#ordering-rows">12.3.1. Ordering rows</a></li>
<li><a class="reference internal" href="#handling-duplicated-rows">12.3.2. Handling duplicated rows</a></li>
<li><a class="reference internal" href="#joining-merging-data-frames">12.3.3. Joining (merging) data frames</a></li>
<li><a class="reference internal" href="#aggregating-and-transforming-columns">12.3.4. Aggregating and transforming columns</a></li>
<li><a class="reference internal" href="#handling-missing-values">12.3.5. Handling missing values</a></li>
<li><a class="reference internal" href="#reshaping-data-frames">12.3.6. Reshaping data frames</a></li>
<li><a class="reference internal" href="#aggregating-data-in-groups">12.3.7. Aggregating data in groups</a></li>
<li><a class="reference internal" href="#transforming-data-in-groups">12.3.8. Transforming data in groups</a></li>
<li><a class="reference internal" href="#metaprogramming-based-techniques">12.3.9. Metaprogramming-based techniques (*)</a></li>
<li><a class="reference internal" href="#a-note-on-the-dplyr-tidyverse-and-data-table-packages">12.3.10. A note on the <strong class="program">dplyr</strong> (<strong class="program">tidyverse</strong>) and <strong class="program">data.table</strong> packages (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">12.4. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=ec7d7b54"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=deb2f140"></script>
    <script src="../_static/auto-render.min.js?v=8b9f325c"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>