<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="11. Matrices and other arrays" href="230-matrix.html" /><link rel="prev" title="9. Designing functions" href="210-design.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/220-s3.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/deepr.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>10. S3 classes - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/deepr.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.0.9005
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing functions</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="s3-classes">
<span id="chap-s3"></span><h1><span class="section-number">10. </span>S3 classes<a class="headerlink" href="#s3-classes" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2024).  Minimalist Data Wrangling with Python. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">27</a>]</span> too.</em></p>
</div></blockquote>
<p>Let <code class="docutils literal notranslate"><span class="pre">x</span></code> be a randomly generated matrix with 1 000 000 rows and 1 000 columns,
<code class="docutils literal notranslate"><span class="pre">y</span></code> be a data frame with results from the latest survey indicating that
things are way more complicated than what most people think,
and <code class="docutils literal notranslate"><span class="pre">z</span></code> be another matrix, this time with many zeroes.</p>
<p>The human brain is not capable of dealing with excessive data
that are immoderately specific. This is why we have a natural tendency
to <em>group</em> different entities based on their similarities.
This way, we form more abstract classes of objects.</p>
<p>Also, many of us are inherently lazy. Oftentimes we take shortcuts
to minimise energy (at a price to be paid later).</p>
<p>Printing out a matrix, a data frame, and a time series
are all instances of the displaying of things,
although they undoubtedly differ in detail.
By now, we have probably forgotten which objects are hidden behind
the aforementioned <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code>.
Being able to simply call <strong class="command">print</strong><code class="code docutils literal notranslate"><span class="pre">(y)</span></code>
without having to recall that, yes, <code class="docutils literal notranslate"><span class="pre">y</span></code> is a data frame,
seems appealing.</p>
<p>This chapter introduces <em>S3 classes</em> <span id="id2">[<a class="reference internal" href="999-bibliography.html#id52" title="Chambers, J.M. and Hastie, T.J. (1991).  Statistical Models in S. Chapman &amp; Hall.">13</a>]</span>.
They provide a lightweight object-orientated programming (OOP) approach
for automated dispatching calls to <em>generics</em>
of the type <strong class="command">print</strong><code class="code docutils literal notranslate"><span class="pre">(y)</span></code> to concrete <em>methods</em>
such as <strong class="command">print.data.frame</strong><code class="code docutils literal notranslate"><span class="pre">(y)</span></code>,
based on the <em>class</em> of the object they are invoked on.</p>
<p>We shall see that S3 classes in their essence are beautifully
simple<a class="footnote-reference brackets" href="#foots3limits" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Ultimately, <em>generics</em> and <em>methods</em> are ordinary R
functions (<a class="reference internal" href="170-function.html#chap-function"><span class="std std-numref">Chapter 7</span></a>) and <em>classes</em>
are merely additional object attributes (<a class="reference internal" href="140-list.html#sec-attribute"><span class="std std-numref">Section 4.4</span></a>).</p>
<p>Of course, this does not mean that wrapping our heads around them
will be effortless. However, unlike other “class systems”<a class="footnote-reference brackets" href="#foototherclass" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>,
S3 is ubiquitous in most R programming projects. Suffice it to say
that factors, matrices, and data frames discussed in the coming chapters
are straightforward, S3-based extensions of the concepts we
are about to introduce.</p>
<section id="object-type-vs-class">
<span id="sec-type-vs-class"></span><h2><span class="section-number">10.1. </span>Object type vs class<a class="headerlink" href="#object-type-vs-class" title="Link to this heading">¶</a></h2>
<p>Recall that <strong class="command">typeof</strong> (introduced in <a class="reference internal" href="140-list.html#sec-type-hierarchy"><span class="std std-numref">Section 4.1</span></a>)
returns the <em>internal</em> type of an object.
So far, we were mostly focused on atomic and generic vectors;
compare <a class="reference internal" href="000-preface.html#fig-data-types-overview"><span class="std std-numref">Figure 1</span></a> in the Preface.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
<span class="c1">## [1] &quot;NULL&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">))</span>
<span class="c1">## [1] &quot;logical&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">))</span>
<span class="c1">## [1] &quot;double&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">))</span>
<span class="c1">## [1] &quot;character&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">))</span>
<span class="c1">## [1] &quot;list&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;closure&quot;</span>
</pre></div>
</div>
<p>The number of admissible types is small<a class="footnote-reference brackets" href="#footsexptype" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, but they open the
world of endless possibilities<a class="footnote-reference brackets" href="#footexternalptr" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.
They provide a basis for more complex data structures.
This is thanks to the fact that they can be equipped
with arbitrary attributes (<a class="reference internal" href="140-list.html#sec-attribute"><span class="std std-numref">Section 4.4</span></a>).</p>
<p>Most <em>compound types</em> constructed using the mechanisms
discussed in this chapter only <em>pretend</em> they are something
different from what they actually are. Still, they often do their job very
well. By looking under their bonnet, we will be able to manipulate their
state outside of the prescribed use cases.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Setting the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute might make some objects
behave differently in certain scenarios.</p>
</div>
<div class="proof proof-type-example" id="id45">

    <div class="proof-title">
        <span class="proof-type">Example 10.1</span>
        
    </div><div class="proof-content">
<p>Let’s equip two identical objects with different <code class="docutils literal notranslate"><span class="pre">class</span></code> attributes.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">xt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="m">123</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;POSIXct&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># POSIX calendar time</span>
<span class="n">xd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="m">123</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;Date&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Both objects are <em>represented</em> using numeric vectors:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="nf">typeof</span><span class="p">(</span><span class="n">xt</span><span class="p">),</span><span class="w"> </span><span class="nf">typeof</span><span class="p">(</span><span class="n">xd</span><span class="p">))</span>
<span class="c1">## [1] &quot;double&quot; &quot;double&quot;</span>
</pre></div>
</div>
<p>However, when printed, they are <em>decoded</em> differently:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
<span class="c1">## [1] &quot;1970-01-01 01:02:03 CET&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">xd</span><span class="p">)</span>
<span class="c1">## [1] &quot;1970-05-04&quot;</span>
</pre></div>
</div>
<p>In the former case, 123 is understood as the number of <em>seconds</em>
since the <em>UNIX epoch</em>, 1970-01-01T00:00:00+0000.
The latter is deciphered as the number of <em>days</em> since the said timestamp.</p>
<p>Therefore, we expect that there must exist a mechanism
that calls a <em>version</em> of <strong class="command">print</strong> dependent on an
object’s virtual class.</p>
<p>That it only relies on the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute,
which might be set, unset, or reset freely,
is emphasised below.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;class&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Date&quot;</span><span class="w">  </span><span class="c1"># change class from POSIXct to Date</span>
<span class="nf">print</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span><span class="w">  </span><span class="c1"># same 123, but now interpreted as Date</span>
<span class="c1">## [1] &quot;1970-05-04&quot;</span>
<span class="nf">as.numeric</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span><span class="w">  </span><span class="c1"># drops all attributes</span>
<span class="c1">## [1] 123</span>
<span class="nf">unclass</span><span class="p">(</span><span class="n">xd</span><span class="p">)</span><span class="w">  </span><span class="c1"># drops the class attribute; `attr&lt;-`(xd, &quot;class&quot;, NULL)</span>
<span class="c1">## [1] 123</span>
</pre></div>
</div>
</div></div><p>We are having so much fun that one more illustration can only
increase our joy.</p>
<div class="proof proof-type-example" id="id46">

    <div class="proof-title">
        <span class="proof-type">Example 10.2</span>
        
    </div><div class="proof-content">
<p>Consider an example data frame:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w">  </span><span class="c1"># a subset of an example data frame</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##   Sepal.Length Sepal.Width</span>
<span class="c1">## 1          5.1         3.5</span>
<span class="c1">## 2          4.9         3.0</span>
<span class="c1">## 3          4.7         3.2</span>
</pre></div>
</div>
<p>It is an object of the class
(an object whose <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute is set to):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;class&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;data.frame&quot;</span>
</pre></div>
</div>
<p>Some may say, and they are absolutely right, that
we have not covered data frames yet. After all, they are the topic of
<a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>, which is still ahead of us.
However, from the current perspective, we should know that
R data frames are nothing but lists of vectors
of the same lengths equipped with the <code class="docutils literal notranslate"><span class="pre">names</span></code> and <code class="docutils literal notranslate"><span class="pre">row.names</span></code> attributes.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;list&quot;</span>
<span class="nf">`attr&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;class&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">  </span><span class="c1"># or unclass(x)</span>
<span class="c1">## $Sepal.Length</span>
<span class="c1">## [1] 5.1 4.9 4.7</span>
<span class="c1">##</span>
<span class="c1">## $Sepal.Width</span>
<span class="c1">## [1] 3.5 3.0 3.2</span>
<span class="c1">##</span>
<span class="c1">## attr(,&quot;row.names&quot;)</span>
<span class="c1">## [1] 1 2 3</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##   Sepal.Length Sepal.Width</span>
<span class="c1">## 1          5.1         3.5</span>
<span class="c1">## 2          4.9         3.0</span>
<span class="c1">## 3          4.7         3.2</span>
</pre></div>
</div>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Revealing how <code class="docutils literal notranslate"><span class="pre">x</span></code> is <em>actually</em> represented enables us to process it
using the extensive skill set that we have already<a class="footnote-reference brackets" href="#footsplit" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>
developed by studying the material covered in the previous part of our book
(including all the exercises). This fact is noteworthy because some
built-in and third-party data types are not particularly well-designed.</p>
</div>
<p>Let’s underline again that attributes are simple additions to R objects.
However, as we said in <a class="reference internal" href="140-list.html#sec-special-attributes"><span class="std std-numref">Section 4.4.3</span></a>,
certain attributes are special, and <code class="docutils literal notranslate"><span class="pre">class</span></code> is one of them.
In particular, we can only set <code class="docutils literal notranslate"><span class="pre">class</span></code> to be a character vector
(possibly of length greater than one; see <a class="reference internal" href="#sec-multi-class"><span class="std std-numref">Section 10.2.5</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">12345</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;class&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># character vectors only</span>
<span class="c1">## Error in attr(x, &quot;class&quot;) &lt;- 1: attempt to set invalid &#39;class&#39; attribute</span>
</pre></div>
</div>
<p>Furthermore, the <strong class="command">class</strong> function can read the value of
the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute. Its replacement version is also available.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Date&quot;</span><span class="w">  </span><span class="c1"># set; the same as attr(x, &quot;class&quot;) &lt;- &quot;Date&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># get; here, it is the same as attr(x, &quot;class&quot;)</span>
<span class="c1">## [1] &quot;Date&quot;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <strong class="command">class</strong> function always yields a value, even
if the corresponding attribute is not set. We call it an <em>implicit</em>
class. Compare the following results:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w">  </span><span class="c1"># no `class` set because NULL cannot have any attributes</span>
<span class="c1">## [1] &quot;NULL&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">))</span><span class="w">  </span><span class="c1"># no attributes so class is implicit (= typeof)</span>
<span class="c1">## [1] &quot;logical&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">))</span><span class="w">  </span><span class="c1"># typeof returns &quot;double&quot;</span>
<span class="c1">## [1] &quot;numeric&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">))</span>
<span class="c1">## [1] &quot;character&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">))</span>
<span class="c1">## [1] &quot;list&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># typeof gives &quot;closure&quot;</span>
<span class="c1">## [1] &quot;function&quot;</span>
</pre></div>
</div>
<p>Also, <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a> will explain that any object
equipped with the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute also has an implicit class:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)))</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    1</span>
<span class="c1">## [2,]    2</span>
<span class="c1">## [3,]    3</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># `class` is not amongst the attributes</span>
<span class="c1">## $dim</span>
<span class="c1">## [1] 3 1</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># implicit class</span>
<span class="c1">## [1] &quot;matrix&quot; &quot;array&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># it is still a numeric vector (under the bonnet)</span>
<span class="c1">## [1] &quot;double&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="generics-and-method-dispatching">
<span id="sec-s3-generic"></span><h2><span class="section-number">10.2. </span>Generics and method dispatching<a class="headerlink" href="#generics-and-method-dispatching" title="Link to this heading">¶</a></h2>
<section id="generics-default-and-custom-methods">
<h3><span class="section-number">10.2.1. </span>Generics, default, and custom methods<a class="headerlink" href="#generics-default-and-custom-methods" title="Link to this heading">¶</a></h3>
<p>Let’s inspect the source code of the <strong class="command">print</strong> function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">print</span><span class="p">)</span><span class="w">  </span><span class="c1"># sic!</span>
<span class="c1">## function (x, ...)</span>
<span class="c1">## UseMethod(&quot;print&quot;)</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
</pre></div>
</div>
<p>Any function like the above<a class="footnote-reference brackets" href="#footusemeth1" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> we will call from now on
a <em>generic</em> (an <em>S3 generic</em>, from S version 3 <span id="id9">[<a class="reference internal" href="999-bibliography.html#id52" title="Chambers, J.M. and Hastie, T.J. (1991).  Statistical Models in S. Chapman &amp; Hall.">13</a>]</span>).
Its only job is to invoke <strong class="command">UseMethod</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;print&quot;)</span></code>.
It dispatches the control flow to another function,
referred to as a <em>method</em>, based on the class of the first argument.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All arguments passed to the generic will also be
available<a class="footnote-reference brackets" href="#footusemeth2" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> in the method dispatched to.</p>
</div>
<p>For example, let’s define an object of the class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>
(a name that we have just come up with; we could have called it
<code class="docutils literal notranslate"><span class="pre">cat</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEGORICAL</span></code>, or <code class="docutils literal notranslate"><span class="pre">SpanishInquisition</span></code> as well). It will be our
version of the <code class="docutils literal notranslate"><span class="pre">factor</span></code> type that we discuss later.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We assume that such an object is a sequence of small positive integers
(codes). It is equipped with the <code class="docutils literal notranslate"><span class="pre">levels</span></code> attribute,
which is a character vector of length not less than the maximum
of the said integers.
In particular, the first level deciphers the meaning of
the code <code class="docutils literal notranslate"><span class="pre">1</span></code>. Hence, the above vector represents a sequence
<em>a, c, b, a, a, a, c</em>.</p>
<p>There is no special method for displaying objects of the <code class="docutils literal notranslate"><span class="pre">categorical</span></code> class.
Hence, when we call <strong class="command">print</strong>, the <em>default</em> (fallback) method is
invoked:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 1 3 2 1 1 1 3</span>
<span class="c1">## attr(,&quot;levels&quot;)</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span>
<span class="c1">## attr(,&quot;class&quot;)</span>
<span class="c1">## [1] &quot;categorical&quot;</span>
</pre></div>
</div>
<p>This is the standard function for displaying numeric vectors.
We are well familiar with it. Its name is <strong class="command">print.default</strong>,
and we can always call it directly:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print.default</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># the default print method</span>
<span class="c1">## [1] 1 3 2 1 1 1 3</span>
<span class="c1">## attr(,&quot;levels&quot;)</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span>
<span class="c1">## attr(,&quot;class&quot;)</span>
<span class="c1">## [1] &quot;categorical&quot;</span>
</pre></div>
</div>
<p>However, we can introduce a designated method for printing
<code class="docutils literal notranslate"><span class="pre">categorical</span></code> objects. Its name must precisely be
<strong class="command">print.categorical</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">print.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">x_character</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)[</span><span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">x_character</span><span class="p">)</span><span class="w">  </span><span class="c1"># calls `print.default`</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;Categories: %s\n&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">paste</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">invisible</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># this is what all print methods do; see help(&quot;print&quot;)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Calling <strong class="command">print</strong> automatically dispatches
the control flow to this method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;a&quot; &quot;c&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;c&quot;</span>
<span class="c1">## Categories: a, b, c</span>
</pre></div>
</div>
<p>Of course, the default method can still be called.
Referring to <strong class="command">print.default</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> directly
will output the same result as the one a few chunks above.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong class="command">print.categorical</strong> has been equipped with the dot-dot-dot
attribute since the generic <strong class="command">print</strong> had one too<a class="footnote-reference brackets" href="#foots3consistency" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>.</p>
</div>
</section>
<section id="creating-generics">
<h3><span class="section-number">10.2.2. </span>Creating generics<a class="headerlink" href="#creating-generics" title="Link to this heading">¶</a></h3>
<p>Introducing new S3 generics is as straightforward
as defining a function that calls <strong class="command">UseMethod</strong>.
For instance, here is a dispatcher which creates new objects of the
<code class="docutils literal notranslate"><span class="pre">categorical</span></code> class based on other objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">UseMethod</span><span class="p">(</span><span class="s">&quot;as.categorical&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># synonym: UseMethod(&quot;as.categorical&quot;, x)</span>
</pre></div>
</div>
<p>We always need to define the default method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.categorical.default</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.character</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">xu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># drops NAs</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xu</span><span class="p">),</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">levels</span><span class="o">=</span><span class="n">xu</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span>
<span class="c1">## [1] &quot;a&quot; &quot;c&quot; &quot;a&quot; &quot;a&quot; &quot;d&quot; &quot;c&quot;</span>
<span class="c1">## Categories: a, c, d</span>
<span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>
<span class="c1">## [1] &quot;3&quot; &quot;6&quot; &quot;4&quot; NA  &quot;9&quot; &quot;9&quot; &quot;6&quot; NA  &quot;3&quot;</span>
<span class="c1">## Categories: 3, 4, 6, 9</span>
</pre></div>
</div>
<p>This method is already quite flexible. It handles a wide variety
of data types because it relies on the <em>built-in generic</em>
<strong class="command">as.character</strong> (<a class="reference internal" href="#sec-built-in-generics"><span class="std std-numref">Section 10.2.3</span></a>).</p>
<div class="proof proof-type-example" id="id47">

    <div class="proof-title">
        <span class="proof-type">Example 10.3</span>
        
    </div><div class="proof-content">
<p>We might want to forbid the conversion from lists
because it does not necessarily make sense:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.categorical.list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;conversion of lists to categorical is not supported&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The users can always be instructed in the method’s documentation
that they are responsible for converting lists to another type
prior to a call to <strong class="command">as.categorical</strong>.</p>
</div></div><div class="proof proof-type-example" id="id48">

    <div class="proof-title">
        <span class="proof-type">Example 10.4</span>
        
    </div><div class="proof-content">
<p>The default method deals with logical vectors perfectly fine:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">  </span><span class="c1"># as.categorical.default</span>
<span class="c1">## [1] &quot;TRUE&quot;  &quot;FALSE&quot; NA      NA      &quot;FALSE&quot;</span>
<span class="c1">## Categories: FALSE, TRUE</span>
</pre></div>
</div>
<p>However, we might still want to introduce its specialised version.
This is because we know a slightly more efficient algorithm
(and we have nothing better to do)
based on the fact that <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> and <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> converted to
numeric yield 0 and 1, respectively:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.categorical.logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># or maybe stopifnot(is.logical(x))?</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">  </span><span class="c1"># only 1, 2, and NAs will be generated</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;FALSE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TRUE&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It spawns the same result as the default method but is slightly faster.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">  </span><span class="c1"># as.categorical.logical</span>
<span class="c1">## [1] &quot;TRUE&quot;  &quot;FALSE&quot; NA      NA      &quot;FALSE&quot;</span>
<span class="c1">## Categories: FALSE, TRUE</span>
</pre></div>
</div>
<p>We performed some argument consolidation at the beginning because a user
is always able to call a method directly on an R object of any kind
(which is a good thing; see <a class="reference internal" href="#sec-s3-direct-method-call"><span class="std std-numref">Section 10.2.4</span></a>).
In other words, there is no guarantee that the argument <code class="docutils literal notranslate"><span class="pre">x</span></code> must be of
type logical.</p>
</div></div></section>
<section id="built-in-generics">
<span id="sec-built-in-generics"></span><h3><span class="section-number">10.2.3. </span>Built-in generics<a class="headerlink" href="#built-in-generics" title="Link to this heading">¶</a></h3>
<p>Many<a class="footnote-reference brackets" href="#footinternaldispatch" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> functions and operators we have
introduced so far are, in fact, S3 generics:
<strong class="command">print</strong>,
<strong class="command">head</strong>,
`<strong class="command">[</strong>`,
`<strong class="command">[[</strong>`,
`<strong class="command">[&lt;-</strong>`,
`<strong class="command">[[&lt;-</strong>`,
<strong class="command">length</strong>,
`<strong class="command">+</strong>`,
`<strong class="command">&lt;=</strong>`,
<strong class="command">is.numeric</strong>,
<strong class="command">as.numeric</strong>,
<strong class="command">is.character</strong>,
<strong class="command">as.character</strong>,
<strong class="command">as.list</strong>,
<strong class="command">round</strong>,
<strong class="command">log</strong>,
<strong class="command">sum</strong>,
<strong class="command">rep</strong>,
<strong class="command">c</strong>, and
<strong class="command">na.omit</strong>,
to name a few.</p>
<div class="proof proof-type-example" id="id49">

    <div class="proof-title">
        <span class="proof-type">Example 10.5</span>
        
    </div><div class="proof-content">
<p>Let’s overload the <strong class="command">as.character</strong> method.
The default one does not make much sense for the objects
of our custom type:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;1&quot; &quot;3&quot; &quot;2&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;3&quot;</span>
</pre></div>
</div>
<p>So:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.character.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)[</span><span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
</pre></div>
</div>
<p>And now:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;a&quot; &quot;c&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;c&quot;</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id50">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.6</span>
        
    </div><div class="proof-content">
<p>Overload the <strong class="command">unique</strong> and <strong class="command">rep</strong>
methods for objects of the class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>.</p>
</div></div><div class="proof proof-type-example" id="id51">

    <div class="proof-title">
        <span class="proof-type">Example 10.7</span>
        
    </div><div class="proof-content">
<p>New types ought to be designed carefully. For instance,
if we forget to overload the to-numeric converter,
some users might be puzzled<a class="footnote-reference brackets" href="#footpuzzle" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a> when they see:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">666</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)))</span>
<span class="c1">## [1] &quot;4&quot;   &quot;9&quot;   &quot;100&quot; &quot;9&quot;   &quot;9&quot;   &quot;100&quot; &quot;42&quot;  &quot;666&quot; &quot;4&quot;</span>
<span class="c1">## Categories: 100, 4, 42, 666, 9</span>
<span class="nf">as.double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># synonym: as.numeric(x); here, it calls as.double.default(x)</span>
<span class="c1">## [1] 2 5 1 5 5 1 3 4 2</span>
</pre></div>
</div>
<p>Hence, we might want to introduce a new method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.double.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w">  </span><span class="c1"># not: as.numeric.categorical</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1"># actually: as.double.default(as.character.categorical(x))</span>
<span class="w">    </span><span class="nf">as.double</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It now yields:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># or as.numeric(x); calls as.double.categorical(x)</span>
<span class="c1">## [1]   4   9 100   9   9 100  42 666   4</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can still use <strong class="command">unclass</strong> to fetch the codes:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 2 5 1 5 5 1 3 4 2</span>
<span class="c1">## attr(,&quot;levels&quot;)</span>
<span class="c1">## [1] &quot;100&quot; &quot;4&quot;   &quot;42&quot;  &quot;666&quot; &quot;9&quot;</span>
</pre></div>
</div>
<p>It is because the foregoing returns a class-free object,
which is now guaranteed to be processed by the default methods
(<strong class="command">print</strong>, subsetting, <strong class="command">as.character</strong>, etc.).</p>
</div>
<div class="proof proof-type-exercise" id="id52">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.8</span>
        
    </div><div class="proof-content">
<p>What would happen if we used <strong class="command">as.numeric</strong>
instead of <strong class="command">unclass</strong> in
<strong class="command">print.categorical</strong> and <strong class="command">as.character.categorical</strong>?</p>
</div></div><div class="proof proof-type-exercise" id="id53">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.9</span>
        
    </div><div class="proof-content">
<p>Update the preceding methods so that
we can also create <em>named</em> objects of the class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>
(i.e., equipped with the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute).</p>
</div></div><div class="proof proof-type-exercise" id="id54">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.10</span>
        
    </div><div class="proof-content">
<p>The levels of <code class="docutils literal notranslate"><span class="pre">x</span></code> are sorted lexicographically, not numerically.
Introduce a single method that would let the above code
(when rerun without any alterations) generate a more natural result.</p>
</div></div></section>
<section id="first-argument-dispatch-and-calling-s3-methods-directly">
<span id="sec-s3-direct-method-call"></span><h3><span class="section-number">10.2.4. </span>First-argument dispatch and calling S3 methods directly<a class="headerlink" href="#first-argument-dispatch-and-calling-s3-methods-directly" title="Link to this heading">¶</a></h3>
<p>With S3, dispatching is most often done based on the class of
only one<a class="footnote-reference brackets" href="#footonedispatch" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a> argument:
by default, the first one from the parameter list.</p>
<p>For example, the <strong class="command">c</strong> function is a generic that
dispatches on the first argument’s class.
Let’s overload it for <code class="docutils literal notranslate"><span class="pre">categorical</span></code> objects.
In other words, we will create a function to be called by the generic
when it is invoked on a series of objects whose
first element is of the said class.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">c.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">as.categorical</span><span class="p">(</span>
<span class="w">        </span><span class="nf">unlist</span><span class="p">(</span>
<span class="w">            </span><span class="nf">lapply</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">),</span><span class="w"> </span><span class="n">as.character</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</pre></div>
</div>
<p>It converts each argument to a character vector,
relying on the generic <strong class="command">as.character</strong> to take care of the details.
It works because <strong class="command">unlist</strong> converts a list of
such atomic vectors to a single sequence of strings.</p>
<p>Calling <strong class="command">c</strong> with the first argument of the class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>
dispatches to the above method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="n">xc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.categorical</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nf">c</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># c.categorical</span>
<span class="c1">##  [1] &quot;9&quot; &quot;5&quot; &quot;7&quot; &quot;7&quot; &quot;2&quot; &quot;9&quot; &quot;5&quot; &quot;7&quot; &quot;7&quot; &quot;2&quot;</span>
<span class="c1">## Categories: 2, 5, 7, 9</span>
</pre></div>
</div>
<p>However, if the first argument is, say, unclassed, the default
method will be consulted:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xc</span><span class="p">)</span><span class="w">  </span><span class="c1"># default c</span>
<span class="c1">##  [1] 9 5 7 7 2 4 2 3 3 1</span>
</pre></div>
</div>
<p>It ignored the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute and saw <code class="docutils literal notranslate"><span class="pre">xc</span></code> <em>as it is</em>,
a bareboned numeric vector:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`attributes&lt;-`</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">  </span><span class="c1"># the underlying codes</span>
<span class="c1">## [1] 4 2 3 3 1</span>
</pre></div>
</div>
<p>It is not a bug. It is a well-documented (and now explained) behaviour.
After all, compound types (classed objects) are emulated
through the basic ones.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In most cases, S3 methods can be called directly to get the desired
outcome:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c.categorical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xc</span><span class="p">)</span><span class="w">  </span><span class="c1"># force a call to the specific method</span>
<span class="c1">##  [1] &quot;9&quot; &quot;5&quot; &quot;7&quot; &quot;7&quot; &quot;2&quot; &quot;9&quot; &quot;5&quot; &quot;7&quot; &quot;7&quot; &quot;2&quot;</span>
<span class="c1">## Categories: 2, 5, 7, 9</span>
</pre></div>
</div>
<p>We said <em>in most cases</em> because methods can be:</p>
<ul class="simple">
<li><p>hardcoded at the C language level
(e.g., there is no <strong class="command">c.default</strong> defined at all<a class="footnote-reference brackets" href="#footoperoverload" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>),</p></li>
<li><p>hidden (defined in a package’s namespace but not exported;
<a class="reference internal" href="330-environment.html#sec-use-method"><span class="std std-numref">Section 16.3.6</span></a>),</p></li>
<li><p>overloaded as a group; see <a class="reference internal" href="#sec-operator-overloading-s3"><span class="std std-numref">Section 10.2.6</span></a>
and <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;groupGeneric&quot;)</span></code>.</p></li>
</ul>
</div>
<div class="proof proof-type-example" id="id55">

    <div class="proof-title">
        <span class="proof-type">Example 10.11</span>
        
    </div><div class="proof-content">
<p>Purely for jollity, let’s find a partition of the <code class="docutils literal notranslate"><span class="pre">iris</span></code> dataset
into three clusters using the <span class="math">\(k\)</span>-means algorithm:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">kmeans</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">-5</span><span class="p">],</span><span class="w"> </span><span class="n">centers</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">nstart</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">## K-means clustering with 3 clusters of sizes 50, 62, 38</span>
<span class="c1">##</span>
<span class="c1">## Cluster means:</span>
<span class="c1">##   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## 1       5.0060      3.4280       1.4620      0.2460</span>
<span class="c1">## 2       5.9016      2.7484       4.3935      1.4339</span>
<span class="c1">## 3       6.8500      3.0737       5.7421      2.0711</span>
<span class="c1">##</span>
<span class="c1">## Clustering vector:</span>
<span class="c1">##  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="c1">## [36] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="c1">## [71] 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="c1">##  [ reached getOption(&quot;max.print&quot;) -- omitted 51 entries ]</span>
<span class="c1">##</span>
<span class="c1">## Within cluster sum of squares by cluster:</span>
<span class="c1">## [1] 15.151 39.821 23.879</span>
<span class="c1">##  (between_SS / total_SS =  88.4 %)</span>
<span class="c1">##</span>
<span class="c1">## Available components:</span>
<span class="c1">##</span>
<span class="c1">## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;</span>
<span class="c1">## [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;</span>
<span class="c1">## [9] &quot;ifault&quot;</span>
</pre></div>
</div>
<p>It is an object of the class:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">## [1] &quot;kmeans&quot;</span>
</pre></div>
</div>
<p>which, in fact, is a:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">## [1] &quot;list&quot;</span>
</pre></div>
</div>
<p>The underlying list looks like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unclass</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">## $cluster</span>
<span class="c1">##  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="c1">## [36] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="c1">## [71] 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="c1">##  [ reached getOption(&quot;max.print&quot;) -- omitted 51 entries ]</span>
<span class="c1">##</span>
<span class="c1">## $centers</span>
<span class="c1">##   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## 1       5.0060      3.4280       1.4620      0.2460</span>
<span class="c1">## 2       5.9016      2.7484       4.3935      1.4339</span>
<span class="c1">## 3       6.8500      3.0737       5.7421      2.0711</span>
<span class="c1">##</span>
<span class="c1">## $totss</span>
<span class="c1">## [1] 681.37</span>
<span class="c1">##</span>
<span class="c1">## $withinss</span>
<span class="c1">## [1] 15.151 39.821 23.879</span>
<span class="c1">##</span>
<span class="c1">## $tot.withinss</span>
<span class="c1">## [1] 78.851</span>
<span class="c1">##</span>
<span class="c1">## $betweenss</span>
<span class="c1">## [1] 602.52</span>
<span class="c1">##</span>
<span class="c1">## $size</span>
<span class="c1">## [1] 50 62 38</span>
<span class="c1">##</span>
<span class="c1">## $iter</span>
<span class="c1">## [1] 2</span>
<span class="c1">##</span>
<span class="c1">## $ifault</span>
<span class="c1">## [1] 0</span>
</pre></div>
</div>
<p>We already know that <code class="docutils literal notranslate"><span class="pre">res</span></code> was displayed in a fancy way
only because there is a <strong class="command">print</strong> method overloaded
for objects of the <code class="docutils literal notranslate"><span class="pre">kmeans</span></code> class.</p>
<p>But is there?</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">print.kmeans</span>
<span class="c1">## Error in eval(expr, envir, enclos): object &#39;print.kmeans&#39; not found</span>
</pre></div>
</div>
<p>Even though the method is hidden (internal) in the <strong class="program">stats</strong> package’s
namespace, from <a class="reference internal" href="330-environment.html#sec-use-method"><span class="std std-numref">Section 16.3.6</span></a> we will learn that
it can be accessed by calling
<strong class="command">getS3method</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;print&quot;,</span> <span class="pre">&quot;kmeans&quot;)</span></code>
or referring to <strong class="program">stats</strong><code class="code docutils literal notranslate"><span class="pre">:::</span></code><strong class="command">print.kmeans</strong>
(note the triple colon).</p>
</div></div></section>
<section id="multi-class-ness">
<span id="sec-multi-class"></span><h3><span class="section-number">10.2.5. </span>Multi-class-ness<a class="headerlink" href="#multi-class-ness" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute can be instantiated as a character vector
of any length. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">())</span>
<span class="c1">## [1] &quot;2024-07-11 14:22:07 CEST&quot;</span>
<span class="p">(</span><span class="n">t2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">strptime</span><span class="p">(</span><span class="s">&quot;2021-08-15T12:59:59+1000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="p">))</span>
<span class="c1">## [1] &quot;2021-08-15 04:59:59&quot;</span>
</pre></div>
</div>
<p>Let’s inspect the classes of these two objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<span class="c1">## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
<span class="c1">## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#sec-datetime"><span class="std std-numref">Section 10.3.1</span></a> will discuss date-time classes in more detail.
It will highlight that the former is represented as a numeric
vector, while the latter is a list. Thus, these two should primarily
be seen as instances of two distinct types.</p>
<p>However, both of them have a lot in common. Hence, it was a wise design
choice to allow them to be seen also as the representatives of the
same generic category of <em>POSIX time</em> objects.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When calling a generic function<a class="footnote-reference brackets" href="#footoper" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a> <strong class="command">f</strong> on an object <code class="docutils literal notranslate"><span class="pre">x</span></code>
of the classes<a class="footnote-reference brackets" href="#footclassdispatch" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>
<code class="docutils literal notranslate"><span class="pre">class1</span></code>, <code class="docutils literal notranslate"><span class="pre">class2</span></code>, …, <code class="docutils literal notranslate"><span class="pre">classK</span></code>  (in this order),
<strong class="command">UseMethod</strong><code class="code docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">x)</span></code> dispatches to the method
determined as follows:</p>
<ol class="arabic simple">
<li><p>if <strong class="command">f.class1</strong> is available<a class="footnote-reference brackets" href="#footlookup" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a>, call it;</p></li>
<li><p>otherwise, if <strong class="command">f.class2</strong> is available, call this one;</p></li>
<li><p>…;</p></li>
<li><p>otherwise, if <strong class="command">f.classK</strong> is available, invoke it;</p></li>
<li><p>otherwise, refer to the fallback <strong class="command">f.default</strong>.</p></li>
</ol>
</div>
<div class="proof proof-type-example" id="id56">

    <div class="proof-title">
        <span class="proof-type">Example 10.12</span>
        
    </div><div class="proof-content">
<p>There is a method <strong class="command">diff</strong> for objects of the class
<code class="docutils literal notranslate"><span class="pre">POSIXt</span></code> that carries a statement:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="nf">inherits</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;POSIXlt&quot;</span><span class="p">))</span><span class="w"> </span><span class="nf">as.POSIXct</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">x</span>
</pre></div>
</div>
<p>This way, we can process both <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> and <code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> instances
using the same procedure.</p>
</div></div><p>We should see no magic in this simple scheme. It is nothing more than
a way to determine the method to be called for a
particular R object. It can be used as a mechanism to mimic
the idea of inheritance in object-orientated programming languages.
However, the S3 system does not allow for defining classes
in any formal manner.</p>
<p>For example, we cannot say that objects of the class <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> inherit
from <code class="docutils literal notranslate"><span class="pre">POSIXt</span></code>. Neither can we say that each object of the class <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code>
is also an instance of <code class="docutils literal notranslate"><span class="pre">POSIXt</span></code>.
The class attribute can still be set arbitrarily on
a per-object basis. We can create ones whose class is
simply <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> (without the <code class="docutils literal notranslate"><span class="pre">POSIXt</span></code> part)
or even <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;POSIXt&quot;,</span> <span class="pre">&quot;POSIXct&quot;)</span></code> (in this order).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In any method, it is possible to call the method corresponding
to the next class by calling <strong class="command">NextMethod</strong>.</p>
</div>
<p>For instance, if we are in <strong class="command">f.class1</strong>, a call to
<strong class="command">NextMethod</strong><code class="code docutils literal notranslate"><span class="pre">(f)</span></code> will try invoking
<strong class="command">f.class2</strong>. If such a method does not exist,
further methods in the search chain will be probed,
falling back to the default method if necessary.
We will give an illustration later.</p>
</section>
<section id="operator-overloading">
<span id="sec-operator-overloading-s3"></span><h3><span class="section-number">10.2.6. </span>Operator overloading<a class="headerlink" href="#operator-overloading" title="Link to this heading">¶</a></h3>
<p>Operators are ordinary functions (<a class="reference internal" href="210-design.html#sec-operfun"><span class="std std-numref">Section 9.3.5</span></a>).
Even though what follows can partially be implied by what we
have already said, as usual in R, some oddities are to be expected.</p>
<p>For example, let’s overload the index operator for
objects of the class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>.
Looking at <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;[&quot;)</span></code>, we see that the default method
has two arguments: <code class="docutils literal notranslate"><span class="pre">x</span></code> (the <code class="docutils literal notranslate"><span class="pre">categorical</span></code> object being sliced)
and <code class="docutils literal notranslate"><span class="pre">i</span></code> (the indexer).
Ours will have the same interface then:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`[.categorical`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="w">  </span><span class="c1"># `[`(unclass(x), i)</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">levels</span><span class="o">=</span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># the same levels as input</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The default S3 method,
`<strong class="command">[.default</strong>`, is hardcoded at the C language level
and we cannot refer to it directly.
This is why we called <strong class="command">unclass</strong> instead.
Alternatively, we can also invoke <strong class="command">NextMethod</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`[.categorical`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="nf">NextMethod</span><span class="p">(</span><span class="s">&quot;[&quot;</span><span class="p">),</span><span class="w">  </span><span class="c1"># call default method, passing `x` and `i`</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">levels</span><span class="o">=</span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># the same levels as input</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can also introduce the replacement version of this operator:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`[&lt;-.categorical`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">)</span><span class="w">  </span><span class="c1"># integer codes corresponding to levels</span>
<span class="w">    </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">        </span><span class="nf">NextMethod</span><span class="p">(</span><span class="s">&quot;[&lt;-&quot;</span><span class="p">),</span><span class="w">  </span><span class="c1"># call default method, passing `x`, `i`, `values`</span>
<span class="w">        </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="w">  </span><span class="c1"># same levels as input</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1"># # or, equivalently:</span>
<span class="w">    </span><span class="c1"># structure(</span>
<span class="w">    </span><span class="c1">#     `[&lt;-`(unclass(x), i, value=match(value, attr(x, &quot;levels&quot;))),</span>
<span class="w">    </span><span class="c1">#     class=&quot;categorical&quot;,</span>
<span class="w">    </span><span class="c1">#     levels=attr(x, &quot;levels&quot;)</span>
<span class="w">    </span><span class="c1"># )</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span>
<span class="c1">## [1] &quot;3&quot; &quot;6&quot; &quot;4&quot; NA</span>
<span class="c1">## Categories: 3, 4, 6, 9</span>
<span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;7&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;6&quot; NA  &quot;6&quot; NA  &quot;9&quot; &quot;9&quot; &quot;6&quot; NA  &quot;3&quot;</span>
<span class="c1">## Categories: 3, 4, 6, 9</span>
</pre></div>
</div>
<p>Notice how we handled the case of nonexistent levels
and that the recycling rule has been automagically inherited
(amongst other features) from the default index operator.</p>
<div class="proof proof-type-exercise" id="id57">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.13</span>
        
    </div><div class="proof-content">
<p>Do these two operators preserve the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">x</span></code>?
Is indexing with negative integers or logical vectors supported as well?
Why is that/is that not the case?</p>
</div></div><p>Furthermore, let’s overload the `<strong class="command">==</strong>` operator.
Assume<a class="footnote-reference brackets" href="#footcatcmp" id="id19" role="doc-noteref"><span class="fn-bracket">[</span>16<span class="fn-bracket">]</span></a> that we would like two <code class="docutils literal notranslate"><span class="pre">categorical</span></code> objects
to be compared based on the actual labels they encode, in an elementwise
manner:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`==.categorical`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span>
<span class="w">    </span><span class="nf">as.character</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
</pre></div>
</div>
<p>We are feeling lucky: by not performing any type checking,
we rely on the particular <strong class="command">as.character</strong> methods
corresponding to the types of <code class="docutils literal notranslate"><span class="pre">e1</span></code> and <code class="docutils literal notranslate"><span class="pre">e2</span></code>.
Also, assuming that <strong class="command">as.character</strong> always<a class="footnote-reference brackets" href="#footascharacter" id="id20" role="doc-noteref"><span class="fn-bracket">[</span>17<span class="fn-bracket">]</span></a>
returns a <code class="docutils literal notranslate"><span class="pre">character</span></code> object,
we dispatch to the default method for `<strong class="command">==</strong>`
(which handles atomic vectors).</p>
<p>Some examples:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1]  TRUE  TRUE FALSE  TRUE</span>
<span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1]  TRUE  TRUE FALSE  TRUE</span>
<span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1]  TRUE  TRUE FALSE  TRUE</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the case of binary operators, dispatching is done based on the classes
of both arguments. In all three preceding calls,
we call `<strong class="command">==.categorical</strong>`, regardless
of whether the classed object is the first or the second operand.</p>
<p>If two operands are classed, and different methods are
overloaded for both, a warning will be generated,
and the default internal method will be called.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`==.A`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;A&quot;</span>
<span class="n">`==.B`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;B&quot;</span>
<span class="nf">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
<span class="c1">## Warning: Incompatible methods (&quot;==.A&quot;, &quot;==.B&quot;) for &quot;==&quot;</span>
<span class="c1">## [1] FALSE    NA  TRUE</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) By creating a single <strong class="command">Ops</strong> method,
we can define the meaning of all binary operators at once.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Ops.categorical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">.Generic</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;=&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;=&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;==&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;!=&quot;</span><span class="p">)))</span>
<span class="w">        </span><span class="nf">stop</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%s not defined for &#39;categorical&#39; objects&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">.Generic</span><span class="p">))</span>
<span class="w">    </span><span class="n">e1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
<span class="w">    </span><span class="n">e2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
<span class="w">    </span><span class="nf">NextMethod</span><span class="p">(</span><span class="n">.Generic</span><span class="p">)</span><span class="w">  </span><span class="c1"># dispatch to the default method (for character)</span>
<span class="p">}</span>

<span class="nf">as.categorical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [1] FALSE  TRUE  TRUE FALSE</span>
</pre></div>
</div>
<p>Here, `<code class="docutils literal notranslate"><span class="pre">.Generic</span></code>` is a variable representing the name
of the operator (generic) being invoked; see <a class="reference internal" href="330-environment.html#sec-use-method"><span class="std std-numref">Section 16.3.6</span></a>.</p>
<p>Other <em>group generics</em> are: <strong class="command">Summary</strong>
(including functions such as
<strong class="command">min</strong>, <strong class="command">sum</strong>, and <strong class="command">all</strong>),
<strong class="command">Math</strong> (<strong class="command">abs</strong>, <strong class="command">log</strong>, <strong class="command">round</strong>, etc.),
<strong class="command">matrixOps</strong> (`<strong class="command">%*%</strong>`),
and <strong class="command">Complex</strong> (e.g., <strong class="command">Re</strong>, <strong class="command">Im</strong>);
see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;groupGeneric&quot;)</span></code> for more details.</p>
<p>Sometimes we must rely on the `<strong class="command">.S3method</strong>` function
to let R recognise a custom method related to such generics.</p>
</div>
</section>
</section>
<section id="common-built-in-s3-classes">
<h2><span class="section-number">10.3. </span>Common built-in S3 classes<a class="headerlink" href="#common-built-in-s3-classes" title="Link to this heading">¶</a></h2>
<p>Below we discuss a few noteworthy classes,
including those representing date-time information and
factors (ordered or not).</p>
<p>Note that classes representing tabular data will be dealt with in separate parts,
owing to their importance and ubiquity. Namely, matrices and other
arrays are covered in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>,
and data frames are discussed in <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>.
Inspecting other<a class="footnote-reference brackets" href="#foototherclasses" id="id21" role="doc-noteref"><span class="fn-bracket">[</span>18<span class="fn-bracket">]</span></a> interesting compound types is left
as a simple exercise for the studious reader.</p>
<section id="date-time-etc">
<span id="sec-datetime"></span><h3><span class="section-number">10.3.1. </span>Date, time, etc.<a class="headerlink" href="#date-time-etc" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Date</span></code> class represents… dates (calendar ones, not fruits).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">Sys.Date</span><span class="p">(),</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;1969-12-31&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1970-01-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2023-02-29&quot;</span><span class="p">))))</span>
<span class="c1">## [1] &quot;2024-07-11&quot; &quot;1969-12-31&quot; &quot;1970-01-01&quot; NA</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;Date&quot;</span>
</pre></div>
</div>
<p>Complex types are built on basic ones. Underneath,
what we deal with here is:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;double&quot;</span>
<span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 19915    -1     0    NA</span>
</pre></div>
</div>
<p>which is the number of days since the <em>UNIX epoch</em>,
1970-01-01T00:00:00+0000 (midnight GMT/UTC).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> (calendar time) class represents date-time objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">())</span>
<span class="c1">## [1] &quot;2024-07-11 14:22:07 CEST&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;double&quot;</span>
<span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 1720700528</span>
</pre></div>
</div>
<p>Underneath, it is the number of seconds since the UNIX epoch.
By default, whilst printing, the current default timezone
is used (see <strong class="command">Sys.timezone</strong>).
However, such objects can be equipped with the <code class="docutils literal notranslate"><span class="pre">tzone</span></code> attribute.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;POSIXct&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;POSIXt&quot;</span><span class="p">))</span><span class="w">  </span><span class="c1"># using current default timezone</span>
<span class="c1">## [1] &quot;1970-01-01 01:00:01 CET&quot;</span>
<span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;POSIXct&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;POSIXt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">tzone</span><span class="o">=</span><span class="s">&quot;UTC&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;1970-01-01 00:00:01 UTC&quot;</span>
</pre></div>
</div>
<p>In both cases, the time is 1 second after the beginning of the UNIX epoch.
On the author’s PC, the former is displayed in the current local timezone, though.</p>
<div class="proof proof-type-exercise" id="id58">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.14</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">ISOdatetime</strong> to inspect how
midnights are displayed in different timezones.</p>
</div></div><p>The <code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> (local time) class is represented using a list
of atomic vectors<a class="footnote-reference brackets" href="#footposixlt" id="id22" role="doc-noteref"><span class="fn-bracket">[</span>19<span class="fn-bracket">]</span></a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.POSIXlt</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&quot;1970-01-01 00:00:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="s">&quot;2030-12-31 23:59:59&quot;</span><span class="p">)))</span>
<span class="c1">##                         a                         b</span>
<span class="c1">## &quot;1970-01-01 00:00:00 CET&quot; &quot;2030-12-31 23:59:59 CET&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;list&quot;</span>
<span class="nf">str</span><span class="p">(</span><span class="nf">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># calling str instead of print to make display more compact</span>
<span class="c1">## List of 11</span>
<span class="c1">##  $ sec   : num [1:2] 0 59</span>
<span class="c1">##  $ min   : int [1:2] 0 59</span>
<span class="c1">##  $ hour  : int [1:2] 0 23</span>
<span class="c1">##  $ mday  : int [1:2] 1 31</span>
<span class="c1">##  $ mon   : int [1:2] 0 11</span>
<span class="c1">##  $ year  : Named int [1:2] 70 130</span>
<span class="c1">##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;a&quot; &quot;b&quot;</span>
<span class="c1">##  $ wday  : int [1:2] 4 2</span>
<span class="c1">##  $ yday  : int [1:2] 0 364</span>
<span class="c1">##  $ isdst : int [1:2] 0 0</span>
<span class="c1">##  $ zone  : chr [1:2] &quot;CET&quot; &quot;CET&quot;</span>
<span class="c1">##  $ gmtoff: int [1:2] NA NA</span>
<span class="c1">##  - attr(*, &quot;tzone&quot;)= chr [1:3] &quot;&quot; &quot;CET&quot; &quot;CEST&quot;</span>
<span class="c1">##  - attr(*, &quot;balanced&quot;)= logi TRUE</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id59">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.15</span>
        
    </div><div class="proof-content">
<p>Read about the meaning of each named element,
especially <code class="docutils literal notranslate"><span class="pre">mon</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;DateTimeClasses&quot;)</span></code>.</p>
</div></div><p>The manual states that <code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> is supposedly
<em>closer to human-readable forms</em> than <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code>,
but it is a matter of taste.
Some R functions return the former, and other output the latter type.</p>
<div class="proof proof-type-exercise" id="id60">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.16</span>
        
    </div><div class="proof-content">
<p>The two main functions for date formatting and parsing,
<strong class="command">strftime</strong> and <strong class="command">strptime</strong>,
use special field formatters (similar to <strong class="command">sprintf</strong>).
Read about them in the R manual.
What type of inputs do they accept? What outputs do they produce?</p>
</div></div><p>There are several methods overloaded for objects of the said classes.
In fact, the first call in this section
already involved the use of <strong class="command">c.Date</strong>.</p>
<div class="proof proof-type-exercise" id="id61">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.17</span>
        
    </div><div class="proof-content">
<p>Play around with the overloaded versions of
<strong class="command">seq</strong>, <strong class="command">rep</strong>, and
<strong class="command">as.character</strong>.</p>
</div></div><p>A specific number of days or seconds can be added to or
subtracted from a date or time, respectively.
However, `<strong class="command">-</strong>` (see also <strong class="command">diff</strong>)
can also be applied on two date-time objects,
which yields an object of the class <code class="docutils literal notranslate"><span class="pre">difftime</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nf">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## Time difference of 1 days</span>
<span class="nf">Sys.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## Time difference of 1 secs</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id62">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.18</span>
        
    </div><div class="proof-content">
<p>Check out how objects of the class <code class="docutils literal notranslate"><span class="pre">difftime</span></code> are internally represented.</p>
</div></div><p>Applying other arithmetic operations on date-time objects
raises an error. Because date-time objects are just numbers,
they can be compared to each other using binary operators<a class="footnote-reference brackets" href="#footdateops" id="id23" role="doc-noteref"><span class="fn-bracket">[</span>20<span class="fn-bracket">]</span></a>.
Also, methods such as <strong class="command">sort</strong> and <strong class="command">order</strong><a class="footnote-reference brackets" href="#footdatextfrm" id="id24" role="doc-noteref"><span class="fn-bracket">[</span>21<span class="fn-bracket">]</span></a>
could be applied on them.</p>
<div class="proof proof-type-exercise" id="id63">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.19</span>
        
    </div><div class="proof-content">
<p>Check out the <strong class="program">stringx</strong> package,
which replaces the base R date-time processing functions with
their more portable counterparts.</p>
</div></div><div class="proof proof-type-exercise" id="id64">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.20</span>
        
    </div><div class="proof-content">
<p><strong class="command">proc.time</strong> can be used to measure the time
to execute a given expression:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">proc.time</span><span class="p">()</span><span class="w">  </span><span class="c1"># timer start</span>
<span class="c1"># ... to do - something time-consuming ...</span>
<span class="nf">sum</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1e7</span><span class="p">))</span><span class="w">  </span><span class="c1"># whatever, just testing</span>
<span class="c1">## [1] 4999488</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">proc.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="p">)</span><span class="w">  </span><span class="c1"># elapsed time</span>
<span class="c1">##    user  system elapsed</span>
<span class="c1">##   0.125   0.010   0.135</span>
</pre></div>
</div>
<p>The function returns an object of the class <code class="docutils literal notranslate"><span class="pre">proc_time</span></code>.
Inspect how it is represented internally.</p>
</div></div></section>
<section id="factors">
<span id="sec-factor"></span><h3><span class="section-number">10.3.2. </span>Factors<a class="headerlink" href="#factors" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">factor</span></code> class is often used to represent qualitative
data, e.g., species, groups, types. In fact, <code class="docutils literal notranslate"><span class="pre">categorical</span></code> (our example
class) was inspired by the built-in <code class="docutils literal notranslate"><span class="pre">factor</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sausage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">))</span>
<span class="c1">## [1] &quot;spam&quot;    &quot;spam&quot;    &quot;bacon&quot;   &quot;sausage&quot; &quot;spam&quot;    &quot;bacon&quot;</span>
<span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">## [1] spam    spam    bacon   sausage spam    bacon</span>
<span class="c1">## Levels: bacon sausage spam</span>
</pre></div>
</div>
<p>Note how factors are printed. There are no double quote characters
around the labels. The list of levels is given at the end.</p>
<p>Internally, such objects are represented as integer vectors
(<a class="reference internal" href="160-character.html#sec-integer"><span class="std std-numref">Section 6.4.1</span></a>) with elements between <span class="math">\(1\)</span> and <span class="math">\(k\)</span>.
They are equipped with the special
(as in <a class="reference internal" href="140-list.html#sec-special-attributes"><span class="std std-numref">Section 4.4.3</span></a>) <code class="docutils literal notranslate"><span class="pre">levels</span></code>
attribute, which is a character vector of length <span class="math">\(k\)</span><a class="footnote-reference brackets" href="#footfactorint" id="id25" role="doc-noteref"><span class="fn-bracket">[</span>22<span class="fn-bracket">]</span></a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">## [1] &quot;factor&quot;</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">## [1] &quot;integer&quot;</span>
<span class="nf">unclass</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">## [1] 3 3 1 2 3 1</span>
<span class="c1">## attr(,&quot;levels&quot;)</span>
<span class="c1">## [1] &quot;bacon&quot;   &quot;sausage&quot; &quot;spam&quot;</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># also: levels(f)</span>
<span class="c1">## [1] &quot;bacon&quot;   &quot;sausage&quot; &quot;spam&quot;</span>
</pre></div>
</div>
<p>Factors are often used instead of character vectors defined over
a small number of unique labels<a class="footnote-reference brackets" href="#footstrcache" id="id26" role="doc-noteref"><span class="fn-bracket">[</span>23<span class="fn-bracket">]</span></a>,
where there is a need to manipulate their levels conveniently.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;levels&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># also levels(f) &lt;- c(....new...)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">## [1] c c a b c a</span>
<span class="c1">## Levels: a b c</span>
</pre></div>
</div>
<p>The underlying integer codes remain the same.</p>
<p>Certain operations on vectors of small integers are relatively easy to
express, especially those concerning element grouping:
splitting, counting, and plotting (e.g., <a class="reference internal" href="250-graphics.html#fig-irisplot-factors"><span class="std std-numref">Figure 13.17</span></a>).
It is because the integer codes can naturally be used whilst indexing
other vectors. <a class="reference internal" href="150-indexing.html#sec-fun-indexing"><span class="std std-numref">Section 5.4</span></a> mentioned a few functions
related to this, such as
<strong class="command">match</strong>,
<strong class="command">split</strong>,
<strong class="command">findInterval</strong>, and
<strong class="command">tabulate</strong>.
Specifically, the latter can be implemented like
“for each <code class="docutils literal notranslate"><span class="pre">i</span></code>, increase <code class="docutils literal notranslate"><span class="pre">count[factor_codes[i]]</span></code> by one”.</p>
<div class="proof proof-type-exercise" id="id65">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.21</span>
        
    </div><div class="proof-content">
<p>Study the source code of the <strong class="command">factor</strong> function.
Note the use of <strong class="command">as.character</strong>,
<strong class="command">unique</strong>, <strong class="command">order</strong>, and <strong class="command">match</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id66">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.22</span>
        
    </div><div class="proof-content">
<p>Implement a simplified version of <strong class="command">table</strong>
based on <strong class="command">tabulate</strong>. It should work
for objects of the class <code class="docutils literal notranslate"><span class="pre">factor</span></code> and return a named numeric vector.</p>
</div></div><div class="proof proof-type-exercise" id="id67">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.23</span>
        
    </div><div class="proof-content">
<p>Implement a version of <strong class="command">cut</strong> based on <strong class="command">findInterval</strong>.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <strong class="command">as.numeric</strong> method has not been overloaded for factors.
Therefore, when we call the generic, the default method is
used: it returns the underlying integer codes as-is.
This can surprise unaware users when they play with
factors representing integer numbers:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">)))</span><span class="w">  </span><span class="c1"># converts numbers to strings</span>
<span class="c1">## [1] 11 15 16 11 13 4  15</span>
<span class="c1">## Levels: 4 11 13 15 16</span>
<span class="nf">as.numeric</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="c1"># the underlying codes</span>
<span class="c1">## [1] 2 4 5 2 3 1 4</span>
<span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">g</span><span class="p">))</span><span class="w">  </span><span class="c1"># to get the numbers encoded</span>
<span class="c1">## [1] 11 15 16 11 13  4 15</span>
</pre></div>
</div>
<p>Alas, support for factors is often hardcoded at the
C language level. From the end user perspective, it makes this class
behave less predictably. In particular, the manual overloading
of certain methods for factor objects might have no effect.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If <code class="docutils literal notranslate"><span class="pre">f</span></code> is a factor, then <code class="docutils literal notranslate"><span class="pre">x[f]</span></code> does not behave like
<code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">as.character</strong><code class="code docutils literal notranslate"><span class="pre">(f)]</span></code>, i.e.,
it is not indexing by labels using the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute.
Instead, we get <code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">as.numeric</strong><code class="code docutils literal notranslate"><span class="pre">(f)]</span></code>;
the underlying codes determine the positions.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span>
<span class="nf">levels</span><span class="p">(</span><span class="n">h</span><span class="p">)[</span><span class="n">h</span><span class="p">]</span><span class="w">  </span><span class="c1"># the same as c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)[c(1, 2, 1, 3, 1, 3)]</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot; &quot;a&quot; &quot;c&quot; &quot;a&quot; &quot;c&quot;</span>
<span class="nf">c</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="s">&quot;z&quot;</span><span class="p">)[</span><span class="n">h</span><span class="p">]</span><span class="w">  </span><span class="c1"># names are not used whilst indexing</span>
<span class="c1">##   b   c   b   a   b   a</span>
<span class="c1">## &quot;x&quot; &quot;y&quot; &quot;x&quot; &quot;z&quot; &quot;x&quot; &quot;z&quot;</span>
<span class="nf">c</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="s">&quot;z&quot;</span><span class="p">)[</span><span class="nf">as.character</span><span class="p">(</span><span class="n">h</span><span class="p">)]</span><span class="w">  </span><span class="c1"># names are used now</span>
<span class="c1">##   a   b   a   c   a   c</span>
<span class="c1">## &quot;z&quot; &quot;x&quot; &quot;z&quot; &quot;y&quot; &quot;z&quot; &quot;y&quot;</span>
</pre></div>
</div>
<p>More often than not, indexing by factors will happen
“accidentally”<a class="footnote-reference brackets" href="#footstringsasfactors" id="id27" role="doc-noteref"><span class="fn-bracket">[</span>24<span class="fn-bracket">]</span></a>,
leaving us slightly puzzled. In particular,
factors look much like character vectors when they are carried
in data frames:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">))))</span>
<span class="c1">##   A B</span>
<span class="c1">## 1 x x</span>
<span class="c1">## 2 y y</span>
<span class="c1">## 3 z z</span>
<span class="nf">class</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;A&quot;</span><span class="p">]])</span>
<span class="c1">## [1] &quot;character&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s">&quot;B&quot;</span><span class="p">]])</span>
<span class="c1">## [1] &quot;factor&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be careful when combining factors and not-factors:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">))</span>
<span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;1&quot; &quot;2&quot; &quot;1&quot; &quot;C&quot;</span>
<span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">))</span>
<span class="c1">## [1] A B A C</span>
<span class="c1">## Levels: A B C</span>
</pre></div>
</div>
</div>
<div class="proof proof-type-exercise" id="id68">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.24</span>
        
    </div><div class="proof-content">
<p>When subsetting a factor object, the result will inherit the
<code class="docutils literal notranslate"><span class="pre">levels</span></code> attribute in its entirety:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)]</span><span class="w">  </span><span class="c1"># drop=FALSE</span>
<span class="c1">## [1] c c</span>
<span class="c1">## Levels: a b c</span>
</pre></div>
</div>
<p>However:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">]</span>
<span class="c1">## [1] c c</span>
<span class="c1">## Levels: c</span>
</pre></div>
</div>
<p>Implement your version of the <strong class="command">droplevels</strong> function,
which removes the unused attributes.</p>
</div></div><div class="proof proof-type-exercise" id="id69">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.25</span>
        
    </div><div class="proof-content">
<p>The replacement version of the index operator does not automatically
add new levels to the modified object:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">))</span>
<span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="s">&quot;C&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># like in x[4] &lt;- &quot;C&quot;</span>
<span class="c1">## Warning in `[&lt;-.factor`(x, 4, value = &quot;C&quot;): invalid factor level, NA</span>
<span class="c1">##     generated</span>
<span class="c1">## [1] A    B    A    &lt;NA&gt;</span>
<span class="c1">## Levels: A B</span>
</pre></div>
</div>
<p>Implement a version of `<strong class="command">[&lt;-.factor</strong>` that has such a capability.</p>
</div></div></section>
<section id="ordered-factors">
<h3><span class="section-number">10.3.3. </span>Ordered factors<a class="headerlink" href="#ordered-factors" title="Link to this heading">¶</a></h3>
<p>When creating factors, we can enforce a particular ordering
and the number of levels:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sausage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">)</span>
<span class="nf">factor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sausage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">))</span>
<span class="c1">## [1] spam    spam    bacon   sausage spam    bacon</span>
<span class="c1">## Levels: eggs bacon sausage spam</span>
</pre></div>
</div>
<p>If we want the arrangement of the levels to define a linear ordering
relation over the set of labels, we can call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sausage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">## [1] spam    spam    bacon   sausage spam    bacon</span>
<span class="c1">## Levels: eggs &lt; bacon &lt; sausage &lt; spam</span>
<span class="nf">class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">## [1] &quot;ordered&quot; &quot;factor&quot;</span>
</pre></div>
</div>
<p>It yields an ordered factor, which enables comparisons like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">]</span><span class="w">  </span><span class="c1"># what&#39;s not worse than bacon?</span>
<span class="c1">## [1] spam    spam    bacon   sausage spam    bacon</span>
<span class="c1">## Levels: eggs &lt; bacon &lt; sausage &lt; spam</span>
</pre></div>
</div>
<p>How is that possible? Well, based on information provided in this chapter,
it will come as no surprise that it is because… someone has
created a relational operator for objects of the class <code class="docutils literal notranslate"><span class="pre">ordered</span></code>.</p>
</section>
<section id="formulae">
<span id="sec-formula-intro"></span><h3><span class="section-number">10.3.4. </span>Formulae (*)<a class="headerlink" href="#formulae" title="Link to this heading">¶</a></h3>
<p>Formulae are created using the `<strong class="command">~</strong>` operator.
Some R users employ them to specify widely-conceived <em>statistical models</em>
in functions such as
<strong class="command">lm</strong> (e.g., linear regression),
<strong class="command">glm</strong> (generalised linear models like logistic regression etc.),
<strong class="command">aov</strong> (analysis of variance),
<strong class="command">wilcox.test</strong> (the two-sample Mann–Whitney–Wilcoxon test),
<strong class="command">aggregate</strong> (computing aggregates within data groups),
<strong class="command">boxplot</strong> (box-and-whisker plots for a variable
split by a combination of factors), or <strong class="command">plot</strong> (scatter plots);
see also Chapter 11 of <span id="id28">[<a class="reference internal" href="999-bibliography.html#id9" title="Venables, W.N., Smith, D.M., and R Development Core Team. (2023).  An Introduction to R. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-intro.html.">58</a>]</span>. For instance, formulae can be
used to describe symbolic relationships such as:</p>
<ul class="simple">
<li><p>“<code class="docutils literal notranslate"><span class="pre">y</span></code> as a linear combination of <code class="docutils literal notranslate"><span class="pre">x1</span></code>, <code class="docutils literal notranslate"><span class="pre">x2</span></code>, and <code class="docutils literal notranslate"><span class="pre">x3</span></code>”,</p></li>
<li><p>“<code class="docutils literal notranslate"><span class="pre">y</span></code> grouped/split by a combination of <code class="docutils literal notranslate"><span class="pre">x1</span></code> and <code class="docutils literal notranslate"><span class="pre">x2</span></code>”,</p></li>
</ul>
<p>where <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x1</span></code>, etc., are, for example, column names in a data frame.</p>
<p>Formulae are interpreted by the corresponding
functions, and not the R language itself. Thus, programmers are free
to assign them any meaning. As their syntax is quite esoteric,
beginners might find them confusing. Hence,
we will postpone discussing them until <a class="reference internal" href="340-lazy.html#sec-formula"><span class="std std-numref">Section 17.6</span></a>.
Luckily, the use of formulae can usually easily
be avoided<a class="footnote-reference brackets" href="#footagainstformulae" id="id29" role="doc-noteref"><span class="fn-bracket">[</span>25<span class="fn-bracket">]</span></a>.</p>
</section>
</section>
<section id="over-using-the-forward-pipe-operator">
<span id="sec-pipe"></span><h2><span class="section-number">10.4. </span>(Over)using the forward pipe operator, `<strong class="command">|&gt;</strong>` (*)<a class="headerlink" href="#over-using-the-forward-pipe-operator" title="Link to this heading">¶</a></h2>
<p>The OOP paradigm is utile when we wish
to define a new data type, perhaps even a hierarchy of types.
Many development teams find it an efficient tool to organise larger
pieces of software. However, in the data science and numerical computing
domains, more often than not, we are the <em>consumers</em> of object orientation
rather than class <em>designers</em>.</p>
<p>Thanks to the S3 method dispatch mechanism, our language is easily
extensible. Something that mimics a new data type can easily be introduced.
Most importantly, methods can be added or removed
during runtime, e.g., when importing external packages.</p>
<p>However, R is still a functional programming language,
where functions are not just first-class citizens: they are privileged.</p>
<p>In functional programming, the emphasis is on operations (verbs),
not data (nouns). It leads to a very readable syntax. For example,
assuming that <strong class="command">square</strong>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">y</span></code> are sensibly defined,
the mean squared difference can be written as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">mean</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">))</span><span class="w">  </span><span class="c1"># read: mean of squares of differences</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id70">

    <div class="proof-title">
        <span class="proof-type">Example 10.26</span>
        
    </div><div class="proof-content">
<p>Base R is extremely flexible. We can introduce new
vocabulary as we please. In <a class="reference internal" href="240-data-frame.html#sec-df-group-by"><span class="std std-numref">Section 12.3.7</span></a>, we will
study an example where we define:</p>
<ul class="simple">
<li><p><strong class="command">group_by</strong> (a function that splits a data frame with respect to
a combination of levels in given named columns
and returns a list of data frames with class <code class="docutils literal notranslate"><span class="pre">list_dfs</span></code>),</p></li>
<li><p><strong class="command">aggregate.list_dfs</strong> (which applies an aggregation function on
every column of all data frames in a given list), and</p></li>
<li><p><strong class="command">mean.list_dfs</strong> (a specialised version of the former
that calls <strong class="command">mean</strong>).</p></li>
</ul>
<p>The specifics do not matter now. Let’s just
consider the notation we use when the operations are chained:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># select a few rows and columns from the `iris` data frame:</span>
<span class="n">iris_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">51</span><span class="o">:</span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Petal.Length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">)]</span>
<span class="c1"># compute the averages of all variables grouped by Species:</span>
<span class="nf">mean</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="n">iris_subset</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">))</span>
<span class="c1">##      Species            x  Mean</span>
<span class="c1">## 1 versicolor  Sepal.Width 2.770</span>
<span class="c1">## 2 versicolor Petal.Length 4.260</span>
<span class="c1">## 3  virginica  Sepal.Width 2.974</span>
<span class="c1">## 4  virginica Petal.Length 5.552</span>
</pre></div>
</div>
<p>The functional syntax is very <em>reader</em>-centric. We compute the mean
in groups defined by <code class="docutils literal notranslate"><span class="pre">Species</span></code> in a subset of the <code class="docutils literal notranslate"><span class="pre">iris</span></code> data frame.
All <em>verbs</em> appear on the left side of the expression,
with the final (the most important?) operation being listed first.</p>
<p>By the way, self-explanatory variable names and rich comments are priceless.</p>
</div></div><p>Nonetheless, when implementing more complex data processing pipelines,
<em>programmers</em> think in different categories: “first, we need to do this,
then we need to do that, and afterwards…”. When they write their ideas
down, they have to press <kbd class="kbd docutils literal notranslate">Home</kbd> and <kbd class="kbd docutils literal notranslate">End</kbd> or arrow keys a few
times to move the caret to the right places:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">finally</span><span class="p">(</span><span class="nf">thereafter</span><span class="p">(</span><span class="nf">then</span><span class="p">(</span><span class="nf">first</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
</pre></div>
</div>
<p>As we are inherently lazy, we might want to “optimise” our
workflow to save a bit of energy.</p>
<p>In more traditional object-orientated programming languages, either
the method list is sealed inside<a class="footnote-reference brackets" href="#footsealmeth" id="id30" role="doc-noteref"><span class="fn-bracket">[</span>26<span class="fn-bracket">]</span></a> the class’ definition
(like in C++), or cumbersome patches must be applied to
inject a method (like in Python)<a class="footnote-reference brackets" href="#footextmeth" id="id31" role="doc-noteref"><span class="fn-bracket">[</span>27<span class="fn-bracket">]</span></a>.
There, it is <em>the objects</em> that are <em>told</em> what to do.
They are treated as black boxes.</p>
<p>Many popular languages rely on message-passing syntax,
where operations are propagated (and written) left-to-right
instead of inside-out. For instance,
<code class="docutils literal notranslate"><span class="pre">obj.</span></code><strong class="command">method1</strong><code class="code docutils literal notranslate"><span class="pre">().</span></code><strong class="command">method2</strong><code class="code docutils literal notranslate"><span class="pre">()</span></code>
might mean “call <strong class="command">method1</strong> on <code class="docutils literal notranslate"><span class="pre">obj</span></code> and
then call <strong class="command">method2</strong> on the result”.</p>
<p>Since R 4.1.0, there is a <em>pipe operator</em><a class="footnote-reference brackets" href="#footpipe" id="id32" role="doc-noteref"><span class="fn-bracket">[</span>28<span class="fn-bracket">]</span></a>, `<strong class="command">|&gt;</strong>`.
It is merely syntactic sugar for translating between the message-passing
and function-centric notion. In a nutshell, writing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">h</span><span class="p">()</span>
<span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">square</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>is equivalent, respectively, to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">h</span><span class="p">(</span><span class="nf">g</span><span class="p">(</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="nf">mean</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>This syntax is developer-centric. It is fast to write;
no wonder why some refer to it as a <em>fluent</em> form.
It emphasises the order in which the operations are executed.
However, we must stress that it is something that can always be achieved
with the function-centric form and perhaps a few auxiliary variables.</p>
<p>The placeholder `<code class="docutils literal notranslate"><span class="pre">_</span></code>` can be used on the right side of the pipe
operator (only once) to indicate that the left side must be matched
with a specific <em>named</em> argument of the function to be called.
Otherwise, the left side is always passed as the first
argument.</p>
<p>Therefore, the two following expressions are equivalent:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">median</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">`-`</span><span class="p">(</span><span class="n">e1</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="o">=</span>_<span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">abs</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">median</span><span class="p">()</span>
<span class="nf">median</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="nf">median</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id71">

    <div class="proof-title">
        <span class="proof-type">Example 10.27</span>
        
    </div><div class="proof-content">
<p>The pipe operator version of the above <code class="docutils literal notranslate"><span class="pre">iris</span></code> aggregation exercise
would look like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">iris_subset</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="s">&quot;Species&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">mean</span><span class="p">()</span>
</pre></div>
</div>
</div></div><p>Expressions on the right side of the pipe operator
must always be proper calls. Therefore, the use of round brackets is
obligatory. Thus, when passing anonymous functions, we must write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">mean</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">))()</span><span class="w">  </span><span class="c1"># note the &quot;()&quot; at the end</span>
<span class="c1">## [1] 0.078184</span>
</pre></div>
</div>
<p>Peculiarly, in R 4.1.0, a “shorthand” notation
for creating functions was introduced. We can save seven keystrokes
and scribble “<code class="docutils literal notranslate"><span class="pre">\(...)</span> <span class="pre">expr</span></code>” instead of
“<strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">(...)</span> <span class="pre">expr</span></code>”.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="p">(</span>\<span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">mean</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">))()</span><span class="w">  </span><span class="c1"># again: &quot;()&quot; at the end</span>
<span class="c1">## [1] 0.078184</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>There is nothing that cannot be achieved without the pipe operator.
As this book is minimalist by design, we refrain ourselves from using it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When writing code interactively, we may sometimes benefit from
using the rightward `<strong class="command">-&gt;</strong>` operator. Suffice it to say
that “<code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>” and “<code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">-&gt;</span> <span class="pre">name</span></code>” are synonymous.</p>
<p>This way, we can type some lengthy code, store the result
in an intermediate variable, and then continue in the next line
(possibly referring to that auxiliary value more than once).
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">.</span>
<span class="nf">mean</span><span class="p">((</span><span class="n">.</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [1] 0.078184</span>
</pre></div>
</div>
<p>Recall that `<code class="docutils literal notranslate"><span class="pre">.</span></code>` is as valid a variable name as any other one.
Another example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">iris</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Sepal.Width&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Petal.Length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">.</span>
<span class="n">.</span><span class="p">[</span><span class="w"> </span><span class="n">.</span><span class="p">[,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;versicolor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;virginica&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">.</span>
<span class="nf">mean</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Species&quot;</span><span class="p">))</span>
<span class="c1">##      Species            x  Mean</span>
<span class="c1">## 1 versicolor  Sepal.Width 2.770</span>
<span class="c1">## 2 versicolor Petal.Length 4.260</span>
<span class="c1">## 3  virginica  Sepal.Width 2.974</span>
<span class="c1">## 4  virginica Petal.Length 5.552</span>
</pre></div>
</div>
</div>
</section>
<section id="s4-classes">
<span id="sec-s4"></span><h2><span class="section-number">10.5. </span>S4 classes (*)<a class="headerlink" href="#s4-classes" title="Link to this heading">¶</a></h2>
<p>The S3-style OOP is based on a brilliantly simple idea: calling a generic
<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> dispatches automatically to a method
<strong class="command">f.class_of_x</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> or
<strong class="command">f.default</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> in the case where the former does not exist.
Naturally, S3 has some inherent limitations:</p>
<ul class="simple">
<li><p>classes cannot be formally defined; the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute
may be assigned arbitrarily to any object<a class="footnote-reference brackets" href="#foots3fix1" id="id33" role="doc-noteref"><span class="fn-bracket">[</span>29<span class="fn-bracket">]</span></a>,</p></li>
<li><p>argument dispatch is performed only<a class="footnote-reference brackets" href="#footmutdis" id="id34" role="doc-noteref"><span class="fn-bracket">[</span>30<span class="fn-bracket">]</span></a> with regard to one data
type<a class="footnote-reference brackets" href="#foots3fix2" id="id35" role="doc-noteref"><span class="fn-bracket">[</span>31<span class="fn-bracket">]</span></a>.</p></li>
</ul>
<p>In most cases, and with an appropriate level of mindfulness, they are not
a problem at all. However, it is a typical condition of programmers
who come to our world from more mainstream languages (e.g., C++ or Java;
yours truly included) until they appreciate the true beauty of R’s being
somewhat different. Before they fully develop such an acquired taste,
though, they grow restless as “R is has no real OOP
because it lacks polymorphism, encapsulation, formal inheritance, and so on,
and something must be done about it!”. The truth is that it had not
had to, but with high probability, it would have anyway
in one way or another.</p>
<p>And so the fourth version of the S language was introduced in 1998
(see <span id="id36">[<a class="reference internal" href="999-bibliography.html#id51" title="Chambers, J.M. (1998).  Programming with Data. A Guide to the S Language. Springer.">9</a>]</span>). It brought a new object-orientated system,
which we are used to referring to as S4.
Its R version is defined by the <strong class="program">methods</strong> package.
Below we discuss it briefly. For more details, see
<strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Classes_Details&quot;)</span></code> and <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Methods_Details&quot;)</span></code> as well as
<span id="id37">[<a class="reference internal" href="999-bibliography.html#id19" title="Chambers, J.M. (2008).  Software for Data Analysis. Programming with R. Springer.">10</a>]</span> and <span id="id38">[<a class="reference internal" href="999-bibliography.html#id21" title="Chambers, J.M. (2016).  Extending R. Chapman &amp; Hall.">11</a>]</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
S4 was loosely inspired by the Common Lisp Object System
(with its <code class="docutils literal notranslate"><span class="pre">defclass</span></code>, <code class="docutils literal notranslate"><span class="pre">defmethod</span></code>, etc.; see, e.g., <span id="id39">[<a class="reference internal" href="999-bibliography.html#id7" title="DeMichiel, L.G. and Gabriel, R.P. (1987).  The Common Lisp Object System: An overview. ECOOP. URL: https://www.dreamsongs.com/Files/ECOOP.pdf.">20</a>]</span>).
In the current author’s opinion, the S4 system is somewhat of
an afterthought. Due to appendages like this, R seems like a patchwork
language. Suffice it to say that it was not the last attempt to introduce
a “real” OOP in the overall functional R:
the story will resume in <a class="reference internal" href="330-environment.html#sec-refclass"><span class="std std-numref">Section 16.1.5</span></a>.</p>
<p>The main issue with all the supplementary OOP approaches is that each
of them is <em>parallel</em> to S3 which never lost its popularity
and is still in the very core of our language.
We are thus covering them only for the sake of completeness
for the readers might come across such objects.
In particular, we shall explain the meaning of a notation like <code class="docutils literal notranslate"><span class="pre">x&#64;slot</span></code>.
Moreover, in <a class="reference internal" href="230-matrix.html#sec-matrix-s4"><span class="std std-numref">Section 11.4.7</span></a> we mention the <code class="docutils literal notranslate"><span class="pre">Matrix</span></code> class
which is perhaps the most prominent showcase of S4.</p>
<p>Nonetheless, the current author advises taking with a pinch of salt
statements such as <em>for new projects, it is recommended to use the more
flexible and robust S4 scheme provided in the <strong class="program">methods</strong> package</em>
mentioned in <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;UseMethod&quot;)</span></code>.</p>
</div>
<section id="defining-s4-classes">
<h3><span class="section-number">10.5.1. </span>Defining S4 classes<a class="headerlink" href="#defining-s4-classes" title="Link to this heading">¶</a></h3>
<p>An S4 class can be formally registered through a call to <strong class="command">setClass</strong>.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;methods&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># in the case where it is not auto-loaded</span>
<span class="nf">setClass</span><span class="p">(</span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">slots</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s">&quot;integer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>We defined a class named <code class="docutils literal notranslate"><span class="pre">qualitative</span></code> (similarity to
our own <code class="docutils literal notranslate"><span class="pre">categorical</span></code> and the built-in <code class="docutils literal notranslate"><span class="pre">factor</span></code> S3 classes is intended).
It has two slots: <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">levels</span></code> being integer and character
vectors, respectively. This notation is already outlandish.
There is no assignment suggesting that we have introduced something novel.</p>
<p>An object of the above class can be instantiated
by calling <strong class="command">new</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">,</span><span class="w"> </span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="m">1L</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## An object of class &quot;qualitative&quot;</span>
<span class="c1">## Slot &quot;data&quot;:</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="c1">##</span>
<span class="c1">## Slot &quot;levels&quot;:</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot;</span>
</pre></div>
</div>
<p>That <code class="docutils literal notranslate"><span class="pre">z</span></code> is of this class can be verified by calling <strong class="command">is</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">is</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;qualitative&quot;</span><span class="p">)</span>
<span class="c1">## [1] TRUE</span>
<span class="nf">class</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># also: attr(z, &quot;class&quot;)</span>
<span class="c1">## [1] &quot;qualitative&quot;</span>
<span class="c1">## attr(,&quot;package&quot;)</span>
<span class="c1">## [1] &quot;.GlobalEnv&quot;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A few R packages import the <strong class="program">methods</strong> package only to get access
the handy <strong class="command">is</strong> function. It does not mean they are defining
new S4 classes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>S4 objects are marked as being of the following basic type:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## [1] &quot;S4&quot;</span>
</pre></div>
</div>
<p>See Section 1.12 of <span id="id40">[<a class="reference internal" href="999-bibliography.html#id13" title="R Development Core Team. (2023).  R Internals. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-ints.html.">68</a>]</span> for technical details on how they are
internally represented. In particular, in our case, all the slots are simply
stored as object attributes:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attributes</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## $data</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="c1">##</span>
<span class="c1">## $levels</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot;</span>
<span class="c1">##</span>
<span class="c1">## $class</span>
<span class="c1">## [1] &quot;qualitative&quot;</span>
<span class="c1">## attr(,&quot;package&quot;)</span>
<span class="c1">## [1] &quot;.GlobalEnv&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="accessing-slots">
<h3><span class="section-number">10.5.2. </span>Accessing slots<a class="headerlink" href="#accessing-slots" title="Link to this heading">¶</a></h3>
<p>Reading or writing slot contents can be done via the `<strong class="command">&#64;</strong>`
operator and the <strong class="command">slot</strong> function or their replacement versions.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">@</span><span class="n">data</span><span class="w">  </span><span class="c1"># or slot(z, &quot;data&quot;)</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="n">z</span><span class="o">@</span><span class="n">levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The `<strong class="command">&#64;</strong>` operator can only be used on S4 objects,
and some sanity checks are automatically performed:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">@</span><span class="n">unknown</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="c1">## Error in (function (cl, name, valueClass) : &#39;unknown&#39; is not a slot in</span>
<span class="c1">##     class &quot;qualitative&quot;</span>
<span class="n">z</span><span class="o">@</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="c1">## Error in (function (cl, name, valueClass) : assignment of an object of</span>
<span class="c1">##     class &quot;character&quot; is not valid for @&#39;data&#39; in an object of class</span>
<span class="c1">##     &quot;qualitative&quot;; is(value, &quot;integer&quot;) is not TRUE</span>
</pre></div>
</div>
</div>
</section>
<section id="defining-methods">
<h3><span class="section-number">10.5.3. </span>Defining methods<a class="headerlink" href="#defining-methods" title="Link to this heading">¶</a></h3>
<p>For the S4 counterparts of the S3 generics
(<a class="reference internal" href="#sec-s3-generic"><span class="std std-numref">Section 10.2</span></a>), see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;setGeneric&quot;)</span></code>.
Luckily, there is a reasonable degree of interoperability between
the S3 and S4 systems.</p>
<p>Let’s introduce a new method for the
well-known <strong class="command">as.character</strong> generic.
Instead of defining <strong class="command">as.character.qualitative</strong>,
we need to register a new routine with <strong class="command">setMethod</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;as.character&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1"># name of the generic</span>
<span class="w">    </span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span><span class="w">      </span><span class="c1"># class of 1st arg; or: signature=c(x=&quot;qualitative&quot;)</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span><span class="w">    </span><span class="c1"># method definition</span>
<span class="w">        </span><span class="n">x</span><span class="o">@</span><span class="n">levels</span><span class="p">[</span><span class="n">x</span><span class="o">@</span><span class="n">data</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.character</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## [1] &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot;</span>
</pre></div>
</div>
<p><strong class="command">show</strong> is the S4 counterpart of <strong class="command">print</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;show&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
<span class="w">        </span><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># calls `print.default`</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;Categories: %s\n&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nf">paste</span><span class="p">(</span><span class="n">object</span><span class="o">@</span><span class="n">levels</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="p">)))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Interestingly, it is involved automatically on a call to <strong class="command">print</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># calls `show` for `qualitative`</span>
<span class="c1">## [1] &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot;</span>
<span class="c1">## Categories: A, B</span>
</pre></div>
</div>
<p>Methods that dispatch on the type of multiple arguments
are also possible. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;split&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;ANY&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">=</span><span class="s">&quot;qualitative&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">function </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">        </span><span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It permits the first argument to be of any type (like a default method).
Moreover, here is its version tailored for matrices
(see <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;split&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;matrix&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">=</span><span class="s">&quot;qualitative&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">function </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">)</span>
<span class="w">        </span><span class="nf">lapply</span><span class="p">(</span>
<span class="w">            </span><span class="nf">split</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">),</span><span class="w">  </span><span class="c1"># calls the above</span>
<span class="w">            </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Some tests:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w">  </span><span class="c1"># whatever</span>
<span class="nf">split</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w">    </span><span class="c1"># matrix, qualitative</span>
<span class="c1">## $A</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span>
<span class="c1">## [1,]    1    6   11   16   21   26   31</span>
<span class="c1">## [2,]    4    9   14   19   24   29   34</span>
<span class="c1">## [3,]    5   10   15   20   25   30   35</span>
<span class="c1">##</span>
<span class="c1">## $B</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span>
<span class="c1">## [1,]    2    7   12   17   22   27   32</span>
<span class="c1">## [2,]    3    8   13   18   23   28   33</span>
<span class="nf">split</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># ANY, qualitative</span>
<span class="c1">## $A</span>
<span class="c1">## [1] 1 4 5</span>
<span class="c1">##</span>
<span class="c1">## $B</span>
<span class="c1">## [1] 2 3</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id72">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.28</span>
        
    </div><div class="proof-content">
<p>Overload the `<strong class="command">[</strong>` operator for the <code class="docutils literal notranslate"><span class="pre">qualitative</span></code> class.</p>
</div></div></section>
<section id="defining-constructors">
<h3><span class="section-number">10.5.4. </span>Defining constructors<a class="headerlink" href="#defining-constructors" title="Link to this heading">¶</a></h3>
<p>We can also overload the <strong class="command">initialize</strong> method,
which is automatically called by <strong class="command">new</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;initialize&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1"># note the American spelling</span>
<span class="w">    </span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">.Object</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span><span class="w">  </span><span class="c1"># the method itself</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.character</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># see above</span>
<span class="w">        </span><span class="n">xu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># drops NAs</span>

<span class="w">        </span><span class="n">.Object</span><span class="o">@</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xu</span><span class="p">)</span>
<span class="w">        </span><span class="n">.Object</span><span class="o">@</span><span class="n">levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xu</span>

<span class="w">        </span><span class="n">.Object</span><span class="w">  </span><span class="c1"># return value - a modified object</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This constructor yields instances of the class <code class="docutils literal notranslate"><span class="pre">qualitative</span></code>
based on an object coercible to a character vector. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="s">&quot;qualitative&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="c1">## [1] &quot;a&quot; &quot;c&quot; &quot;a&quot; &quot;a&quot; &quot;d&quot; &quot;c&quot;</span>
<span class="c1">## Categories: a, c, d</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id73">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.29</span>
        
    </div><div class="proof-content">
<p>Set up a validating method for our class; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;setValidity&quot;)</span></code>.</p>
</div></div></section>
<section id="inheritance">
<h3><span class="section-number">10.5.5. </span>Inheritance<a class="headerlink" href="#inheritance" title="Link to this heading">¶</a></h3>
<p>New S4 classes can be derived from existing ones. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setClass</span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="o">=</span><span class="s">&quot;qualitative&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is a child class that inherits all slots from its parent.
We can overload its initialisation method:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;initialize&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;binary&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">.Object</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">        </span><span class="n">xu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">.Object</span><span class="o">@</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xu</span><span class="p">)</span>
<span class="w">        </span><span class="n">.Object</span><span class="o">@</span><span class="n">levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xu</span>
<span class="w">        </span><span class="n">.Object</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">new</span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">## [1] &quot;1&quot; &quot;0&quot; &quot;1&quot; &quot;0&quot; NA  &quot;1&quot;</span>
<span class="c1">## Categories: 0, 1</span>
</pre></div>
</div>
<p>We can still use the <strong class="command">show</strong> method of the parent class.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">10.6. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="proof proof-type-exercise" id="id74">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.30</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>How to display the source code of the default methods
for <strong class="command">head</strong> and <strong class="command">tail</strong>?</p></li>
<li><p>Can there be, at the same time,
one object of the class <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;A&quot;,</span> <span class="pre">&quot;B&quot;)</span></code>
and another one of the class <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;B&quot;,</span> <span class="pre">&quot;A&quot;)</span></code>?</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">f</span></code> is a factor, what are the relationships between
<strong class="command">as.character</strong><code class="code docutils literal notranslate"><span class="pre">(f)</span></code>,
<strong class="command">as.numeric</strong><code class="code docutils literal notranslate"><span class="pre">(f)</span></code>,
<strong class="command">as.character</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">as.numeric</strong><code class="code docutils literal notranslate"><span class="pre">(f))</span></code>, and
<strong class="command">as.numeric</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">as.character</strong><code class="code docutils literal notranslate"><span class="pre">(f))</span></code>?</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">x</span></code> is a named vector and <code class="docutils literal notranslate"><span class="pre">f</span></code> is a factor,
is <code class="docutils literal notranslate"><span class="pre">x[f]</span></code> equivalent to <code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">as.character</strong><code class="code docutils literal notranslate"><span class="pre">(f)]</span></code> or rather
<code class="docutils literal notranslate"><span class="pre">x[</span></code><strong class="command">as.numeric</strong><code class="code docutils literal notranslate"><span class="pre">(f)]</span></code>?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id75">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.31</span>
        
    </div><div class="proof-content">
<p>A user calls:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">log</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are numeric vectors. Consult <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;plot&quot;)</span></code>
for the meaning of the <code class="docutils literal notranslate"><span class="pre">ylim</span></code> and <code class="docutils literal notranslate"><span class="pre">log</span></code> arguments.
Was that straightforward?</p>
</div></div><div class="proof proof-type-exercise" id="id76">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.32</span>
        
    </div><div class="proof-content">
<p>Explain why the two following calls return significantly different results.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="nf">Sys.Date</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;1970-01-01&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;2024-07-11&quot; &quot;1970-01-01&quot;</span>
<span class="nf">c</span><span class="p">(</span><span class="s">&quot;1970-01-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">Sys.Date</span><span class="p">())</span>
<span class="c1">## [1] &quot;1970-01-01&quot; &quot;19915&quot;</span>
</pre></div>
</div>
<p>Propose a workaround.</p>
</div></div><div class="proof proof-type-exercise" id="id77">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.33</span>
        
    </div><div class="proof-content">
<p>Write methods <strong class="command">head</strong> and <strong class="command">tail</strong>
for our example <code class="docutils literal notranslate"><span class="pre">categorical</span></code> class.</p>
</div></div><div class="proof proof-type-exercise" id="id78">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.34</span>
        
    </div><div class="proof-content">
<p>(*) Write an R package that defines S3 class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>.
Add a few methods for this class.
Note the need to use the <code class="docutils literal notranslate"><span class="pre">S3method</span></code> directive
in the <code class="file docutils literal notranslate"><span class="pre">NAMESPACE</span></code> file; see <span id="id41">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id79">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.35</span>
        
    </div><div class="proof-content">
<p>Inspect the result of a call to
<strong class="command">binom.test</strong><code class="code docutils literal notranslate"><span class="pre">(79,</span> <span class="pre">100)</span></code>
and to
<strong class="command">rle</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">4,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">2,</span> <span class="pre">2))</span></code>.
Find the methods responsible for such objects’ pretty-printing.</p>
</div></div><div class="proof proof-type-exercise" id="id80">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.36</span>
        
    </div><div class="proof-content">
<p>Read more about the <code class="docutils literal notranslate"><span class="pre">connection</span></code> class. In particular,
see the <em>Value</em> section of <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;connections&quot;)</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id81">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.37</span>
        
    </div><div class="proof-content">
<p>Read about the subsetting operators overloaded for the <code class="docutils literal notranslate"><span class="pre">package_version</span></code>
class; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;numeric_version&quot;)</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id82">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.38</span>
        
    </div><div class="proof-content">
<p>There are <strong class="command">xtfrm</strong> methods
overloaded for classes such as <code class="docutils literal notranslate"><span class="pre">numeric_version</span></code>,
<code class="docutils literal notranslate"><span class="pre">difftime</span></code>, <code class="docutils literal notranslate"><span class="pre">Date</span></code>, and <code class="docutils literal notranslate"><span class="pre">factor</span></code>.  Find out how they work and
where they might be of service (especially in relation to
<strong class="command">order</strong> and <strong class="command">sort</strong>; see also <a class="reference internal" href="240-data-frame.html#sec-df-order"><span class="std std-numref">Section 12.3.1</span></a>).</p>
</div></div><div class="proof proof-type-exercise" id="id83">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.39</span>
        
    </div><div class="proof-content">
<p>Give an example where
<strong class="command">split</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> </code><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(y1,</span> <span class="pre">y2))</span></code>
(with default arguments) will fail to generate the correct result.</p>
</div></div><div class="proof proof-type-exercise" id="id84">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.40</span>
        
    </div><div class="proof-content">
<p>Write a function that determines the mode, i.e., the most frequently
occurring value in a given object of the class <code class="docutils literal notranslate"><span class="pre">factor</span></code>. If the mode
is not unique, return a randomly chosen one (each with the same probability).</p>
</div></div><div class="proof proof-type-exercise" id="id85">

    <div class="proof-title">
        <span class="proof-type">Exercise 10.41</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">gl</strong> function.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="foots3limits" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>They were built on top of the ordinary (“old S”) R
so they have inherent limitations that we discuss in the sequel:
classes cannot be formally defined (often we will use named lists
for representing objects, and we know we cannot be any more
flexible than this), and method dispatching can only be based
on the class of one of the arguments (usually the first one,
but, e.g., binary operators take both types into account).</p>
</aside>
<aside class="footnote brackets" id="foototherclass" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>Other class systems may give an impression that
they are alien implants which were forcefully added to our language
to solve a specific, rather narrow class of problems; e.g.,
S4 (<a class="reference internal" href="#sec-s4"><span class="std std-numref">Section 10.5</span></a>), reference classes (<a class="reference internal" href="330-environment.html#sec-refclass"><span class="std std-numref">Section 16.1.5</span></a>),
and other ones proposed by third-party packages.</p>
</aside>
<aside class="footnote brackets" id="footsexptype" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">3</a><span class="fn-bracket">]</span></span>
<p>Their list is hardcoded at the C language level;
see the list of <code class="docutils literal notranslate"><span class="pre">SEXPTYPE</span></code>s in <a class="reference internal" href="310-compiled.html#tab-sexp-types"><span class="std std-numref">Table 14.1</span></a> and
<span id="id42">[<a class="reference internal" href="999-bibliography.html#id13" title="R Development Core Team. (2023).  R Internals. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-ints.html.">68</a>]</span>.</p>
</aside>
<aside class="footnote brackets" id="footexternalptr" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">4</a><span class="fn-bracket">]</span></span>
<p>In particular, <a class="reference internal" href="310-compiled.html#sec-xptr"><span class="std std-numref">Section 14.2.8</span></a> mentions
<code class="docutils literal notranslate"><span class="pre">externalptr</span></code>s which are simple pointers to memory blocks
that can be instances of any C <code class="docutils literal notranslate"><span class="pre">struct</span></code>s or C++ <code class="docutils literal notranslate"><span class="pre">class</span></code>es.
This makes R a very extensible language.</p>
</aside>
<aside class="footnote brackets" id="footsplit" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">5</a><span class="fn-bracket">]</span></span>
<p>For instance, consider once again the example from
<a class="reference internal" href="150-indexing.html#sec-split"><span class="std std-numref">Section 5.4.3</span></a> that applies the <strong class="command">split</strong>
function on a data frame reduced to a list.</p>
</aside>
<aside class="footnote brackets" id="footusemeth1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">6</a><span class="fn-bracket">]</span></span>
<p>Some functions can have a version of
<strong class="command">UseMethod</strong> hidden at the C language level (internally);
see <a class="reference internal" href="#sec-built-in-generics"><span class="std std-numref">Section 10.2.3</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footusemeth2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">7</a><span class="fn-bracket">]</span></span>
<p>However, it cannot be implied by reading
the preceding source code. <strong class="command">UseMethod</strong> heavily
relies on some obscure hacks. We may only call it inside
a function’s body. Once invoked, it does not return to the generic.
Before dispatching to a particular method,
it creates a couple of hidden variables which give more detail
on the operation conveyed, e.g., `<code class="docutils literal notranslate"><span class="pre">.Generic</span></code>` or
`<code class="docutils literal notranslate"><span class="pre">.Class</span></code>`; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;UseMethod&quot;)</span></code> and
Section 5 of <span id="id43">[<a class="reference internal" href="999-bibliography.html#id11" title="R Development Core Team. (2023).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">69</a>]</span>.</p>
</aside>
<aside class="footnote brackets" id="foots3consistency" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">8</a><span class="fn-bracket">]</span></span>
<p>(*) Ensuring S3 generic/method
consistency is part of R package check.</p>
</aside>
<aside class="footnote brackets" id="footinternaldispatch" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">9</a><span class="fn-bracket">]</span></span>
<p>Generating the list of all S3 generics is somewhat
tricky, but at least the internal ones are enumerated in
<strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;InternalMethods&quot;)</span></code> and <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;groupGeneric&quot;)</span></code>; compare
`<code class="docutils literal notranslate"><span class="pre">.S3PrimitiveGenerics</span></code>`, `<code class="docutils literal notranslate"><span class="pre">.internalGenerics</span></code>`,
`<code class="docutils literal notranslate"><span class="pre">.knownS3Generics</span></code>`, and `<code class="docutils literal notranslate"><span class="pre">.S3_methods_table</span></code>`.
Some of them do not even call <strong class="command">UseMethod</strong> explicitly;
they dispatch at the C language level.
This is unfortunate as it decreases transparency.
Instead of simply inspecting a function’s source code
(compare, e.g., <strong class="command">cbind</strong>), we need to look this information
up in the documentation. Also, methods may be hardcoded internally,
and thus be unoverloadable. However, sometimes these design choices
can be defended because they improve execution speed or memory
consumption.</p>
</aside>
<aside class="footnote brackets" id="footpuzzle" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">10</a><span class="fn-bracket">]</span></span>
<p>It is a different story if we <em>really</em> want this behaviour.
Provided that we document it <em>thoroughly</em> (see how <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;factor&quot;)</span></code>
discusses the behaviour of a to-numeric conversion), we can start
holding the users responsible for their feeling confused
(those who have experience in teaching others will certainly agree
how complex this matter is). Remember that we can never make an API
fully foolproof and that there will always be someone to
challenge/stress-test our ideas.
Bad design is always wrong, but being overprotective or too defensive
also has its cons. We should maintain our audience wisely.
Users of open-source software are not our <em>clients</em>.
We do not work <em>for</em> them. We are in this <em>together</em>.</p>
</aside>
<aside class="footnote brackets" id="footonedispatch" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">11</a><span class="fn-bracket">]</span></span>
<p>There are many exceptions to this rule.
They were made for the (debatable) sake of the
R users’ convenience. In particular, in
<a class="reference internal" href="240-data-frame.html#sec-cbind-data-frame"><span class="std std-numref">Section 12.1.2</span></a>
we mention that <strong class="command">cbind</strong> and <strong class="command">rbind</strong>
will dispatch to the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> method if at least one argument
is a data frame (and others are unclassed).
Binary operators consider the type of both operands;
see <a class="reference internal" href="#sec-operator-overloading-s3"><span class="std std-numref">Section 10.2.6</span></a>.
Furthermore, it is worth noting that the S4 class system
(<a class="reference internal" href="#sec-s4"><span class="std std-numref">Section 10.5</span></a>) allows for dispatching based on the classes
many arguments.</p>
</aside>
<aside class="footnote brackets" id="footoperoverload" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">12</a><span class="fn-bracket">]</span></span>
<p>Dispatching to internal methods
can also be done… internally. For instance, overloading
`<strong class="command">&lt;.character</strong>` (or <strong class="command">Compare.character</strong>; see below)
will have no effect unless
the base `<strong class="command">&lt;</strong>` is replaced with a custom one
that makes an explicit call to <strong class="command">UseMethod</strong>.
Most often, we can expect that the built-in types (e.g.,
atomic vectors), factors, data frames, and matrices and other arrays
might be treated specially.</p>
</aside>
<aside class="footnote brackets" id="footoper" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id16">13</a><span class="fn-bracket">]</span></span>
<p>The case of binary operators is handled differently;
see <a class="reference internal" href="#sec-operator-overloading-s3"><span class="std std-numref">Section 10.2.6</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footclassdispatch" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">14</a><span class="fn-bracket">]</span></span>
<p><strong class="command">UseMethod</strong> dispatches on the implicit
class as determined by the <strong class="command">class</strong> function.
Note that the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute does not necessarily have to be set
in order for <strong class="command">class</strong> to return a sensible answer.</p>
</aside>
<aside class="footnote brackets" id="footlookup" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id18">15</a><span class="fn-bracket">]</span></span>
<p>For more details on S3 method lookup,
see <a class="reference internal" href="330-environment.html#sec-use-method"><span class="std std-numref">Section 16.3.6</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footcatcmp" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id19">16</a><span class="fn-bracket">]</span></span>
<p>There are, of course, many possible ways to implement
the `<strong class="command">==</strong>` operator for the discussed objects.
For instance, it may return
either a single <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> depending on if two objects are
identical (although probably overloading <strong class="command">all.equal</strong>
would be a better idea). We could also compare the
corresponding underlying integer codes instead of the labels, etc.</p>
</aside>
<aside class="footnote brackets" id="footascharacter" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id20">17</a><span class="fn-bracket">]</span></span>
<p>Which, of course, does not
have to be the case; it is merely an assumption based on
our belief in the common sense of other developers.</p>
</aside>
<aside class="footnote brackets" id="foototherclasses" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id21">18</a><span class="fn-bracket">]</span></span>
<p><strong class="command">unique</strong><code class="code docutils literal notranslate"><span class="pre">(.S3_methods_table[,</span> <span class="pre">2])</span></code>
approximates the list of available classes.</p>
</aside>
<aside class="footnote brackets" id="footposixlt" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id22">19</a><span class="fn-bracket">]</span></span>
<p>Which was inspired by <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tm</span></code> in C’s
<code class="file docutils literal notranslate"><span class="pre">&lt;time.h&gt;</span></code>.</p>
</aside>
<aside class="footnote brackets" id="footdateops" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id23">20</a><span class="fn-bracket">]</span></span>
<p>The overloaded group generic <strong class="command">Ops</strong>
prevents us from adding or multiplying two dates
and defines the meaning of the relational operators.
As an exercise, check out its source code.</p>
</aside>
<aside class="footnote brackets" id="footdatextfrm" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id24">21</a><span class="fn-bracket">]</span></span>
<p>See an exercise below on the use of <strong class="command">xtfrm</strong>.</p>
</aside>
<aside class="footnote brackets" id="footfactorint" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id25">22</a><span class="fn-bracket">]</span></span>
<p><span id="id44">[<a class="reference internal" href="999-bibliography.html#id11" title="R Development Core Team. (2023).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">69</a>]</span> states: <em>Factors are currently
implemented using an integer
array to specify the actual levels and a second array of names that are
mapped to the integers. Rather unfortunately users often make use of the
implementation in order to make some calculations easier. This, however,
is an implementation issue and is not guaranteed to hold in all
implementations of R.</em>
Still, <em>fortunately</em>, this has been a de facto standard for factors for
a very long time.</p>
</aside>
<aside class="footnote brackets" id="footstrcache" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id26">23</a><span class="fn-bracket">]</span></span>
<p>Recall that there is a global (internal) string cache.
Hence, having many duplicated strings is not a burden on the computer’s
memory.</p>
</aside>
<aside class="footnote brackets" id="footstringsasfactors" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id27">24</a><span class="fn-bracket">]</span></span>
<p>(*) Up until R 4.0, many functions
(including <strong class="command">data.frame</strong> and <strong class="command">read.csv</strong>)
had the <code class="docutils literal notranslate"><span class="pre">stringsAsFactors</span></code> option set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;options&quot;)</span></code>.
It resulted in all character vectors’ being automatically
converted to factors, e.g., when creating data frames
(compare <a class="reference internal" href="240-data-frame.html#sec-stringsasfactors"><span class="std std-numref">Section 12.1.5</span></a>). Luckily, this is no longer
the case. However, factor objects can still be encountered;
for instance, check the class of <code class="docutils literal notranslate"><span class="pre">iris[[&quot;Species&quot;]]</span></code>.</p>
</aside>
<aside class="footnote brackets" id="footagainstformulae" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id29">25</a><span class="fn-bracket">]</span></span>
<p>For example, <strong class="command">lm.fit</strong>
can be used instead of <strong class="command">lm</strong>. It is slightly more difficult
to learn, but it has the added benefit of ensuring
the user knows that the emergence of all model variables is
not magical (especially the nonlinear/mixed effect terms).</p>
</aside>
<aside class="footnote brackets" id="footsealmeth" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id30">26</a><span class="fn-bracket">]</span></span>
<p>When methods are parts of particular classes,
there can be a lot of duplicated code.
Functional OOP can be more developer-friendly as we
can provide all methods related to roughly the same
functionality in one spot.</p>
</aside>
<aside class="footnote brackets" id="footextmeth" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id31">27</a><span class="fn-bracket">]</span></span>
<p>See also the concept
of extension methods in C# or Kotlin and, to some extent,
of class inheritance.</p>
</aside>
<aside class="footnote brackets" id="footpipe" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id32">28</a><span class="fn-bracket">]</span></span>
<p>It was inspired by `<strong class="command">|</strong>` in Bash
and `<strong class="command">|&gt;&#64;</strong>` in F# and Julia (which are part of the
language specification).
Also, there is a `<strong class="command">%&gt;%</strong>` operator (and related ones)
in the R package <strong class="program">magrittr</strong>.</p>
</aside>
<aside class="footnote brackets" id="foots3fix1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id33">29</a><span class="fn-bracket">]</span></span>
<p>A partial solution to this could involve defining
a method like <strong class="command">validate.class_name</strong>, which is called
frequently and which checks whether a given object enjoys
a few desirable constraints.</p>
</aside>
<aside class="footnote brackets" id="footmutdis" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id34">30</a><span class="fn-bracket">]</span></span>
<p>Certain functions implement ad hoc workarounds
(see, e.g., <strong class="command">cbind</strong>, which dispatches to
<strong class="command">cbind.data.frame</strong> if one argument is a data frame
and the remaining ones are vectors or matrices).
Also, we said in the previous chapter that
binary operators consider the classes of both operands.</p>
</aside>
<aside class="footnote brackets" id="foots3fix2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id35">31</a><span class="fn-bracket">]</span></span>
<p>Hypothetically, we can imagine an OOP system
relying on methods named like <strong class="command">method.class_name1.class_name2</strong>
where dispatching is based on two argument types.
This would be beautiful, but it is not the case in R.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="230-matrix.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">11. </span>Matrices and other arrays</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="210-design.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">9. </span>Designing functions</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2024 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2024-07-19T10:24:08+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">10. S3 classes</a><ul>
<li><a class="reference internal" href="#object-type-vs-class">10.1. Object type vs class</a></li>
<li><a class="reference internal" href="#generics-and-method-dispatching">10.2. Generics and method dispatching</a><ul>
<li><a class="reference internal" href="#generics-default-and-custom-methods">10.2.1. Generics, default, and custom methods</a></li>
<li><a class="reference internal" href="#creating-generics">10.2.2. Creating generics</a></li>
<li><a class="reference internal" href="#built-in-generics">10.2.3. Built-in generics</a></li>
<li><a class="reference internal" href="#first-argument-dispatch-and-calling-s3-methods-directly">10.2.4. First-argument dispatch and calling S3 methods directly</a></li>
<li><a class="reference internal" href="#multi-class-ness">10.2.5. Multi-class-ness</a></li>
<li><a class="reference internal" href="#operator-overloading">10.2.6. Operator overloading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-built-in-s3-classes">10.3. Common built-in S3 classes</a><ul>
<li><a class="reference internal" href="#date-time-etc">10.3.1. Date, time, etc.</a></li>
<li><a class="reference internal" href="#factors">10.3.2. Factors</a></li>
<li><a class="reference internal" href="#ordered-factors">10.3.3. Ordered factors</a></li>
<li><a class="reference internal" href="#formulae">10.3.4. Formulae (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#over-using-the-forward-pipe-operator">10.4. (Over)using the forward pipe operator, `<strong class="command">|&gt;</strong>` (*)</a></li>
<li><a class="reference internal" href="#s4-classes">10.5. S4 classes (*)</a><ul>
<li><a class="reference internal" href="#defining-s4-classes">10.5.1. Defining S4 classes</a></li>
<li><a class="reference internal" href="#accessing-slots">10.5.2. Accessing slots</a></li>
<li><a class="reference internal" href="#defining-methods">10.5.3. Defining methods</a></li>
<li><a class="reference internal" href="#defining-constructors">10.5.4. Defining constructors</a></li>
<li><a class="reference internal" href="#inheritance">10.5.5. Inheritance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">10.6. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4805ff4d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>