<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />

  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2022" name="citation_date" />
<meta content="2022" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com/" name="citation_public_url" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com/" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>9. Designing Functions &mdash; Deep R Programming by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  

  
  

  
    <link rel="canonical" href="https://deepr.gagolewski.com/chapter/210-design.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10. S3 Classes" href="220-s3.html" />
    <link rel="prev" title="8. Flow of Execution" href="180-flow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Deep R Programming
          

          
          </a>

          <div class="version">
          An Open-Access Textbook<br />    by <a style="color: inherit" href="https://www.gagolewski.com">Marek     Gagolewski</a><br />    v0.1.12 (draft)
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr/">Report Bugs or Typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com">Data Wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of Execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. Designing Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#principles-of-sustainable-design">9.1. Principles of Sustainable Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#to-write-or-to-abstain">9.1.1. To Write or to Abstain</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-pamper-or-to-challenge">9.1.2. To Pamper or to Challenge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-build-or-to-reuse">9.1.3. To Build or to Reuse</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-flow">9.2. Managing Data Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checking-input-data-integrity-and-argument-handling">9.2.1. Checking Input Data Integrity and Argument Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-outputs-into-context">9.2.2. Putting Outputs into Context</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#organising-and-maintaining-functions">9.3. Organising and Maintaining Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#function-libraries">9.3.1. Function Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-r-packages">9.3.2. Writing R Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documenting-r-packages">9.3.3. Documenting R Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assuring-quality-code">9.3.4. Assuring Quality Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#managing-changes-and-working-collaboratively">9.3.4.1. Managing Changes and Working Collaboratively</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-driven-development-and-continuous-integration">9.3.4.2. Test-driven Development and Continuous Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">9.3.4.3. Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profiling">9.3.4.4. Profiling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#special-functions-syntactic-sugar">9.4. Special Functions: Syntactic Sugar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-note-on-backticks">9.4.1. A Note on Backticks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#curly-braces">9.4.2. Curly Braces,  `<strong class="command">{</strong>`</a></li>
<li class="toctree-l3"><a class="reference internal" href="#if">9.4.3. `<strong class="command">if</strong>`</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operators-are-functions-too">9.4.4. Operators are Functions Too</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#calling-built-in-operators-as-functions">9.4.4.1. Calling Built-in Operators as Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-own-binary-operators">9.4.4.2. Creating Own Binary Operators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#replacement-functions">9.4.5. Replacement Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-own-replacement-functions">9.4.5.1. Creating Own Replacement Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#substituting-parts-of-vectors">9.4.5.2. Substituting Parts of Vectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replacing-attributes">9.4.5.3. Replacing Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compositions-of-replacement-functions">9.4.5.4. Compositions of Replacement Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#arguments-and-local-variables">9.5. Arguments and Local Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pass-by-value">9.5.1. Pass by ‚ÄúValue‚Äù</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variable-scope">9.5.2. Variable Scope</a></li>
<li class="toctree-l3"><a class="reference internal" href="#closures">9.5.3. Closures (*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-arguments">9.5.4. Default Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lazy-evaluation">9.5.5. Lazy Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ellipsis">9.5.6. Ellipsis, `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metaprogramming">9.5.7. Metaprogramming (*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">9.6. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and Other Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. üöß Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compile.html">14. üöß Interfacing Compiled Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. üöß Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. üöß Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-eval-expr.html">17. üöß Evaluating Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="350-eval-fun.html">18. üöß Evaluating Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Deep R Programming</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">9. </span>Designing Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/deepr" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/deepr on GitHub">GitHub</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="220-s3.html" class="btn btn-neutral float-right" title="10. S3 Classes" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="180-flow.html" class="btn btn-neutral float-left" title="8. Flow of Execution" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="designing-functions">
<span id="chap-design"></span><h1><span class="section-number">9. </span>Designing Functions<a class="headerlink" href="#designing-functions" title="Permalink to this heading">ÔÉÅ</a></h1>
<blockquote>
<div><p><em>The open-access textbook</em>
Deep R Programming <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone‚Äôs enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>).
It is a non-profit project.</em>
<strong>This book is still a work in progress. Beta versions
of Chapters 1‚Äì12 are already complete, but there will be more.
In the meantime, any
<a class="reference external" href="https://github.com/gagolews/deepr/issues">bug/typos reports/fixes</a>
are appreciated.</strong>
<em>Although available online, it is a whole course;
it should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em>
<em>Also, check out my other book, <a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a> <span id="id1">[<a class="reference internal" href="999-bibliography.html#id52" title="Gagolewski, M. (2022).  Minimalist Data Wrangling with Python. Zenodo, Melbourne. ISBN 978-0-6455719-1-2. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">20</a>]</span>.</em></p>
</div></blockquote>
<p>In <a class="reference internal" href="170-function.html#chap-function"><span class="std std-numref">Chapter 7</span></a>, we learnt how to write our own
functions. This skill is key to enforcing the good
development practice of avoiding the repetition of code: running the
same command sequence on different data.</p>
<p>This chapter is devoted to the designing of such reusable modules
so that they are easier to use, test, and maintain.
We also provide some more technical details which were not of the highest
importance upon our first exposure to this topic,
but which our crucial to our better understanding of how R works.</p>
<section id="principles-of-sustainable-design">
<h2><span class="section-number">9.1. </span>Principles of Sustainable Design<a class="headerlink" href="#principles-of-sustainable-design" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Good design is more art than science.
As usual in real life, we will need to make
many compromises. This is because
improving things with regard to one criterion sometimes makes them
worse with respect to other aspects<a class="footnote-reference brackets" href="#footparetooptim" id="id2">1</a>
(also which we are not aware of).
Also, not everything that counts can and will be counted.
Below are some observations, ideas, and food for thought.</p>
<section id="to-write-or-to-abstain">
<h3><span class="section-number">9.1.1. </span>To Write or to Abstain<a class="headerlink" href="#to-write-or-to-abstain" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Functions that we write ourselves can oftentimes be considered
merely creative combinations of the building blocks available in base R
or a few high-quality add-on packages<a class="footnote-reference brackets" href="#footfunc" id="id3">2</a>. Some are simpler than
others. Thus, there is a question if a new operation
should be introduced at all: whether we are faced with the case of
multiplying entities without necessity.</p>
<p>On the one hand, the DRY (don‚Äôt repeat yourself) principle tells us that
most frequently used (say, at least 3 times) code chunks
should be generalised in the form of a new function.
This is definitely a correct approach with regard to non-trivial
operations.</p>
<p>On the other hand, not every generalisation is necessarily welcome.
Let us say that we are lazy and tired of writing
<strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code> for the <em>n</em>-th time.
Why don‚Äôt we therefore introduce <strong class="command">h</strong> defined as a combination
of <strong class="command">g</strong> and <strong class="command">f</strong>?
This might <em>seem</em> like a good idea, but let us not take it for granted:
being tired might be an indication of our body and mind
needing a rest; being lazy can be a call for more self-discipline
(not an overly popular word these days, but still, an important trait).</p>
<div class="proof proof-type-example" id="id22">

    <div class="proof-title">
        <span class="proof-type">Example 9.1</span>
        
    </div><div class="proof-content">
<p><strong class="command">paste0</strong> is a specialised version of <strong class="command">paste</strong>,
but having the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument hardcoded to an empty string.</p>
<ul class="simple">
<li><p>Even if this might be the most often applied use case,
is the introduction of a new function justifiable?
Is it so hard to write <code class="docutils literal notranslate"><span class="pre">paste=&quot;&quot;</span></code> each time?</p></li>
<li><p>Would changing <strong class="command">paste</strong>‚Äôs default argument be better?
That of course would harm backward compatibility, but what strategies
could we apply to make the transition as smooth as possible?</p></li>
<li><p>Would it be better to introduce a new version of <strong class="command">paste</strong>
with <code class="docutils literal notranslate"><span class="pre">sep</span></code> defaulting to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>,
informing the users that the old version is deprecated and
to be removed in, say, two years? Or maybe one year is better? Or five?</p></li>
</ul>
</div></div><div class="proof proof-type-example" id="id23">

    <div class="proof-title">
        <span class="proof-type">Example 9.2</span>
        
    </div><div class="proof-content">
<p>In R 4.0, <strong class="command">deparse1</strong> has been introduced: it is merely
a combination of <strong class="command">deparse</strong> (see below) and <strong class="command">paste</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">deparse1</span><span class="p">)</span>
<span class="c1">## function (expr, collapse = &quot; &quot;, width.cutoff = 500L, ...) </span>
<span class="c1">## paste(deparse(expr, width.cutoff, ...), collapse = collapse)</span>
<span class="c1">## &lt;bytecode: 0x55bfdca44690&gt;</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
</pre></div>
</div>
<p>Let us say this covers 90% of use cases: was introducing
it a justified idea then?
What if that number was 99%?</p>
</div></div><p>Overall, more functions contribute to the information overload.
We do not want our users to be overwhelmed by too many choices.
Luckily, nothing is cemented once and for all.
Had we done bad design choices resulting in our API‚Äôs being bloated,
we can always clean up those that no longer spark joy.</p>
</section>
<section id="to-pamper-or-to-challenge">
<h3><span class="section-number">9.1.2. </span>To Pamper or to Challenge<a class="headerlink" href="#to-pamper-or-to-challenge" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Think about the kind of audience we would like to serve: is it our team only,
students, professionals, certain client groups, etc.? Do they have
mathematical, programming, engineering, or scientific background?
Not everything that is appropriate for one cohort, will be valuable for
another. And not everything that is good for some <em>now</em>, will be beneficial
for them in the long run. People (their skills, attitudes, etc.) change.</p>
<div class="proof proof-type-example" id="id24">

    <div class="proof-title">
        <span class="proof-type">Example 9.3</span>
        
    </div><div class="proof-content">
<p>Assume we are writing a friendly and inclusive package
for novices who would like to grasp the basics
of data analysis as quickly<a class="footnote-reference brackets" href="#footquick" id="id4">3</a> as possible.
Without much effort, it would enable them to solve 80‚Äì95%
of the most common, easy problems.</p>
<p>Think of introducing the students to a function
that returns five largest observations in a given vector.
Let us call it <strong class="command">nlargest</strong>: so pleasant to use.
It makes the students feel empowered quickly.</p>
<p>Still, when faced with the remaining 5‚Äì20% tasks, they will have to
learn another, more advanced, generic, and powerful tool anyway
(in our case, the base R itself). Are they determined
and skilled enough to do that? Time will tell.
The least we can do is to be explicit about it.</p>
<p>Recall that it took us some time to arrive at <strong class="command">order</strong>
and subsetting via `<strong class="command">[</strong>`. Assuming that we read this
book from the beginning to the end and solve all the
exercises, which we should, we are now able to implement
the said <strong class="command">nlargest</strong> (and lots of other functions) ourselves,
using a single line of code.
This will also pay off in many scenarios that we will be facing
in the future, e.g., when we consider matrices and data frames.</p>
<p>Yes, everyone will be reinventing their own <strong class="command">nlargest</strong> this way.
But this constitutes a great exercise: by our being too <em>nice</em>,
some might have lost an opportunity to learn a new, more universal skill.</p>
</div></div><p>Although most of the users would really love to minimise
the effort put into all their activities, ultimately,
they sometimes need to learn new things.
Let us thus not be afraid to teach them stuff.</p>
<p>Furthermore, we do not want to discourage experts (or experts to-be)
by presenting them with overly simplified solutions
that keep their hands tied when something more ambitious needs to be done.</p>
</section>
<section id="to-build-or-to-reuse">
<h3><span class="section-number">9.1.3. </span>To Build or to Reuse<a class="headerlink" href="#to-build-or-to-reuse" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In the short term, the <em>fail fast</em> philosophy encourages
us to build our applications using prefabricated components.
This is fantastic at the early stage of its life cycle.
If we build something really simple or whose purpose is merely to
illustrate an idea, show-off how ‚Äúawesome‚Äù we are, or to educate,
let us be explicit about it so that other users do not feel
obliged to treat our product (exercise) seriously.</p>
<p>In the (not so likely, probabilistically speaking) event of its
becoming successful, we should start thinking about the project‚Äôs
long-term stability and sustainability.
After all, relying on third-party functions, packages, or programs
makes our software projects less‚Ä¶ independent. This may be problematic,
because:</p>
<ul class="simple">
<li><p>the dependencies might not be available on every platform
or may behave differently across various system configurations,</p></li>
<li><p>they may be huge (and can depend on other external software too),</p></li>
<li><p>their APIs may change which could result in our project‚Äôs not
working anymore,</p></li>
<li><p>their functionality can change which can lead to some unexpected
behaviours.</p></li>
</ul>
<p>Hence, it might be a good idea to rewrite some parts from scratch on our own.</p>
<div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.4</span>
        
    </div><div class="proof-content">
<p>Identify some R packages on CRAN with many dependencies.
See what functions do they import from other packages.
How often it is just a few lines of code?</p>
</div></div><p>The Unix philosophy emphasises upon the building and using of
minimalistic yet nontrivial, single-purpose, high quality pieces of software
that can work as parts of larger, custom pipelines.
R serves as a glue language quite well.</p>
<p>In the long run, some of our software projects might converge to such
a tool ‚Äì it might be a good idea to standardise our API
(e.g., make it available from the command-line; <a class="reference internal" href="110-basics.html#sec-ide"><span class="std std-numref">Section¬†1.2</span></a>)
so that the users of other languages can benefit from our work too.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If our project is merely a modified interface/front-end
to a larger program developed by others,
we should be humble about it and make sure it is not us who
get all the credit for other people‚Äôs work.</p>
<p>Also, we should state very clearly how can
the original tools be used to achieve the same goals,
e.g., when working from the command line.</p>
</div>
</section>
</section>
<section id="managing-data-flow">
<span id="sec-fun-io"></span><h2><span class="section-number">9.2. </span>Managing Data Flow<a class="headerlink" href="#managing-data-flow" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>A function, most of the time, can and should be treated as a black box:
its callers do not have to care what it hides inside.
After all, they are supposed to <em>use</em> it: given some <em>inputs</em>,
they expect a well-defined (read: explained in very detail
in the function‚Äôs manual; see <a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section¬†9.3.3</span></a>) <em>outputs</em>.</p>
<section id="checking-input-data-integrity-and-argument-handling">
<span id="sec-arg-check"></span><h3><span class="section-number">9.2.1. </span>Checking Input Data Integrity and Argument Handling<a class="headerlink" href="#checking-input-data-integrity-and-argument-handling" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A function takes R objects of any kind as arguments, but it does not mean
that feeding it with every- or any-thing is healthy for its guts.</p>
<p>When designing functions, it is best to handle the inputs
in a manner similar to base R‚Äôs behaviour.
This will make our contributions easier to handle.</p>
<p>Unfortunately, base R functions frequently do not handle arguments
of similar <em>kind</em> 100% consistently.
Such variability might be due to many reasons and, in essence,
is not necessarily bad.
Usually, there might be many different possible behaviours
and choosing one over another will make a few users unhappy anyway.
Some choices might not be optimal, but they are for historical
compatibility (e.g., with S).
Of course, it might also happen (but the probability is low)
that there is a bug or something is not at all well designed.</p>
<p>This is why it is better to keep the vocabulary quite restricted
(and we advocate for such minimalism in this book): even
if there are exceptions to the general rules, with fewer
functions, they are simply easier to remember.</p>
<p>Consider the following case study, illustrating that even the extremely
simple scenario where we deal with a single positive integer,
is not necessarily straightforward.</p>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.5</span>
        
    </div><div class="proof-content">
<p>In mathematical notation, we usually denote
the number of objects in a collection
with the famous ‚Äú<em>n</em>‚Äù.</p>
<p>It is implicitly assumed that such <em>n</em> is a single natural
number (although whether this includes 0 or not should be specified at
some point).
The functions <strong class="command">runif</strong>,
<strong class="command">sample</strong>,
<strong class="command">seq</strong>,
<strong class="command">rep</strong>,
<strong class="command">strrep</strong>, and
<strong class="command">class::knn</strong>
take it arguments. However,
nothing prevents their users from trying to challenge them by passing:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">2.5</span></code>, <code class="docutils literal notranslate"><span class="pre">-1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1-1e-16</span></code> (non-positive numbers, non-integers);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NA_real_</span></code>, <code class="docutils literal notranslate"><span class="pre">Inf</span></code>  (not finite);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1:5</span></code> (not of length 1; after all, there are no scalars in R)</p></li>
<li><p><strong class="command">numeric</strong><code class="code docutils literal notranslate"><span class="pre">(0)</span></code> (an empty vector);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">NA</span></code>, <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">FALSE,</span> <span class="pre">NA)</span></code>,  <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code>,
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;1&quot;,</span> <span class="pre">&quot;2&quot;,</span> <span class="pre">&quot;3&quot;)</span></code> (non-numeric, but coercible to);</p></li>
<li><p><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code>, <strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>,
<strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1:3,</span> <span class="pre">4)</span></code> (non-atomic);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code> (utter nonsense);</p></li>
<li><p><strong class="command">as.matrix</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code>, <strong class="command">factor</strong><code class="code docutils literal notranslate"><span class="pre">(7)</span></code>,
<strong class="command">factor</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>,
etc. (compound types; see <a class="reference internal" href="220-s3.html#chap-s3"><span class="std std-numref">Chapter 10</span></a>).</p></li>
</ul>
<p>Read the aforementioned functions‚Äô reference manuals and call them
on different inputs, noting how differently they handle such
atypical arguments.</p>
</div></div><p>Sometimes we will rely on other functions to handle the data
integrity checking for us.</p>
<div class="proof proof-type-example" id="id27">

    <div class="proof-title">
        <span class="proof-type">Example 9.6</span>
        
    </div><div class="proof-content">
<p>Let us consider the following
function that generates <em>n</em> pseudorandom numbers
from the unit interval rounded to <em>d</em> decimal digits.
We strongly believe or hope (good faith and high competence assumption)
that its authors knew what they were doing
when they wrote:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">round_rand</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># runif will check if `n` makes sense</span>
    <span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>    <span class="c1"># round will determine the appropriateness of `d`</span>
<span class="p">}</span>
</pre></div>
</div>
<p>What constitutes correct <em>n</em> and <em>d</em> and how the function behaves
when not provided with positive integers is determined
by the two underlying functions, <strong class="command">runif</strong>
and <strong class="command">round</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># the expected use case</span>
<span class="c1">## [1] 0.3 0.8 0.4 0.9</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4.8</span><span class="p">,</span> <span class="m">1.9</span><span class="p">)</span>  <span class="c1"># 4, 2</span>
<span class="c1">## [1] 0.94 0.05 0.53 0.89</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="kc">NA</span><span class="p">)</span>
<span class="c1">## [1] NA NA NA NA</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="c1">## numeric(0)</span>
</pre></div>
</div>
</div></div><p>If well thought-out and properly documented, many such design
choices can be defended.
Some programmers will opt for high uniformity/compatibility across
numerous tools, but there are cases where some exceptions/diversity
do more good than harm.</p>
<p>Yet, we should keep in mind that the functions we write
might be part of a more complicated data flow pipeline,
where some other function generates a value that we did not expect
(because of a bug therein or because we did not study its manual)
and this value is used as input to our function.
In our case, this would correspond to the said <em>n</em> or <em>d</em> being
determined programmatically.</p>
<div class="proof proof-type-example" id="id28">

    <div class="proof-title">
        <span class="proof-type">Example 9.7</span>
        
    </div><div class="proof-content">
<p>Continuing the previous example, the following might be somewhat challenging
with regard to our being flexible and open minded:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">42</span><span class="p">,</span> <span class="m">63</span><span class="p">,</span> <span class="m">30</span><span class="p">),</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># length(c(...)), 1)</span>
<span class="c1">## [1] 0.7 0.6 0.1 0.9</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="s">&quot;4&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># as.numeric(...), 1</span>
<span class="c1">## [1] 0.2 0.0 0.3 1.0</span>
</pre></div>
</div>
<p>Sure, it is quite convenient, but might lead to problems
that are hard to diagnose.</p>
<p>Also note the not-really informative error messages in cases like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="c1">## Error in runif(n): invalid arguments</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="c1">## Error in round(x, d): non-numeric argument to mathematical function</span>
</pre></div>
</div>
</div></div><p>Hence, some <em>defensive design</em> mechanisms are not a bad idea,
especially if they lead to generating an informative error message.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong class="command">stopifnot</strong> gives a convenient means to assert the
enjoyment of our expectations with regard to a function‚Äôs arguments
(or some intermediate values).
A call to <strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(cond1,</span> <span class="pre">cond2,</span> <span class="pre">...)</span></code>
is more or less equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cond1</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nf">all</span><span class="p">(</span><span class="n">cond1</span><span class="p">)))</span>
    <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;`cond1` are not all TRUE&quot;</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">cond2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cond2</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nf">all</span><span class="p">(</span><span class="n">cond2</span><span class="p">)))</span>
    <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;`cond2` are not all TRUE&quot;</span><span class="p">)</span>
<span class="kc">...</span>
</pre></div>
</div>
<p>Thus, if all the elements in the given logical vectors are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>,
nothing happens and we can safely move on.</p>
</div>
<div class="proof proof-type-example" id="id29">

    <div class="proof-title">
        <span class="proof-type">Example 9.8</span>
        
    </div><div class="proof-content">
<p>We can rewrite the above function as follows:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">round_rand2</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">stopifnot</span><span class="p">(</span>
        <span class="nf">is.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span>
        <span class="nf">is.finite</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">==</span> <span class="nf">floor</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
        <span class="nf">is.numeric</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="nf">length</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span>
        <span class="nf">is.finite</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="n">d</span> <span class="o">==</span> <span class="nf">floor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># runif will check if n makes sense</span>
    <span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>    <span class="c1"># round will determine the appropriateness of d</span>
<span class="p">}</span>

<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="c1">## [1] 0.7 0.7 0.5 0.6 0.3</span>
<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5.4</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="c1">## Error in round_rand2(5.4, 1): n == floor(n) is not TRUE</span>
<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="c1">## Error in round_rand2(5, &quot;1&quot;): is.numeric(d) is not TRUE</span>
</pre></div>
</div>
<p>This implements the strictest test for ‚Äúa single positive integer‚Äù
possible. In the case of any violation of the underlying condition,
we get a very informative error message.</p>
</div></div><div class="proof proof-type-example" id="id30">

    <div class="proof-title">
        <span class="proof-type">Example 9.9</span>
        
    </div><div class="proof-content">
<p>At other times, we might be interested in argument checking like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">warning</span><span class="p">(</span><span class="s">&quot;only the first element will be used&quot;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">&lt;-</span> <span class="n">n</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">n</span> <span class="o">&lt;-</span> <span class="nf">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">is.finite</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This way, <code class="docutils literal notranslate"><span class="pre">&quot;4&quot;</span></code> and <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(4.9,</span> <span class="pre">100)</span></code>
will all be accepted as <code class="docutils literal notranslate"><span class="pre">4</span></code><a class="footnote-reference brackets" href="#footfactorstop" id="id5">4</a>.</p>
</div></div><p>We see that there is always a tension between being
generous/flexible and precise/restrictive.
Also, for some functions, it will be better to behave differently
than the others, because of their particular use cases.
Too much uniformity is as bad as chaos.
Overall, we should rely on common sense, but add some lightweight
foolproof mechanisms.</p>
<p>It is our duty to be explicit about all the assumptions we make
or exceptions we allow (by writing good documentation;
see <a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section¬†9.3.3</span></a>).</p>
<p>We will revisit this topic in <a class="reference internal" href="220-s3.html#sec-arg-check-s3"><span class="std std-numref">Section¬†10.4</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Example exercises related to the improving of the consistency of base R‚Äôs
handling of arguments in different domains include the <strong class="program">vctrs</strong>
and <strong class="program">stringx</strong> packages<a class="footnote-reference brackets" href="#footstringx" id="id6">5</a>.
Can these contributions be justified?</p>
</div>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.10</span>
        
    </div><div class="proof-content">
<p>Reflect on how you would handle the following scenarios
(and how base R and other
packages or languages you know deals with them):</p>
<ul class="simple">
<li><p>a vectorised mathematical function
(empty vectors? non-numeric inputs? what if it is equipped
with the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute? what if it has other ones?);</p></li>
<li><p>an aggregation function (what about missing values? empty vectors?);</p></li>
<li><p>a function vectorised with regard to two arguments
(elementwise vectorisation? recycling rule?
only scalar vs vector or vector vs vector of the same length allowed?
what if one argument is a row vector and the other is a column vector);</p></li>
<li><p>a function vectorised with regard to all arguments (really all?
maybe some exceptions are necessary?);</p></li>
<li><p>a function vectorised with respect to the first argument
but not the second (why such a restriction? when?).</p></li>
</ul>
<p>Find a few functions that match each case.</p>
</div></div></section>
<section id="putting-outputs-into-context">
<h3><span class="section-number">9.2.2. </span>Putting Outputs into Context<a class="headerlink" href="#putting-outputs-into-context" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The functions we write do not exist in a vacuum.
We should put them into a much wider context: how are they going to be used
when combined with other tools?</p>
<p>As a general rule, our functions should generate outputs of <em>predictable</em>
kind, so that when we write and read the code chunks that utilise them,
we can easily deduce what is going to happen.</p>
<div class="proof proof-type-example" id="id32">

    <div class="proof-title">
        <span class="proof-type">Example 9.11</span>
        
    </div><div class="proof-content">
<p>Some base R functions do not adhere to this rule for the sake of
(questionable) users‚Äô convenience. We will meet
a few of them in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a> and <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>.
In particular,
<strong class="command">sapply</strong> and the underlying <strong class="command">simplify2array</strong>,
can return a list, an atomic vector, or a matrix.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span>    <span class="c1"># list</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1</span>
<span class="c1">## </span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 3 4</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>      <span class="c1"># vector</span>
<span class="c1">## [1] 1 3</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span>  <span class="c1"># matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    3</span>
<span class="c1">## [2,]    2    4</span>
</pre></div>
</div>
<p>Further, the index operator with <code class="docutils literal notranslate"><span class="pre">drop=TRUE</span></code>, which is the default,
may output an atomic vector. But it may as well
yield a matrix or a data frame.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">))</span>  <span class="c1"># an example matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="c1">## [3,]    3    6</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="p">]</span>    <span class="c1"># vector</span>
<span class="c1">## [1] 1 4</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>  <span class="c1"># matrix with 1 row</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
</pre></div>
</div>
</div></div><p>We proclaim that the default functions‚Äô behaviour should be to return
the object of the most generic kind possible (if there are other options),
and then to either have a further argument which must be explicitly
set if we really wish to simplify the output, or we should ask the user
to call a simplifier explicitly.</p>
<p>In the latter case, the simplifier should probably fail issuing an error
if it is unable to neaten the object or at least
apply some brute force solution (e.g., or ‚Äúfill the gaps‚Äù somehow
itself, possibly with a warning).</p>
<div class="proof proof-type-example" id="id33">

    <div class="proof-title">
        <span class="proof-type">Example 9.12</span>
        
    </div><div class="proof-content">
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">])</span>  <span class="c1"># always returns a vector</span>
<span class="c1">## [1] 1 2 4 5</span>
<span class="n">stringi</span><span class="o">::</span><span class="nf">stri_list2matrix</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span>  <span class="c1"># fills the gaps with NAs</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,] &quot;1&quot;  &quot;3&quot; </span>
<span class="c1">## [2,] NA   &quot;4&quot;</span>
</pre></div>
</div>
</div></div><p>Ideally, a function should perform one
(and only one) well-defined task.
If a function tends to generate objects of different kinds,
depending on the arguments provided, maybe it is better to write two
functions instead?</p>
<div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.13</span>
        
    </div><div class="proof-content">
<p>Functions such as <strong class="command">rep</strong>, <strong class="command">seq</strong>, and <strong class="command">sample</strong>
do not perform a single task.
Or do they?</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
In a purely functional programming language,
we can assume the so-called <em>referential transparency</em>:
a call to a <em>pure function</em> can always safely be replaced
with the value it is supposed to generate.
If this is true, then for the same set of argument values, the output
is always the same. Furthermore, there are no side effects.
In R, it is not really the case:</p>
<ul class="simple">
<li><p>a call can introduce/modify/delete the variables in other
environments (see <code class="xref std std-numref docutils literal notranslate"><span class="pre">sec:to-do</span></code>), e.g.,
the state of the random number generator,</p></li>
<li><p>metaprogramming and lazy evaluation techniques lead to the functions‚Äô
being free to interpret the argument <em>forms</em> (not only: values) freely
(see <code class="xref std std-numref docutils literal notranslate"><span class="pre">sec:to-do</span></code>),</p></li>
<li><p>printing, plotting, file reading, database access have obvious
consequences with regard to the state of some external resources.</p></li>
</ul>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Each function must return some value,
but there are several instances (e.g., plotting, printing),
where this does not make sense.</p>
<p>In such a case, we should consider returning
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>, a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> whose <em>first</em> printing
will be suppressed.</p>
<p>Compare the following:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">function</span><span class="p">()</span> <span class="kc">NULL</span><span class="p">)()</span>  <span class="c1"># anonymous function, called instantly</span>
<span class="c1">## NULL</span>
<span class="p">(</span><span class="nf">function</span><span class="p">()</span> <span class="nf">invisible</span><span class="p">(</span><span class="kc">NULL</span><span class="p">))()</span>  <span class="c1"># printing suppressed</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="nf">function</span><span class="p">()</span> <span class="nf">invisible</span><span class="p">(</span><span class="kc">NULL</span><span class="p">))()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># no longer invisible</span>
<span class="c1">## NULL</span>
</pre></div>
</div>
<p>Take a look at the return value of the built-on <strong class="command">cat</strong>.</p>
</div>
</section>
</section>
<section id="organising-and-maintaining-functions">
<span id="sec-own-functions-design"></span><h2><span class="section-number">9.3. </span>Organising and Maintaining Functions<a class="headerlink" href="#organising-and-maintaining-functions" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="function-libraries">
<h3><span class="section-number">9.3.1. </span>Function Libraries<a class="headerlink" href="#function-libraries" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Definitions of frequently-used functions or datasets can be emplaced
in separate source files (.R extension) for further reference.</p>
<p>Such libraries can be executed by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">source</span><span class="p">(</span><span class="s">&quot;path_to_file.R&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.14</span>
        
    </div><div class="proof-content">
<p>Create a source file (script) named <code class="docutils literal notranslate"><span class="pre">mylib.R</span></code>,
where you define a function called <strong class="command">nlargest</strong> which returns
a few largest elements in a given atomic vector.</p>
<p>From within another script, call
<strong class="command">source</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;mylib.R&quot;)</span></code>
(note that relative paths to refer to the current working director;
(compare <a class="reference internal" href="120-numeric.html#sec-scan"><span class="std std-numref">Section¬†2.1.6</span></a>)
and then write a few lines of code where you test <strong class="command">nlargest</strong>
on some example inputs.</p>
</div></div></section>
<section id="writing-r-packages">
<span id="sec-own-packages"></span><h3><span class="section-number">9.3.2. </span>Writing R Packages<a class="headerlink" href="#writing-r-packages" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>When a function library grows substantially, or when there is a need for
equipping it with the relevant manual pages<a class="footnote-reference brackets" href="#footalwaysdocument" id="id7">6</a>
(<a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section¬†9.3.3</span></a>) or compiled code (<a class="reference internal" href="310-compile.html#chap-compile"><span class="std std-numref">Chapter 14</span></a>),
turning it into an own R package (<a class="reference internal" href="170-function.html#sec-packages"><span class="std std-numref">Section¬†7.3.1</span></a>)
might be a good idea (even if it is
only for our own or small team‚Äôs purpose).</p>
<p>A <em>source package</em> is merely a directory containing
some special files and subdirectories:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> ‚Äì a text file that gives the name of the package,
its version, authors, dependencies upon other packages, license, etc.;
see Section 1.1.1 of <span id="id8">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2022).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">45</a>]</span>;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">NAMESPACE</span></code> ‚Äì a text file containing directives
stating which objects are to be exported so that they are
available to the package users,
and which names are to be imported from other packages;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">R</span></code> ‚Äì a directory with R scripts (.R files),
which define, e.g., functions, example datasets, etc.;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">man</span></code> ‚Äì a directory with R documentation files (.Rd),
describing at least all the exported objects;
see <a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section¬†9.3.3</span></a>;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src</span></code> ‚Äì optional; compiled code, see <a class="reference internal" href="310-compile.html#chap-compile"><span class="std std-numref">Chapter 14</span></a>;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">tests</span></code> ‚Äì optional; tests to run on the package check,
see <a class="reference internal" href="#sec-testing"><span class="std std-numref">Section¬†9.3.4.2</span></a>;</p></li>
</ul>
<p>see Section 1.5 of <em>Writing R Extensions</em> <span id="id9">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2022).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">45</a>]</span> for more
details and other options: there is no need for us to repeat
the information from the official manual as everyone can read it themself.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A source package can be built and installed from within an
R session by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;pkg_directory&quot;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;source&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then it can be used as any other R package (<a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section¬†9.3.3</span></a>).
In particular, it can be loaded and attached via a call to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;pkg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This makes all the objects listed in its <code class="docutils literal notranslate"><span class="pre">NAMESPACE</span></code> file available
to the user.</p>
</div>
<div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.15</span>
        
    </div><div class="proof-content">
<p>Create your own package <code class="docutils literal notranslate"><span class="pre">mypkg</span></code> featuring some of the solutions
to the exercises you have solved whilst studying the material
in the previous chapters.
When in doubt, refer to the official manual <span id="id10">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2022).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">45</a>]</span>.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that you <em>do not have to</em> publish your package on CRAN<a class="footnote-reference brackets" href="#footcranpolicy" id="id11">7</a>.
Many users are tempted to submit whatever they have been tinkering
around with for a while. Have mercy on the busy CRAN maintainers
and do not contribute to the information overload,
unless you have come up with something potentially useful for other R
users (make it less about you, and more about the community;
thank you in advance).
R packages can always be hosted on and installed from, for instance,
GitLab or GitHub.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
The building and installing of packages also be done from
the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>R CMD build pkg_directory
R CMD INSTALL --build pkg_directory
</pre></div>
</div>
<p>Also, some users could potentially benefit from
creating own Makefiles that help automate the processes
of building, testing, checking, etc.</p>
</div>
</section>
<section id="documenting-r-packages">
<span id="sec-doc-packages"></span><h3><span class="section-number">9.3.3. </span>Documenting R Packages<a class="headerlink" href="#documenting-r-packages" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Documenting functions and commenting code thoroughly
is very important, even if we just write for ourselves.
Most programmers sooner or later will note that they find it
hard to determine what a piece of code is doing after they
took a break from it. In some sense, we always write for external audience,
which incudes our future self.</p>
<p>The help system is one of the stronger assets of the R environment.
By far we should have interacted with many man pages and
got a good idea of what constitutes an informative documentation
piece.</p>
<p>From the technical side, R Documentation (.Rd) files
should be emplaced in the <code class="file docutils literal notranslate"><span class="pre">man</span></code> subdirectory of a source package.
All exported objects (e.g., functions) should be described clearly.
Additional topics can be covered too.</p>
<p>During the package install, the .Rd files are converted to various
output formats, e.g., HTML or plain text, and displayed upon a call to
the well-known <strong class="command">help</strong> function.</p>
<p>Documentation files use a LaTeX-like syntax, which looks quite obscure
to an untrained eye. The relevant commands are explained in very detail
in Section 2 of <em>Writing R Extensions</em> <span id="id12">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2022).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">45</a>]</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The process of writing .Rd files by hand might be quite tedious,
especially keeping track of the changes to the <code class="docutils literal notranslate"><span class="pre">\usage</span></code> and <code class="docutils literal notranslate"><span class="pre">\arguments</span></code>
commands.
Rarely do we recommend the use of third-party packages,
because base R facilities are usually good enough,
but <strong class="program">roxygen2</strong> might be worth a try,
because it really makes the developers‚Äô lives easier.
Most importantly, it allows for documentation to be specified alongside
the functions‚Äô definitions, which is much more natural.</p>
</div>
<div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.16</span>
        
    </div><div class="proof-content">
<p>Add a few manual pages to your example R package.</p>
</div></div></section>
<section id="assuring-quality-code">
<span id="sec-code-quality"></span><h3><span class="section-number">9.3.4. </span>Assuring Quality Code<a class="headerlink" href="#assuring-quality-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Below we mention some good development practices
related to maintaining quality code.
This is an important topic, but writing about them is tedious
to the same extent that reading about them is boring,
because it is the less scientific part of software engineering.
After all, these are some heuristics that are learnt best by observing
and mimicking what the others are doing (and hence
the exercises below will encourage to do so).</p>
<section id="managing-changes-and-working-collaboratively">
<h4><span class="section-number">9.3.4.1. </span>Managing Changes and Working Collaboratively<a class="headerlink" href="#managing-changes-and-working-collaboratively" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>It is a good idea to employ some source code version control system
such as <strong class="program">git</strong> to keep track of the changes made to the software.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is worth investing some time and effort to learn how
to use <strong class="program">git</strong> from the command line;
see <a class="reference external" href="https://git-scm.com/doc">https://git-scm.com/doc</a>.</p>
</div>
<p>There are a few hosting providers for <strong class="program">git</strong> repositories,
with GitLab and GitHub being a popular choice amongst
open-source software developers.</p>
<p>Not only do they support working collaboratively on the projects,
but also are equipped with additional tools for reporting bugs,
suggesting feature requests, etc.</p>
<div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.17</span>
        
    </div><div class="proof-content">
<p>Find where the source code of some of your most favourite R packages
or other open-source projects are hosted.
Explore the corresponding repositories, feature trackers, wikis,
discussion boards, etc.
Note that each community is different and is governed by different
guidelines: after all, we are from all over the world.</p>
</div></div></section>
<section id="test-driven-development-and-continuous-integration">
<span id="sec-testing"></span><h4><span class="section-number">9.3.4.2. </span>Test-driven Development and Continuous Integration<a class="headerlink" href="#test-driven-development-and-continuous-integration" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>It is often hygienic to include some principles of
test-driven development when writing own functions.</p>
<div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.18</span>
        
    </div><div class="proof-content">
<p>Assume that, for some reasons, we were asked to write a function to compute
the root mean square (quadratic mean) of a given numeric vector.
Before implementing  the actual routine, it is a good idea
to reflect upon what we want to achieve, especially how we
want our function to behave in certain boundary cases.</p>
<p><strong class="command">stopifnot</strong> gives simple means to assure a given
assertion is fulfilled. If that is the case, it will
move forward quietly.</p>
<p>Let us say we have come up with the following set of <em>expectations</em>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="m">1</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">),</span> <span class="m">58.16786054171151931769</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span> <span class="m">10</span><span class="p">)),</span> <span class="kc">pi</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="nf">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">)),</span> <span class="m">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Write a function <strong class="command">rms</strong> that fulfils the above assertions.</p>
</div></div><div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.19</span>
        
    </div><div class="proof-content">
<p>Implement your own version of the <strong class="command">sample</strong> function
(assuming <code class="docutils literal notranslate"><span class="pre">replace=TRUE</span></code>), using calls to <strong class="command">runif</strong>.
However, start by writing a few unit tests.</p>
</div></div><p>There are also a couple of R packages that support
writing and executing of unit tests, including
<strong class="program">testthat</strong>, <strong class="program">tinytest</strong> (which is
a lighter-weight version of the former),
<strong class="program">RUnit</strong>, or <strong class="program">realtest</strong>.
However, in the most typical use cases, relying
on <strong class="command">stopifnot</strong> is powerful enough.</p>
<div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.20</span>
        
    </div><div class="proof-content">
<p>(*)
Consult the <em>Writing R Extensions</em> manual <span id="id13">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2022).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">45</a>]</span>
about where and how to include unit tests
in your example package.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
R includes a built-in mechanism to check a couple of code quality
areas: running <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span> <span class="pre">pkg_directory</span></code> from the command line
(preferably using the most recent version of R) can suggest a number
of improvements.</p>
<p>Also, it is possible to use various continuous integration techniques
that are automatically triggered when pushing changes to our software
repositories; see GitLab CI or GitHub Actions.
For instance, it is possible to run a package build, install,
and check process upon every <strong class="program">git</strong> commit.
Also, CRAN features some continuous integration services, including
checking the package on a range of different platforms.</p>
</div>
</section>
<section id="debugging">
<h4><span class="section-number">9.3.4.3. </span>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For all his life, the current author has been debugging all his programs
mostly by manually printing the state of suspected
variables (<strong class="command">printf</strong> and the like) in different areas of the code.
No shame in that.</p>
<p>For an interactive debugger, see the <strong class="command">browser</strong> function.
Also, refer to Section 9 of <span id="id14">[<a class="reference internal" href="999-bibliography.html#id6" title="R Development Core Team. (2022).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">49</a>]</span> for more details.</p>
<p>Some IDEs (e.g., <strong class="program">RStudio</strong>) support this feature too; see
their corresponding documentation.</p>
</section>
<section id="profiling">
<h4><span class="section-number">9.3.4.4. </span>Profiling<a class="headerlink" href="#profiling" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Typically, a program spends relatively
long time executing only a small portion of code.
The <strong class="command">Rprof</strong> function can be a helpful tool to identify which chunks
might need a rewrite, for instance using a compiled language
(<a class="reference internal" href="310-compile.html#chap-compile"><span class="std std-numref">Chapter 14</span></a>).</p>
<p>Please remember, though, that not only implementations of algorithms
that have hight computational complexity can form a bottleneck,
but also data input and output (such as reading files from disk,
printing messages, on the console, querying Web APIs, etc.).</p>
</section>
</section>
</section>
<section id="special-functions-syntactic-sugar">
<span id="sec-syntactic-sugar"></span><h2><span class="section-number">9.4. </span>Special Functions: Syntactic Sugar<a class="headerlink" href="#special-functions-syntactic-sugar" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Some functions, such as `<strong class="command">*</strong>`, are somewhat special.
They can be referred to using an alternative syntax which for some
reason most of us accepted as the default one.
Below we will reveal, amongst others,
that ‚Äú<code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">*</span> <span class="pre">9</span></code>‚Äù reduces in fact to an ordinary function <em>call</em>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`*`</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>  <span class="c1"># a call to `*` with 2 arguments, equivalent to 5 * 9</span>
<span class="c1">## [1] 45</span>
</pre></div>
</div>
<section id="a-note-on-backticks">
<span id="sec-backtick"></span><h3><span class="section-number">9.4.1. </span>A Note on Backticks<a class="headerlink" href="#a-note-on-backticks" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In <a class="reference internal" href="120-numeric.html#sec-assign"><span class="std std-numref">Section¬†2.2</span></a>, we have mentioned that
we can assign (as in `<strong class="command">&lt;-</strong>`)
<em>syntactically valid names</em> to  our objects. Most identifiers comprised
of letters, digits, dots, and underscores
can be used directly in R code.</p>
<p>However, it is possible to name our objects whichever we like:
non-syntactically valid (nonstandard) names just need to be
enclosed in backticks (back quotes, grave accents):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`42 a quite peculiar name :O lollolll`</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">-5</span><span class="p">)</span><span class="o">:</span><span class="m">5</span>
<span class="nf">mean</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">`42 a quite peculiar name :O lollolll`</span><span class="p">)))</span>
<span class="c1">## [1] 0.5</span>
</pre></div>
</div>
<p>Of course, they are less convenient, but still:
backticks lets us access them in any context.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">`1`</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">`2`</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">)</span>  <span class="c1"># structure(list(&quot;a&quot;, &quot;b&quot;), names=c(&quot;1&quot;, &quot;2&quot;))</span>
<span class="n">x</span><span class="o">$</span><span class="n">`1`</span>  <span class="c1"># x[[&quot;1&quot;]] is still okay (and we prefer this syntax)</span>
<span class="c1">## [1] &quot;a&quot;</span>
</pre></div>
</div>
</section>
<section id="curly-braces">
<h3><span class="section-number">9.4.2. </span>Curly Braces,  `<strong class="command">{</strong>`<a class="headerlink" href="#curly-braces" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A block of statements grouped with curly braces,
`<strong class="command">{</strong>`, corresponds to a function call.
When we write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
    <span class="nf">cat</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">)</span>
    <span class="m">3</span>
<span class="p">}</span>
<span class="c1">## [1] TRUE</span>
<span class="c1">## two</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p>The parser translates it to a call to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`{`</span><span class="p">(</span><span class="nf">print</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">),</span> <span class="nf">cat</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">),</span> <span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] TRUE</span>
<span class="c1">## two</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p>When the above is executed, every argument, one by one,
is evaluated and then the last value is returned in result of that call.</p>
</section>
<section id="if">
<h3><span class="section-number">9.4.3. </span>`<strong class="command">if</strong>`<a class="headerlink" href="#if" title="Permalink to this heading">ÔÉÅ</a></h3>
<p><strong class="command">if</strong> is a function too; as mentioned in <a class="reference internal" href="180-flow.html#sec-if"><span class="std std-numref">Section¬†8.1</span></a>,
it returns the value corresponding
to the expression evaluated conditionally. Hence, we may write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="s">&quot;head&quot;</span> <span class="n">else</span> <span class="s">&quot;tail&quot;</span>
<span class="c1">## [1] &quot;head&quot;</span>
</pre></div>
</div>
<p>but also:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`if`</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;head&quot;</span><span class="p">,</span> <span class="s">&quot;tail&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;head&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A call like `<strong class="command">if</strong>`<code class="code docutils literal notranslate"><span class="pre">(test,</span> <span class="pre">what_if_true,</span> <span class="pre">what_if_false)</span></code>
can only work properly because of the lazy evaluation of function arguments;
see <a class="reference internal" href="#sec-lazy-eval"><span class="std std-numref">Section¬†9.5.5</span></a>.</p>
</div>
<p>On a side note, <strong class="command">while</strong>, <strong class="command">for</strong>, <strong class="command">repeat</strong>
can also be called that way, but they return
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>.</p>
</section>
<section id="operators-are-functions-too">
<span id="sec-operfun"></span><h3><span class="section-number">9.4.4. </span>Operators are Functions Too<a class="headerlink" href="#operators-are-functions-too" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="calling-built-in-operators-as-functions">
<h4><span class="section-number">9.4.4.1. </span>Calling Built-in Operators as Functions<a class="headerlink" href="#calling-built-in-operators-as-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Every arithmetic, logical, and comparison operator
is translated to a call to the corresponding function.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`&lt;`</span><span class="p">(</span><span class="nf">`+`</span><span class="p">(</span><span class="nf">`*`</span><span class="p">(</span><span class="nf">`-`</span><span class="p">(</span><span class="m">3</span><span class="p">),</span> <span class="m">4</span><span class="p">)),</span> <span class="m">5</span><span class="p">)</span>  <span class="c1"># 2+(-3)*4 &lt; 5</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
<p>Also, <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> is equivalent to `<strong class="command">[</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">i)</span></code>
and <code class="docutils literal notranslate"><span class="pre">x[[i]]</span></code> maps to `<strong class="command">[[</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">i)</span></code>.</p>
<p>Knowing this will not only enable us to manipulate unevaluated R
code (<a class="reference internal" href="320-language.html#chap-language"><span class="std std-numref">Chapter 15</span></a>)
or access the corresponding manual pages (see, e.g.,
<strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;[&quot;)</span></code>),
but also write some expressions in a more concise manner.
For instance,</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">11</span><span class="o">:</span><span class="m">17</span><span class="p">,</span> <span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">)</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">`[`</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>  <span class="c1"># 1 is a further argument passed to `[`</span>
<span class="c1">## [1]  1 11 21</span>
</pre></div>
</div>
<p>is equivalent to a call to
<strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">(e)</span> <span class="pre">e[1],</span> <span class="pre">x)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unsurprisingly, the assignment operator, `<strong class="command">&lt;-</strong>`, is a function
too. It returns the assigned value, invisibly.</p>
<p>Knowing that `<strong class="command">&lt;-</strong>` binds right to left (compare <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Syntax&quot;)</span></code>), this is why the expression ‚Äú<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;-</span> <span class="pre">b</span> <span class="pre">&lt;-</span> <span class="pre">1</span></code>‚Äù
results in both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> being assigned 1:
it is equivalent to
‚Äú`<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> </code>`<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;b&quot;,</span> <span class="pre">1))</span></code>‚Äù
and ‚Äú`<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;b&quot;,</span> <span class="pre">1)</span></code>‚Äù returns 1.</p>
<p>Owing to the pass-by-value semantics (<a class="reference internal" href="#sec-pass-by-value"><span class="std std-numref">Section¬†9.5.1</span></a>)
we can also expect that we will always be (with the exception
of environments, <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>)
assigning a <em>copy</em> of the value on the righthand side.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">6</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="n">x</span>  <span class="c1"># makes a copy (but delayed, on demand, for performance reasons)</span>
<span class="n">y</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="kc">NA_real_</span>  <span class="c1"># modify every 2nd element</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## [1] NA  2 NA  4 NA  6</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># state of x has not changed ‚Äî x and y are different objects</span>
<span class="c1">## [1] 1 2 3 4 5 6</span>
</pre></div>
</div>
<p>This is especially worth pointing out to Python (amongst others)
programmers, where the above assignment would mean that <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
both refer to the same (shared) object in the computer‚Äôs memory.</p>
<p>However, with no harm done to semantics, the actual copying of <code class="docutils literal notranslate"><span class="pre">x</span></code>
is postponed until absolutely necessary (<a class="reference internal" href="330-environment.html#sec-copy-on-demand"><span class="std std-numref">Section¬†16.2</span></a>).
This is efficient both time- and memory-wise.</p>
</div>
</section>
<section id="creating-own-binary-operators">
<h4><span class="section-number">9.4.4.2. </span>Creating Own Binary Operators<a class="headerlink" href="#creating-own-binary-operators" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>We can also introduce our own binary operators
named like `<strong class="command">%myopname%</strong>`:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`%:)%`</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span> <span class="p">(</span><span class="n">e1</span><span class="o">+</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
<span class="m">5</span> <span class="o">%:)%</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span>
<span class="c1">##  [1] 3.0 3.5 4.0 4.5 5.0 5.5 6.0 6.5 7.0 7.5</span>
</pre></div>
</div>
<p>Recall that `<strong class="command">%%</strong>` and `<strong class="command">%/%</strong>` are built-in operators
denoting division remainder and integer division.
Rarely will we be defining our own operators, but
when we encounter a similar one next time, we will no longer be surprised.
For instance, in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a> we will learn
about `<strong class="command">%*%</strong>` which implements matrix multiplication.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a class="reference internal" href="220-s3.html#chap-s3"><span class="std std-numref">Chapter 10</span></a>,
we will note that most existing operators can be overloaded for objects
of different types.</p>
</div>
</section>
</section>
<section id="replacement-functions">
<span id="sec-replacementfun"></span><h3><span class="section-number">9.4.5. </span>Replacement Functions<a class="headerlink" href="#replacement-functions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Functions generally do not change the state
of their arguments. However, there is some syntactic sugar
that allows us to replace objects or parts thereof with new content.
We call them <em>replacement functions</em>.</p>
<p>For instance, three of the following calls <em>replace</em>
the input <code class="docutils literal notranslate"><span class="pre">x</span></code> with its modified version:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>  <span class="c1"># example input</span>
<span class="n">x</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">0</span>  <span class="c1"># replace the 3rd element with 0</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">7</span>  <span class="c1"># &quot;replace&quot; length</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="kc">LETTERS</span><span class="p">[</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>  <span class="c1"># replace the names attribute</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x is different than before</span>
<span class="c1">##  A  B  C  D  E  F  G </span>
<span class="c1">##  1  2  0  4  5 NA NA</span>
</pre></div>
</div>
<section id="creating-own-replacement-functions">
<h4><span class="section-number">9.4.5.1. </span>Creating Own Replacement Functions<a class="headerlink" href="#creating-own-replacement-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A replacement function is a mapping named like `<strong class="command">name&lt;-</strong>` with
at least two parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> (the object to be modified),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">...</span></code> (possible further arguments),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> (as the last parameter;
the object on the righthand side of the `<strong class="command">&lt;-</strong>` operator).</p></li>
</ul>
<p>Most often, we will be interacting with existing
replacement functions, not creating our own ones.
However, knowing how to do the latter is key to understanding
this language feature.</p>
<p>For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`add&lt;-`</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span><span class="p">[</span><span class="n">where</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="p">[</span><span class="n">where</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span>
    <span class="n">x</span>  <span class="c1"># the modified object that will replace the original one</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above aims to add some <code class="docutils literal notranslate"><span class="pre">value</span></code> to a subset of the input vector <code class="docutils literal notranslate"><span class="pre">x</span></code>
(by default, to each element therein) and return its altered version
that will replace the object it has been called upon.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>           <span class="c1"># example vector</span>
<span class="nf">add</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">10</span>       <span class="c1"># calls `add&lt;-`(y, value=10)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>           <span class="c1"># y has changed</span>
<span class="c1">## [1] 11 12 13 14 15</span>
<span class="nf">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">1000</span>  <span class="c1"># calls `add&lt;-`(y, 3, value=1000)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>           <span class="c1"># y has changed again</span>
<span class="c1">## [1]   11   12 1013   14   15</span>
</pre></div>
</div>
<p>We see that calling ‚Äú<strong class="command">add</strong><code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">w)</span> <span class="pre">&lt;-</span> <span class="pre">v</span></code>‚Äù
works as if we have called
‚Äú<code class="code docutils literal notranslate"><span class="pre">y</span> <span class="pre">&lt;-</span> </code>`<strong class="command">add&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">w,</span> <span class="pre">value=v)</span></code>‚Äù.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
According to <span id="id15">[<a class="reference internal" href="999-bibliography.html#id6" title="R Development Core Team. (2022).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">49</a>]</span>,
a call ‚Äú<strong class="command">add</strong><code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">3)</span> <span class="pre">&lt;-</span> <span class="pre">1000</span></code>‚Äù is a syntactic
sugar precisely for:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`*tmp*`</span> <span class="o">&lt;-</span> <span class="n">y</span>  <span class="c1"># temporary substitution</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">`add&lt;-`</span><span class="p">(</span><span class="n">`*tmp*`</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="s">&quot;*tmp*&quot;</span><span class="p">)</span>  <span class="c1"># remove the named object from the current scope</span>
</pre></div>
</div>
<p>This has at least two implications.
First, in the unlikely event that a variable `<code class="code docutils literal notranslate"><span class="pre">*tmp*</span></code>` existed before
the call to the replacement function, it will be no more,
it will cease to be. It will be an ex-variable.
Second, the temporary substitution guarantees that <code class="docutils literal notranslate"><span class="pre">y</span></code> must exist
before the call (a function‚Äôs body does not have to refer to all the
arguments passed; because of lazy evaluation, see <a class="reference internal" href="#sec-lazy-eval"><span class="std std-numref">Section¬†9.5.5</span></a>,
we could get away with it otherwise).</p>
</div>
</section>
<section id="substituting-parts-of-vectors">
<h4><span class="section-number">9.4.5.2. </span>Substituting Parts of Vectors<a class="headerlink" href="#substituting-parts-of-vectors" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The replacement versions of the subsetting operators
are named as follows:</p>
<ul class="simple">
<li><p>`<strong class="command">[&lt;-</strong>` is used in substitutions like ‚Äú<code class="docutils literal notranslate"><span class="pre">x[i]</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>‚Äù,</p></li>
<li><p>`<strong class="command">[[&lt;-</strong>` is called when we perform ‚Äú<code class="docutils literal notranslate"><span class="pre">x[[i]]</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>‚Äù,</p></li>
<li><p>`<strong class="command">$&lt;-</strong>` is used whilst calling ‚Äú<code class="docutils literal notranslate"><span class="pre">x$i</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>‚Äù.</p></li>
</ul>
<p>Here is a use case:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="kc">NA_real_</span><span class="p">)</span>  <span class="c1"># returns a new object</span>
<span class="c1">## [1]  1  2 NA  4 NA</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># does not change the original input</span>
<span class="c1">## [1] 1 2 3 4 5</span>
</pre></div>
</div>
<p>On a side note, `<strong class="command">length&lt;-</strong>` can be used to expand
or shorten a given vector
by calling ‚Äú<strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span> <span class="pre">&lt;-</span> <span class="pre">new_length</span></code>‚Äù,
see also <a class="reference internal" href="150-indexing.html#sec-insert-new-elem"><span class="std std-numref">Section¬†5.3.3</span></a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="n">x</span><span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">7</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">10</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##  [1]  1  2  3  4  5 NA  7 NA NA NA</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">3</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 1 2 3</span>
</pre></div>
</div>
<p>Despite the fact that, semantically speaking,
calling `<strong class="command">[&lt;-</strong>` results in the creation of a new
vector (a modified version of the original one),
we may luckily expect some performance optimisations happening
behind our back (reference counting, modification in-place;
see <code class="xref std std-numref docutils literal notranslate"><span class="pre">sec:to-do</span></code>).</p>
<div class="proof proof-type-exercise" id="id42">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.21</span>
        
    </div><div class="proof-content">
<p>Write a function `<strong class="command">extend&lt;-</strong>` which pushes new elements
at the end of a given vector, modifying it in place.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`extend&lt;-`</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="n">...to.do...</span>
</pre></div>
</div>
<p>Example use:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span>
<span class="nf">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">2</span>     <span class="c1"># push 2 at the back</span>
<span class="nf">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">3</span><span class="o">:</span><span class="m">10</span>  <span class="c1"># add 3, 4, ..., 10</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##  [1]  1  2  3  4  5  6  7  8  9 10</span>
</pre></div>
</div>
</div></div></section>
<section id="replacing-attributes">
<h4><span class="section-number">9.4.5.3. </span>Replacing Attributes<a class="headerlink" href="#replacing-attributes" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Many replacement functions deal with the re-setting of objects‚Äô
attributes (<a class="reference internal" href="140-list.html#sec-attribute"><span class="std std-numref">Section¬†4.4</span></a>).</p>
<p>In particular, for each special attribute,
there is also its replacement version, e.g.,
`<strong class="command">names&lt;-</strong>`,
`<strong class="command">class&lt;-</strong>`,
`<strong class="command">dim&lt;-</strong>`,
`<strong class="command">levels&lt;-</strong>`,
etc.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>  <span class="c1"># change the `names` attribute</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x has been altered</span>
<span class="c1">## a b c </span>
<span class="c1">## 1 2 3</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Individual (arbitrary, including non-special ones) attributes can be
set using `<strong class="command">attr&lt;-</strong>` and all of them can be established
by means of a single call to `<strong class="command">attributes&lt;-</strong>`.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="s">&quot;spam&quot;</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;oval&quot;</span><span class="p">,</span> <span class="n">smell</span><span class="o">=</span><span class="s">&quot;meaty&quot;</span><span class="p">)</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">taste</span><span class="o">=</span><span class="s">&quot;umami&quot;</span><span class="p">)</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="s">&quot;rose&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;shape&quot;)</span>
<span class="c1">## [1] &quot;oval&quot;</span>
<span class="c1">## attr(,&quot;smell&quot;)</span>
<span class="c1">## [1] &quot;meaty&quot;</span>
<span class="c1">## attr(,&quot;taste&quot;)</span>
<span class="c1">## [1] &quot;umami&quot;</span>
<span class="c1">## attr(,&quot;colour&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
</pre></div>
</div>
<p>Also note that setting an attribute to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> results, by convention,
in its removal:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;taste&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>  <span class="c1"># this is tasteless now</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;shape&quot;)</span>
<span class="c1">## [1] &quot;oval&quot;</span>
<span class="c1">## attr(,&quot;smell&quot;)</span>
<span class="c1">## [1] &quot;meaty&quot;</span>
<span class="c1">## attr(,&quot;colour&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>  <span class="c1"># remove all</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
</pre></div>
</div>
<p>Which can be useful in contexts such as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">),</span> <span class="n">some_attrib</span><span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">`attributes&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">x</span></code> retains its attributes and <code class="docutils literal notranslate"><span class="pre">y</span></code> is a version of <code class="docutils literal notranslate"><span class="pre">x</span></code> with
metadata removed.</p>
</section>
<section id="compositions-of-replacement-functions">
<h4><span class="section-number">9.4.5.4. </span>Compositions of Replacement Functions<a class="headerlink" href="#compositions-of-replacement-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Updating only selected names like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;spam&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##    a spam    c </span>
<span class="c1">##    1    2    3</span>
</pre></div>
</div>
<p>is possible due to the fact
that ‚Äú<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(x)[i]</span> <span class="pre">&lt;-</span> <span class="pre">v</span></code>‚Äù
is equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">old_names</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">new_names</span> <span class="o">&lt;-</span> <span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">old_names</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">`names&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">new_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>More generally, a composition of replacement
calls  ‚Äú<strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b)</span> <span class="pre">&lt;-</span> <span class="pre">y</span></code>‚Äù
yields a result equivalent to
‚Äú<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> </code>`<strong class="command">f&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a,</span> <span class="pre">value=</span></code>`<strong class="command">g&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b,</span> <span class="pre">value=y))</span></code>‚Äù.
Note that both <strong class="command">f</strong> and `<strong class="command">f&lt;-</strong>` need to be defined,
but having <strong class="command">g</strong> is not necessary.</p>
</div>
<div class="proof proof-type-exercise" id="id43">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.22</span>
        
    </div><div class="proof-content">
<p>(*) What is
‚Äú<strong class="command">h</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b),</span> <span class="pre">c)</span> <span class="pre">&lt;-</span> <span class="pre">y</span></code>‚Äù
equivalent to?</p>
</div></div><div class="proof proof-type-exercise" id="id44">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.23</span>
        
    </div><div class="proof-content">
<p>Write a (actually very useful!) function `<strong class="command">recode&lt;-</strong>` which
replaces specific elements in a character
vector with some other ones, allowing the following
interface:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`recode&lt;-`</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="n">...to.do...</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;bacon&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
<span class="nf">recode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">eggs</span><span class="o">=</span><span class="s">&quot;best spam&quot;</span><span class="p">,</span> <span class="n">bacon</span><span class="o">=</span><span class="s">&quot;yummy spam&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;       &quot;yummy spam&quot; &quot;best spam&quot;  &quot;spam&quot;       &quot;best spam&quot;</span>
</pre></div>
</div>
<p>We see that the named character vector gives a few <code class="docutils literal notranslate"><span class="pre">from=&quot;to&quot;</span></code> pairs,
e.g., all <code class="docutils literal notranslate"><span class="pre">eggs</span></code> are to be replaced by <code class="docutils literal notranslate"><span class="pre">best</span> <span class="pre">spam</span></code>.</p>
<p>Now, determine which calls  are equivalent to the following:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>  <span class="c1"># or equivalently = ... ?</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## a y z </span>
<span class="c1">## 1 2 3</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;bacon&quot;</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">,</span> <span class="s">&quot;cauliflower&quot;</span><span class="p">))</span>
<span class="nf">recode</span><span class="p">(</span><span class="n">y</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">cauliflower</span><span class="o">=</span><span class="s">&quot;broccoli&quot;</span><span class="p">)</span>  <span class="c1"># or = ... ?</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] &quot;spam&quot;  &quot;bacon&quot; &quot;spam&quot; </span>
<span class="c1">## </span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] &quot;spam&quot;     &quot;eggs&quot;     &quot;broccoli&quot;</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id45">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.24</span>
        
    </div><div class="proof-content">
<p>(*) Consider the  `<strong class="command">recode&lt;-</strong>` function from the
previous exercise.</p>
<p>Here is an example matrix with the <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>
attribute whose <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute is set (more
details in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;-</span> <span class="n">Titanic</span><span class="p">[</span><span class="s">&quot;Crew&quot;</span><span class="p">,</span> <span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="p">,</span> <span class="p">])</span>
<span class="c1">##        Survived</span>
<span class="c1">## Age      No Yes</span>
<span class="c1">##   Child   0   0</span>
<span class="c1">##   Adult 670 192</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">Age</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">Survived</span><span class="o">=</span><span class="s">&quot;survived&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##        survived</span>
<span class="c1">## age      No Yes</span>
<span class="c1">##   Child   0   0</span>
<span class="c1">##   Adult 670 192</span>
</pre></div>
</div>
<p>This changes the <code class="docutils literal notranslate"><span class="pre">x</span></code> object. For each of the following subtasks,
write a single call  which alters
<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>
without modifying <code class="docutils literal notranslate"><span class="pre">x</span></code> in-place but returning
a recoded copy of:</p>
<ul class="simple">
<li><p><strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>,</p></li>
<li><p><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id46">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.25</span>
        
    </div><div class="proof-content">
<p>(*) Consider the  `<strong class="command">recode&lt;-</strong>` function once again
but now let an example object be a data frame featuring
a column of class <code class="docutils literal notranslate"><span class="pre">factor</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">51</span><span class="p">,</span> <span class="m">101</span><span class="p">),</span> <span class="p">]</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]]))</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span>
    <span class="n">setosa</span><span class="o">=</span><span class="s">&quot;SET&quot;</span><span class="p">,</span> <span class="n">versicolor</span><span class="o">=</span><span class="s">&quot;VER&quot;</span><span class="p">,</span> <span class="n">virginica</span><span class="o">=</span><span class="s">&quot;VIR&quot;</span>
<span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2     SET</span>
<span class="c1">## 2            4.9         3.0          1.4         0.2     SET</span>
<span class="c1">## 51           7.0         3.2          4.7         1.4     VER</span>
<span class="c1">## 101          6.3         3.3          6.0         2.5     VIR</span>
</pre></div>
</div>
<p>Without modifying <code class="docutils literal notranslate"><span class="pre">x</span></code> in-place, how to change
<strong class="command">levels</strong><code class="code docutils literal notranslate"><span class="pre">(x[[&quot;Species&quot;]])</span></code> and return
an altered copy of:</p>
<ul class="simple">
<li><p><strong class="command">levels</strong><code class="code docutils literal notranslate"><span class="pre">(x[[&quot;Species&quot;]])</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[[&quot;Species&quot;]]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code>?</p></li>
</ul>
</div></div></section>
</section>
</section>
<section id="arguments-and-local-variables">
<h2><span class="section-number">9.5. </span>Arguments and Local Variables<a class="headerlink" href="#arguments-and-local-variables" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="pass-by-value">
<span id="sec-pass-by-value"></span><h3><span class="section-number">9.5.1. </span>Pass by ‚ÄúValue‚Äù<a class="headerlink" href="#pass-by-value" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>As a general rule, functions cannot change the state of their
arguments<a class="footnote-reference brackets" href="#footchgenvir" id="id16">8</a>. We can think of them as being passed
by <em>value</em>, i.e., as if their copy was made.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_change</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">7</span>
    <span class="n">y</span>
<span class="p">}</span>

<span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">test_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 7 2 3 4 5</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># same</span>
<span class="c1">## [1] 1 2 3 4 5</span>
</pre></div>
</div>
<p>If the above was not the case, the state of <code class="docutils literal notranslate"><span class="pre">x</span></code> would have been
changed after the call.</p>
</section>
<section id="variable-scope">
<h3><span class="section-number">9.5.2. </span>Variable Scope<a class="headerlink" href="#variable-scope" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Function arguments as well as any other variables we create
inside a function‚Äôs body are <em>relative</em> to each call to that function.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_change</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="m">+1</span>
    <span class="n">z</span> <span class="o">&lt;-</span> <span class="o">-</span><span class="n">x</span>
    <span class="n">z</span>
<span class="p">}</span>

<span class="n">x</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">test_change</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="m">10</span><span class="p">)</span>
<span class="c1">## [1] -11 -21 -31 -41 -51</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x in the function&#39;s body was a different x</span>
<span class="c1">## [1] 1 2 3 4 5</span>
<span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># z was local</span>
<span class="c1">## Error in print(z): object &#39;z&#39; not found</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code> are local variables and live only whilst
our function is being executed.
The former temporarily ‚Äúovershadows‚Äù<a class="footnote-reference brackets" href="#footshadow" id="id17">9</a> the object
of the same name from the caller‚Äôs context.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is a good development practice to refrain from referring to objects
not created within the current function, especially to ‚Äúglobal‚Äù variables.
We can always pass an object as an argument explicitly.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is a function call as such, not curly braces per se
that form a local scope.</p>
<p>Writing ‚Äú<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">&lt;-</span> <span class="pre">1;</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">}</span></code>‚Äù, <code class="docutils literal notranslate"><span class="pre">y</span></code> is not an auxiliary variable;
it is an ordinary named object created alongside <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>On the other hand, in
‚Äú<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">(</span></code><strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">()</span> <span class="pre">{</span> <span class="pre">z</span> <span class="pre">&lt;-</span> <span class="pre">1;</span> <span class="pre">z</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">})()</span></code>‚Äù,
<code class="docutils literal notranslate"><span class="pre">z</span></code> will not be available thereafter.</p>
</div>
</section>
<section id="closures">
<span id="sec-closures"></span><h3><span class="section-number">9.5.3. </span>Closures (*)<a class="headerlink" href="#closures" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Most user-defined functions are in fact representatives
of the so-called <em>closures</em>; see <a class="reference internal" href="350-eval-fun.html#chap-eval-fun"><span class="std std-numref">Chapter 18</span></a> and <span id="id18">[<a class="reference internal" href="999-bibliography.html#id11" title="Abelson, H., Sussman, G.J., Sussman, J. (1996).  Structure and Interpretation of Computer Programs. MIT Press.">1</a>]</span>.
They not only consist of an R expression to evaluate,
but also can carry some auxiliary data.</p>
<p>For instance, given two equal-length numeric vectors <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>,
a call to <strong class="command">approxfun</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code> returns
a <em>function</em> that linearly interpolates between the
consecutive points <span class="math notranslate nohighlight">\((x_1, y_1)\)</span>, <span class="math notranslate nohighlight">\((x_2, y_2)\)</span>, and so forth, so that
a corresponding <span class="math notranslate nohighlight">\(y\)</span> can be determined for any <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">length.out</span><span class="o">=</span><span class="m">11</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">&lt;-</span> <span class="nf">approxfun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">&lt;-</span> <span class="nf">approxfun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">^</span><span class="m">3</span><span class="p">)</span>
<span class="nf">f1</span><span class="p">(</span><span class="m">0.75</span><span class="p">)</span>  <span class="c1"># check that it is quite close to the true 0.75^2</span>
<span class="c1">## [1] 0.565</span>
<span class="nf">f2</span><span class="p">(</span><span class="m">0.75</span><span class="p">)</span>  <span class="c1"># compare with 0.75^3</span>
<span class="c1">## [1] 0.4275</span>
</pre></div>
</div>
<p>Inspecting, however, the source codes of the above functions:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
<span class="c1">## function (v) </span>
<span class="c1">## .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span>
<span class="c1">## &lt;bytecode: 0x55bfdbd80888&gt;</span>
<span class="c1">## &lt;environment: 0x55bfdbd7ff20&gt;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
<span class="c1">## function (v) </span>
<span class="c1">## .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span>
<span class="c1">## &lt;bytecode: 0x55bfdbd80888&gt;</span>
<span class="c1">## &lt;environment: 0x55bfdbe82e30&gt;</span>
</pre></div>
</div>
<p>we might wonder how can they produce different results ‚Äî it is
evident that they are identical.
It turns out, however, that they internally store some additional
data that is referred to upon their calls:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">environment</span><span class="p">(</span><span class="n">f1</span><span class="p">)[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span>
<span class="c1">##  [1] 0.00 0.01 0.04 0.09 0.16 0.25 0.36 0.49 0.64 0.81 1.00</span>
<span class="nf">environment</span><span class="p">(</span><span class="n">f2</span><span class="p">)[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span>
<span class="c1">##  [1] 0.000 0.001 0.008 0.027 0.064 0.125 0.216 0.343 0.512 0.729 1.000</span>
</pre></div>
</div>
<p>This and many more we will explore in great detail in the third part
of this book.</p>
</section>
<section id="default-arguments">
<h3><span class="section-number">9.5.4. </span>Default Arguments<a class="headerlink" href="#default-arguments" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We have already mentioned above that, when designing functions
that perform complex tasks, we will sometimes be
faced with a design problem: how to find a sweet spot between
being generous/mindful of the diverse needs of our users
and making the API neither overwhelming nor oversimplistic.</p>
<p>We know that it is best if a function performs one,
well-specified task, but also allows its behaviour be tuned-up if one
wishes to do so.
This principle can be facilitated by the use of <em>default arguments</em>.</p>
<p>For instance, <strong class="command">log</strong> computes logarithms,
by default the natural ones.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">log</span><span class="p">(</span><span class="m">2.718</span><span class="p">)</span>  <span class="c1"># the same as log(2.78, base=exp(1)) ‚Äî default base</span>
<span class="c1">## [1] 0.9999</span>
<span class="nf">log</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>  <span class="c1"># different base</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id47">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.26</span>
        
    </div><div class="proof-content">
<p>Study the documentation of the following functions and note
the default values that they define:
<strong class="command">round</strong>, <strong class="command">hist</strong>,
<strong class="command">grep</strong>, and
<strong class="command">download.file</strong>.</p>
</div></div><p>We can easily define our own functions equipped with such
<em>recommended</em> settings:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_default</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="n">x</span>

<span class="nf">test_default</span><span class="p">()</span>   <span class="c1"># use default</span>
<span class="c1">## [1] 1</span>
<span class="nf">test_default</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>  <span class="c1"># use something else</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<p>Most often, default arguments are just constants, e.g., <code class="docutils literal notranslate"><span class="pre">1</span></code>.
However, they can be any R expressions,
also including a reference to other arguments
passed to the same function; see more in <a class="reference internal" href="350-eval-fun.html#sec-default-args-eval"><span class="std std-numref">Section¬†18.1</span></a>.</p>
<p>Note that default arguments will most often appear
and the end of the parameter list, but see
<a class="reference internal" href="#sec-replacementfun"><span class="std std-numref">Section¬†9.4.5</span></a> (on replacement functions)
for a well-justified exception.</p>
</section>
<section id="lazy-evaluation">
<span id="sec-lazy-eval"></span><h3><span class="section-number">9.5.5. </span>Lazy Evaluation<a class="headerlink" href="#lazy-evaluation" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In some languages, function arguments are always evaluated
prior to a call. In R, though, they are only computed when actually needed.
We call it <em>lazy</em> or <em>delayed</em> evaluation.
Recall that in <a class="reference internal" href="180-flow.html#sec-short-circuit-ops"><span class="std std-numref">Section¬†8.1.4</span></a> we introduced
the short-circuit evaluation operators `<strong class="command">||</strong>` (or) and
`<strong class="command">&amp;&amp;</strong>` (and). They are able to do their job precisely
thanks to this mechanism.</p>
<div class="proof proof-type-example" id="id48">

    <div class="proof-title">
        <span class="proof-type">Example 9.27</span>
        
    </div><div class="proof-content">
<p>In the following example, we do not use the function‚Äôs argument at all:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_test1</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="m">1</span>  <span class="c1"># x not used at all</span>

<span class="nf">lazy_test1</span><span class="p">({</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;and now for something completely different!&quot;</span><span class="p">);</span> <span class="m">7</span><span class="p">})</span>
<span class="c1">## [1] 1</span>
</pre></div>
</div>
<p>Otherwise, we would see a message being printed out on the console.</p>
</div></div><div class="proof proof-type-example" id="id49">

    <div class="proof-title">
        <span class="proof-type">Example 9.28</span>
        
    </div><div class="proof-content">
<p>Next, let us use <code class="docutils literal notranslate"><span class="pre">x</span></code> amidst other expressions in the body:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_test2</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">cat</span><span class="p">(</span><span class="s">&quot;it&#39;s... &quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="o">+</span><span class="n">x</span>  <span class="c1"># using x twice</span>
    <span class="nf">cat</span><span class="p">(</span><span class="s">&quot; a man with two noses&quot;</span><span class="p">)</span>
    <span class="n">y</span>
<span class="p">}</span>

<span class="nf">lazy_test2</span><span class="p">({</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;and now for something completely different!&quot;</span><span class="p">);</span> <span class="m">7</span><span class="p">})</span>
<span class="c1">## it&#39;s... and now for something completely different! a man with two noses</span>
<span class="c1">## [1] 14</span>
</pre></div>
</div>
<p>Note that an argument is evaluated once and its value is stored
for further reference. If that was not the case,
we would see two messages like <code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">now...</span></code>.</p>
</div></div></section>
<section id="ellipsis">
<span id="sec-ellipsis"></span><h3><span class="section-number">9.5.6. </span>Ellipsis, `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`<a class="headerlink" href="#ellipsis" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Let us start with an exercise.</p>
<div class="proof proof-type-exercise" id="id50">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.29</span>
        
    </div><div class="proof-content">
<p>Note the presence of `<code class="code docutils literal notranslate"><span class="pre">...</span></code>` in the parameter list of
<strong class="command">c</strong>,
<strong class="command">list</strong>,
<strong class="command">structure</strong>,
<strong class="command">cbind</strong>,
<strong class="command">rbind</strong>,
<strong class="command">cat</strong>,
<strong class="command">Map</strong> (and the underlying <strong class="command">mapply</strong>),
<strong class="command">lapply</strong> (a specialised version of  <strong class="command">Map</strong>),
<strong class="command">optimise</strong>,
<strong class="command">optim</strong>,
<strong class="command">uniroot</strong>,
<strong class="command">integrate</strong>,
<strong class="command">outer</strong>,
<strong class="command">aggregate</strong>.
What purpose does it serve, according to these functions manual pages?</p>
</div></div><p>We can create a <em>variadic function</em> by placing a dot-dot-dot (ellipsis;
see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;dots&quot;)</span></code>),
`<code class="code docutils literal notranslate"><span class="pre">...</span></code>`, somewhere in its parameter list.
The ellipsis serves as placeholder for all objects passed to the function
but not matched by any formal (named) parameters.</p>
<p>The easiest way to process arguments passed via `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`
programmatically (see also <a class="reference internal" href="350-eval-fun.html#sec-ellipsis-eval"><span class="std std-numref">Section¬†18.2</span></a>)
is by redirecting them to <strong class="command">list</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_dots</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
    <span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>

<span class="nf">test_dots</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1</span>
<span class="c1">## </span>
<span class="c1">## $a</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<p>Such a list can be processed just like‚Ä¶ any other R list.
What we can do with these arguments is only limited by our creativity
(in particular, recall from <a class="reference internal" href="170-function.html#sec-do-call-intro"><span class="std std-numref">Section¬†7.2.2</span></a>
the very powerful <strong class="command">do.call</strong> function).
Still, there are two major use cases of the ellipsis<a class="footnote-reference brackets" href="#footpykwargs" id="id19">10</a>:</p>
<ul>
<li><p>create a new object by combining an arbitrary number of other objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>   <span class="c1"># 3 arguments</span>
<span></span><span class="c1">## [1] 1 2 3</span>
<span></span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="o">:</span><span class="m">7</span><span class="p">)</span>  <span class="c1"># 2 arguments</span>
<span></span><span class="c1">## [1] 1 2 3 4 5 6 7</span>
<span></span><span class="nf">structure</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>  <span class="c1"># 0 additional arguments</span>
<span></span><span class="c1">## [1] &quot;spam&quot;</span>
<span></span><span class="nf">structure</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;rose&quot;</span><span class="p">,</span> <span class="n">taste</span><span class="o">=</span><span class="s">&quot;umami&quot;</span><span class="p">)</span>  <span class="c1"># 2 further arguments</span>
<span></span><span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;color&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
<span class="c1">## attr(,&quot;taste&quot;)</span>
<span class="c1">## [1] &quot;umami&quot;</span>
<span></span><span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">)</span>
<span></span><span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    3</span>
<span class="c1">## [2,]    2    4</span>
<span></span><span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="o">:</span><span class="m">8</span><span class="p">)</span>
<span></span><span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    3    5    7</span>
<span class="c1">## [2,]    2    4    6    8</span>
<span></span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">42</span><span class="p">)</span>
<span></span><span class="c1">## [1] 108</span>
</pre></div>
</div>
</li>
<li><p>pass further arguments (as-is) to other methods :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">lapply</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="m">4</span><span class="o">:</span><span class="m">9</span><span class="p">),</span> <span class="n">mean</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># mean(x, na.rm=TRUE)</span>
<span></span><span class="c1">## [[1]]</span>
<span class="c1">## [1] 2</span>
<span class="c1">## </span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 6.5</span>
<span></span><span class="nf">integrate</span><span class="p">(</span><span class="n">dbeta</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">shape1</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span> <span class="n">shape2</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span>  <span class="c1"># dbeta(x, shape1=2.5, shape2=0.5)</span>
<span></span><span class="c1">## 1 with absolute error &lt; 1.2e-05</span>
</pre></div>
</div>
</li>
</ul>
<div class="proof proof-type-example" id="id51">

    <div class="proof-title">
        <span class="proof-type">Example 9.30</span>
        
    </div><div class="proof-content">
<p>The documentation of <strong class="command">lapply</strong> (let us call <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;lapply&quot;)</span></code> now)
states that this function is defined as
<strong class="command">lapply</strong><code class="code docutils literal notranslate"><span class="pre">(X,</span> <span class="pre">FUN,</span> <span class="pre">...)</span></code>.
Here, the ellipsis is a placeholder for a number of optional arguments
that can be passed to <strong class="command">FUN</strong>.
Hence, if we denote the <em>i</em>-th element of a vector <code class="docutils literal notranslate"><span class="pre">X</span></code> by
<code class="docutils literal notranslate"><span class="pre">X[[i]]</span></code>, calling <strong class="command">lapply</strong><code class="code docutils literal notranslate"><span class="pre">(X,</span> <span class="pre">FUN,</span> <span class="pre">...)</span></code>
will return a list whose <em>i</em>-th element will be equal to
<strong class="command">FUN</strong><code class="code docutils literal notranslate"><span class="pre">(X[[i]],</span> <span class="pre">...)</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id52">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.31</span>
        
    </div><div class="proof-content">
<p>Using a single call to <strong class="command">lapply</strong>, generate
a list with three numeric vectors of lengths 3, 9, and 7, respectively,
drawn from the uniform distribution on the unit interval.
Then, upgrade your code to get numbers sampled form the interval <span class="math notranslate nohighlight">\([-1, 1]\)</span>.</p>
</div></div></section>
<section id="metaprogramming">
<span id="sec-metaprogramming-intro"></span><h3><span class="section-number">9.5.7. </span>Metaprogramming (*)<a class="headerlink" href="#metaprogramming" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Under the hood, lazy evaluation is a quite complicated mechanism
that relies upon the storing of unevaluated R expressions
and special <em>promises</em> to instantiate them<a class="footnote-reference brackets" href="#footevalmodel" id="id20">11</a>.</p>
<p>It turns out that we have access to such expressions programmatically.
In particular, a call to the composition of
<strong class="command">deparse</strong> and <strong class="command">substitute</strong> can convert them
to a character vector:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_deparse_substitute</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nf">deparse</span><span class="p">(</span><span class="nf">substitute</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="nf">test_deparse_substitute</span><span class="p">(</span><span class="n">testing</span><span class="m">+1+2+3</span><span class="p">)</span>
<span class="c1">## [1] &quot;testing + 1 + 2 + 3&quot;</span>
<span class="nf">test_deparse_substitute</span><span class="p">(</span><span class="n">spam</span> <span class="o">&amp;</span> <span class="n">spam</span><span class="o">^</span><span class="m">2</span> <span class="o">&amp;</span> <span class="n">bacon</span> <span class="o">|</span> <span class="nf">grilled</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
<span class="c1">## [1] &quot;spam &amp; spam^2 &amp; bacon | grilled(spam)&quot;</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id53">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.32</span>
        
    </div><div class="proof-content">
<p>Check out the y-axis label generated by
<strong class="command">plot.default</strong><code class="code docutils literal notranslate"><span class="pre">((1:100)^2)</span></code>.
Inspect its source code and note a call to the two aforementioned functions.</p>
<p>Similarly, call
<strong class="command">shapiro.test</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">rlnorm</strong><code class="code docutils literal notranslate"><span class="pre">(100)))</span></code> and take note of the <code class="docutils literal notranslate"><span class="pre">data:</span></code> field.</p>
</div></div><p>A function is free to do with such an expression whatever it likes.
For instance, it can manipulate it and evaluate it in a different context.
Thanks to such a language feature, certain operations can be
designed so that their users can express them much more compactly.
This is certainly (in theory) a very powerful tool but from practice
we know many instances where it has been over/misused and made
the use of R confusing.</p>
<div class="proof proof-type-example" id="id54">

    <div class="proof-title">
        <span class="proof-type">Example 9.33</span>
        
    </div><div class="proof-content">
<p>(*)
The built-in <strong class="command">subset</strong> and <strong class="command">transform</strong>
use metaprogramming techniques to specify basic
data frame transformation techniques (see <a class="reference internal" href="240-data-frame.html#sec-metaprogramming-df"><span class="std std-numref">Section¬†12.3.9</span></a>).
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">transform</span><span class="p">(</span>
    <span class="nf">subset</span><span class="p">(</span>
        <span class="n">iris</span><span class="p">,</span>
        <span class="n">Sepal.Length</span><span class="o">&gt;=</span><span class="m">7.7</span> <span class="o">&amp;</span> <span class="n">Sepal.Width</span> <span class="o">&gt;=</span> <span class="m">3.0</span><span class="p">,</span>
        <span class="n">select</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="n">Sepal.Length</span><span class="o">:</span><span class="n">Sepal.Width</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">Sepal.Length.mm</span><span class="o">=</span><span class="n">Sepal.Length</span><span class="o">/</span><span class="m">10</span>
<span class="p">)</span>
<span class="c1">##       Species Sepal.Length Sepal.Width Sepal.Length.mm</span>
<span class="c1">## 118 virginica          7.7         3.8            0.77</span>
<span class="c1">## 132 virginica          7.9         3.8            0.79</span>
<span class="c1">## 136 virginica          7.7         3.0            0.77</span>
</pre></div>
</div>
<p>Note that none of the arguments ‚Äì except <code class="docutils literal notranslate"><span class="pre">iris</span></code> ‚Äì makes sense
outside of the function call contexts.
In particular, neither <code class="docutils literal notranslate"><span class="pre">Sepal.Length</span></code> nor <code class="docutils literal notranslate"><span class="pre">Sepal.Width</span></code>
variables exist.</p>
<p>The two functions took the liberty to interpret the arguments passed
as they felt like. They have created their own virtual reality within
our well-defined world.
The reader must refer to their documentation to discover
the meaning of the special syntax used therein.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Some functions have rather peculiar default arguments.
For instance, in the manual page of <strong class="command">prop.test</strong>,
we read that the <code class="docutils literal notranslate"><span class="pre">alternative</span></code>
parameter defaults to <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;two.sided&quot;,</span> <span class="pre">&quot;less&quot;,</span> <span class="pre">&quot;greater&quot;)</span></code>
but that <code class="docutils literal notranslate"><span class="pre">&quot;two.sided&quot;</span></code> is actually the default one.</p>
<p>If we call <strong class="command">print</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">prop.test</strong><code class="code docutils literal notranslate"><span class="pre">)</span></code>,
we will find the code line responsible for this behaviour:
‚Äú<code class="docutils literal notranslate"><span class="pre">alternative</span> <span class="pre">&lt;-</span> </code><strong class="command">match.arg</strong><code class="code docutils literal notranslate"><span class="pre">(alternative)</span></code>‚Äù.
Consider the following example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_match_arg</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">))</span> <span class="nf">match.arg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nf">test_match_arg</span><span class="p">()</span>  <span class="c1"># missing argument ‚Äî choose 1st</span>
<span class="c1">## [1] &quot;a&quot;</span>
<span class="nf">test_match_arg</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>  <span class="c1"># one of the predefined options</span>
<span class="c1">## [1] &quot;c&quot;</span>
<span class="nf">test_match_arg</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">)</span>  <span class="c1"># unexpected setting</span>
<span class="c1">## Error in match.arg(x): &#39;arg&#39; should be one of &quot;a&quot;, &quot;b&quot;, &quot;c&quot;</span>
</pre></div>
</div>
<p>In this setting, <strong class="command">match.arg</strong> allows only
an actual parameter amongst a given set of choices, but selects the first
option if the argument is missing.</p>
<p>Unfortunately, we have to learn this behaviour by heart, because
actually looking at the above source code gives us no clue
about this being possible whatsoever.
If such an expression was normally evaluated, we would either be passing
the default argument or whatever the user passed as <code class="docutils literal notranslate"><span class="pre">x</span></code> (but
then the function would not know about the range of possible choices).
A call to ‚Äú<strong class="command">match.arg</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;))</span></code>‚Äù could guarantee the desired functionality and would be much more readable.
Instead, metaprogramming techniques allowed <strong class="command">match.arg</strong> to access
the enclosing function‚Äôs default argument list without our explicitly
referring to them.</p>
<p>One may ask ‚Äúwhy is it so‚Äù and the only sensible answer to this will be
‚Äúbecause its programmer decided it must be this way‚Äù.
Let us contemplate this for a while.
In cases like this, we are dealing not with some
base R language design choice that we might like or dislike,
but which we should normally just accept as an inherent feature.
Rather, we are struggling intellectually because of some R
programmer‚Äôs (mis)use (in good faith‚Ä¶) of R‚Äôs flexibility itself.
They have introduced a slang/dialect on top of our mother tongue,
whose meaning is valid only within this function.
Blame the middleman, not the environment, please.</p>
</div>
<p>We generally advocate for avoiding metaprogramming wherever possible
(and will elaborate on this later on, including
formulas (`<strong class="command">~</strong>`), built-in functions like <strong class="command">subset</strong>
or <strong class="command">transform</strong>, etc.).</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">9.6. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">ÔÉÅ</a></h2>
<div class="proof proof-type-exercise" id="id55">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.34</span>
        
    </div><div class="proof-content">
<p>Answer the following questions:</p>
<ul class="simple">
<li><p>Will ‚Äú<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code>‚Äù stop?
What about ‚Äú<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(NA)</span></code>‚Äù,
‚Äú<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">FALSE)</span></code>‚Äù, and
‚Äú<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">TRUE,</span> <span class="pre">NA))</span></code>‚Äù?</p></li>
<li><p>What does the `<strong class="command">if</strong>` function return?</p></li>
<li><p>Does `<strong class="command">attributes&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">NULL)</span></code> modify <code class="docutils literal notranslate"><span class="pre">x</span></code>?</p></li>
<li><p>When can we be interested in calling
`<strong class="command">[</strong>` and `<strong class="command">[&lt;-</strong>` as functions
(and not as operators) directly?</p></li>
<li><p>How to define our own binary operator? Can it have some default arguments?</p></li>
<li><p>What are the main use cases of `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`?</p></li>
<li><p>What is wrong with <strong class="command">transform</strong>, <strong class="command">subset</strong>, and
<strong class="command">match.arg</strong>?</p></li>
<li><p>When a call like
‚Äú<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(-1,</span> </code><strong class="command">do_something_that_takes_a_million_years</strong><code class="code docutils literal notranslate"><span class="pre">())</span></code>‚Äù
does not necessarily have to be a bad idea?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id56">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.35</span>
        
    </div><div class="proof-content">
<p>What is the return value of a call to
‚Äú<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>‚Äù?</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">e</span> <span class="n">in</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Is it <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>,
<code class="docutils literal notranslate"><span class="pre">x[[</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)]]</span></code>, or
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(x[[</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)]])</span></code>?</p>
</div></div><div class="proof proof-type-exercise" id="id57">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.36</span>
        
    </div><div class="proof-content">
<p>The <strong class="command">split</strong> function also has its replacement version.
Study its documentation to learn how it works.</p>
</div></div><div class="proof proof-type-exercise" id="id58">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.37</span>
        
    </div><div class="proof-content">
<p>A call to <strong class="command">ls</strong><code class="code docutils literal notranslate"><span class="pre">(envir=</span></code><strong class="command">baseenv</strong><code class="code docutils literal notranslate"><span class="pre">())</span></code>
returns all objects defined in package <strong class="program">base</strong>
(see <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>).
List the names corresponding to some replacement functions.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Apply the principle of test-driven development
when solving the remaining exercises (or those which you have
skipped intentionally).</p>
</div>
<div class="proof proof-type-exercise" id="id59">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.38</span>
        
    </div><div class="proof-content">
<p>Implement your own version of the <strong class="command">Position</strong>
and <strong class="command">Find</strong> functions.
Evaluation should stop as soon as the first element
fulfilling a given predicate has been found.</p>
</div></div><div class="proof proof-type-exercise" id="id60">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.39</span>
        
    </div><div class="proof-content">
<p>Implement your own version of the <strong class="command">Reduce</strong> function.</p>
</div></div><div class="proof proof-type-exercise" id="id61">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.40</span>
        
    </div><div class="proof-content">
<p>Write a function <strong class="command">slide</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">k,</span> <span class="pre">...)</span></code>
which returns a list <code class="docutils literal notranslate"><span class="pre">y</span></code> of size <strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)-k+1</span></code>
such that <code class="docutils literal notranslate"><span class="pre">y[[i]]</span> <span class="pre">=</span> </code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x[i:(i+k-1)],</span> <span class="pre">...)</span></code></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
<span class="c1">## [1] 1 2 3 4 5</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>
<span class="c1">## [1]  6  9 12</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>
<span class="c1">## [1] 15</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id62">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.41</span>
        
    </div><div class="proof-content">
<p>Using <strong class="command">slide</strong> defined above,
write another function that counts how many
increasing pairs of numbers are featured in a given numeric
vector. For instance, in <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(0,2,1,1,0,1,6,0)</span></code>
there are three such pairs: (0,2), (0,1), (1,6).</p>
</div></div><div class="proof proof-type-exercise" id="id63">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.42</span>
        
    </div><div class="proof-content">
<p>(*) Write your own version of
<strong class="program">tools</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">package_dependencies</strong> with
<code class="docutils literal notranslate"><span class="pre">reverse=TRUE</span></code> based on information extracted by calling
<strong class="program">utils</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">available.packages</strong>.</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="footparetooptim"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Compare the notion of Pareto efficiency.</p>
</dd>
<dt class="label" id="footfunc"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>If some non-trivial operation is missing, we can
always implement it at the C language level; see <a class="reference internal" href="310-compile.html#chap-compile"><span class="std std-numref">Chapter 14</span></a>.</p>
</dd>
<dt class="label" id="footquick"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>We will leave the reflection upon whether
this is at all feasible for another time.</p>
<p>Note that this strategy is employed by many companies
(and drug dealers): make the introductory experience super-smooth
and fun. At the same time, do not allow your users to become
independent too easily. Instead, make them rely on your
product lines/proprietary solutions/payable services etc.</p>
<p>The free software movement with its do-it-yourself approach stresses
on users‚Äô becoming autonomous. This does not contradict the
user-friendliness (but that many open-source projects could benefit
from becoming less exclusive is a different story, and this book tries
to make a change in this area too).</p>
</dd>
<dt class="label" id="footfactorstop"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Note that here we rely on S3 generics
<strong class="command">is.numeric</strong> and <strong class="command">as.numeric</strong>;
see <a class="reference internal" href="220-s3.html#sec-arg-check-s3"><span class="std std-numref">Section¬†10.4</span></a>.</p>
</dd>
<dt class="label" id="footstringx"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd><p>Yours truly is the author of the latter
and thus is guilty of multiplying entities beyond necessity.</p>
</dd>
<dt class="label" id="footalwaysdocument"><span class="brackets"><a class="fn-backref" href="#id7">6</a></span></dt>
<dd><p>This should read: i.e., always.</p>
</dd>
<dt class="label" id="footcranpolicy"><span class="brackets"><a class="fn-backref" href="#id11">7</a></span></dt>
<dd><p>And always consult the CRAN Repository Policy at
<a class="reference external" href="https://cran.r-project.org/web/packages/policies.html">https://cran.r-project.org/web/packages/policies.html</a>.</p>
</dd>
<dt class="label" id="footchgenvir"><span class="brackets"><a class="fn-backref" href="#id16">8</a></span></dt>
<dd><p>With the exception of objects of type <code class="docutils literal notranslate"><span class="pre">environment</span></code>,
which are passed by reference; see <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>.
Also, the fact that we have access to unevaluated R expressions
can cause further deviations to this rule (see below).</p>
</dd>
<dt class="label" id="footshadow"><span class="brackets"><a class="fn-backref" href="#id17">9</a></span></dt>
<dd><p>In <a class="reference internal" href="350-eval-fun.html#chap-eval-fun"><span class="std std-numref">Chapter 18</span></a>, we will discuss this
topic in-depth; objects are bound to their names within environments.
Moreover, R uses lexical (static) scoping, which is not necessarily
intuitive, especially taking into account that a function‚Äôs environment
can always be changed.</p>
</dd>
<dt class="label" id="footpykwargs"><span class="brackets"><a class="fn-backref" href="#id19">10</a></span></dt>
<dd><p>Which is somewhat similar to Python‚Äôs <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>
in a function‚Äôs parameter list.</p>
</dd>
<dt class="label" id="footevalmodel"><span class="brackets"><a class="fn-backref" href="#id20">11</a></span></dt>
<dd><p>Such an evaluation model has been heavily inspired
by Scheme <span id="id21">[<a class="reference internal" href="999-bibliography.html#id12" title="Ihaka, R., Gentleman, R. (1996).  R: A language for data analysis and graphics. Journal of Computational and Graphical Statistics, 5(3):299‚Äì314. URL: https://doi.org/10.1080/10618600.1996.10474713.">31</a>]</span>.
It will be explained in more detail in <code class="xref std std-numref docutils literal notranslate"><span class="pre">sec:to-do</span></code>.</p>
</dd>
</dl>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="220-s3.html" class="btn btn-neutral float-right" title="10. S3 Classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="180-flow.html" class="btn btn-neutral float-left" title="8. Flow of Execution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.

    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a>
    theme.
      <span class="lastupdated">
        Last updated on 2022-12-28T15:36:00+1100.
      </span>


    This site will never display any ads: it is a non-profit project.
    It does not collect any data.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>