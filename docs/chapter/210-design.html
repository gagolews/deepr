<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="10. S3 classes" href="220-s3.html" /><link rel="prev" title="8. Flow of execution" href="180-flow.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/210-design.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/deepr.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>9. Designing functions - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/deepr.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.0.9005
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">9. Designing functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="designing-functions">
<span id="chap-design"></span><h1><span class="section-number">9. </span>Designing functions<a class="headerlink" href="#designing-functions" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2024).  Minimalist Data Wrangling with Python. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">27</a>]</span> too.</em></p>
</div></blockquote>
<p>In <a class="reference internal" href="170-function.html#chap-function"><span class="std std-numref">Chapter 7</span></a>, we learnt how to compose simple functions.
This skill is vital to enforcing the good development practice
of avoiding code repetition: running the
same command sequence on different data.</p>
<p>This chapter is devoted to designing reusable methods so that
they are easier to use, test, and maintain.
We also provide more technical details about functions.
They were not of the highest
importance during our first exposure to this topic
but are crucial to our better understanding of how R works.</p>
<section id="managing-data-flow">
<span id="sec-fun-io"></span><h2><span class="section-number">9.1. </span>Managing data flow<a class="headerlink" href="#managing-data-flow" title="Link to this heading">¶</a></h2>
<p>A function, most of the time, can and should be treated as a black box.
Its callers do not have to care what it hides inside.
After all, they are supposed to <em>use</em> it. Given some <em>inputs</em>,
they expect well-defined <em>outputs</em> that are
explained in detail in the function’s manual.</p>
<section id="checking-input-data-integrity-and-argument-handling">
<span id="sec-arg-check"></span><h3><span class="section-number">9.1.1. </span>Checking input data integrity and argument handling<a class="headerlink" href="#checking-input-data-integrity-and-argument-handling" title="Link to this heading">¶</a></h3>
<p>A function takes R objects of any kind as arguments, but it does not mean
feeding it with everything is healthy for its guts.</p>
<p>When designing functions, it is best to handle the inputs
in a manner similar to base R’s behaviour.
This will make our contributions easier to work with.</p>
<p>Lamentably, base functions frequently do not process arguments
of a similar <em>kind</em> fully consistently.
Such variability might be due to many reasons and, in essence,
is not necessarily bad.
Usually, there might be many possible behaviours
and choosing one over another would make a few users unhappy anyway.
Some choices might not be optimal, but they are for historical
compatibility (e.g., with S).
Of course, it might also happen that something is poorly designed
or there is a bug (but the likelihood is low).</p>
<p>This is why we should rather keep our vocabulary restricted.
Even if there are exceptions to the general rules, with fewer
functions, they are easier to remember.
We advocate for such minimalism in this book.</p>
<p>Consider the following case study, illustrating that even the extremely
simple scenario dealing with a single positive integer
is not necessarily straightforward.</p>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.1</span>
        
    </div><div class="proof-content">
<p>In mathematical notation, we usually denote the number of objects in a
collection by the famous “<span class="math">\(n\)</span>”. It is implicitly assumed that such <span class="math">\(n\)</span>
is a single natural number (albeit whether this includes 0 or not should
be specified at some point). The functions
<strong class="command">runif</strong>,
<strong class="command">sample</strong>,
<strong class="command">seq</strong>,
<strong class="command">rep</strong>,
<strong class="command">strrep</strong>, and
<strong class="program">class</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">knn</strong>
take it as arguments. Nonetheless, nothing stops us from trying
to challenge them by passing:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">2.5</span></code>, <code class="docutils literal notranslate"><span class="pre">-1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1-1e-16</span></code> (non-positive numbers, non-integers);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NA_real_</span></code>, <code class="docutils literal notranslate"><span class="pre">Inf</span></code>  (not finite);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1:5</span></code> (not of length 1; after all, there are no scalars in R);</p></li>
<li><p><strong class="command">numeric</strong><code class="code docutils literal notranslate"><span class="pre">(0)</span></code> (an empty vector);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">NA</span></code>, <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">FALSE,</span> <span class="pre">NA)</span></code>,  <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code>,
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;1&quot;,</span> <span class="pre">&quot;2&quot;,</span> <span class="pre">&quot;3&quot;)</span></code> (non-numeric, but coercible to);</p></li>
<li><p><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code>, <strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>,
<strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1:3,</span> <span class="pre">4)</span></code> (non-atomic);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Spanish</span> <span class="pre">Inquisition&quot;</span></code> (unexpected nonsense);</p></li>
<li><p><strong class="command">as.matrix</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code>, <strong class="command">factor</strong><code class="code docutils literal notranslate"><span class="pre">(7)</span></code>,
<strong class="command">factor</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>,
etc. (compound types; <a class="reference internal" href="220-s3.html#chap-s3"><span class="std std-numref">Chapter 10</span></a>).</p></li>
</ul>
<p>Read the aforementioned functions’ reference manuals and call them
on different inputs. Notice how differently they handle such
atypical arguments.</p>
</div></div><p>Sometimes we will rely on other functions to check data integrity for us.</p>
<div class="proof proof-type-example" id="id19">

    <div class="proof-title">
        <span class="proof-type">Example 9.2</span>
        
    </div><div class="proof-content">
<p>Consider a function that generates <span class="math">\(n\)</span> pseudorandom
numbers from the unit interval rounded to <span class="math">\(d\)</span> decimal digits. We strongly
believe, or at least hope (the good faith and high competence assumption),
that its author knew what he was doing when he wrote:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">round_rand</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">  </span><span class="c1"># runif will check if `n` makes sense</span>
<span class="w">    </span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w">    </span><span class="c1"># round will determine the appropriateness of `d`</span>
<span class="p">}</span>
</pre></div>
</div>
<p>What constitutes correct <span class="math">\(n\)</span> and <span class="math">\(d\)</span> and how the function behaves
when not provided with positive integers is determined
by the two underlying functions, <strong class="command">runif</strong>
and <strong class="command">round</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># the expected use case</span>
<span class="c1">## [1] 0.3 0.8 0.4 0.9</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="m">1.9</span><span class="p">)</span><span class="w">  </span><span class="c1"># 4, 2</span>
<span class="c1">## [1] 0.94 0.05 0.53 0.89</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span>
<span class="c1">## [1] NA NA NA NA</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## numeric(0)</span>
</pre></div>
</div>
</div></div><p>Some design choices can be defended if they are well thought out and
adequately documented. Certain programmers will opt for high
uniformity/compatibility across numerous tools, as there are cases
where diversity does more good than harm.</p>
<p>Our functions might become part of a more complicated data flow pipeline.
Let’s consider what happens when another procedure generates a value that
we did not expect (due to a bug or because we did not study its manual).
The problem arises when this <em>unthinkable</em> value is passed to our function.
In our case, this would correspond to the said <span class="math">\(n\)</span>’s or <span class="math">\(d\)</span>’s being
determined programmatically.</p>
<div class="proof proof-type-example" id="id20">

    <div class="proof-title">
        <span class="proof-type">Example 9.3</span>
        
    </div><div class="proof-content">
<p>Continuing the previous example, the following might be somewhat challenging
with regard to our being flexible and open-minded:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">63</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># n=length(c(...))</span>
<span class="c1">## [1] 0.7 0.6 0.1 0.9</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="s">&quot;4&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># n=as.numeric(&quot;4&quot;)</span>
<span class="c1">## [1] 0.2 0.0 0.3 1.0</span>
</pre></div>
</div>
<p>Sure, it is convenient. Nevertheless, it might lead to problems
that are hard to diagnose.</p>
<p>Also, note the not so informative error messages in cases like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round_rand</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## Error in runif(n): invalid arguments</span>
<span class="nf">round_rand</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="c1">## Error in round(x, d): non-numeric argument to mathematical function</span>
</pre></div>
</div>
</div></div><p><em>Defensive design</em> strategies are always welcome,
especially if they lead to constructive error messages.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong class="command">stopifnot</strong> gives a convenient means to assert the
enjoyment of our expectations about a function’s arguments
(or intermediate values).
A call to <strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(cond1,</span> <span class="pre">cond2,</span> <span class="pre">...)</span></code>
is more or less equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">cond1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cond1</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span><span class="n">cond1</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;`cond1` are not all TRUE&quot;</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nf">is.logical</span><span class="p">(</span><span class="n">cond2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cond2</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span><span class="n">cond2</span><span class="p">)))</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;`cond2` are not all TRUE&quot;</span><span class="p">)</span>
<span class="kc">...</span>
</pre></div>
</div>
<p>Thus, if all the elements in the given logical vectors are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>,
nothing happens. We can move on with certainty.</p>
</div>
<div class="proof proof-type-example" id="id21">

    <div class="proof-title">
        <span class="proof-type">Example 9.4</span>
        
    </div><div class="proof-content">
<p>We can rewrite the preceding function as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">round_rand2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">stopifnot</span><span class="p">(</span>
<span class="w">        </span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">        </span><span class="nf">is.finite</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
<span class="w">        </span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">        </span><span class="nf">is.finite</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1] 0.7 0.7 0.5 0.6 0.3</span>
<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## Error in round_rand2(5.4, 1): n == floor(n) is not TRUE</span>
<span class="nf">round_rand2</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="c1">## Error in round_rand2(5, &quot;1&quot;): is.numeric(d) is not TRUE</span>
</pre></div>
</div>
<p>It is the strictest test for “a single positive integer”
possible. In the case of any violation of the underlying condition,
we get a very informative error message.</p>
</div></div><div class="proof proof-type-example" id="id22">

    <div class="proof-title">
        <span class="proof-type">Example 9.5</span>
        
    </div><div class="proof-content">
<p>At other times, we might be interested in a more liberal
yet still foolproof argument checking like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">warning</span><span class="p">(</span><span class="s">&quot;only the first element will be used&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">is.finite</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This way, <code class="docutils literal notranslate"><span class="pre">&quot;4&quot;</span></code> and <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(4.9,</span> <span class="pre">100)</span></code>
will all be accepted as <code class="docutils literal notranslate"><span class="pre">4</span></code><a class="footnote-reference brackets" href="#footfactorstop" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
</div></div><p>We see that there is always a tension between being generous/flexible
and precise/restrictive. Also, because of their particular use cases,
for certain functions, it will be better to behave differently from the
others. Excessive uniformity is as bad as chaos. We are always expected to
rely on common sense. Let’s not be boring bureaucrats.</p>
<p>Still, it is our duty to be explicit about all the assumptions we make
or exceptions we tolerate (by writing comprehensive documentation;
see <a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section 9.2.2.3</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Example exercises related to improving the consistency of base R’s
argument handling in different domains include the <strong class="program">vctrs</strong>
and <strong class="program">stringx</strong> packages. Can these contributions be justified?</p>
</div>
<div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.6</span>
        
    </div><div class="proof-content">
<p>Reflect on how you would respond to miscellaneous boundary cases
in the following scenarios
(and how base R and other packages or languages you know deal with them):</p>
<ul class="simple">
<li><p>a vectorised mathematical function
(empty vector? non-numeric input? what if it is equipped
with the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute? what if it has other ones?);</p></li>
<li><p>an aggregation function (what about missing values? empty vector?);</p></li>
<li><p>a function vectorised with regard to two arguments
(elementwise vectorisation? recycling rule?
only scalar vs vector, or vector vs vector of the same length allowed?
what if one argument is a row vector and the other is a column vector?);</p></li>
<li><p>a function vectorised with respect to all arguments (really all?
maybe some exceptions are necessary?);</p></li>
<li><p>a function vectorised with respect to the first argument
but not the second (why such a restriction? when?).</p></li>
</ul>
<p>Find a few functions that match each case.</p>
</div></div></section>
<section id="putting-outputs-into-context">
<h3><span class="section-number">9.1.2. </span>Putting outputs into context<a class="headerlink" href="#putting-outputs-into-context" title="Link to this heading">¶</a></h3>
<p>Our functions do not exist in a vacuum. We should put them into a much
broader context: how can they be combined with other tools?</p>
<p>As a general rule, we ought to generate outputs of a <em>predictable</em> kind.
This way, we can easily deduce what will happen
in the code chunks that utilise them.</p>
<div class="proof proof-type-example" id="id24">

    <div class="proof-title">
        <span class="proof-type">Example 9.7</span>
        
    </div><div class="proof-content">
<p>Some base R functions do not adhere to this rule for the sake of
(questionable) users’ convenience. We will meet
a few of them in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a> and <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>.
In particular,
<strong class="command">sapply</strong> and the underlying <strong class="command">simplify2array</strong>,
can return a list, an atomic vector, or a matrix.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span><span class="w">    </span><span class="c1"># list</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 3 4</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">      </span><span class="c1"># vector</span>
<span class="c1">## [1] 1 3</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span><span class="w">  </span><span class="c1"># matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    3</span>
<span class="c1">## [2,]    2    4</span>
</pre></div>
</div>
<p>Further, the index operator with <code class="docutils literal notranslate"><span class="pre">drop=TRUE</span></code>, which is the default,
may output an atomic vector. However, it may as well
yield a matrix or a data frame.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">))</span><span class="w">  </span><span class="c1"># an example matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="c1">## [3,]    3    6</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">    </span><span class="c1"># vector</span>
<span class="c1">## [1] 1 4</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># matrix</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span><span class="w">  </span><span class="c1"># matrix with 1 row</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
</pre></div>
</div>
</div></div><p>We proclaim that, if there are many options,
the default functions’ behaviour should be to return
the object of the most generic kind possible, even when it is not the most
convenient form.
Then, either:</p>
<ul class="simple">
<li><p>we equip the function with a further argument which must be
explicitly set if we <em>really</em> want to simplify the output, or</p></li>
<li><p>we ask the user to call a simplifier explicitly after the
function call; in this case, if the simplifier cannot neaten the object,
it should probably fail by issuing an error or at least try
to apply some brute force solution (e.g., “fill the gaps” somehow
itself, preferably with a warning).</p></li>
</ul>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">  </span><span class="c1"># always returns a vector</span>
<span class="c1">## [1] 1 2 4 5</span>
<span class="n">stringi</span><span class="o">::</span><span class="nf">stri_list2matrix</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span><span class="w">  </span><span class="c1"># fills the gaps with NAs</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,] &quot;1&quot;  &quot;3&quot;</span>
<span class="c1">## [2,] NA   &quot;4&quot;</span>
</pre></div>
</div>
<p>Ideally, a function is expected to perform one (and only one)
well-defined task. If it tends to generate objects of different
kinds, depending on the arguments provided, it might be better to
compose two or more separate procedures instead.</p>
<div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.8</span>
        
    </div><div class="proof-content">
<p>Functions such as <strong class="command">rep</strong>, <strong class="command">seq</strong>, and <strong class="command">sample</strong>
do not perform a single task.
Or do they?</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
In a purely functional programming language,
we can assume the so-called <em>referential transparency</em>:
a call to a <em>pure function</em> can always be replaced
with the <em>value</em> it generates.
If this is true, then for the same set of argument values, the output
is always the same. Furthermore, there are no side effects.
In R, it is not exactly the case:</p>
<ul class="simple">
<li><p>a call can introduce/modify/delete variables in other
environments (see <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>), e.g.,
the state of the random number generator,</p></li>
<li><p>due to lazy evaluation, functions are free to interpret the argument
<em>forms</em> (passed <em>expressions</em>, i.e., not only: <em>values</em>)
however they like; see <a class="reference internal" href="#sec-metaprogramming-intro"><span class="std std-numref">Section 9.4.7</span></a>,
<a class="reference internal" href="240-data-frame.html#sec-metaprogramming-df"><span class="std std-numref">Section 12.3.9</span></a>, and
<a class="reference internal" href="340-lazy.html#sec-metaprogramming-implement"><span class="std std-numref">Section 17.5</span></a>,</p></li>
<li><p>printing, plotting, file writing, and database access have apparent
consequences with regard to the state of certain external devices or
resources.</p></li>
</ul>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Each function <em>must</em> return a value. However, in several instances
(e.g., plotting, printing) this does not necessarily make sense.
In such a case, we may consider returning
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>, a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> whose <em>first</em> printing
will be suppressed. Compare the following:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="nf">invisible</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
<span class="nf">f</span><span class="p">()</span><span class="w">  </span><span class="c1"># printing suppressed</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w">  </span><span class="c1"># by the way, assignment also returns an invisible value</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># no longer invisible</span>
<span class="c1">## NULL</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="organising-and-maintaining-functions">
<span id="sec-own-functions-design"></span><h2><span class="section-number">9.2. </span>Organising and maintaining functions<a class="headerlink" href="#organising-and-maintaining-functions" title="Link to this heading">¶</a></h2>
<section id="function-libraries">
<h3><span class="section-number">9.2.1. </span>Function libraries<a class="headerlink" href="#function-libraries" title="Link to this heading">¶</a></h3>
<p>Definitions of frequently-used functions or datasets can be emplaced
in separate source files (.R extension) for further reference.</p>
<p>Such libraries can be executed by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">source</span><span class="p">(</span><span class="s">&quot;path_to_file.R&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.9</span>
        
    </div><div class="proof-content">
<p>Create a source file (script) named <code class="file docutils literal notranslate"><span class="pre">mylib.R</span></code>,
where you define a function called <strong class="command">nlargest</strong> which returns
a few largest elements in a given atomic vector.</p>
<p>From within another script, call <strong class="command">source</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;mylib.R&quot;)</span></code>;
note that relative paths refer to the current working directory
(<a class="reference internal" href="120-numeric.html#sec-scan"><span class="std std-numref">Section 2.1.6</span></a>). Then, write a few lines of code where you
test <strong class="command">nlargest</strong> on some example inputs.</p>
</div></div></section>
<section id="writing-r-packages">
<span id="sec-own-packages"></span><h3><span class="section-number">9.2.2. </span>Writing R packages (*)<a class="headerlink" href="#writing-r-packages" title="Link to this heading">¶</a></h3>
<p>When a function library grows substantially, there is a need for
equipping its contents with the relevant help pages, or we wish to rely
on compiled code, turning it into an R package might be worth considering.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Packages can be written only for ourselves or a small team’s purpose.
We <em>do not have to</em> publish them on CRAN<a class="footnote-reference brackets" href="#footcranpolicy" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.
Have mercy on the busy CRAN maintainers
and do not contribute to the information overload unless we have come up
with something potentially of service<a class="footnote-reference brackets" href="#footservice" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> for other R users.
Packages can always be hosted on and installed from GitLab or GitHub.</p>
</div>
<section id="package-structure">
<h4><span class="section-number">9.2.2.1. </span>Package structure (*)<a class="headerlink" href="#package-structure" title="Link to this heading">¶</a></h4>
<p>A <em>source package</em> is a directory containing the following special files and
subdirectories:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> – a text file that gives the name of the project,
its version, authors, dependencies on other packages, license, etc.;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">NAMESPACE</span></code> – a text file containing directives
stating which objects are available to the package users
and which names are imported from other packages;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">R</span></code> – a directory with R scripts (.R files),
which define, e.g., functions, example datasets, etc.;</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">man</span></code> – a directory with R documentation files (.Rd), describing
at least all the exported objects (<a class="reference internal" href="#sec-doc-packages"><span class="std std-numref">Section 9.2.2.3</span></a>);</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src</span></code> – optional; compiled code (<a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a>);</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">tests</span></code> – optional; tests to run on the package check
(<a class="reference internal" href="#sec-testing"><span class="std std-numref">Section 9.2.4.2</span></a>).</p></li>
</ul>
<p>See Section 1 of <em>Writing R Extensions</em> <span id="id5">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span> for more
details and other options. We do not need to repeat
the information from the official manual
as all readers can read it themselves.</p>
<div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.10</span>
        
    </div><div class="proof-content">
<p>Inspect the source code of the example package
available for download from <a class="reference external" href="https://github.com/gagolews/rpackagedemo">https://github.com/gagolews/rpackagedemo</a>.</p>
</div></div></section>
<section id="building-and-installing">
<h4><span class="section-number">9.2.2.2. </span>Building and installing (*)<a class="headerlink" href="#building-and-installing" title="Link to this heading">¶</a></h4>
<p>Recall from <a class="reference internal" href="170-function.html#sec-src-package"><span class="std std-numref">Section 7.3.1.2</span></a> that
a source package can be built and installed by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;pkg_directory&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;source&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then it can be used as any other R package (<a class="reference internal" href="170-function.html#sec-packages"><span class="std std-numref">Section 7.3.1</span></a>).
In particular, it can be loaded and attached to the search
path (<a class="reference internal" href="330-environment.html#sec-attach"><span class="std std-numref">Section 16.2.6</span></a>) via a call to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;pkg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All the exported objects mentioned in its <code class="docutils literal notranslate"><span class="pre">NAMESPACE</span></code> file
are now available to the user; see also <a class="reference internal" href="330-environment.html#sec-package-namespace"><span class="std std-numref">Section 16.3.5</span></a>.</p>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.11</span>
        
    </div><div class="proof-content">
<p>Create a package <strong class="program">mypkg</strong> with the solutions
to the exercises listed in the previous chapter.
When in doubt, refer to the official manual <span id="id6">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span>.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
The building and installing of packages also be done from
the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>R<span class="w"> </span>CMD<span class="w"> </span>build<span class="w"> </span>pkg_directory<span class="w">  </span><span class="c1"># creates a distributable source tarball (.tar.gz)</span>
R<span class="w"> </span>CMD<span class="w"> </span>INSTALL<span class="w"> </span>pkg-version.tar.gz
R<span class="w"> </span>CMD<span class="w"> </span>INSTALL<span class="w"> </span>--build<span class="w"> </span>pkg_directory
</pre></div>
</div>
<p>Also, some users may benefit from authoring Makefiles
that help automate the processes of building, testing, checking, etc.</p>
</div>
</section>
<section id="documenting">
<span id="sec-doc-packages"></span><h4><span class="section-number">9.2.2.3. </span>Documenting (*)<a class="headerlink" href="#documenting" title="Link to this heading">¶</a></h4>
<p>Documenting functions and commenting code thoroughly
is critical, even if we just write for ourselves.
Most programmers sooner or later will notice that they find it
hard to determine what a piece of code is doing after they
took a break from it. In some sense, we always communicate with
external audiences, which includes our future selves.</p>
<p>The help system is one of the stronger assets of the R environment.
By far, we most likely have interacted with many documentation pages and
got a general idea of what constitutes an informative documentation
piece.</p>
<p>From the technical side, documentation (.Rd) files
are located in the <code class="file docutils literal notranslate"><span class="pre">man</span></code> subdirectory of a source package.
All exported objects (e.g., functions) should be described clearly.
Additional topics can be covered too.</p>
<p>During the package installation, the .Rd files are converted to various
output formats, e.g., HTML or plain text, and displayed on a call to
the well-known <strong class="command">help</strong> function.</p>
<p>Documentation files use a LaTeX-like syntax, which looks obscure
to an untrained eye. The relevant commands are explained in very detail
in Section 2 of <span id="id7">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The process of writing .Rd files by hand might be tedious,
especially keeping track of the changes to the <code class="docutils literal notranslate"><span class="pre">\usage</span></code> and <code class="docutils literal notranslate"><span class="pre">\arguments</span></code>
commands. Rarely do we recommend using external packages for
base R facilities are usually sufficient.
But <strong class="program">roxygen2</strong> might be worth a try
because it makes the developers’ lives easier.
Most importantly, it allows the documentation to be specified alongside
the functions’ definitions, which is much more natural.</p>
</div>
<div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.12</span>
        
    </div><div class="proof-content">
<p>Add a few manual pages to your example R package.</p>
</div></div></section>
</section>
<section id="writing-standalone-programs">
<span id="sec-command-args"></span><h3><span class="section-number">9.2.3. </span>Writing standalone programs (**)<a class="headerlink" href="#writing-standalone-programs" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="170-function.html#sec-external-programs"><span class="std std-numref">Section 7.3.2</span></a> mentioned how to call
external programs using <strong class="command">system2</strong>.</p>
<p>On UNIX-like operating systems, it is easy to turn our R scripts
into standalone tools that can be run from the terminal.
We have already touched upon this topic in <a class="reference internal" href="110-basics.html#sec-batch-mode"><span class="std std-numref">Section 1.2.3</span></a>.</p>
<p>The <strong class="command">commandArgs</strong> function returns the list of arguments
passed from the command line to our script in the form
of a character vector. Whatever we do with them is up to us.
Moreover, <strong class="command">q</strong> can terminate a script, yielding any
integer return code. By convention, anything other than 0 indicates
an error.</p>
<div class="proof proof-type-example" id="id30">

    <div class="proof-title">
        <span class="proof-type">Example 9.13</span>
        
    </div><div class="proof-content">
<p>Say we have the following script named <code class="file docutils literal notranslate"><span class="pre">testfile</span></code>
in the current directory:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/bin/env -S Rscript --vanilla</span>

<span class="n">argv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">commandArgs</span><span class="p">(</span><span class="n">trailingOnly</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;commandArgs:\n&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Usage: testfiles file1 file2 ...\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">q</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># exit with code 1</span>
<span class="p">}</span>

<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">file.exists</span><span class="p">(</span><span class="n">argv</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Some files do not exist.\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">q</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1"># exit with code 2</span>
<span class="p">}</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;All files exist.\n&quot;</span><span class="p">)</span>

<span class="c1"># exits with code 0 (success)</span>
</pre></div>
</div>
<p>Example interactions with this program from a UNIX-like shell
(<strong class="program">bash</strong>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>u+x<span class="w"> </span>testfiles<span class="w">  </span><span class="c1"># add permission to execute</span>
./testfiles
<span class="c1">## commandArgs:</span>
<span class="c1">## character(0)</span>
<span class="c1">## Usage: testfiles file1 file2 ...</span>
./testfiles<span class="w"> </span>spanish_inquisition
<span class="c1">## commandArgs:</span>
<span class="c1">## [1] &quot;spanish_inquisition&quot;</span>
<span class="c1">## Some files do not exist.</span>
./testfiles<span class="w"> </span>spam<span class="w"> </span>bacon<span class="w"> </span>eggs<span class="w"> </span>spam
<span class="c1">## commandArgs:</span>
<span class="c1">## [1] &quot;spam&quot;  &quot;bacon&quot; &quot;eggs&quot;  &quot;spam&quot;</span>
<span class="c1">## All files exist.</span>
</pre></div>
</div>
</div></div><p><strong class="command">stdin</strong>, <strong class="command">stdout</strong>, and <strong class="command">stderr</strong>
represent the always-open connections mapped to
the standard input (“keyboard”), as well as the normal and error output.
They can be read from or written to using functions such as
<strong class="command">scan</strong> or <strong class="command">cat</strong>.</p>
<p>During run time, we can redirect
<strong class="command">stdout</strong> and <strong class="command">stderr</strong>
to different files or even strings using <strong class="command">sink</strong>.</p>
</section>
<section id="assuring-quality-code">
<span id="sec-code-quality"></span><h3><span class="section-number">9.2.4. </span>Assuring quality code<a class="headerlink" href="#assuring-quality-code" title="Link to this heading">¶</a></h3>
<p>Below we mention some good development practices related to maintaining
quality code. This is an important topic, but writing about them is tedious
to the same extent that reading about them is dull. It is the more <em>artistic</em>
part of software engineering as such heuristics are learnt best by observing
and mimicking what more skilled programmers are doing (the coming exercises
aim to make up for our not having them at hand at the moment).</p>
<section id="managing-changes-and-working-collaboratively">
<h4><span class="section-number">9.2.4.1. </span>Managing changes and working collaboratively<a class="headerlink" href="#managing-changes-and-working-collaboratively" title="Link to this heading">¶</a></h4>
<p>We recommend employing a source code version control system,
such as <strong class="program">git</strong>, to keep track of the changes made to the software.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is worth investing time and effort to learn how
to use <strong class="program">git</strong> from the command line;
see <a class="reference external" href="https://git-scm.com/doc">https://git-scm.com/doc</a>.</p>
</div>
<p>There are a few hosting providers for <strong class="program">git</strong> repositories,
with GitLab and GitHub being particularly popular among
open-source software developers.
They support working collaboratively on the projects
and are equipped with additional tools for reporting bugs,
suggesting feature requests, etc.</p>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.14</span>
        
    </div><div class="proof-content">
<p>Find source code of your favourite R packages or other projects.
Explore the corresponding repositories, feature trackers,
wikis, discussion boards, etc. Each community is different
and is governed by varied, sometimes contrasting guidelines;
after all, we come from all corners of the world.</p>
</div></div></section>
<section id="test-driven-development-and-continuous-integration">
<span id="sec-testing"></span><h4><span class="section-number">9.2.4.2. </span>Test-driven development and continuous integration<a class="headerlink" href="#test-driven-development-and-continuous-integration" title="Link to this heading">¶</a></h4>
<p>It is often hygienic to include some principles of
<em>test-driven development</em>.</p>
<div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.15</span>
        
    </div><div class="proof-content">
<p>Assume that, for some reason, we were asked to compose a function to compute
the root mean square (quadratic mean) of a given numeric vector.
Before implementing the actual routine, we need
to reflect upon what we want to achieve, especially how we
want our function to behave in certain boundary cases.</p>
<p><strong class="command">stopifnot</strong> gives simple means to ensure that a given
assertion is fulfilled. If that is the case, it will
move forward without fuss.</p>
<p>Say we have come up with the following set of <em>expectations</em>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="m">58.16786054171151931769</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)),</span><span class="w"> </span><span class="kc">pi</span><span class="p">))</span>
<span class="nf">stopifnot</span><span class="p">(</span><span class="nf">all.equal</span><span class="p">(</span><span class="nf">rms</span><span class="p">(</span><span class="nf">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">)),</span><span class="w"> </span><span class="m">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Write a function <strong class="command">rms</strong> that fulfils these assertions.</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.16</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">sample</strong> function
(assuming <code class="docutils literal notranslate"><span class="pre">replace=TRUE</span></code>), using calls to <strong class="command">runif</strong>.
Start by writing a few unit tests.</p>
</div></div><p>A couple of R packages support writing and executing unit tests,
including <strong class="program">testthat</strong>, <strong class="program">tinytest</strong>,
<strong class="program">RUnit</strong>, or <strong class="program">realtest</strong>.
However, in the most typical use cases, relying
on <strong class="command">stopifnot</strong> is powerful enough.</p>
<div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.17</span>
        
    </div><div class="proof-content">
<p>(*)
Consult the <em>Writing R Extensions</em> manual <span id="id8">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span>
about where and how to include unit tests
in your example package.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
R can check a couple of code quality areas: running
<code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span> <span class="pre">pkg_directory</span></code> from the command line (preferably using the most
recent version of the environment) will suggest several improvements.</p>
<p>Also, it is possible to use various continuous integration techniques
that are automatically triggered when pushing changes to our software
repositories; see GitLab CI or GitHub Actions.
For instance, we can run a package build, install,
and check process is possible on every <strong class="program">git</strong> commit.
Also, CRAN deploys continuous integration services, including
checking the package on various platforms.</p>
</div>
</section>
<section id="debugging">
<h4><span class="section-number">9.2.4.3. </span>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">¶</a></h4>
<p>For all his life, the current author has been debugging his programs
primarily by manually printing the state of the suspicious variables
(<strong class="command">printf</strong> and the like) in different code areas.
This is old-school but uncannily efficient.</p>
<p>R has an interactive debugger; see the <strong class="command">browser</strong> function
and Section 9 of <span id="id9">[<a class="reference internal" href="999-bibliography.html#id11" title="R Development Core Team. (2023).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">69</a>]</span> for more details.
Some IDEs (e.g., <strong class="program">RStudio</strong>) also support this feature; see
their corresponding documentation.</p>
</section>
<section id="profiling">
<h4><span class="section-number">9.2.4.4. </span>Profiling<a class="headerlink" href="#profiling" title="Link to this heading">¶</a></h4>
<p>Typically, a program spends relatively
long time executing only a small portion of code.
The <strong class="command">Rprof</strong> function can be a helpful tool to identify which chunks
might need a rewrite, for instance, using a compiled language
(<a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a>).</p>
<p>Please remember, though, that bottlenecks are
not only formed by using algorithms with high computational
complexity, but also data input and output (such as reading files from disk,
printing messages on the console, querying Web APIs, etc.).</p>
</section>
</section>
</section>
<section id="special-functions-syntactic-sugar">
<span id="sec-syntactic-sugar"></span><h2><span class="section-number">9.3. </span>Special functions: Syntactic sugar<a class="headerlink" href="#special-functions-syntactic-sugar" title="Link to this heading">¶</a></h2>
<p>Some functions, such as `<strong class="command">*</strong>`, are somewhat special.
They can be referred to using <em>infix</em> syntax which, for obvious reasons,
most of us accepted as the default one. However, we will later reveal,
amongst others, that “<code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">*</span> <span class="pre">9</span></code>” reduces to an ordinary function <em>call</em>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`*`</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">  </span><span class="c1"># a call to `*` with two arguments, equivalent to 5 * 9</span>
<span class="c1">## [1] 45</span>
</pre></div>
</div>
<section id="backticks">
<span id="sec-backtick"></span><h3><span class="section-number">9.3.1. </span>Backticks<a class="headerlink" href="#backticks" title="Link to this heading">¶</a></h3>
<p>In <a class="reference internal" href="120-numeric.html#sec-assign"><span class="std std-numref">Section 2.2</span></a>, we mentioned that
via `<strong class="command">&lt;-</strong>` we can assign <em>syntactically valid names</em>
to our objects. Most identifiers comprised
of letters, digits, dots, and underscores
can be used directly in R code.</p>
<p>Nevertheless, it is possible to label our objects however we like.
Not syntactically valid (nonstandard) identifiers just need to be
enclosed in backticks (back quotes, grave accents):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`42 a quite peculiar name :O`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">`b c`</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">`42`</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">`!`</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">`42 a quite peculiar name :O`</span><span class="p">))</span>
<span class="c1">##       a     b c      42       !</span>
<span class="c1">## 0.73106 0.88080 0.95257 0.98201</span>
</pre></div>
</div>
<p>Such names are less convenient but backticks allow us to refer to them
in <em>any</em> setting.</p>
</section>
<section id="dollar">
<span id="sec-dollar"></span><h3><span class="section-number">9.3.2. </span>Dollar, `<strong class="command">$</strong>` (*)<a class="headerlink" href="#dollar" title="Link to this heading">¶</a></h3>
<p>The dollar operator, `<strong class="command">$</strong>`, can be an alternative
accessor to a single element in a named list<a class="footnote-reference brackets" href="#footdollar" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.
If a <code class="docutils literal notranslate"><span class="pre">label</span></code> is a syntactically valid name, then <code class="docutils literal notranslate"><span class="pre">x$label</span></code>
does the same job as <code class="docutils literal notranslate"><span class="pre">x[[&quot;label&quot;]]</span></code> (saving five keystrokes:
such a burden!).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eggs</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">`eggs and spam`</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">best.spam.ever</span><span class="o">=</span><span class="s">&quot;d&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="o">$</span><span class="n">eggs</span>
<span class="c1">## [1] &quot;b&quot;</span>
<span class="n">x</span><span class="o">$</span><span class="n">best.spam.ever</span><span class="w">  </span><span class="c1"># recall that a dot has no special meaning in most contexts</span>
<span class="c1">## [1] &quot;d&quot;</span>
</pre></div>
</div>
<p>Nonstandard names must still be enclosed in backticks (or quotes):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">$</span><span class="n">`eggs and spam`</span><span class="w">  </span><span class="c1"># x[[&quot;eggs and spam&quot;]] is okay as usual</span>
<span class="c1">## [1] &quot;c&quot;</span>
</pre></div>
</div>
<p>We are minimalist by design here. Thence, we will avoid this
operator for it does not increase the expressive power of our
function repertoire. Also, it does not work on atomic vectors
nor matrices. Furthermore, it does not support names that are generated
programmatically:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">what</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="n">x</span><span class="o">$</span><span class="n">what</span><span class="w">  </span><span class="c1"># the same as x[[&quot;what&quot;]]; we do not want this</span>
<span class="c1">## NULL</span>
<span class="n">x</span><span class="p">[[</span><span class="n">what</span><span class="p">]]</span><span class="w">  </span><span class="c1"># works fine</span>
<span class="c1">## [1] &quot;a&quot;</span>
</pre></div>
</div>
<p>The support for the <em>partial matching</em> of element names has
been added to provide users working in interactive programming sessions
with some relief in the case where they find typing the whole
label daunting:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">$</span><span class="n">s</span>
<span class="c1">## Warning in x$s: partial match of &#39;s&#39; to &#39;spam&#39;</span>
<span class="c1">## [1] &quot;a&quot;</span>
</pre></div>
</div>
<p>Compare:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;s&quot;</span><span class="p">]]</span><span class="w">  </span><span class="c1"># no warning here...</span>
<span class="c1">## NULL</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">exact</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]]</span>
<span class="c1">## [1] &quot;a&quot;</span>
</pre></div>
</div>
<p>Partial matching is generally a rubbishy programming practice.
The result depends on the names of other items in <code class="docutils literal notranslate"><span class="pre">x</span></code>
(which might change later)
and can decrease code readability. The only reason why we obtained
a warning message was because this book enforces the
<strong class="command">options</strong><code class="code docutils literal notranslate"><span class="pre">(warnPartialMatchDollar=TRUE)</span></code> setting,
which, sadly, is not the default.</p>
<p>Note the behaviour on an ambiguous partial match:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">$</span><span class="n">egg</span><span class="w">  </span><span class="c1"># ambiguous resolution</span>
<span class="c1">## NULL</span>
</pre></div>
</div>
<p>as well as on an element assignment:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">$</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;e&quot;</span>
<span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## List of 5</span>
<span class="c1">##  $ spam          : chr &quot;a&quot;</span>
<span class="c1">##  $ eggs          : chr &quot;b&quot;</span>
<span class="c1">##  $ eggs and spam : chr &quot;c&quot;</span>
<span class="c1">##  $ best.spam.ever: chr &quot;d&quot;</span>
<span class="c1">##  $ s             : chr &quot;e&quot;</span>
</pre></div>
</div>
<p>It did not modify <code class="docutils literal notranslate"><span class="pre">spam</span></code> but added a new element, <code class="docutils literal notranslate"><span class="pre">s</span></code>.
Confusing? Just let’s not use the dollar operator and we will
have one less thing to worry about.</p>
</section>
<section id="curly-braces">
<h3><span class="section-number">9.3.3. </span>Curly braces,  `<strong class="command">{</strong>`<a class="headerlink" href="#curly-braces" title="Link to this heading">¶</a></h3>
<p>A block of statements grouped with curly braces,
`<strong class="command">{</strong>`, corresponds to a function call.
When we write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="m">3</span>
<span class="p">}</span>
<span class="c1">## [1] TRUE</span>
<span class="c1">## two</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p>The parser translates it to a call to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`{`</span><span class="p">(</span><span class="nf">print</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] TRUE</span>
<span class="c1">## two</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p>When it is executed, every argument to `<strong class="command">{</strong>`
is evaluated one by one. Then, the last value is returned
as the result of that call.</p>
</section>
<section id="if">
<h3><span class="section-number">9.3.4. </span>`<strong class="command">if</strong>`<a class="headerlink" href="#if" title="Link to this heading">¶</a></h3>
<p><strong class="command">if</strong> is a function too. As mentioned in <a class="reference internal" href="180-flow.html#sec-if"><span class="std std-numref">Section 8.1</span></a>,
it returns the value corresponding to the expression
that is evaluated conditionally. Hence, we may write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="s">&quot;tail&quot;</span>
<span class="c1">## [1] &quot;head&quot;</span>
</pre></div>
</div>
<p>but also:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`if`</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tail&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;head&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A call like `<strong class="command">if</strong>`<code class="code docutils literal notranslate"><span class="pre">(test,</span> <span class="pre">what_if_true,</span> <span class="pre">what_if_false)</span></code>
can only work correctly because of the lazy evaluation of function arguments;
see <a class="reference internal" href="340-lazy.html#chap-lazy"><span class="std std-numref">Chapter 17</span></a>.</p>
</div>
<p>On a side note, <strong class="command">while</strong>, <strong class="command">for</strong>, <strong class="command">repeat</strong>
can also be called that way, but they return
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>.</p>
</section>
<section id="operators-are-functions">
<span id="sec-operfun"></span><h3><span class="section-number">9.3.5. </span>Operators are functions<a class="headerlink" href="#operators-are-functions" title="Link to this heading">¶</a></h3>
<section id="calling-built-in-operators-as-functions">
<h4><span class="section-number">9.3.5.1. </span>Calling built-in operators as functions<a class="headerlink" href="#calling-built-in-operators-as-functions" title="Link to this heading">¶</a></h4>
<p>Every arithmetic, logical, and relational operator
is translated to a call to the corresponding function.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`&lt;`</span><span class="p">(</span><span class="nf">`+`</span><span class="p">(</span><span class="nf">`*`</span><span class="p">(</span><span class="nf">`-`</span><span class="p">(</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)),</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">  </span><span class="c1"># 2+(-3)*4 &lt; 5</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
<p>Also, <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> is equivalent to `<strong class="command">[</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">i)</span></code>
and <code class="docutils literal notranslate"><span class="pre">x[[i]]</span></code> maps to `<strong class="command">[[</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">i)</span></code>.</p>
<p>Knowing this will not only enable us to manipulate unevaluated R
code (<a class="reference internal" href="320-language.html#chap-language"><span class="std std-numref">Chapter 15</span></a>) or access the corresponding manual pages
(see, e.g., <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;[&quot;)</span></code>), but also verbalise certain operations more concisely.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="o">:</span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">)</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">`[`</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">  </span><span class="c1"># 1 is a further argument passed to `[`</span>
<span class="c1">## [1]  1 11 21</span>
</pre></div>
</div>
<p>is equivalent to a call to
<strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">(e)</span> <span class="pre">e[1],</span> <span class="pre">x)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unsurprisingly, the assignment operator, `<strong class="command">&lt;-</strong>`, is also
a function. It returns the assigned value invisibly.</p>
<p>`<strong class="command">&lt;-</strong>` binds right to left (compare <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Syntax&quot;)</span></code>).
Thus, the expression “<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;-</span> <span class="pre">b</span> <span class="pre">&lt;-</span> <span class="pre">1</span></code>” assigns 1 to both <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code>.
It is equivalent to
`<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> </code>`<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;b&quot;,</span> <span class="pre">1))</span></code>
and `<strong class="command">&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(&quot;b&quot;,</span> <span class="pre">1)</span></code> returns 1.</p>
<p>Owing to the pass-by-value-like semantics (<a class="reference internal" href="#sec-pass-by-value"><span class="std std-numref">Section 9.4.1</span></a>),
we can also expect that we will be
assigning a <em>copy</em> of the value on the right side of the operator
(with the exception of environments; <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">6</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w">  </span><span class="c1"># makes a copy (but delayed, on demand, for performance reasons)</span>
<span class="n">y</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA_real_</span><span class="w">  </span><span class="c1"># modify every second element</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## [1] NA  2 NA  4 NA  6</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># state of x has not changed; x and y are different objects</span>
<span class="c1">## [1] 1 2 3 4 5 6</span>
</pre></div>
</div>
<p>This is especially worth pointing out to Python (amongst others)
programmers, where the preceding assignment would mean that <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
both refer to the same (shared) object in the computer’s memory.</p>
<p>However, with no harm done to semantics, copying <code class="docutils literal notranslate"><span class="pre">x</span></code>
is postponed until absolutely necessary (<a class="reference internal" href="330-environment.html#sec-copy-on-demand"><span class="std std-numref">Section 16.1.4</span></a>).
This is efficient both time- and memory-wisely.</p>
</div>
</section>
<section id="defining-binary-operators">
<h4><span class="section-number">9.3.5.2. </span>Defining binary operators<a class="headerlink" href="#defining-binary-operators" title="Link to this heading">¶</a></h4>
<p>We can also introduce custom binary operators
named like `<strong class="command">%myopname%</strong>`:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`%:)%`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="o">+</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
<span class="m">5</span><span class="w"> </span><span class="o">%:)%</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span>
<span class="c1">##  [1] 3.0 3.5 4.0 4.5 5.0 5.5 6.0 6.5 7.0 7.5</span>
</pre></div>
</div>
<p>Recall that `<strong class="command">%%</strong>`, `<strong class="command">%/%</strong>`, and `<strong class="command">%in%</strong>`
are built-in operators denoting division remainder, integer division,
and testing for set inclusion.
Also, in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>, we will learn
about `<strong class="command">%*%</strong>`, which implements matrix multiplication.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="220-s3.html#chap-s3"><span class="std std-numref">Chapter 10</span></a> notes that most existing operators
can be overloaded for objects of custom types.</p>
</div>
</section>
</section>
<section id="replacement-functions">
<span id="sec-replacementfun"></span><h3><span class="section-number">9.3.6. </span>Replacement functions<a class="headerlink" href="#replacement-functions" title="Link to this heading">¶</a></h3>
<p>Functions generally do not change the state
of their arguments. However, there is some syntactic sugar
that permits us to replace objects or their parts with new content.
We call them <em>replacement functions</em>.</p>
<p>For instance, three of the following calls <em>replace</em>
the input <code class="docutils literal notranslate"><span class="pre">x</span></code> with its modified version:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="w">  </span><span class="c1"># example input</span>
<span class="n">x</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># replace the third element with 0</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">7</span><span class="w">  </span><span class="c1"># &quot;replace&quot; length</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="w">  </span><span class="c1"># replace the names attribute</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># `x` is now different</span>
<span class="c1">##  A  B  C  D  E  F  G</span>
<span class="c1">##  1  2  0  4  5 NA NA</span>
</pre></div>
</div>
<section id="creating-replacement-functions">
<h4><span class="section-number">9.3.6.1. </span>Creating replacement functions<a class="headerlink" href="#creating-replacement-functions" title="Link to this heading">¶</a></h4>
<p>A <em>replacement function</em> is a mapping named like `<strong class="command">f&lt;-</strong>` with
at least two parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> (the object to be modified),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">...</span></code> (possible further arguments),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> (as the last parameter;
the object on the right-hand side of the `<strong class="command">&lt;-</strong>` operator).</p></li>
</ul>
<p>We will most often interact with <em>existing</em> replacement functions,
not create our own ones. But knowing how to do the latter is vital to
understanding this language feature.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`add&lt;-`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">x</span><span class="p">[</span><span class="n">where</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">where</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span>
<span class="w">    </span><span class="n">x</span><span class="w">  </span><span class="c1"># the modified object that will replace the original one</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function aims to add a <code class="docutils literal notranslate"><span class="pre">value</span></code> to a subset of the input vector <code class="docutils literal notranslate"><span class="pre">x</span></code>
(by default, to each element therein).
Then, it returns its altered version.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="w">           </span><span class="c1"># example vector</span>
<span class="nf">add</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">       </span><span class="c1"># calls y &lt;- `add&lt;-`(y, value=10)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">           </span><span class="c1"># y has changed</span>
<span class="c1">## [1] 11 12 13 14 15</span>
<span class="nf">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1"># calls y &lt;- `add&lt;-`(y, 3, value=1000)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">           </span><span class="c1"># y has changed again</span>
<span class="c1">## [1]   11   12 1013   14   15</span>
</pre></div>
</div>
<p>Thus, invoking “<strong class="command">add</strong><code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">w)</span> <span class="pre">&lt;-</span> <span class="pre">v</span></code>”
is equivalent to
“<code class="code docutils literal notranslate"><span class="pre">y</span> <span class="pre">&lt;-</span> </code>`<strong class="command">add&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">w,</span> <span class="pre">value=v)</span></code>”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
According to <span id="id11">[<a class="reference internal" href="999-bibliography.html#id11" title="R Development Core Team. (2023).  R Language Definition. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-lang.html.">69</a>]</span>,
a call “<strong class="command">add</strong><code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">3)</span> <span class="pre">&lt;-</span> <span class="pre">1000</span></code>” is a syntactic
sugar precisely for:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`*tmp*`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="w">  </span><span class="c1"># temporary substitution</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`add&lt;-`</span><span class="p">(</span><span class="n">`*tmp*`</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="s">&quot;*tmp*&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># remove the named object from the current scope</span>
</pre></div>
</div>
<p>This has at least two implications.
First, in the unlikely event that a variable `<code class="code docutils literal notranslate"><span class="pre">*tmp*</span></code>` existed before
the call to the replacement function, it will be no more,
it will cease to be. It will be an ex-variable.
Second, the temporary substitution guarantees that <code class="docutils literal notranslate"><span class="pre">y</span></code> must exist
before the call (due to lazy evaluation, a function’s body does not have
to refer to all the arguments passed).</p>
</div>
</section>
<section id="substituting-parts-of-vectors">
<h4><span class="section-number">9.3.6.2. </span>Substituting parts of vectors<a class="headerlink" href="#substituting-parts-of-vectors" title="Link to this heading">¶</a></h4>
<p>The replacement versions of the index-like operators
are named as follows:</p>
<ul class="simple">
<li><p>`<strong class="command">[&lt;-</strong>` is used in substitutions like “<code class="docutils literal notranslate"><span class="pre">x[i]</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>”,</p></li>
<li><p>`<strong class="command">[[&lt;-</strong>` is called when we perform “<code class="docutils literal notranslate"><span class="pre">x[[i]]</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>”,</p></li>
<li><p>`<strong class="command">$&lt;-</strong>` is used whilst calling “<code class="docutils literal notranslate"><span class="pre">x$i</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code>”.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">)</span><span class="w">  </span><span class="c1"># returns a new object</span>
<span class="c1">## [1]  1  2 NA  4 NA</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># does not change the original input</span>
<span class="c1">## [1] 1 2 3 4 5</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.18</span>
        
    </div><div class="proof-content">
<p>Write a function `<strong class="command">extend&lt;-</strong>`, which pushes new elements
at the end of a given vector, modifying it in place.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`extend&lt;-`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
</pre></div>
</div>
<p>Example use:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">     </span><span class="c1"># push 2 at the back</span>
<span class="nf">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">10</span><span class="w">  </span><span class="c1"># add 3, 4, ..., 10</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##  [1]  1  2  3  4  5  6  7  8  9 10</span>
</pre></div>
</div>
</div></div></section>
<section id="replacing-attributes">
<h4><span class="section-number">9.3.6.3. </span>Replacing attributes<a class="headerlink" href="#replacing-attributes" title="Link to this heading">¶</a></h4>
<p>There are many replacement functions to reset object
attributes (<a class="reference internal" href="140-list.html#sec-attribute"><span class="std std-numref">Section 4.4</span></a>).
In particular, each special attribute has its replacement procedure,
e.g., `<strong class="command">names&lt;-</strong>`,
`<strong class="command">class&lt;-</strong>`,
`<strong class="command">dim&lt;-</strong>`,
`<strong class="command">levels&lt;-</strong>`,
etc.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># change the `names` attribute</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># x has been altered</span>
<span class="c1">## a b c</span>
<span class="c1">## 1 2 3</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Individual (arbitrary, including non-special ones) attributes can be
set using `<strong class="command">attr&lt;-</strong>`, and all of them can be established
via a single call to `<strong class="command">attributes&lt;-</strong>`.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s">&quot;oval&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">smell</span><span class="o">=</span><span class="s">&quot;meaty&quot;</span><span class="p">)</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">taste</span><span class="o">=</span><span class="s">&quot;umami&quot;</span><span class="p">)</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;colour&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;rose&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;shape&quot;)</span>
<span class="c1">## [1] &quot;oval&quot;</span>
<span class="c1">## attr(,&quot;smell&quot;)</span>
<span class="c1">## [1] &quot;meaty&quot;</span>
<span class="c1">## attr(,&quot;taste&quot;)</span>
<span class="c1">## [1] &quot;umami&quot;</span>
<span class="c1">## attr(,&quot;colour&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
</pre></div>
</div>
<p>Also, setting an attribute to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> results, by convention,
in its removal:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;taste&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">  </span><span class="c1"># it is tasteless now</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;shape&quot;)</span>
<span class="c1">## [1] &quot;oval&quot;</span>
<span class="c1">## attr(,&quot;smell&quot;)</span>
<span class="c1">## [1] &quot;meaty&quot;</span>
<span class="c1">## attr(,&quot;colour&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
<span class="nf">attributes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">  </span><span class="c1"># remove all</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;</span>
</pre></div>
</div>
<p>Which can be worthwhile in contexts such as:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">some_attrib</span><span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">)</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`attributes&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> is a version of <code class="docutils literal notranslate"><span class="pre">x</span></code> with metadata removed.
The latter remains unchanged.</p>
</section>
<section id="compositions-of-replacement-functions">
<h4><span class="section-number">9.3.6.4. </span>Compositions of replacement functions (*)<a class="headerlink" href="#compositions-of-replacement-functions" title="Link to this heading">¶</a></h4>
<p>Updating only selected names like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##    a spam    c</span>
<span class="c1">##    1    2    3</span>
</pre></div>
</div>
<p>is possible due to the fact
that “<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(x)[i]</span> <span class="pre">&lt;-</span> <span class="pre">v</span></code>”
is equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">old_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">new_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`[&lt;-`</span><span class="p">(</span><span class="n">old_names</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">`names&lt;-`</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">new_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>More generally, a composition of replacement
calls  “<strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b)</span> <span class="pre">&lt;-</span> <span class="pre">y</span></code>”
yields a result equivalent to
“<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> </code>`<strong class="command">f&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a,</span> <span class="pre">value=</span></code>`<strong class="command">g&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b,</span> <span class="pre">value=y))</span></code>”.
Both <strong class="command">f</strong> and `<strong class="command">f&lt;-</strong>` need to be defined,
but having <strong class="command">g</strong> is not necessary.</p>
</div>
<div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.19</span>
        
    </div><div class="proof-content">
<p>(*) What is
“<strong class="command">h</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a),</span> <span class="pre">b),</span> <span class="pre">c)</span> <span class="pre">&lt;-</span> <span class="pre">y</span></code>”
equivalent to?</p>
</div></div><div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.20</span>
        
    </div><div class="proof-content">
<p>Write a (convenient!) function `<strong class="command">recode&lt;-</strong>` which
replaces specific elements in a character vector with other ones,
allowing the following interface:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">`recode&lt;-`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">)</span>
<span class="nf">recode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">eggs</span><span class="o">=</span><span class="s">&quot;best spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bacon</span><span class="o">=</span><span class="s">&quot;yummy spam&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;spam&quot;       &quot;yummy spam&quot; &quot;best spam&quot;  &quot;spam&quot;       &quot;best spam&quot;</span>
</pre></div>
</div>
<p>We see that the named character vector gives a few <code class="docutils literal notranslate"><span class="pre">from=&quot;to&quot;</span></code> pairs,
e.g., all <code class="docutils literal notranslate"><span class="pre">eggs</span></code> are to be replaced by <code class="docutils literal notranslate"><span class="pre">best</span> <span class="pre">spam</span></code>.
Determine which calls are equivalent to the following:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># or equivalently = ... ?</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## a y z</span>
<span class="c1">## 1 2 3</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cauliflower&quot;</span><span class="p">))</span>
<span class="nf">recode</span><span class="p">(</span><span class="n">y</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">cauliflower</span><span class="o">=</span><span class="s">&quot;broccoli&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># or = ... ?</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] &quot;spam&quot;  &quot;bacon&quot; &quot;spam&quot;</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] &quot;spam&quot;     &quot;eggs&quot;     &quot;broccoli&quot;</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.21</span>
        
    </div><div class="proof-content">
<p>(*) Consider the  `<strong class="command">recode&lt;-</strong>` function from the
previous exercise.</p>
<p>Here is an example matrix with the <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>
attribute whose <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute is set (more
details in <a class="reference internal" href="230-matrix.html#chap-matrix"><span class="std std-numref">Chapter 11</span></a>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Titanic</span><span class="p">[</span><span class="s">&quot;Crew&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adult&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">])</span>
<span class="c1">##         Survived</span>
<span class="c1">## Sex       No Yes</span>
<span class="c1">##   Male   670 192</span>
<span class="c1">##   Female   3  20</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Sex</span><span class="o">=</span><span class="s">&quot;sex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Survived</span><span class="o">=</span><span class="s">&quot;survived&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##         survived</span>
<span class="c1">## sex       No Yes</span>
<span class="c1">##   Male   670 192</span>
<span class="c1">##   Female   3  20</span>
</pre></div>
</div>
<p>This changes the <code class="docutils literal notranslate"><span class="pre">x</span></code> object. For each of the following subtasks,
compose a single call that alters
<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>
without modifying <code class="docutils literal notranslate"><span class="pre">x</span></code> in place but returning
a recoded copy of:</p>
<ul class="simple">
<li><p><strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>,</p></li>
<li><p><strong class="command">dimnames</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.22</span>
        
    </div><div class="proof-content">
<p>(*) Consider the  `<strong class="command">recode&lt;-</strong>` function again
but now let an example object be a data frame with
a column of the <code class="docutils literal notranslate"><span class="pre">factor</span></code> class:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="p">]</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]]))</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="w">    </span><span class="n">setosa</span><span class="o">=</span><span class="s">&quot;SET&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">versicolor</span><span class="o">=</span><span class="s">&quot;VER&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">virginica</span><span class="o">=</span><span class="s">&quot;VIR&quot;</span>
<span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##     Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="c1">## 1            5.1         3.5          1.4         0.2     SET</span>
<span class="c1">## 2            4.9         3.0          1.4         0.2     SET</span>
<span class="c1">## 51           7.0         3.2          4.7         1.4     VER</span>
<span class="c1">## 101          6.3         3.3          6.0         2.5     VIR</span>
</pre></div>
</div>
<p>How to change <strong class="command">levels</strong><code class="code docutils literal notranslate"><span class="pre">(x[[&quot;Species&quot;]])</span></code> and return
an altered copy of:</p>
<ul class="simple">
<li><p><strong class="command">levels</strong><code class="code docutils literal notranslate"><span class="pre">(x[[&quot;Species&quot;]])</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[[&quot;Species&quot;]]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
</ul>
<p>without modifying <code class="docutils literal notranslate"><span class="pre">x</span></code> in place?</p>
</div></div></section>
</section>
</section>
<section id="arguments-and-local-variables">
<h2><span class="section-number">9.4. </span>Arguments and local variables<a class="headerlink" href="#arguments-and-local-variables" title="Link to this heading">¶</a></h2>
<section id="call-by-value">
<span id="sec-pass-by-value"></span><h3><span class="section-number">9.4.1. </span>Call by “value”<a class="headerlink" href="#call-by-value" title="Link to this heading">¶</a></h3>
<p>As a general rule, functions cannot change the state of their
arguments<a class="footnote-reference brackets" href="#footchgenvir" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>. We can think of them as being passed
by <em>value</em>, i.e., as if their copy was made.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">7</span>
<span class="w">    </span><span class="n">y</span>
<span class="p">}</span>

<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">test_change</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 7 2 3 4 5</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># same</span>
<span class="c1">## [1] 1 2 3 4 5</span>
</pre></div>
</div>
<p>If the preceding statement was not true, the state of <code class="docutils literal notranslate"><span class="pre">x</span></code> would change
after the call.</p>
</section>
<section id="variable-scope">
<h3><span class="section-number">9.4.2. </span>Variable scope<a class="headerlink" href="#variable-scope" title="Link to this heading">¶</a></h3>
<p>Function arguments and any other variables we create
inside a function’s body are <em>relative</em> to each call to that function.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="m">+1</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="n">x</span>
<span class="w">    </span><span class="n">z</span>
<span class="p">}</span>

<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">test_change</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="m">10</span><span class="p">)</span>
<span class="c1">## [1] -11 -21 -31 -41 -51</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># x in the function&#39;s body was a different x</span>
<span class="c1">## [1] 1 2 3 4 5</span>
<span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># z was local</span>
<span class="c1">## Error in eval(expr, envir, enclos): object &#39;z&#39; not found</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code> are local variables. They only live whilst our function
is being executed.
The former temporarily <em>masks</em><a class="footnote-reference brackets" href="#footshadow" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> the object
of the same name from the caller’s context.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is a good development practice to refrain from referring to objects
not created within the current function, especially to “global” variables.
We can always pass an object as an argument explicitly.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is a function call as such, not curly braces per se
that form a local scope.
When we run “<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">&lt;-</span> <span class="pre">1;</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">}</span></code>”, <code class="docutils literal notranslate"><span class="pre">y</span></code> is not an temporary variable.
It is an ordinary named object created alongside <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>On the other hand, in
“<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">(</span></code><strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">()</span> <span class="pre">{</span> <span class="pre">z</span> <span class="pre">&lt;-</span> <span class="pre">1;</span> <span class="pre">z</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">})()</span></code>”,
<code class="docutils literal notranslate"><span class="pre">z</span></code> will not be available thereafter.</p>
</div>
</section>
<section id="closures">
<span id="sec-closures"></span><h3><span class="section-number">9.4.3. </span>Closures (*)<a class="headerlink" href="#closures" title="Link to this heading">¶</a></h3>
<p>Most user-defined functions are, in fact, instances
of the so-called <em>closures</em>; see <a class="reference internal" href="330-environment.html#sec-lexical-scope"><span class="std std-numref">Section 16.3.2</span></a> and <span id="id14">[<a class="reference internal" href="999-bibliography.html#id16" title="Abelson, H., Sussman, G.J., and Sussman, J. (1996).  Structure and Interpretation of Computer Programs. MIT Press.">1</a>]</span>.
They not only consist of an R expression to evaluate
but also can carry auxiliary data.</p>
<p>For instance, given two numeric vectors <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> of the same length,
a call to <strong class="command">approxfun</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code> returns
a <em>function</em> that linearly interpolates between the
consecutive points <span class="math">\((x_1, y_1)\)</span>, <span class="math">\((x_2, y_2)\)</span>, etc., so that
a corresponding <span class="math">\(y\)</span> can be determined for any <span class="math">\(x\)</span>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="o">=</span><span class="m">11</span><span class="p">)</span>
<span class="n">f1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">approxfun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">f2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">approxfun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="m">3</span><span class="p">)</span>
<span class="nf">f1</span><span class="p">(</span><span class="m">0.75</span><span class="p">)</span><span class="w">  </span><span class="c1"># check that it is close to the true 0.75^2</span>
<span class="c1">## [1] 0.565</span>
<span class="nf">f2</span><span class="p">(</span><span class="m">0.75</span><span class="p">)</span><span class="w">  </span><span class="c1"># compare with 0.75^3</span>
<span class="c1">## [1] 0.4275</span>
</pre></div>
</div>
<p>Let’s inspect the source code of the above functions:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
<span class="c1">## function (v)</span>
<span class="c1">## .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span>
<span class="c1">## &lt;environment: 0x55ac138c37f8&gt;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
<span class="c1">## function (v)</span>
<span class="c1">## .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span>
<span class="c1">## &lt;environment: 0x55ac13bca680&gt;</span>
</pre></div>
</div>
<p>We might wonder how they can produce different results.
It is evident that they are identical.
It turns out, however, that they internally store additional
data that are referred to when they are called:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">environment</span><span class="p">(</span><span class="n">f1</span><span class="p">)[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span>
<span class="c1">##  [1] 0.00 0.01 0.04 0.09 0.16 0.25 0.36 0.49 0.64 0.81 1.00</span>
<span class="nf">environment</span><span class="p">(</span><span class="n">f2</span><span class="p">)[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span>
<span class="c1">##  [1] 0.000 0.001 0.008 0.027 0.064 0.125 0.216 0.343 0.512 0.729 1.000</span>
</pre></div>
</div>
<p>We will explore these concepts in detail in the third part of this book.</p>
</section>
<section id="default-arguments">
<span id="sec-default-args"></span><h3><span class="section-number">9.4.4. </span>Default arguments<a class="headerlink" href="#default-arguments" title="Link to this heading">¶</a></h3>
<p>We often need to find a sweet spot between being generous, mindful
of the diverse needs of our users, and making the API neither
overwhelming nor oversimplistic. We have established that it is best if
a function performs a single, well-specified task. However, we are always
delighted when it also lets us tweak its behaviour should we wish to do so.
The use of <em>default arguments</em> can facilitate this principle.</p>
<p>For instance, <strong class="command">log</strong> computes logarithms,
by default, the natural ones.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">log</span><span class="p">(</span><span class="m">2.718</span><span class="p">)</span><span class="w">  </span><span class="c1"># the same as log(2.718, base=exp(1)), i.e., default base, e</span>
<span class="c1">## [1] 0.9999</span>
<span class="nf">log</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1"># different base</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.23</span>
        
    </div><div class="proof-content">
<p>Study the documentation of the following functions and note
the default values they define:
<strong class="command">round</strong>, <strong class="command">hist</strong>,
<strong class="command">grep</strong>, and
<strong class="command">download.file</strong>.</p>
</div></div><p>Let’s create a function equipped with such <em>recommended</em> settings:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_default</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="n">x</span>

<span class="nf">test_default</span><span class="p">()</span><span class="w">   </span><span class="c1"># use default</span>
<span class="c1">## [1] 1</span>
<span class="nf">test_default</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1"># use something else</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<p>Most often, default arguments are just constants, e.g., <code class="docutils literal notranslate"><span class="pre">1</span></code>.
Generally, though, they can be any R expressions,
also ones that include a reference to other arguments
passed to the same function; see <a class="reference internal" href="340-lazy.html#sec-default-args-eval"><span class="std std-numref">Section 17.2</span></a>.</p>
<p>Default arguments usually appear at the end of the parameter list,
but see <a class="reference internal" href="#sec-replacementfun"><span class="std std-numref">Section 9.3.6</span></a> (on replacement functions)
for a well-justified exception.</p>
</section>
<section id="lazy-vs-eager-evaluation">
<span id="sec-lazy-eval-intro"></span><h3><span class="section-number">9.4.5. </span>Lazy vs eager evaluation<a class="headerlink" href="#lazy-vs-eager-evaluation" title="Link to this heading">¶</a></h3>
<p>In some languages, function arguments are always evaluated
prior to a call. In R, though, they are only computed when actually needed.
We call it <em>lazy</em> or <em>delayed</em> evaluation.
Recall that in <a class="reference internal" href="180-flow.html#sec-short-circuit-ops"><span class="std std-numref">Section 8.1.4</span></a>, we introduced
the short-circuit evaluation operators `<strong class="command">||</strong>` (or) and
`<strong class="command">&amp;&amp;</strong>` (and). They can do their job precisely
thanks to this mechanism.</p>
<div class="proof proof-type-example" id="id41">

    <div class="proof-title">
        <span class="proof-type">Example 9.24</span>
        
    </div><div class="proof-content">
<p>In the following example, we do not use the function’s argument at all:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_test1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># x is not used</span>

<span class="nf">lazy_test1</span><span class="p">({</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;and now for something completely different!&quot;</span><span class="p">);</span><span class="w"> </span><span class="m">7</span><span class="p">})</span>
<span class="c1">## [1] 1</span>
</pre></div>
</div>
<p>Otherwise, we would see a message being printed out on the console.</p>
</div></div><div class="proof proof-type-example" id="id42">

    <div class="proof-title">
        <span class="proof-type">Example 9.25</span>
        
    </div><div class="proof-content">
<p>Next, let’s use <code class="docutils literal notranslate"><span class="pre">x</span></code> amidst other expressions in a function’s body:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_test2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;it&#39;s... &quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="w">  </span><span class="c1"># using x twice</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot; a man with two noses&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">y</span>
<span class="p">}</span>

<span class="nf">lazy_test2</span><span class="p">({</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;and now for something completely different!&quot;</span><span class="p">);</span><span class="w"> </span><span class="m">7</span><span class="p">})</span>
<span class="c1">## it&#39;s... and now for something completely different! a man with two noses</span>
<span class="c1">## [1] 14</span>
</pre></div>
</div>
<p>An argument is evaluated once, and its value is stored
for further reference. If that was not the case,
we would see two messages like “<code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">now...</span></code>”.</p>
</div></div><p>We will elaborate on this in <a class="reference internal" href="340-lazy.html#chap-lazy"><span class="std std-numref">Chapter 17</span></a>.</p>
</section>
<section id="ellipsis">
<span id="sec-ellipsis"></span><h3><span class="section-number">9.4.6. </span>Ellipsis, `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`<a class="headerlink" href="#ellipsis" title="Link to this heading">¶</a></h3>
<p>We will start with an exercise.</p>
<div class="proof proof-type-exercise" id="id43">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.26</span>
        
    </div><div class="proof-content">
<p>Notice the presence of `<code class="code docutils literal notranslate"><span class="pre">...</span></code>` in the parameter list of
<strong class="command">c</strong>,
<strong class="command">list</strong>,
<strong class="command">structure</strong>,
<strong class="command">cbind</strong>,
<strong class="command">rbind</strong>,
<strong class="command">cat</strong>,
<strong class="command">Map</strong> (and the underlying <strong class="command">mapply</strong>),
<strong class="command">lapply</strong> (a specialised version of  <strong class="command">Map</strong>),
<strong class="command">optimise</strong>,
<strong class="command">optim</strong>,
<strong class="command">uniroot</strong>,
<strong class="command">integrate</strong>,
<strong class="command">outer</strong>,
<strong class="command">aggregate</strong>.
What purpose does it serve, according to these functions’ documentation
pages?</p>
</div></div><p>We can create a <em>variadic function</em> by including
`<code class="code docutils literal notranslate"><span class="pre">...</span></code>` (dot-dot-dot, ellipsis; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;dots&quot;)</span></code>)
somewhere in its parameter list.
The ellipsis serves as a placeholder for all objects passed to the function
but not matched by any formal (named) parameters.</p>
<p>The easiest way to process arguments passed via `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`
programmatically (see also <a class="reference internal" href="340-lazy.html#sec-ellipsis-eval"><span class="std std-numref">Section 17.3</span></a>)
is by redirecting them to <strong class="command">list</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_dots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>

<span class="nf">test_dots</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1</span>
<span class="c1">##</span>
<span class="c1">## $a</span>
<span class="c1">## [1] 2</span>
</pre></div>
</div>
<p>Such a list can be processed just like… any other generic vector.
What we can do with these arguments is only limited by our creativity
(in particular, recall from <a class="reference internal" href="170-function.html#sec-do-call-intro"><span class="std std-numref">Section 7.2.2</span></a>
the very powerful <strong class="command">do.call</strong> function).
There are two primary use cases of the ellipsis<a class="footnote-reference brackets" href="#footpykwargs" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>:</p>
<ul>
<li><p>create a new object by combining an arbitrary number of other objects:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">   </span><span class="c1"># three arguments</span>
<span></span><span class="c1">## [1] 1 2 3</span>
<span></span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">7</span><span class="p">)</span><span class="w">  </span><span class="c1"># two arguments</span>
<span></span><span class="c1">## [1] 1 2 3 4 5 6 7</span>
<span></span><span class="nf">structure</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># no additional arguments</span>
<span></span><span class="c1">## [1] &quot;spam&quot;</span>
<span></span><span class="nf">structure</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;rose&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">taste</span><span class="o">=</span><span class="s">&quot;umami&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># two further arguments</span>
<span></span><span class="c1">## [1] &quot;spam&quot;</span>
<span class="c1">## attr(,&quot;color&quot;)</span>
<span class="c1">## [1] &quot;rose&quot;</span>
<span class="c1">## attr(,&quot;taste&quot;)</span>
<span class="c1">## [1] &quot;umami&quot;</span>
<span></span><span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="w">  </span><span class="c1"># two</span>
<span></span><span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    3</span>
<span class="c1">## [2,]    2    4</span>
<span></span><span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="o">:</span><span class="m">8</span><span class="p">)</span><span class="w">  </span><span class="c1"># four</span>
<span></span><span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    3    5    7</span>
<span class="c1">## [2,]    2    4    6    8</span>
<span></span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">)</span><span class="w">  </span><span class="c1"># twelve</span>
<span></span><span class="c1">## [1] 108</span>
</pre></div>
</div>
</li>
<li><p>pass further arguments (as-is) to other methods:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">lapply</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="o">:</span><span class="m">9</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1"># mean(x, na.rm=TRUE)</span>
<span></span><span class="c1">## [[1]]</span>
<span class="c1">## [1] 2</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 6.5</span>
<span></span><span class="nf">integrate</span><span class="p">(</span><span class="n">dbeta</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">shape1</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="n">shape2</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">  </span><span class="c1"># dbeta(x, shape1=2.5, shape2=0.5)</span>
<span></span><span class="c1">## 1 with absolute error &lt; 1.2e-05</span>
</pre></div>
</div>
</li>
</ul>
<div class="proof proof-type-example" id="id44">

    <div class="proof-title">
        <span class="proof-type">Example 9.27</span>
        
    </div><div class="proof-content">
<p>The documentation of <strong class="command">lapply</strong> states that this function is defined
like <strong class="command">lapply</strong><code class="code docutils literal notranslate"><span class="pre">(X,</span> <span class="pre">FUN,</span> <span class="pre">...)</span></code>.
Here, the ellipsis is a placeholder for a number of optional arguments
that can be passed to <strong class="command">FUN</strong>.
Hence, if we denote the <span class="math">\(i\)</span>-th element of a vector <code class="docutils literal notranslate"><span class="pre">X</span></code> by
<code class="docutils literal notranslate"><span class="pre">X[[i]]</span></code>, calling <strong class="command">lapply</strong><code class="code docutils literal notranslate"><span class="pre">(X,</span> <span class="pre">FUN,</span> <span class="pre">...)</span></code>
will return a list whose <span class="math">\(i\)</span>-th element will be equal to
<strong class="command">FUN</strong><code class="code docutils literal notranslate"><span class="pre">(X[[i]],</span> <span class="pre">...)</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id45">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.28</span>
        
    </div><div class="proof-content">
<p>Using a single call to <strong class="command">lapply</strong>, generate
a list with three numeric vectors of lengths 3, 9, and 7, respectively,
drawn from the uniform distribution on the unit interval.
Then, upgrade your code to get numbers sampled from the interval <span class="math">\([-1, 1]\)</span>.</p>
</div></div><div class="proof proof-type-example" id="id46">

    <div class="proof-title">
        <span class="proof-type">Example 9.29</span>
        
    </div><div class="proof-content">
<p><a class="reference internal" href="140-list.html#chap-list"><span class="std std-numref">Chapter 4</span></a> mentioned that concatenating a mix of lists
and atomic vectors with <strong class="command">c</strong>, unfortunately, unrolls the latter:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="o">=</span><span class="m">7</span><span class="o">:</span><span class="m">8</span><span class="p">))</span>
<span class="c1">## List of 5</span>
<span class="c1">##  $ u  : int [1:2] 1 2</span>
<span class="c1">##  $ v.a: int [1:2] 3 4</span>
<span class="c1">##  $ v.b: int [1:2] 5 6</span>
<span class="c1">##  $ w1 : int 7</span>
<span class="c1">##  $ w2 : int 8</span>
</pre></div>
</div>
<p>Let’s implement a fix:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">as.list2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="nf">is.list</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">clist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="kc">...</span><span class="p">),</span><span class="w"> </span><span class="n">as.list2</span><span class="p">))</span>
<span class="nf">str</span><span class="p">(</span><span class="nf">clist</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="o">=</span><span class="m">7</span><span class="o">:</span><span class="m">8</span><span class="p">))</span>
<span class="c1">## List of 4</span>
<span class="c1">##  $ u  : int [1:2] 1 2</span>
<span class="c1">##  $ v.a: int [1:2] 3 4</span>
<span class="c1">##  $ v.b: int [1:2] 5 6</span>
<span class="c1">##  $ w  : int [1:2] 7 8</span>
</pre></div>
</div>
</div></div></section>
<section id="metaprogramming">
<span id="sec-metaprogramming-intro"></span><h3><span class="section-number">9.4.7. </span>Metaprogramming (*)<a class="headerlink" href="#metaprogramming" title="Link to this heading">¶</a></h3>
<p>We can access <em>expressions</em> passed as a function’s arguments
<em>without evaluating them</em>. In particular, a call to the composition of
<strong class="command">deparse</strong> and <strong class="command">substitute</strong> converts them
to a character vector.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_deparse_substitute</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="nf">deparse</span><span class="p">(</span><span class="nf">substitute</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># does not evaluate whatever is behind `x`</span>

<span class="nf">test_deparse_substitute</span><span class="p">(</span><span class="n">testing</span><span class="m">+1+2+3</span><span class="p">)</span>
<span class="c1">## [1] &quot;testing + 1 + 2 + 3&quot;</span>
<span class="nf">test_deparse_substitute</span><span class="p">(</span><span class="n">spam</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">spam</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bacon</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">grilled</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
<span class="c1">## [1] &quot;spam &amp; spam^2 &amp; bacon | grilled(spam)&quot;</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id47">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.30</span>
        
    </div><div class="proof-content">
<p>Check out the y-axis label generated by
<strong class="command">plot.default</strong><code class="code docutils literal notranslate"><span class="pre">((1:100)^2)</span></code>.
Inspect its source code. Notice a call to the two aforementioned functions.</p>
<p>Similarly, call
<strong class="command">shapiro.test</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">log</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">rlnorm</strong><code class="code docutils literal notranslate"><span class="pre">(100)))</span></code>
and take note of the “<code class="docutils literal notranslate"><span class="pre">data:</span></code>” field.</p>
</div></div><p>A function is free to do with such an expression whatever it likes.
For instance, it can modify the expression and then evaluate it in a very
different context. Such a language feature allows
certain operations to be expressed much more compactly.
In theory, it is a potent tool. Alas, it is easy to find many practical
examples where it was over/misused and made learning or using R confusing.</p>
<div class="proof proof-type-example" id="id48">

    <div class="proof-title">
        <span class="proof-type">Example 9.31</span>
        
    </div><div class="proof-content">
<p>(*)
In <a class="reference internal" href="240-data-frame.html#sec-metaprogramming-df"><span class="std std-numref">Section 12.3.9</span></a> and
<a class="reference internal" href="340-lazy.html#sec-metaprogramming-implement"><span class="std std-numref">Section 17.5</span></a>, we explain that
<strong class="command">subset</strong> and <strong class="command">transform</strong>
use metaprogramming techniques to specify basic data frame transformations.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">transform</span><span class="p">(</span>
<span class="w">    </span><span class="nf">subset</span><span class="p">(</span>
<span class="w">        </span><span class="n">iris</span><span class="p">,</span>
<span class="w">        </span><span class="n">Sepal.Length</span><span class="o">&gt;=</span><span class="m">7.7</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Sepal.Width</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">3.0</span><span class="p">,</span><span class="w">  </span><span class="c1"># huh?</span>
<span class="w">        </span><span class="n">select</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="o">:</span><span class="n">Sepal.Width</span><span class="p">)</span><span class="w">  </span><span class="c1"># le what?</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">Sepal.Length.mm</span><span class="o">=</span><span class="n">Sepal.Length</span><span class="o">/</span><span class="m">10</span><span class="w">  </span><span class="c1"># pardon my French, but pardon?</span>
<span class="p">)</span>
<span class="c1">##       Species Sepal.Length Sepal.Width Sepal.Length.mm</span>
<span class="c1">## 118 virginica          7.7         3.8            0.77</span>
<span class="c1">## 132 virginica          7.9         3.8            0.79</span>
<span class="c1">## 136 virginica          7.7         3.0            0.77</span>
</pre></div>
</div>
<p>None of the arguments (except <code class="docutils literal notranslate"><span class="pre">iris</span></code>) makes sense
outside of the function’s call.
In particular, neither <code class="docutils literal notranslate"><span class="pre">Sepal.Length</span></code> nor <code class="docutils literal notranslate"><span class="pre">Sepal.Width</span></code>
exists as a standalone variable.</p>
<p>The two functions took the liberty to interpret the arguments passed
how they felt. They created their own virtual reality within
our well-defined world.
The reader must refer to their documentation to discover
the meaning of such special syntax.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Some functions have rather bizarre default arguments.
For instance, in the manual page of <strong class="command">prop.test</strong>,
we read that the <code class="docutils literal notranslate"><span class="pre">alternative</span></code> parameter defaults to
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;two.sided&quot;,</span> <span class="pre">&quot;less&quot;,</span> <span class="pre">&quot;greater&quot;)</span></code>.
However, if a user does not set this argument explicitly,
<code class="docutils literal notranslate"><span class="pre">alternative=&quot;two.sided&quot;</span></code> (the first element in the above vector),
will actually be assumed.</p>
<p>If we call <strong class="command">print</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">prop.test</strong><code class="code docutils literal notranslate"><span class="pre">)</span></code>,
we will find the code line responsible for this odd behaviour:
“<code class="docutils literal notranslate"><span class="pre">alternative</span> <span class="pre">&lt;-</span> </code><strong class="command">match.arg</strong><code class="code docutils literal notranslate"><span class="pre">(alternative)</span></code>”.
Consider the following example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test_match_arg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span><span class="w"> </span><span class="nf">match.arg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nf">test_match_arg</span><span class="p">()</span><span class="w">  </span><span class="c1"># missing argument; choose first</span>
<span class="c1">## [1] &quot;a&quot;</span>
<span class="nf">test_match_arg</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># one of the predefined options</span>
<span class="c1">## [1] &quot;c&quot;</span>
<span class="nf">test_match_arg</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># unexpected setting</span>
<span class="c1">## Error in match.arg(x): &#39;arg&#39; should be one of &quot;a&quot;, &quot;b&quot;, &quot;c&quot;</span>
</pre></div>
</div>
<p>In the current context, <strong class="command">match.arg</strong> only allows an actual parameter
from a given set of choices. However, if the argument is missing,
it selects the first option.</p>
<p>Unfortunately, we have to learn this behaviour by heart,
because the above source code is far from self-explanatory.
If such an expression was normally evaluated, we would use
either the default argument or whatever the user passed as <code class="docutils literal notranslate"><span class="pre">x</span></code> (but
then the function would not know the range of possible choices). A call to
<strong class="command">match.arg</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;))</span></code>
could guarantee the desired functionality and would be much more readable.
Instead, metaprogramming techniques enabled <strong class="command">match.arg</strong> to access
the enclosing function’s default argument list without explicitly
referring to them.</p>
</div>
<p>One may ask: why is it so? The only sensible answer to this will be
“because its programmer decided it must be this way”.
Let’s contemplate this for a while.
In cases like these, we are not dealing with some
base R language design choice that we might like or dislike,
but which we should just accept as an inherent feature.
Instead, we are struggling intellectually because of some
programmers’ (mis)use (in good faith…) of R’s flexibility itself.
They have introduced a slang/dialect on top of our mother tongue,
whose meaning is valid only within this function.
Blame the middleman, not the environment, please.</p>
<p>This is why we generally advocate for avoiding
metaprogramming-based techniques wherever possible.
We shall elaborate on this topic in the third part of this book.</p>
</section>
</section>
<section id="principles-of-sustainable-design">
<h2><span class="section-number">9.5. </span>Principles of sustainable design (*)<a class="headerlink" href="#principles-of-sustainable-design" title="Link to this heading">¶</a></h2>
<p>Fine design is more art than science. As usual in real life,
we will need to make many compromises. This is because
improving things with regard to one criterion sometimes makes them
worse with respect to other aspects<a class="footnote-reference brackets" href="#footparetooptim" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>
(also those that we are not aware of).
Moreover, not everything that counts can nor will be counted.</p>
<p>We do not want to be considered heedless enablers who say that
if anything is possible, it should be done. Therefore,
below we serve some food for thought. However, as there is no accounting
for taste, the kind readers might as well decide to skip this spicy meal.</p>
<section id="to-write-or-abstain">
<h3><span class="section-number">9.5.1. </span>To write or abstain<a class="headerlink" href="#to-write-or-abstain" title="Link to this heading">¶</a></h3>
<p>Our functions can often be considered
merely creative combinations of the building blocks available in base R
or a few high-quality add-on packages. Some are simpler than
others. Thus, there is a question if a new operation
should be introduced at all: whether we are faced with the case of
multiplying entities without necessity.</p>
<p>On the one hand, the DRY (don’t repeat yourself) principle tells us that
the most frequently used code chunks (say, called at least thrice)
should be generalised in the form of a new function.
As far as <em>complex</em> operations are concerned,
this is definitely a correct approach.</p>
<p>On the other hand, not every generalisation is necessarily welcome.
Let’s say we are tired of writing
<strong class="command">g</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code> for the <span class="math">\(n\)</span>-th time,
<span class="math">\(n\ge 2\)</span>. Why not introduce <strong class="command">h</strong> defined as a combination
of <strong class="command">g</strong> and <strong class="command">f</strong>? This might <em>seem</em> like a clever idea,
but let’s not take it for granted. Being tired might be an indication
that we need a rest. Being lazy can be a call for more self-discipline
(not an overly popular word these days, but still, an endearing trait).</p>
<div class="proof proof-type-example" id="id49">

    <div class="proof-title">
        <span class="proof-type">Example 9.32</span>
        
    </div><div class="proof-content">
<p><strong class="command">paste0</strong> is a specialised version of <strong class="command">paste</strong>,
but has the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument hardcoded to an empty string.</p>
<ul class="simple">
<li><p>Even if this might be the most often applied use case,
is the introduction of a new function justifiable?
Is it so hard to write <code class="docutils literal notranslate"><span class="pre">sep=&quot;&quot;</span></code> each time?</p></li>
<li><p>Would changing <strong class="command">paste</strong>’s default argument be better?
That, of course, would harm backward compatibility, but what strategies
could we apply to make the transition as smooth as possible?</p></li>
<li><p>What about introducing a new version of <strong class="command">paste</strong>
with <code class="docutils literal notranslate"><span class="pre">sep</span></code> defaulting to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, and informing the users that the
old version is deprecated and will be removed in, say, two years?
(or maybe one month is preferable? or five?)</p></li>
</ul>
</div></div><div class="proof proof-type-example" id="id50">

    <div class="proof-title">
        <span class="proof-type">Example 9.33</span>
        
    </div><div class="proof-content">
<p>R 4.0 defined a new function called <strong class="command">deparse1</strong>.
It is nothing but a combination of <strong class="command">deparse</strong> and <strong class="command">paste</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">deparse1</span><span class="p">)</span>
<span class="c1">## function (expr, collapse = &quot; &quot;, width.cutoff = 500L, ...)</span>
<span class="c1">## paste(deparse(expr, width.cutoff, ...), collapse = collapse)</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
</pre></div>
</div>
<p>Let’s say this covers 90% of use cases: was introducing
it a justified idea then? What if that number was 99%?
Might it lead to new users’ not knowing that the more primitive
operations are available?</p>
</div></div><p>Overall, more functions contribute to information overload.
We do not want our users to be overwhelmed by unreasonably many choices.
Luckily, nothing is cemented once and for all.
Had we made bad design choices resulting in our API’s being bloated,
we could always cancel those that no longer spark joy.</p>
</section>
<section id="to-pamper-or-challenge">
<h3><span class="section-number">9.5.2. </span>To pamper or challenge<a class="headerlink" href="#to-pamper-or-challenge" title="Link to this heading">¶</a></h3>
<p>We should think about the kind of audience we would like to serve:
is it our team only, students, professionals, certain client groups,
etc.? Do they have mathematical, programming, engineering,
or scientific background?</p>
<p>Not everything appropriate for one cohort will be valuable for another.</p>
<p>Not everything pleasing some <em>now</em> will benefit
them in the long run: people (their skills, attitudes, etc.) change.</p>
<div class="proof proof-type-example" id="id51">

    <div class="proof-title">
        <span class="proof-type">Example 9.34</span>
        
    </div><div class="proof-content">
<p>Assume we are writing a friendly package for novices who would like to grasp
the rudiments of data analysis as quickly as possible. Without much
effort, it could enable them to solve 80–95% of the most common, easy
problems.</p>
<p>Think of introducing the students to a function
that returns the five largest observations in a given vector.
Let’s call it <strong class="command">nlargest</strong>. So pleasant.
It makes the students feel <em>empowered</em> and improves their
retention<a class="footnote-reference brackets" href="#footquick" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>.</p>
<p>However, when faced with the remaining 5–20% of tasks, they will have to
learn another, more advanced, generic, and capable tool anyway
(in our case, the base R itself). Are they determined
and skilled enough to do that? Some might, unfortunately,
say: “it is not my problem, I made sure everyone was happy at that time”.
Due to this shortsightedness, it is <em>our</em> problem now.</p>
<p>Recall that it took us some time to arrive at <strong class="command">order</strong>
and subsetting via `<strong class="command">[</strong>`. Assuming that we read this
book from the beginning to the end and solve all the
exercises, which we should, we are now able to author
the said <strong class="command">nlargest</strong> (and lots of other functions) ourselves,
using a single line of code.
This will also pay off in many scenarios that we will be facing
in the future, e.g., when we consider matrices and data frames.</p>
<p>Yes, everyone will be reinventing their own <strong class="command">nlargest</strong> this way.
But this constitutes a great exercise: by our being immoderately <em>nice</em>
(spoonfeeding), some might have lost an opportunity to learn a new,
more universal skill.</p>
</div></div><p>Although most users would love to minimise
the effort put into all their activities, ultimately,
they sometimes need to learn new things.
Let’s thus not be afraid to teach them stuff.</p>
<p>Furthermore, we do not want to discourage experts (or experts to-be)
by presenting them with overly simplified solutions
that keep their hands tied when something more ambitious needs to be done.</p>
</section>
<section id="to-build-or-reuse">
<h3><span class="section-number">9.5.3. </span>To build or reuse<a class="headerlink" href="#to-build-or-reuse" title="Link to this heading">¶</a></h3>
<p>The <em>fail-fast</em> philosophy encourages us to build applications using
prefabricated components. This is fantastic at the early stage of their life
cycles. Nonetheless, if we construct something uncomplicated or whose only
purpose is to illustrate an idea, educate, or show off, let’s be explicit
about it so that other users do not feel obliged to treat our product
(exercise) seriously.</p>
<p>In the (not so likely, probabilistically speaking) event of its
becoming successful, we are expected to start thinking about the project’s
long-term stability and sustainability.
After all, relying on third-party functions, packages, or programs
makes our software projects less… independent. This may be problematic
because:</p>
<ul class="simple">
<li><p>the dependencies might not be available on every platform
or may behave differently across various system configurations,</p></li>
<li><p>they may be huge (and can depend on other external software too),</p></li>
<li><p>their APIs may be altered, which can cause our code to break,</p></li>
<li><p>their functionality can change, which can lead to unexpected
behaviour.</p></li>
</ul>
<p>Hence, it might be better to rewrite some parts from scratch on our own.</p>
<div class="proof proof-type-exercise" id="id52">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.35</span>
        
    </div><div class="proof-content">
<p>Identify a few R packages on CRAN with many dependencies.
See what functions they import from other packages.
How often do they only borrow a few lines of code?</p>
</div></div><p>The UNIX philosophy emphasises building and using
minimalist yet nontrivial, single-purpose, high-quality pieces of software
that can work as parts of more complex pipelines.
R serves as a glue language very well.</p>
<p>In the long run, our software project might converge to such
a tool. Thus, we might have to standardise its API
(e.g., make it available from the command line; <a class="reference internal" href="110-basics.html#sec-ide"><span class="std std-numref">Section 1.2</span></a>)
so that the users of other languages can benefit from our work.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If our project is merely a modified interface/front-end
to a standalone program developed by others,
we should be humble about it. We should strive to ensure
we are not the ones who get all the credit for other people’s work.
Also, we must clearly state how the original tools can be used
to achieve the same goals, e.g., when working from the command line.
In other words, let’s not be selfish jerks.</p>
</div>
</section>
<section id="to-revolt-or-evolve">
<h3><span class="section-number">9.5.4. </span>To revolt or evolve<a class="headerlink" href="#to-revolt-or-evolve" title="Link to this heading">¶</a></h3>
<p>The wise, gradual improving of things is generally welcome.
It gives everyone time to adjust.</p>
<p>Some projects, however, are governed in a compulsive way,
reinforced by neurotic thinking that “stakeholders need to be kept engaged
or we’re going to lose popularity”. It is not a sustainable strategy.
Less is better, even though slightly more challenging. Put
good engineering first.</p>
<p>It might even happen that we realise that “everything so far was wrong
and we need a global reset”. But if we become very successful, we will cause
a <em>divide</em> in the community. Especially when we decide to duplicate
the existing, base functionality, we should note that some
users will be introduced to the system through the supplementary
interface and they will not be familiar with the classic one.
Others will have to learn the added syntax to be able to communicate
with the former group. This gives rise to a whole
new set of issues (how to make all the functions interoperable
with each other seamlessly, etc.). Such moves are sometimes necessary,
but let’s not treat them lightly; it is a great responsibility.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">9.6. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="proof proof-type-exercise" id="id53">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.36</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>Will <strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(1)</span></code> stop?
What about <strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(NA)</span></code>,
<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">FALSE)</span></code>, and
<strong class="command">stopifnot</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(TRUE,</span> <span class="pre">TRUE,</span> <span class="pre">NA))</span></code>?</p></li>
<li><p>What does the `<strong class="command">if</strong>` function return?</p></li>
<li><p>Does `<strong class="command">attributes&lt;-</strong>`<code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">NULL)</span></code> modify <code class="docutils literal notranslate"><span class="pre">x</span></code>?</p></li>
<li><p>When can we be interested in calling
`<strong class="command">[</strong>` and `<strong class="command">[&lt;-</strong>` as functions
(and not as operators) directly?</p></li>
<li><p>How to define a new binary operator? Can it be equipped with
default arguments?</p></li>
<li><p>What are the main use cases of the ellipsis?</p></li>
<li><p>What is wrong with <strong class="command">transform</strong>, <strong class="command">subset</strong>, and
<strong class="command">match.arg</strong>?</p></li>
<li><p>When a call like
<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(-1,</span> </code><strong class="command">do_something_that_takes_a_million_years</strong><code class="code docutils literal notranslate"><span class="pre">())</span></code>
does not necessarily have to be a regrettable action?</p></li>
<li><p>What is the difference between
“<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(x)[1]</span> <span class="pre">&lt;-</span> <span class="pre">new_name</span></code>” and
“<strong class="command">names</strong><code class="code docutils literal notranslate"><span class="pre">(x[1])</span> <span class="pre">&lt;-</span> <span class="pre">new_name</span></code>”?</p></li>
<li><p>What might be the form of <code class="docutils literal notranslate"><span class="pre">x</span></code> if it is legit to
call it like <code class="docutils literal notranslate"><span class="pre">x[[c(1,</span> <span class="pre">2)]]()()()[[1]]()()</span></code>?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id54">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.37</span>
        
    </div><div class="proof-content">
<p>Consider a function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>What is the return value of a call to
<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>?
Is it <code class="docutils literal notranslate"><span class="pre">NULL</span></code>,
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(NULL)</span></code>,
<code class="docutils literal notranslate"><span class="pre">x[[</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)]]</span></code>, or
<strong class="command">invisible</strong><code class="code docutils literal notranslate"><span class="pre">(x[[</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)]])</span></code>?
Does it change relative to whether <code class="docutils literal notranslate"><span class="pre">x</span></code> is empty or not?</p>
</div></div><div class="proof proof-type-exercise" id="id55">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.38</span>
        
    </div><div class="proof-content">
<p>The <strong class="command">split</strong> function also has its replacement version.
Study its documentation to learn how it works.</p>
</div></div><div class="proof proof-type-exercise" id="id56">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.39</span>
        
    </div><div class="proof-content">
<p>A call to <strong class="command">ls</strong><code class="code docutils literal notranslate"><span class="pre">(envir=</span></code><strong class="command">baseenv</strong><code class="code docutils literal notranslate"><span class="pre">())</span></code>
returns all objects defined in the <strong class="program">base</strong> package
(see <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>).
List the names corresponding to replacement functions.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Apply the principle of test-driven development
when solving the remaining exercises.</p>
</div>
<div class="proof proof-type-exercise" id="id57">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.40</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">Position</strong>
and <strong class="command">Find</strong> functions.
Evaluation should stop as soon as the first element
fulfilling a given predicate has been found.</p>
</div></div><div class="proof proof-type-exercise" id="id58">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.41</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">Reduce</strong> function.</p>
</div></div><div class="proof proof-type-exercise" id="id59">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.42</span>
        
    </div><div class="proof-content">
<p>Write a function <strong class="command">slide</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">k,</span> <span class="pre">...)</span></code>
which returns a list <code class="docutils literal notranslate"><span class="pre">y</span></code> with <strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)-k+1</span></code> elements
such that <code class="docutils literal notranslate"><span class="pre">y[[i]]</span> <span class="pre">=</span> </code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x[i:(i+k-1)],</span> <span class="pre">...)</span></code></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1] 1 2 3 4 5</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>
<span class="c1">## [1]  6  9 12</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">slide</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="c1">## [1] 15</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id60">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.43</span>
        
    </div><div class="proof-content">
<p>Using <strong class="command">slide</strong> defined above,
write another function that counts how many
increasing pairs of numbers are in a given numeric
vector. For instance, in (0, 2, 1, 1, 0, 1, 6, 0),
there are three such pairs: (0, 2), (0, 1), (1, 6).</p>
</div></div><div class="proof proof-type-exercise" id="id61">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.44</span>
        
    </div><div class="proof-content">
<p>(*) Write your version of
<strong class="program">tools</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">package_dependencies</strong> with
<code class="docutils literal notranslate"><span class="pre">reverse=TRUE</span></code> based on information extracted by calling
<strong class="program">utils</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">available.packages</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id62">

    <div class="proof-title">
        <span class="proof-type">Exercise 9.45</span>
        
    </div><div class="proof-content">
<p>(**)
Write a standalone program which can be run from the system shell
and which computes the total size of all the files in directories
given as the script’s arguments (via <strong class="command">commandArgs</strong>).</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footfactorstop" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>We rely on the S3 generics
<strong class="command">is.numeric</strong> and <strong class="command">as.numeric</strong> here;
see <a class="reference internal" href="220-s3.html#sec-built-in-generics"><span class="std std-numref">Section 10.2.3</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footcranpolicy" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Always consult the CRAN Repository Policy at
<a class="reference external" href="https://cran.r-project.org/web/packages/policies.html">https://cran.r-project.org/web/packages/policies.html</a>.</p>
</aside>
<aside class="footnote brackets" id="footservice" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>Let’s make it less about ourselves and more about the
community. Developing expertise in any complex area takes years of
hard work. In the meantime, we can help open-source projects
by spreading the good word about them,
submitting bug fixes, extending documentation,
supporting other users through their journey, etc.</p>
</aside>
<aside class="footnote brackets" id="footdollar" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">4</a><span class="fn-bracket">]</span></span>
<p>And hence also in data frames.</p>
</aside>
<aside class="footnote brackets" id="footchgenvir" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">5</a><span class="fn-bracket">]</span></span>
<p>With the exception of objects of the type <code class="docutils literal notranslate"><span class="pre">environment</span></code>,
which are passed by reference; see <a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a>.
Also, the fact that we have access to unevaluated R expressions
can cause further deviations to this rule because, actually,
R implements the <em>call-by-need</em> strategy; see <a class="reference internal" href="340-lazy.html#chap-lazy"><span class="std std-numref">Chapter 17</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footshadow" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">6</a><span class="fn-bracket">]</span></span>
<p><a class="reference internal" href="330-environment.html#chap-environment"><span class="std std-numref">Chapter 16</span></a> discusses this
topic in-depth: names are bound to objects within environment frames.
Moreover, R uses lexical (static) scoping, which is not necessarily
intuitive, especially taking into account that a function’s environment
can always be changed.</p>
</aside>
<aside class="footnote brackets" id="footpykwargs" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">7</a><span class="fn-bracket">]</span></span>
<p>Which is somewhat similar to Python’s <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>
in a function’s parameter list.</p>
</aside>
<aside class="footnote brackets" id="footparetooptim" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id16">8</a><span class="fn-bracket">]</span></span>
<p>Compare the notion of Pareto efficiency.</p>
</aside>
<aside class="footnote brackets" id="footquick" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">9</a><span class="fn-bracket">]</span></span>
<p>Brought to the extreme, this strategy is employed by certain
companies (and drug dealers): make the introductory experience
smooth and fun. At the same time, do not permit your users to become
independent too easily. Instead, make them rely on your product
lines/proprietary solutions/payable services, etc.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="220-s3.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">10. </span>S3 classes</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="180-flow.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">8. </span>Flow of execution</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2024 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2024-07-19T10:24:08+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">9. Designing functions</a><ul>
<li><a class="reference internal" href="#managing-data-flow">9.1. Managing data flow</a><ul>
<li><a class="reference internal" href="#checking-input-data-integrity-and-argument-handling">9.1.1. Checking input data integrity and argument handling</a></li>
<li><a class="reference internal" href="#putting-outputs-into-context">9.1.2. Putting outputs into context</a></li>
</ul>
</li>
<li><a class="reference internal" href="#organising-and-maintaining-functions">9.2. Organising and maintaining functions</a><ul>
<li><a class="reference internal" href="#function-libraries">9.2.1. Function libraries</a></li>
<li><a class="reference internal" href="#writing-r-packages">9.2.2. Writing R packages (*)</a><ul>
<li><a class="reference internal" href="#package-structure">9.2.2.1. Package structure (*)</a></li>
<li><a class="reference internal" href="#building-and-installing">9.2.2.2. Building and installing (*)</a></li>
<li><a class="reference internal" href="#documenting">9.2.2.3. Documenting (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-standalone-programs">9.2.3. Writing standalone programs (**)</a></li>
<li><a class="reference internal" href="#assuring-quality-code">9.2.4. Assuring quality code</a><ul>
<li><a class="reference internal" href="#managing-changes-and-working-collaboratively">9.2.4.1. Managing changes and working collaboratively</a></li>
<li><a class="reference internal" href="#test-driven-development-and-continuous-integration">9.2.4.2. Test-driven development and continuous integration</a></li>
<li><a class="reference internal" href="#debugging">9.2.4.3. Debugging</a></li>
<li><a class="reference internal" href="#profiling">9.2.4.4. Profiling</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#special-functions-syntactic-sugar">9.3. Special functions: Syntactic sugar</a><ul>
<li><a class="reference internal" href="#backticks">9.3.1. Backticks</a></li>
<li><a class="reference internal" href="#dollar">9.3.2. Dollar, `<strong class="command">$</strong>` (*)</a></li>
<li><a class="reference internal" href="#curly-braces">9.3.3. Curly braces,  `<strong class="command">{</strong>`</a></li>
<li><a class="reference internal" href="#if">9.3.4. `<strong class="command">if</strong>`</a></li>
<li><a class="reference internal" href="#operators-are-functions">9.3.5. Operators are functions</a><ul>
<li><a class="reference internal" href="#calling-built-in-operators-as-functions">9.3.5.1. Calling built-in operators as functions</a></li>
<li><a class="reference internal" href="#defining-binary-operators">9.3.5.2. Defining binary operators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#replacement-functions">9.3.6. Replacement functions</a><ul>
<li><a class="reference internal" href="#creating-replacement-functions">9.3.6.1. Creating replacement functions</a></li>
<li><a class="reference internal" href="#substituting-parts-of-vectors">9.3.6.2. Substituting parts of vectors</a></li>
<li><a class="reference internal" href="#replacing-attributes">9.3.6.3. Replacing attributes</a></li>
<li><a class="reference internal" href="#compositions-of-replacement-functions">9.3.6.4. Compositions of replacement functions (*)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#arguments-and-local-variables">9.4. Arguments and local variables</a><ul>
<li><a class="reference internal" href="#call-by-value">9.4.1. Call by “value”</a></li>
<li><a class="reference internal" href="#variable-scope">9.4.2. Variable scope</a></li>
<li><a class="reference internal" href="#closures">9.4.3. Closures (*)</a></li>
<li><a class="reference internal" href="#default-arguments">9.4.4. Default arguments</a></li>
<li><a class="reference internal" href="#lazy-vs-eager-evaluation">9.4.5. Lazy vs eager evaluation</a></li>
<li><a class="reference internal" href="#ellipsis">9.4.6. Ellipsis, `<code class="code docutils literal notranslate"><span class="pre">...</span></code>`</a></li>
<li><a class="reference internal" href="#metaprogramming">9.4.7. Metaprogramming (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#principles-of-sustainable-design">9.5. Principles of sustainable design (*)</a><ul>
<li><a class="reference internal" href="#to-write-or-abstain">9.5.1. To write or abstain</a></li>
<li><a class="reference internal" href="#to-pamper-or-challenge">9.5.2. To pamper or challenge</a></li>
<li><a class="reference internal" href="#to-build-or-reuse">9.5.3. To build or reuse</a></li>
<li><a class="reference internal" href="#to-revolt-or-evolve">9.5.4. To revolt or evolve</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">9.6. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4805ff4d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>