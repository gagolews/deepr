<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />

  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2023" name="citation_date" />
<meta content="2023" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com/" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>16. üöß Environments &mdash; Deep R Programming by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  

  
  

  
    <link rel="canonical" href="https://deepr.gagolewski.com/chapter/330-environment.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="17. üöß Evaluating Expressions" href="340-eval-expr.html" />
    <link rel="prev" title="15. üöß Expressions" href="320-language.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Deep R Programming
          

          
          </a>

          <div class="version">
          An Open-Access Textbook<br />    by <a style="color: inherit" href="https://www.gagolewski.com">Marek     Gagolewski</a><br />    v0.1.12.9001 (draft)
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr/">Report Bugs or Typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com">Data Wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of Execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and Other Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. üöß Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="310-compile.html">14. üöß Interfacing Compiled Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. üöß Expressions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">16. üöß Environments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#frames-environments-as-object-containers">16.1. üöß Frames: Environments as Object Containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environments-vs-named-lists">16.1.1. üöß Environments vs Named Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pass-by-value-copy-on-demand-not-for-environments">16.1.2. üöß Pass-by-value, Copy on Demand ‚Äì Not for Environments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#enclosing-environments">16.2. üöß Enclosing Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-note-on-reference-classes">16.3. üöß A Note on Reference Classes (*)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">16.4. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="340-eval-expr.html">17. üöß Evaluating Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="350-eval-fun.html">18. üöß Evaluating Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Deep R Programming</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">16. </span>üöß Environments</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/deepr" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/deepr on GitHub">GitHub</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="340-eval-expr.html" class="btn btn-neutral float-right" title="17. üöß Evaluating Expressions" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="320-language.html" class="btn btn-neutral float-left" title="15. üöß Expressions" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="environments">
<span id="chap-environment"></span><h1><span class="section-number">16. </span>üöß Environments<a class="headerlink" href="#environments" title="Permalink to this heading">ÔÉÅ</a></h1>
<blockquote>
<div><p><em>The open-access textbook</em>
Deep R Programming <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone‚Äôs enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>).
It is a non-profit project.</em>
<strong>This book is still a work in progress. Beta versions
of Chapters 1‚Äì12 are already complete, but there will be more.
In the meantime, any
<a class="reference external" href="https://github.com/gagolews/deepr/issues">bug/typos reports/fixes</a>
are appreciated.</strong>
<em>Although available online, it is a whole course;
it should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em>
<em>Also, check out my other book, <a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a> <span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2022).  Minimalist Data Wrangling with Python. Zenodo, Melbourne. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">20</a>]</span>.</em></p>
</div></blockquote>
<p>In the first part of our book, we have discussed quite a few
<em>basic</em> object types: numeric, logical, and character vectors,
lists (generic vectors), and functions.</p>
<p><em>Environments</em>, which we introduce in this chapter, just like
lists, are instances of recursive types
(compare the diagram in <a class="reference internal" href="350-eval-fun.html#fig-data-types-full"><span class="std std-numref">Figure¬†18.1</span></a>).</p>
<p>Even though we rarely interact with them directly (unless we need
a hash table-like data structure with quick by-name element look-up),
they are utterly important for R itself:
they form the basis of the <em>environment model of evaluation</em>
which governs how expressions are computed; see <a class="reference internal" href="340-eval-expr.html#sec-env-mod-eval"><span class="std std-numref">Section¬†17.1</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Each object of type <em>environment</em> consists of:</p>
<ul class="simple">
<li><p>a <em>frame</em><a class="footnote-reference brackets" href="#footdf" id="id2">1</a> ‚Äì stores a set of <em>bindings</em>,
which associate variable names with their corresponding values;
it can be thought of as a container of named R objects of any type;</p></li>
<li><p>a pointer to an <em>enclosing environment</em><a class="footnote-reference brackets" href="#footencpar" id="id3">2</a>.</p></li>
</ul>
</div>
<blockquote>
<div><p>üöß <strong>This chapter is under construction. Please come back later.</strong></p>
</div></blockquote>
<section id="frames-environments-as-object-containers">
<h2><span class="section-number">16.1. </span>üöß Frames: Environments as Object Containers<a class="headerlink" href="#frames-environments-as-object-containers" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>To create a new, empty environment,
we can call the <strong class="command">new.env</strong> function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="o">&lt;-</span> <span class="nf">new.env</span><span class="p">()</span>
<span class="nf">typeof</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
<span class="c1">## [1] &quot;environment&quot;</span>
</pre></div>
</div>
<p>In this section, we treat environments merely as
containers for named objects of any kind, i.e.,
we deal with the <em>frame</em> part thereof.</p>
<p>Let us insert some elements into <code class="docutils literal notranslate"><span class="pre">e1</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span><span class="p">[[</span><span class="s">&quot;x&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="s">&quot;x in e1&quot;</span>
<span class="n">e1</span><span class="p">[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span>
</pre></div>
</div>
<p>The `<strong class="command">[[</strong>` operator provides some named list-like look-and-feel
also in the case of element extraction:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span><span class="p">[[</span><span class="s">&quot;x&quot;</span><span class="p">]]</span>
<span class="c1">## [1] &quot;x in e1&quot;</span>
<span class="n">e1</span><span class="p">[[</span><span class="s">&quot;spam&quot;</span><span class="p">]]</span>  <span class="c1"># does not exist</span>
<span class="c1">## NULL</span>
<span class="n">e1</span><span class="p">[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">e1</span><span class="p">[[</span><span class="s">&quot;y&quot;</span><span class="p">]]</span><span class="o">*</span><span class="m">10</span>  <span class="c1"># replace with new content</span>
<span class="n">e1</span><span class="p">[[</span><span class="s">&quot;z&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>  <span class="c1"># unlike in the case of lists, creates a new element</span>
</pre></div>
</div>
<p>Even though the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute is not set explicitly,
the corresponding function returns a sensible result:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>  <span class="c1"># compare attr(e1, &quot;names&quot;) ‚Äì it is not set</span>
<span class="c1">## [1] &quot;x&quot; &quot;y&quot; &quot;z&quot;</span>
<span class="nf">length</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<section id="environments-vs-named-lists">
<h3><span class="section-number">16.1.1. </span>üöß Environments vs Named Lists<a class="headerlink" href="#environments-vs-named-lists" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Let us note that the printing of an environment is quite awkward:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>  <span class="c1"># same with str(e1)</span>
<span class="c1">## &lt;environment: 0x55b320bd0018&gt;</span>
</pre></div>
</div>
<p>Later we will mention that this is the address where <code class="docutils literal notranslate"><span class="pre">e1</span></code> is stored
in computer‚Äôs memory.</p>
<p>As we have said, these objects are rather of <em>internal</em> interest,
so nobody cared<a class="footnote-reference brackets" href="#footdiscourage" id="id4">3</a> about making the interaction therewith
particularly smooth.</p>
<p>Environment frames, in some sense, can be thought of
as named lists, but the set of admissible operations is severely restricted.
In particular, we cannot extract more than one element
at the same time with the index operator:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)]</span>  <span class="c1"># but see the mget function</span>
<span class="c1">## Error in e1[c(&quot;x&quot;, &quot;y&quot;)]: object of type &#39;environment&#39; is not subsettable</span>
</pre></div>
</div>
<p>nor can we refer to the elements by position:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="s">&quot;bad key&quot;</span>
<span class="c1">## Error in e1[[1]] &lt;- &quot;bad key&quot;: wrong args for environment subassignment</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id9">

    <div class="proof-title">
        <span class="proof-type">Exercise 16.1</span>
        
    </div><div class="proof-content">
<p>Check if <strong class="command">lapply</strong> and <strong class="command">Map</strong> can be applied
directly on environments.
Also, can we iterate over their elements using a <strong class="command">for</strong> loop?</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Environment frames are internally implemented
using hash tables (hash maps; see, e.g., <span id="id5">[<a class="reference internal" href="999-bibliography.html#id57" title="Cormen, T.H., Leiserson, C.E., Rivest, R.L., Stein, C. (2009).  Introduction to Algorithms. MIT Press and McGraw-Hill.">9</a>, <a class="reference internal" href="999-bibliography.html#id30" title="Knuth, D.E. (1997).  The Art of Computer Programming III: Sorting and Searching. Addison-Wesley.">33</a>]</span>)
with string keys.</p>
<p>A <em>hash table</em> is a data structure that allows for
a very quick<a class="footnote-reference brackets" href="#footquickhash" id="id6">4</a> lookup, insertion, and deletion
of individual elements <em>by name</em>.</p>
<p>But this comes at a price, including:</p>
<ul class="simple">
<li><p>elements are not particularly unordered: they cannot
be referred to by a numeric index;</p></li>
<li><p>all element names must be unique.</p></li>
</ul>
</div>
<p>A list may be considered a <em>sequence</em>,
but an environment frame is only <em>set</em> (a bag) of objects.
In the majority of numerical computing applications,
we would rather store, iterate over, and process all the elements
<em>in order</em>, hence the greater popularity of the former.
Lists still allow for an element look-up by name, even though this
is slightly slower<a class="footnote-reference brackets" href="#footlisttime" id="id7">5</a>. Hence, they are much more universal.</p>
<p>üöß TODO: environments: use case</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">key</span> <span class="n">in</span> <span class="n">some_container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">counter</span><span class="p">[[</span><span class="s">&quot;key&quot;</span><span class="p">]]))</span>
        <span class="n">counter</span><span class="p">[[</span><span class="s">&quot;key&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">counter</span><span class="p">[[</span><span class="s">&quot;key&quot;</span><span class="p">]]</span><span class="m">+1</span>
    <span class="n">else</span>
        <span class="n">counter</span><span class="p">[[</span><span class="s">&quot;key&quot;</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="m">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">counter</span></code> is a list, then, theoretically, the worst-case time of the above
algorithm is <span class="math notranslate nohighlight">\(O(n^2)\)</span>; for environments, it is amortised <span class="math notranslate nohighlight">\(O(n)\)</span>.</p>
<p>üöß TODO: <strong class="command">mget</strong> vs <strong class="command">match</strong>/`<strong class="command">[</strong>` time</p>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 16.2</span>
        
    </div><div class="proof-content">
<p>üöß TODO: amortised constant vs linear-time lookup check: implement the
above scheme and benchmark the two data structures
using <strong class="command">proc.time</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">&lt;-</span> <span class="nf">proc.time</span><span class="p">()</span>  <span class="c1"># timer start</span>
<span class="c1"># ... to do - something time-consuming ...</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">proc.time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>  <span class="c1"># elapsed time</span>
</pre></div>
</div>
</div></div><p>üöß TODO: <strong class="command">as.list</strong>, <strong class="command">as.environment</strong></p>
<p>üöß TODO: All names must be unique:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.list</span><span class="p">(</span><span class="nf">as.environment</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="m">3</span><span class="p">)))</span>
<span class="c1">## $y</span>
<span class="c1">## [1] 2</span>
<span class="c1">## </span>
<span class="c1">## $x</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
</section>
<section id="pass-by-value-copy-on-demand-not-for-environments">
<span id="sec-copy-on-demand"></span><h3><span class="section-number">16.1.2. </span>üöß Pass-by-value, Copy on Demand ‚Äì Not for Environments<a class="headerlink" href="#pass-by-value-copy-on-demand-not-for-environments" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Environments are the only R objects that are not passed-by-value!</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="n">key</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="p">[[</span><span class="n">key</span><span class="p">]]</span><span class="m">+1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="nf">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>  <span class="c1"># pass a &quot;copy&quot; of x</span>
<span class="c1">## [1] 2</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span>  <span class="c1"># state of x did not change</span>
<span class="c1">## [1] 1</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">as.environment</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">))</span>
<span class="nf">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>  <span class="c1"># pass by &quot;reference&quot;</span>
<span class="c1">## [1] 2</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span>   <span class="c1"># x has changed</span>
<span class="c1">## [1] 2</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="n">x</span>
<span class="nf">mod</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>  <span class="c1"># pass by &quot;reference&quot;</span>
<span class="c1">## [1] 3</span>
<span class="n">x</span><span class="p">[[</span><span class="s">&quot;a&quot;</span><span class="p">]]</span>   <span class="c1"># x has changed (names `y` and `x` are bound to the same object)</span>
<span class="c1">## [1] 3</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## &lt;environment: 0x55b31fcf3c28&gt;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## &lt;environment: 0x55b31fcf3c28&gt;</span>
</pre></div>
</div>
<p>copy on demand:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">&lt;-</span> <span class="m">100000000</span>  <span class="c1"># like, a lot</span>
<span class="n">t0</span> <span class="o">&lt;-</span> <span class="nf">proc.time</span><span class="p">()</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">numeric</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="nf">proc.time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   0.095   0.223   0.318</span>
<span class="n">t0</span> <span class="o">&lt;-</span> <span class="nf">proc.time</span><span class="p">()</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="n">x</span>
<span class="nf">proc.time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   0.001   0.000   0.001</span>
<span class="n">t0</span> <span class="o">&lt;-</span> <span class="nf">proc.time</span><span class="p">()</span>
<span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">1</span>
<span class="nf">proc.time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   0.167   0.179   0.348</span>
<span class="n">t0</span> <span class="o">&lt;-</span> <span class="nf">proc.time</span><span class="p">()</span>
<span class="n">y</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">2</span>
<span class="nf">proc.time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   0.000   0.000   0.001</span>
</pre></div>
</div>
</section>
</section>
<section id="enclosing-environments">
<h2><span class="section-number">16.2. </span>üöß Enclosing Environments<a class="headerlink" href="#enclosing-environments" title="Permalink to this heading">ÔÉÅ</a></h2>
</section>
<section id="a-note-on-reference-classes">
<span id="sec-refclass"></span><h2><span class="section-number">16.3. </span>üöß A Note on Reference Classes (*)<a class="headerlink" href="#a-note-on-reference-classes" title="Permalink to this heading">ÔÉÅ</a></h2>
</section>
<section id="exercises">
<h2><span class="section-number">16.4. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">ÔÉÅ</a></h2>
<div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 16.3</span>
        
    </div><div class="proof-content">
<p>Answer the following questions:</p>
<ul class="simple">
<li><p>What is the role of a frame in an environment?</p></li>
<li><p>What is the role of an enclosing environment?</p></li>
<li><p>What is the difference between a named list and an environment?</p></li>
<li><p>What functions and operators work on named lists but cannot be
applied on environments?</p></li>
<li><p>What do we mean by saying that environments are not passed by value
to R functions?</p></li>
<li><p>üöß TODO‚Ä¶</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 16.4</span>
        
    </div><div class="proof-content">
<p>(*)
üöß TODO: assign consecutive, unique numeric IDs for a large list of items</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pkg</span> <span class="o">&lt;-</span> <span class="nf">available.packages</span><span class="p">()</span>
<span class="n">pkg</span><span class="p">[,</span> <span class="s">&quot;Package&quot;</span><span class="p">]</span>  <span class="c1"># a list of the names of available packages</span>
<span class="n">pkg</span><span class="p">[,</span> <span class="s">&quot;Depends&quot;</span><span class="p">]</span>  <span class="c1"># dependencies</span>
</pre></div>
</div>
<p>Convert the dependency lists to a list of character vectors
(preferably using a regular expression).</p>
<p>Then, generate a list of reverse dependencies:</p>
<p>What packages depend on each given package.</p>
<p>This will be much faster using an environment.</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="footdf"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Not to be confused with a ‚Äúdata frame‚Äù, i.e., an object
of S3 class <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>; see <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>.</p>
</dd>
<dt class="label" id="footencpar"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Some also call it a <em>parent</em> environment,
but we will not. We will try following the nomenclature
established in Section 3.2 in <span id="id8">[<a class="reference internal" href="999-bibliography.html#id13" title="Abelson, H., Sussman, G.J., Sussman, J. (1996).  Structure and Interpretation of Computer Programs. MIT Press.">1</a>]</span>.
Note that there is a bit of a mess in the R documentation
regarding the way enclosing environments are referred to as.</p>
</dd>
<dt class="label" id="footdiscourage"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Which might be by design, to discourage the novices
from playing with fire.</p>
</dd>
<dt class="label" id="footquickhash"><span class="brackets"><a class="fn-backref" href="#id6">4</a></span></dt>
<dd><p>Element lookup, insertion, and deletion
in hash tables takes amortised <span class="math notranslate nohighlight">\(O(1)\)</span> time.</p>
</dd>
<dt class="label" id="footlisttime"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p>Accessing elements by position (numeric index)
in lists takes <span class="math notranslate nohighlight">\(O(1)\)</span> time.
Worst-case scenario for the element look-up by name (non-existence)
is linear with respect to the container size.
Also, inserting new elements at the end takes amortised <span class="math notranslate nohighlight">\(O(1)\)</span> time.</p>
</dd>
</dl>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="340-eval-expr.html" class="btn btn-neutral float-right" title="17. üöß Evaluating Expressions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="320-language.html" class="btn btn-neutral float-left" title="15. üöß Expressions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022‚Äì2023 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.

    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a>
    theme.
      <span class="lastupdated">
        Last updated on 2023-01-10T18:18:41+1100.
      </span>


    This site will never display any ads: it is a non-profit project.
    It does not collect any data.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>