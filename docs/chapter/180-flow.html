<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="9. Designing functions" href="210-design.html" /><link rel="prev" title="7. Functions" href="170-function.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/180-flow.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/deepr.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>8. Flow of execution - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/deepr.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.1
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="flow-of-execution">
<span id="chap-flow"></span><h1><span class="section-number">8. </span>Flow of execution<a class="headerlink" href="#flow-of-execution" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2024).  Minimalist Data Wrangling with Python. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">27</a>]</span>, too.</em></p>
</div></blockquote>
<p>The <strong class="command">ifelse</strong> and <strong class="command">Map</strong> functions are potent.
However, they allow us to process only the <em>consecutive</em> elements
in a vector. Below we will (finally!) discuss different ways to alter a program’s control flow manually, based on some criterion, and to evaluate
the same expression many times, but perhaps on different data.
Nevertheless, before proceeding any further, let’s meditate on the fact
that we have managed <em>without</em> them for such a long time,
even though the data processing exercises we solved
were far from trivial.</p>
<section id="conditional-evaluation">
<span id="sec-if"></span><h2><span class="section-number">8.1. </span>Conditional evaluation<a class="headerlink" href="#conditional-evaluation" title="Link to this heading">¶</a></h2>
<p>Life is full of surprises, so it would be nice if we were able to
adapt to any future challenges.
The following evaluates a given <code class="docutils literal notranslate"><span class="pre">expression</span></code> <em>if and only if</em>
a logical <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="n">expression</span>
</pre></div>
</div>
<p>When performing some <code class="docutils literal notranslate"><span class="pre">other_expression</span></code> is preferred
rather than doing nothing in the case of the <code class="docutils literal notranslate"><span class="pre">condition</span></code>’s being false,
we can write:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">other_expression</span>
</pre></div>
</div>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">  </span><span class="c1"># to spice things up</span>
<span class="c1">## [1] 0.28758</span>
<span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;head\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tail\n&quot;</span><span class="p">)</span>
<span class="c1">## tail</span>
</pre></div>
</div>
<p>Many expressions can, of course, be grouped with curly braces,
`<strong class="command">{</strong>`.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;head\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># do not put newline before else!</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tail\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="p">}</span>
<span class="c1">## tail</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 0</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>At the top level, we should not put a new line before <strong class="command">else</strong>.
Otherwise, we will get an error like <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">unexpected</span> <span class="pre">'else'</span> <span class="pre">in</span> <span class="pre">&quot;else&quot;</span></code>.
This is because the interpreter enthusiastically executes the statements
read line by line as soon as it regards them
as standalone expressions.
In this case, we first get an <strong class="command">if</strong> without <strong class="command">else</strong>,
and then, separately, a <em>dangling</em> <strong class="command">else</strong> without the preceding
<strong class="command">if</strong>.</p>
<p>This is not an issue when a conditional statement is part
of an expression group as the latter is read in its entirety.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">function </span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span><span class="w">  </span><span class="c1"># opening bracket – start</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;head\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">else</span><span class="w">              </span><span class="c1"># not dandling because {...} is read as a whole</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tail\n&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w">  </span><span class="c1"># closing bracket – expression ends</span>
</pre></div>
</div>
<p>As an exercise, try removing the curly braces and see what happens.</p>
</div>
<section id="return-value">
<h3><span class="section-number">8.1.1. </span>Return value<a class="headerlink" href="#return-value" title="Link to this heading">¶</a></h3>
<p>`<strong class="command">if</strong>` is a function (compare <a class="reference internal" href="210-design.html#sec-syntactic-sugar"><span class="std std-numref">Section 9.3</span></a>).
Hence, it has a return value: the result of evaluating the
conditional expression.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>
<span class="c1">## [1] 0.28758</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="w">  </span><span class="c1"># no else</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## NULL</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="s">&quot;tail&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">## [1] &quot;tail&quot;</span>
</pre></div>
</div>
<p>This is particularly useful when a call to `<strong class="command">if</strong>`
is the last expression in a curly brace-delimited code block
that constitutes a function’s body.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">cond</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">  </span><span class="c1"># could be something more sophisticated</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w">  </span><span class="c1"># the last expression in the code block</span>
<span class="w">        </span><span class="s">&quot;head&quot;</span><span class="w">        </span><span class="c1"># this can be the return value...</span>
<span class="w">    </span><span class="n">else</span>
<span class="w">        </span><span class="s">&quot;tail&quot;</span><span class="w">        </span><span class="c1"># or this one, depending on the condition</span>
<span class="p">}</span>

<span class="nf">mint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] &quot;tail&quot;</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">mint</span><span class="p">,</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">5</span><span class="p">)))</span>
<span class="c1">## [1] &quot;tail&quot; &quot;head&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot;</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id7">

    <div class="proof-title">
        <span class="proof-type">Example 8.1</span>
        
    </div><div class="proof-content">
<p>Add-on packages can be loaded using <strong class="command">requireNamespace</strong>.
Contrary to <strong class="command">library</strong>, the former does not fail
when a package is not available. Also, it does not attach
it to the search path; see <a class="reference internal" href="330-environment.html#sec-attach"><span class="std std-numref">Section 16.2.6</span></a>.
Instead, it returns a logical value indicating if the package is available
for use. This can be helpful in situations where the availability
of some features depends on the user environment’s configuration:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">process_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;some_extension_package&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="w">        </span><span class="n">some_extension_package</span><span class="o">::</span><span class="nf">very_fast_method</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">else</span>
<span class="w">        </span><span class="nf">normal_method</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div></section>
<section id="nested-ifs">
<h3><span class="section-number">8.1.2. </span>Nested <strong class="command">if</strong>s<a class="headerlink" href="#nested-ifs" title="Link to this heading">¶</a></h3>
<p>If more than two test cases are possible, i.e.,
when we need to go beyond either <code class="docutils literal notranslate"><span class="pre">condition</span></code> or
<code class="docutils literal notranslate"><span class="pre">!condition</span></code>, then we can use the following construct:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_a</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_b</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_c</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_else</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This evaluates all conditions <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, … (in this order)
until the first positive case is found
and then executes the corresponding <code class="docutils literal notranslate"><span class="pre">expression</span></code>.
It is worth stressing that the foregoing is nothing else than a series
of nested <strong class="command">if</strong> statements but written in a more
readable<a class="footnote-reference brackets" href="#footswitch" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> manner:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_a</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression_b</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">expression_c</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">expression_else</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.2</span>
        
    </div><div class="proof-content">
<p>Write a function named <strong class="command">sign</strong> that determines
if a given numeric value is <code class="docutils literal notranslate"><span class="pre">&quot;positive&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;negative&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;zero&quot;</span></code>.</p>
</div></div></section>
<section id="condition-either-true-or-false">
<h3><span class="section-number">8.1.3. </span>Condition: Either <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code><a class="headerlink" href="#condition-either-true-or-false" title="Link to this heading">¶</a></h3>
<p><strong class="command">if</strong> expects a <code class="docutils literal notranslate"><span class="pre">condition</span></code> that is a single, well-defined logical
value, either <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.
Thence, problems may arise when this is not the case.
First, if the <code class="docutils literal notranslate"><span class="pre">condition</span></code> is not of length one,
we get an error:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;spam\n&quot;</span><span class="p">)</span>
<span class="c1">## Error in if (c(TRUE, FALSE)) cat(&quot;spam\n&quot;): the condition has length &gt; 1</span>
<span class="nf">if </span><span class="p">(</span><span class="nf">logical</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;bacon\n&quot;</span><span class="p">)</span>
<span class="c1">## Error in if (logical(0)) cat(&quot;bacon\n&quot;): argument is of length zero</span>
</pre></div>
</div>
<p>We cannot pass a missing value either:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;ham\n&quot;</span><span class="p">)</span>
<span class="c1">## Error in if (NA) cat(&quot;ham\n&quot;): missing value where TRUE/FALSE needed</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If we think that we are immune to writing code violating the preceding
constraints, just we wait until the <code class="docutils literal notranslate"><span class="pre">condition</span></code> becomes a function of data
for which there is no sanity-checking in place.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="s">&quot;tail&quot;</span>

<span class="nf">mint</span><span class="p">(</span><span class="m">0.25</span><span class="p">)</span>
<span class="c1">## [1] &quot;tail&quot;</span>
<span class="nf">mint</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">5</span><span class="p">))</span>
<span class="c1">## Error in if (x &gt; 0.5) &quot;head&quot; else &quot;tail&quot;: the condition has length &gt; 1</span>
<span class="nf">mint</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">1</span><span class="p">)))</span><span class="w">  </span><span class="c1"># not obvious, error triggered sometimes</span>
<span class="c1">## Warning in log(rnorm(1)): NaNs produced</span>
<span class="c1">## Error in if (x &gt; 0.5) &quot;head&quot; else &quot;tail&quot;: missing value where TRUE/FALSE</span>
<span class="c1">##     needed</span>
</pre></div>
</div>
<p><a class="reference internal" href="210-design.html#chap-design"><span class="std std-numref">Chapter 9</span></a> will be concerned with ensuring
input data integrity so that such cases will either fail
gracefully or succeed bombastically.
In the above example, we should probably verify that <code class="docutils literal notranslate"><span class="pre">x</span></code> is a single finite
numeric value. Alternatively, we might need to apply
<strong class="command">ifelse</strong>, <strong class="command">all</strong>, or <strong class="command">any</strong>.</p>
</div>
<p>Interestingly, conditions other that logical are coerced:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># i.e., length(x) != 0, but way less readable</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;length is not zero\n&quot;</span><span class="p">)</span>
<span class="c1">## length is not zero</span>
</pre></div>
</div>
<p>Recall that coercion of numeric to logical yields <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if and
only if the original value is zero.</p>
</section>
<section id="short-circuit-evaluation">
<span id="sec-short-circuit-ops"></span><h3><span class="section-number">8.1.4. </span>Short-circuit evaluation<a class="headerlink" href="#short-circuit-evaluation" title="Link to this heading">¶</a></h3>
<p>Especially for formulating logical conditions
in <strong class="command">if</strong> and <strong class="command">while</strong> (see below),
we have the <em>scalar</em> `<strong class="command">||</strong>` (alternative) and
`<strong class="command">&amp;&amp;</strong>` (conjunction) operators.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="kc">FALSE</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">TRUE</span>
<span class="c1">## [1] TRUE</span>
<span class="kc">NA</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">TRUE</span>
<span class="c1">## [1] TRUE</span>
</pre></div>
</div>
<p>Contrary to their vectorised counterparts (`<strong class="command">|</strong>`
and `<strong class="command">&amp;</strong>`),
the scalar operators are lazy (<a class="reference internal" href="340-lazy.html#chap-lazy"><span class="std std-numref">Chapter 17</span></a>) in the sense
that they evaluate the first operand and then determine if the computing
of the second one is necessary
(because, e.g., <code class="docutils literal notranslate"><span class="pre">FALSE</span> <span class="pre">&amp;&amp;</span> <span class="pre">whatever</span></code> is always <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> anyway).
Therefore,</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># compute b only if a is TRUE</span>
<span class="w">        </span><span class="n">expression</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>corresponds to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expression</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># compute b only if a is FALSE</span>
<span class="w">    </span><span class="n">expression</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For instance,
“<strong class="command">is.vector</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span> <span class="pre">&amp;&amp;</span> </code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span> <span class="pre">&gt;</span> <span class="pre">0</span> <span class="pre">&amp;&amp;</span> <span class="pre">x[[1]]</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>”
is a risk-free test. It takes into account that <code class="docutils literal notranslate"><span class="pre">x[[1]]</span></code> has
the desired meaning only for objects that are nonempty vectors.</p>
<p>Some more examples:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;ham&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;cherries&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">}</span>
<span class="c1">## spamham</span>
<span class="c1">## [1] TRUE</span>
<span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;ham&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;cherries&quot;</span><span class="p">);</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">}</span>
<span class="c1">## spamham</span>
<span class="c1">## [1] FALSE</span>
</pre></div>
</div>
<p>Recall that the expressions
within the curly braces are evaluated one after another
and that the result is determined by the last value in the series.</p>
<div class="proof proof-type-exercise" id="id9">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.3</span>
        
    </div><div class="proof-content">
<p>Study the source code of
<strong class="command">isTRUE</strong> and <strong class="command">isFALSE</strong>
and determine if these functions could be useful in
formulating the conditions within the <strong class="command">if</strong> expressions.</p>
</div></div></section>
</section>
<section id="exception-handling">
<span id="sec-exceptions"></span><h2><span class="section-number">8.2. </span>Exception handling<a class="headerlink" href="#exception-handling" title="Link to this heading">¶</a></h2>
<p>Exceptions are exceptional, but they may happen and break stuff. For
instance, we are in deep skit when the internet connection drops while
we try to download a file, an optimisation algorithm fails to converge, or:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;/path/to/a/file/that/does/not/exist&quot;</span><span class="p">)</span>
<span class="c1">## Warning in file(file, &quot;rt&quot;): cannot open file &#39;/path/to/a/file/that/does/</span>
<span class="c1">##     not/exist&#39;: No such file or directory</span>
<span class="c1">## Error in file(file, &quot;rt&quot;): cannot open the connection</span>
</pre></div>
</div>
<p>Three types of <em>conditions</em> are frequently observed:</p>
<ul class="simple">
<li><p><em>errors</em> stop the flow of execution,</p></li>
<li><p><em>warnings</em> are not critical, but can be turned into errors
(see <code class="docutils literal notranslate"><span class="pre">warn</span></code> in <strong class="command">option</strong>),</p></li>
<li><p><em>messages</em> transmit diagnostic information.</p></li>
</ul>
<p>They can be manually triggered using the
<strong class="command">stop</strong>, <strong class="command">warning</strong>, and <strong class="command">message</strong> functions.</p>
<p>Errors (but warnings too) can be handled by means of the
<strong class="command">tryCatch</strong> function, amongst others.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tryCatch</span><span class="p">({</span><span class="w">           </span><span class="c1"># block of expressions to execute, until an error occurs</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;a...\n&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;b!&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1"># error – breaks the linear control flow</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;c?\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># executed immediately on an error</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;[error] %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">[[</span><span class="s">&quot;message&quot;</span><span class="p">]]))</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">finally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># always executed at the end, regardless of error occurrence</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;d.\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
<span class="c1">## a...</span>
<span class="c1">## [error] b!</span>
<span class="c1">## d.</span>
</pre></div>
</div>
<p>The two other conditions can be ignored by calling
<strong class="command">suppressWarnings</strong> and
<strong class="command">suppressMessages</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">log</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span>
<span class="c1">## Warning in log(-1): NaNs produced</span>
<span class="c1">## [1] NaN</span>
<span class="nf">suppressWarnings</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="m">-1</span><span class="p">))</span><span class="w">  </span><span class="c1"># yeah, yeah, we know what we&#39;re doing</span>
<span class="c1">## [1] NaN</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.4</span>
        
    </div><div class="proof-content">
<p>At the time of writing this book,
when the <strong class="program">data.table</strong> package is attached,
it emits a message.
Call <strong class="command">suppressMessages</strong> to silence it.
Note that consecutive calls to <strong class="command">library</strong> do not
reload an already loaded package. Therefore, the message will only
be seen once per R session.</p>
</div></div><p>Related functions include <strong class="command">stopifnot</strong> discussed
in <a class="reference internal" href="210-design.html#sec-fun-io"><span class="std std-numref">Section 9.1</span></a> and <strong class="command">on.exit</strong> mentioned
in <a class="reference internal" href="340-lazy.html#sec-on-exit"><span class="std std-numref">Section 17.4</span></a>; see <a class="reference internal" href="210-design.html#sec-code-quality"><span class="std std-numref">Section 9.2.4</span></a>
for some code debugging tips.</p>
</section>
<section id="repeated-evaluation">
<span id="sec-loops"></span><h2><span class="section-number">8.3. </span>Repeated evaluation<a class="headerlink" href="#repeated-evaluation" title="Link to this heading">¶</a></h2>
<p>And now for something completely different…
time for the elephant in the room!</p>
<p>We have been able to manage without loops so far
(and will be quite all right in the second part of the book too).
This is because many data processing tasks can be written in terms
of vectorised operations such as
`<strong class="command">+</strong>`,
<strong class="command">sqrt</strong>,
<strong class="command">sum</strong>,
`<strong class="command">[</strong>`,
<strong class="command">Map</strong>, and
<strong class="command">Reduce</strong>.
Oftentimes, compared to their loop-based counterparts, they are more
readable and efficient. We will explore this in the coming exercises.</p>
<p>However, at times, using an explicit <strong class="command">while</strong> or <strong class="command">for</strong> loop
might be the only natural way to solve a problem,
for instance, when processing chunks of data streams.
Also, an explicitly “looped” algorithm may occasionally
have better<a class="footnote-reference brackets" href="#footcpp" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> time or memory complexity.</p>
<section id="while">
<h3><span class="section-number">8.3.1. </span><strong class="command">while</strong><a class="headerlink" href="#while" title="Link to this heading">¶</a></h3>
<p><strong class="command">if</strong> considers a logical condition provided and determines
whether to execute a given statement. On the other hand:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">while </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w">  </span><span class="c1"># single TRUE or FALSE, as in `if`</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>evaluates a given <code class="docutils literal notranslate"><span class="pre">expression</span></code> <em>as long as</em> the logical <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true.
Therefore, it is advisable to make the <code class="docutils literal notranslate"><span class="pre">condition</span></code> dependent on
some variable that the <code class="docutils literal notranslate"><span class="pre">expression</span></code> can modify.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">while </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span>
<span class="c1">## 1, 2, 3,</span>
</pre></div>
</div>
<p>Nested loops are possible too:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">while </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="nf">while </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%d %d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span>
<span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span>
<span class="c1">## 1 1, 1 2, 1 3,</span>
<span class="c1">## 2 1, 2 2, 2 3,</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id11">

    <div class="proof-title">
        <span class="proof-type">Example 8.5</span>
        
    </div><div class="proof-content">
<p>Implement a simple linear congruential pseudorandom number generator
that, given some seed <span class="math">\(X_0\in [0, m)\)</span>,
outputs a sequence <span class="math">\((X_1,X_2,\dots)\)</span> defined by:</p>
<div class="math-wrapper docutils container">
<div class="math">
\[
X_i = (a X_{i-1} + c) \mod m,
\]</div>
</div>
<p>with, e.g.,  <span class="math">\(a=75\)</span>, <span class="math">\(c=74\)</span>, and <span class="math">\(m=2^{16}+1\)</span>
(here, <em>mod</em> is the division remainder, `<strong class="command">%%</strong>`).
This generator has poor statistical properties
and its use in practice is discouraged.
In particular, after a rather small number of iterations <span class="math">\(k\)</span>,
we will find a cycle such that <span class="math">\(X_k=X_1, X_{k+1}=X_2, \dots\)</span>.</p>
</div></div></section>
<section id="for">
<h3><span class="section-number">8.3.2. </span><strong class="command">for</strong><a class="headerlink" href="#for" title="Link to this heading">¶</a></h3>
<p>The for-each loop:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">vector</span><span class="p">)</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>takes each element, from the beginning to the end,
in a given <code class="docutils literal notranslate"><span class="pre">vector</span></code>, assigns it some <code class="docutils literal notranslate"><span class="pre">name</span></code>, and evaluates the <code class="docutils literal notranslate"><span class="pre">expression</span></code>.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fridge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eggs&quot;</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">food</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">fridge</span><span class="p">)</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%s, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">food</span><span class="p">))</span>
<span class="c1">## spam, spam, bacon, eggs,</span>
</pre></div>
</div>
<p>Another example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">fridge</span><span class="p">))</span><span class="w">  </span><span class="c1"># better: seq_along(fridge); see below</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%s, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fridge</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="c1">## spam, spam, bacon, eggs,</span>
</pre></div>
</div>
<p>One more:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%d %d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">## 1 1, 1 2, 1 3,</span>
<span class="c1">## 2 1, 2 2, 2 3,</span>
</pre></div>
</div>
<p>The iterator still exists after the loop’s watch has ended:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1">## [1] 2</span>
<span class="nf">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Writing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>is reckless. If <code class="docutils literal notranslate"><span class="pre">x</span></code> is an empty vector, then we will observe undesired
behaviour because we ask to iterate over <code class="docutils literal notranslate"><span class="pre">1:0</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">logical</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1">## [1] NA</span>
<span class="c1">## logical(0)</span>
</pre></div>
</div>
<p>Recall from <a class="reference internal" href="150-indexing.html#chap-indexing"><span class="std std-numref">Chapter 5</span></a> that
<code class="docutils literal notranslate"><span class="pre">x[1]</span></code> tries to access an out-of-bounds element here,
and <code class="docutils literal notranslate"><span class="pre">x[0]</span></code> returns nothing. We generally suggest replacing
<code class="docutils literal notranslate"><span class="pre">1:</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>
with <strong class="command">seq_along</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> or
<strong class="command">seq_len</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">length</strong><code class="code docutils literal notranslate"><span class="pre">(x))</span></code>
wherever possible.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The preceding model <strong class="command">for</strong> loop is roughly equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
<span class="n">tmp_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span>
<span class="n">tmp_iter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">while </span><span class="p">(</span><span class="n">tmp_iter</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">tmp_vector</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp_vector</span><span class="p">[[</span><span class="n">tmp_iter</span><span class="p">]]</span>
<span class="w">    </span><span class="n">expression</span>
<span class="w">    </span><span class="n">tmp_iter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp_iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">tmp_vector</span></code> is determined before the loop itself.
Hence, any changes to the <code class="docutils literal notranslate"><span class="pre">vector</span></code> will not influence the execution flow.
Furthermore, due to the use of `<strong class="command">[[</strong>`, the loop can also
be applied on lists.</p>
</div>
<div class="proof proof-type-example" id="id12">

    <div class="proof-title">
        <span class="proof-type">Example 8.6</span>
        
    </div><div class="proof-content">
<p>Let <code class="docutils literal notranslate"><span class="pre">x</span></code> be a list and <strong class="command">f</strong> be a function.
The following code generates the same result
as <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x)</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">  </span><span class="c1"># a new list of length `n`</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">ret</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-example" id="id13">

    <div class="proof-title">
        <span class="proof-type">Example 8.7</span>
        
    </div><div class="proof-content">
<p>Let <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> be two lists and <strong class="command">f</strong> be a function.
Here is the most basic version of
<strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">y)</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ny</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">)</span>
<span class="n">ret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vector</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">ret</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">[[((</span><span class="n">i</span><span class="m">-1</span><span class="p">)</span><span class="o">%%</span><span class="n">nx</span><span class="p">)</span><span class="m">+1</span><span class="p">]],</span><span class="w"> </span><span class="n">y</span><span class="p">[[((</span><span class="n">i</span><span class="m">-1</span><span class="p">)</span><span class="o">%%</span><span class="n">ny</span><span class="p">)</span><span class="m">+1</span><span class="p">]])</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> might be of different lengths.
Feel free to upgrade this code by adding a warning like
<em>the longer argument is not a multiple of the length of the shorter one</em>.
Also, rewrite it without using the modulo operator, `<strong class="command">%%</strong>`.</p>
</div></div></section>
<section id="break-and-next">
<h3><span class="section-number">8.3.3. </span><strong class="command">break</strong> and <strong class="command">next</strong><a class="headerlink" href="#break-and-next" title="Link to this heading">¶</a></h3>
<p><strong class="command">break</strong> can be used to escape the current loop.
<strong class="command">next</strong> skips the remaining expressions and advances
to the next iteration (where the testing of
the logical condition occurs).
Here is a rather random example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="m">0.04</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span>
<span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="nf">for </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w">  </span><span class="c1"># skip the current element if it is greater than 0.1</span>
<span class="w">        </span><span class="n">next</span>

<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">  </span><span class="c1"># stop at the first element less than 0.01</span>
<span class="w">        </span><span class="n">break</span>

<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span>
<span class="p">}</span>
<span class="c1">## [1] 0.03</span>
<span class="c1">## [1] 0.04</span>
<span class="c1">## [1] 0.001</span>
<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1">## [1] 0.07</span>
</pre></div>
</div>
<p>We have used a frequently occurring design pattern:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
<span class="w">        </span><span class="n">next</span>

<span class="w">    </span><span class="n">many_statements...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>which is equivalent to:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">many_statements...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>but which avoids introducing a nested block of expressions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
There is a third loop type,</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">repeat</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>which is a shorthand for:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">while </span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>i.e., it is a possibly infinite loop. Such constructs are invaluable when
expressing situations like <em>repeat</em>-something-<em>until</em>-success,
e.g., when we want to execute a command at least once.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="n">repeat</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># while (TRUE)</span>
<span class="w">    </span><span class="c1"># simulate dice casting until we throw &quot;1&quot;</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="n">break</span><span class="w">  </span><span class="c1"># repeat until this</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="m">+1</span><span class="w">  </span><span class="c1"># how many times until success</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1">## [1] 6</span>
</pre></div>
</div>
</div>
<div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.8</span>
        
    </div><div class="proof-content">
<p>What is wrong with the following code?</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">while </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="n">next</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id15">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.9</span>
        
    </div><div class="proof-content">
<p>What about this one?</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">while </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</div></div></section>
<section id="return">
<h3><span class="section-number">8.3.4. </span><strong class="command">return</strong><a class="headerlink" href="#return" title="Link to this heading">¶</a></h3>
<p><strong class="command">return</strong>, when called from within a function,
immediately yields a specified value and goes back to the caller.
For example, here is a simple recursive function
that flattens a given list:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">my_unlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">is.atomic</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">        </span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># so if we are here, x is definitely not atomic</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="nf">my_unlist</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="w">    </span><span class="n">out</span><span class="w">  </span><span class="c1"># or return(out); not necessary as it&#39;s the last expression</span>
<span class="p">}</span>

<span class="nf">my_unlist</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="o">:</span><span class="m">10</span><span class="p">)))))</span>
<span class="c1">##  [1]  1  2  3  4  5  6  7  8  9 10</span>
</pre></div>
</div>
<p><strong class="command">return</strong> is a function: the round brackets are obligatory.</p>
</section>
<section id="time-and-space-complexity-of-algorithms">
<span id="sec-time-complexity"></span><h3><span class="section-number">8.3.5. </span>Time and space complexity of algorithms (*)<a class="headerlink" href="#time-and-space-complexity-of-algorithms" title="Link to this heading">¶</a></h3>
<p>Analysis of algorithms can give us a rough estimate of their run time
or memory consumption as a function of the input problem size,
especially for <em>big</em> data (e.g., <span id="id4">[<a class="reference internal" href="999-bibliography.html#id68" title="Cormen, T.H., Leiserson, C.E., Rivest, R.L., and Stein, C. (2009).  Introduction to Algorithms. MIT Press and McGraw-Hill.">14</a>, <a class="reference internal" href="999-bibliography.html#id32" title="Knuth, D.E. (1997).  The Art of Computer Programming I: Fundamental Algorithms. Addison-Wesley.">43</a>]</span>).
In scientific computing and data science, we often deal with vectors
(sequences) or matrices/data frames (tabular data).
Therefore, we might be interested in determining how many
<em>primitive operations</em> need to be performed as a function
of their length <span class="math">\(n\)</span> or the number of rows <span class="math">\(n\)</span> and columns <span class="math">\(m\)</span>,
respectively.</p>
<p>The <span class="math">\(O\)</span> (Big-Oh) notation can express
the upper bounds for time/resource consumption in asymptotic cases.
For instance, we say that the time complexity is <span class="math">\(O(n^2)\)</span>,
if for large <span class="math">\(n\)</span>, the number of operations to perform
or memory cells to use will be proportional to <em>at most</em> the square of
the vector size (more precisely, there exists <span class="math">\(m\)</span> and <span class="math">\(C&gt;0\)</span>
such that for all <span class="math">\(n&gt;m\)</span>, the number of operations is <span class="math">\(\le Cn^2\)</span>).</p>
<p>Therefore, if we have two algorithms that solve the same task,
one that has <span class="math">\(O(n^2)\)</span> time complexity, and other of <span class="math">\(O(n^3)\)</span>,
it is better to choose the former.
For large problem sizes, we expect it to be faster.
Moreover, whether time grows proportionally to
<span class="math">\(\log n\)</span>, <span class="math">\(\sqrt{n}\)</span>, <span class="math">\(n\)</span>, <span class="math">\(n\log n\)</span>, <span class="math">\(n^2\)</span>, <span class="math">\(n^3\)</span>, or <span class="math">\(2^n\)</span>,
can be informative in predicting how big the data can be if we have
a fixed deadline or not enough space left on the disk.</p>
<div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.10</span>
        
    </div><div class="proof-content">
<p>The <strong class="command">hclust</strong> function determines a hierarchical clustering
of a dataset. It is fed with an object that stores the distance
between all the pairs of input points.
There are <span class="math">\(n(n-1)/2\)</span>  (i.e., <span class="math">\(O(n^2)\)</span>) unique point pairs for any given <span class="math">\(n\)</span>.
One numeric scalar (<code class="docutils literal notranslate"><span class="pre">double</span></code> type) takes 8 bytes of storage.
If you have 16 GiB of RAM, what is the largest dataset that you
can process on your machine using this function?</p>
</div></div><p>Oftentimes, we can learn about the time or memory complexity
of the functions we use from their documentation;
see, e.g., <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;findInterval&quot;)</span></code>.</p>
<div class="proof proof-type-example" id="id17">

    <div class="proof-title">
        <span class="proof-type">Example 8.11</span>
        
    </div><div class="proof-content">
<p>A course in data structures in algorithms, which this one is not,
will give us plenty of opportunities to implement many algorithms ourselves.
This way, we can gain a lot of insights and intuitions.
For instance, here is an <span class="math">\(O(n)\)</span>-time algorithm:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">expression</span>
</pre></div>
</div>
<p>and this one runs in <span class="math">\(O(n^2)\)</span> time:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">        </span><span class="n">expression</span>
</pre></div>
</div>
<p>as long as, of course, the <code class="docutils literal notranslate"><span class="pre">expression</span></code> is rather primitive (e.g.,
operations on scalar variables).</p>
<p>R is a very expressive language. Hence, complex and lengthy
operations can look pretty innocent. After all,
it is a glue language for rapid prototyping.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">[[</span><span class="n">j</span><span class="p">]]</span>
</pre></div>
</div>
<p>can be seen as running in <span class="math">\(O(n^3)\)</span> time if each element in the lists
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> as well as <code class="docutils literal notranslate"><span class="pre">z</span></code> itself are atomic vectors of length <span class="math">\(n\)</span>.
Similarly,</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Map</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>is <span class="math">\(O(n^2)\)</span> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a list of <span class="math">\(n\)</span> atomic vectors, each of length <span class="math">\(n\)</span>.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>A quite common statistical scenario
involves generating a data buffer of a fixed size:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">  </span><span class="c1"># start with an empty vector</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">ret</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">generate_data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">  </span><span class="c1"># here: ret[[length(ret)+1]] &lt;- ...</span>
</pre></div>
</div>
<p>This notation, however, involves growing the <code class="docutils literal notranslate"><span class="pre">ret</span></code> array
in each iteration. Luckily, since R version 3.4.0,
each such size extension has amortised <span class="math">\(O(1)\)</span> time
as some more memory is internally reserved for its
prospective growth (dynamic arrays; see, e.g., Chapter 17 of <span id="id5">[<a class="reference internal" href="999-bibliography.html#id68" title="Cormen, T.H., Leiserson, C.E., Rivest, R.L., and Stein, C. (2009).  Introduction to Algorithms. MIT Press and McGraw-Hill.">14</a>]</span>).</p>
<p>However, it is better to preallocate the output vector
of the desired final size.
We can construct vectors of specific lengths and types
in an efficient way (more efficient than with <strong class="command">rep</strong>) by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">numeric</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] 0 0 0</span>
<span class="nf">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="c1">## numeric(0)</span>
<span class="nf">logical</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="c1">## [1] FALSE FALSE FALSE FALSE FALSE</span>
<span class="nf">character</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [1] &quot;&quot; &quot;&quot;</span>
<span class="nf">vector</span><span class="p">(</span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>
<span class="c1">## [1] 0 0 0 0 0 0 0 0</span>
<span class="nf">vector</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## NULL</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## NULL</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not all data fit into memory, but it does not mean that we should
start installing Apache Hadoop and Spark immediately.
Some datasets can be processed chunk by chunk.
R enables data stream handling (some can be of infinite length)
through file connections. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="s">&quot;https://github.com/gagolews/teaching-data/raw/master/README.md&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">open</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># a big file, the biggest file ever</span>
<span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="nf">while </span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">few_lines</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">readLines</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">  </span><span class="c1"># reads only four lines at a time</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">few_lines</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="n">break</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">few_lines</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">close</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">  </span><span class="c1"># the number of lines</span>
<span class="c1">## [1] 90</span>
</pre></div>
</div>
<p>Many functions support reading from/writing to already
established connections of different types, e.g., <strong class="command">file</strong>,
<strong class="command">gzfile</strong>, <strong class="command">textConnection</strong>, batch by batch.
A common scenario involves reading a very large CSV, JSON, or XML file
only by thousands of lines/records at a time,
parsing and cleansing them, and exporting them to SQL databases
(which we will exercise in <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>).</p>
</div>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">8.4. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<p>From now on, we must stay alert. Many, if not all, of the undermentioned tasks,
can still be implemented without the explicit use of the R loops but
based only on the operations covered in the previous chapters.
If this is the case, try composing both the looped
and loop-free versions.
Use <strong class="command">proc.time</strong> to compare their run times<a class="footnote-reference brackets" href="#footalg" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
<div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.12</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>Let <code class="docutils literal notranslate"><span class="pre">x</span></code> be a numeric vector. When does
“<strong class="command">if</strong><code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">...</span></code>” yield a warning?
When does it give an error? How to guard ourselves against them?</p></li>
<li><p>What is a dangling <strong class="command">else</strong>?</p></li>
<li><p>What happens if you put <strong class="command">if</strong> as the last expression
in a curly braces block within a function’s body?</p></li>
<li><p>Why do we say that `<strong class="command">&amp;&amp;</strong>` and `<strong class="command">||</strong>`
are lazy? What are their use cases?</p></li>
<li><p>What is the difference between `<strong class="command">&amp;&amp;</strong>` and `<strong class="command">&amp;</strong>`?</p></li>
<li><p>Can <strong class="command">while</strong> always be replaced with <strong class="command">for</strong>?
What about the other way around?</p></li>
<li><p>What is wrong with “<strong class="command">return</strong><code class="code docutils literal notranslate"> <span class="pre">(1+2)*3</span></code>”?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.13</span>
        
    </div><div class="proof-content">
<p>Verify which of the following can be safely used as logical conditions
in <strong class="command">if</strong> statements. If that is not the case for all <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, …,
determine the additional conditions that must be imposed
to make them valid.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">0</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x[y]</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>,</p></li>
<li><p><strong class="command">any</strong><code class="code docutils literal notranslate"><span class="pre">(x&gt;0)</span></code>,</p></li>
<li><p><strong class="command">match</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>,</p></li>
<li><p><strong class="command">any</strong><code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">%in%</span> <span class="pre">y)</span></code>.</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.14</span>
        
    </div><div class="proof-content">
<p>What can go wrong in the following code chunk, depending on
the type and form of <code class="docutils literal notranslate"><span class="pre">x</span></code>? Consider as many scenarios as possible.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.15</span>
        
    </div><div class="proof-content">
<p>Implement <strong class="command">shift_left</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">n)</span></code> and
<strong class="command">shift_right</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">n)</span></code>.
The former function gets rid of the first <span class="math">\(n\)</span> observations in <code class="docutils literal notranslate"><span class="pre">x</span></code>
and adds <span class="math">\(n\)</span> missing values at the end of the resulting vector,
e.g., <strong class="command">shift_left</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5),</span> <span class="pre">2)</span></code>
is <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">5,</span> <span class="pre">NA,</span> <span class="pre">NA)</span></code>.
On the other hand,
<strong class="command">shift_right</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5),</span> <span class="pre">2)</span></code> is
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(NA,</span> <span class="pre">NA,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.16</span>
        
    </div><div class="proof-content">
<p>Implement your version of <strong class="command">diff</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.17</span>
        
    </div><div class="proof-content">
<p>Write a function that determines the longest ascending trend
in a given numeric vector, i.e.,
the length of the longest subsequence of consecutive increasing elements.
For example, the input <strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">2,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">3)</span></code>
should yield 4.</p>
</div></div><div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 8.18</span>
        
    </div><div class="proof-content">
<p>Implement the functions that round down and round up
each element in a numeric vector to a number of decimal digits.</p>
</div></div><div style="margin-top: 1em"></div><p>This concludes the first part of this magnificent book.</p>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footswitch" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>(*) Somewhat related is the <strong class="command">switch</strong> function
which relies on the lazy evaluation of its arguments
(<a class="reference internal" href="340-lazy.html#chap-lazy"><span class="std std-numref">Chapter 17</span></a>).
However, it can always be replaced by a series of <strong class="command">if</strong>s.</p>
</aside>
<aside class="footnote brackets" id="footcpp" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>In such a case, rewriting it in C or C++ might
be beneficial; see <a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a>.</p>
</aside>
<aside class="footnote brackets" id="footalg" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">3</a><span class="fn-bracket">]</span></span>
<p>It might be the case that a <strong class="command">for</strong>-based solution is
faster (e.g., for larger objects) because of the use
of a more efficient algorithm. Such cases will
benefit from a rewrite in C or C++ (<a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a>).</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="210-design.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">9. </span>Designing functions</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="170-function.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">7. </span>Functions</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2024 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2024-08-26T12:21:30+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">8. Flow of execution</a><ul>
<li><a class="reference internal" href="#conditional-evaluation">8.1. Conditional evaluation</a><ul>
<li><a class="reference internal" href="#return-value">8.1.1. Return value</a></li>
<li><a class="reference internal" href="#nested-ifs">8.1.2. Nested <strong class="command">if</strong>s</a></li>
<li><a class="reference internal" href="#condition-either-true-or-false">8.1.3. Condition: Either <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code></a></li>
<li><a class="reference internal" href="#short-circuit-evaluation">8.1.4. Short-circuit evaluation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exception-handling">8.2. Exception handling</a></li>
<li><a class="reference internal" href="#repeated-evaluation">8.3. Repeated evaluation</a><ul>
<li><a class="reference internal" href="#while">8.3.1. <strong class="command">while</strong></a></li>
<li><a class="reference internal" href="#for">8.3.2. <strong class="command">for</strong></a></li>
<li><a class="reference internal" href="#break-and-next">8.3.3. <strong class="command">break</strong> and <strong class="command">next</strong></a></li>
<li><a class="reference internal" href="#return">8.3.4. <strong class="command">return</strong></a></li>
<li><a class="reference internal" href="#time-and-space-complexity-of-algorithms">8.3.5. Time and space complexity of algorithms (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">8.4. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=d29a5c0e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>