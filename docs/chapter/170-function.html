<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2024" name="citation_date" />
<meta content="2024" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is a comprehensive and in-depth introductory course on one of the most popular languages for data science. It equips ambitious students, professionals, and researchers with the knowledge and skills to become independent users of this potent environment so that they can tackle any problem related to data wrangling and analytics, numerical computing, statistics, and machine learning. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="8. Flow of execution" href="180-flow.html" /><link rel="prev" title="6. Character vectors" href="160-character.html" />
        <link rel="canonical" href="https://deepr.gagolewski.com/chapter/170-function.html" />

    <link rel="shortcut icon" href="https://www.gagolewski.com/_static/img/deepr.png"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>7. Functions - Deep R Programming</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1e0fcfc0" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Deep R Programming</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<div class="sidebar-logo-container">
  <a class="sidebar-brand" href="../index.html"><img class="sidebar-logo" src="https://www.gagolewski.com/_static/img/deepr.png" alt="Logo"/></a>
</div>

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">Deep R Programming</a>
</span>
<div class="sidebar-brand">
An open-access textbook<br />
by <a href='https://www.gagolewski.com/' style="display: contents">Marek Gagolewski</a><br />
v1.0.0.9005
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This book in PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-paper-copy.html">Order a paper copy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr">Report bugs or typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Data wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character vectors</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="230-matrix.html">11. Matrices and other arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compiled.html">14. Interfacing compiled code (**)</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. Unevaluated expressions (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. Environments and evaluation (*)</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-lazy.html">17. Lazy evaluation (**)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/deepr" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="functions">
<span id="chap-function"></span><h1><span class="section-number">7. </span>Functions<a class="headerlink" href="#functions" title="Link to this heading">¶</a></h1>
<blockquote>
<div><p><em>This open-access textbook
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>;
a paper copy can also be <a class="reference internal" href="../order-paper-copy.html"><span class="doc std std-doc">ordered</span></a>).
It is a non-profit project. Although available online, it is a whole course,
and should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks. Any
<a class="reference external" href="https://github.com/gagolews/deepr">bug/typo reports/fixes</a>
are appreciated. Make sure to check out
<a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a>
<span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2024).  Minimalist Data Wrangling with Python. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">27</a>]</span> too.</em></p>
</div></blockquote>
<p>R is a <em>functional</em> language, i.e., one where functions play first fiddle.
Each action we perform reduces itself to a call to some function
or a combination thereof.</p>
<p>So far, we have been tinkering with dozens of available functions
which were mostly part of base R.
They constitute the essential vocabulary that everyone
<em>must</em> be able to speak fluently.</p>
<p>Any operation, be it <strong class="command">sum</strong>, <strong class="command">sqrt</strong>,
or <strong class="command">paste</strong>, when fed with a number of arguments,
generates a (hopefully fruitful) return value.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1"># invoking `sum` on a specific argument</span>
<span class="c1">## [1] 55</span>
</pre></div>
</div>
<p>From a user’s perspective, each function is merely a tool. To achieve a goal
at hand, we do not have to care about what is going on under its bonnet,
i.e., how the inputs are being transformed so that, after a couple
of nanoseconds or hours, we can relish what has been bred. This is very convenient: all we need to know is the function’s specification which can be stated, for example, informally, in plain Polish or Malay,
on its help page.</p>
<p>In this chapter, we will learn how to write our <em>own</em> functions.
Using this skill is a good development practice when we expect
that <em>the same operations</em> will need to be <em>executed many times</em>
but perhaps on <em>different data</em>.</p>
<p>Also, some functions invoke other procedures,
for instance, on every element in a list or every section of a
data frame grouped by a qualitative variable. Thus,
it is advisable to learn how we can specify a custom operation
to be propagated thereover.</p>
<div class="proof proof-type-example" id="id7">

    <div class="proof-title">
        <span class="proof-type">Example 7.1</span>
        
    </div><div class="proof-content">
<p>Given some objects (whatever):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">16</span><span class="p">)</span>
<span class="n">x2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">32</span><span class="p">)</span>
<span class="n">x3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">64</span><span class="p">)</span>
</pre></div>
</div>
<p>assume we want to apply the same action on different data,
say, compute the root mean square.
Then, instead of retyping almost identical
expressions (or a bunch of them) over and over again:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">x1</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w">  </span><span class="c1"># very fresh</span>
<span class="c1">## [1] 0.6545</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">x2</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w">  </span><span class="c1"># the same second time; borderline okay</span>
<span class="c1">## [1] 0.56203</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">x3</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w">  </span><span class="c1"># third time the same; tedious, barbarous, and error-prone</span>
<span class="c1">## [1] 0.57206</span>
</pre></div>
</div>
<p>we can <em>generalise</em> the operation to any object like <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rms</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">                   </span><span class="c1"># bind the name `rms` to...</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">          </span><span class="c1"># a function that takes one parameter, `x`</span>
<span class="w">        </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w">  </span><span class="c1"># transforming the input to yield output this way</span>
</pre></div>
</div>
<p>and then reuse it on different <em>concrete</em> data instances:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rms</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
<span class="c1">## [1] 0.6545</span>
<span class="nf">rms</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
<span class="c1">## [1] 0.56203</span>
<span class="nf">rms</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span>
<span class="c1">## [1] 0.57206</span>
</pre></div>
</div>
<p>or even combine it with other function calls:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rms</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">)))</span><span class="o">^</span><span class="m">2</span>
<span class="c1">## [1] 0.50824</span>
</pre></div>
</div>
<p>Thus, custom functions are very useful.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Does writing own functions equal reinventing the wheel?
Can everything be found online these days (including
on Stack Overflow, GitHub, or CRAN)? Luckily, it is not the case.
Otherwise, data analysts’, researchers’, and developers’ lives would be
monotonous, dreary, and uninspiring. What is more, we might be able
to compose a function from scratch much more quickly than to get through
the whole garbage dump called the internet from where, only occasionally,
we can dig out some pearls. Let’s remember that we advocate for minimalism
in this book. We will reflect on such issues in <a class="reference internal" href="210-design.html#chap-design"><span class="std std-numref">Chapter 9</span></a>.
There is also the <em>personal growth</em> side: we become more skilled programmers
by crunching those exercises.</p>
</div>
<section id="creating-and-invoking-functions">
<h2><span class="section-number">7.1. </span>Creating and invoking functions<a class="headerlink" href="#creating-and-invoking-functions" title="Link to this heading">¶</a></h2>
<section id="anonymous-functions">
<h3><span class="section-number">7.1.1. </span>Anonymous functions<a class="headerlink" href="#anonymous-functions" title="Link to this heading">¶</a></h3>
<p>Functions are usually created through the following notation:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="n">body</span>
</pre></div>
</div>
<p>First, <code class="docutils literal notranslate"><span class="pre">args</span></code> is a (possibly empty) list of comma-separated parameter
names which act as <em>input</em> variables.</p>
<p>Second, <code class="docutils literal notranslate"><span class="pre">body</span></code> is a <em>single</em> R expression that is evaluated
when the function is called.
The value this expression yields will constitute the function’s
output.</p>
<p>For example, here is a definition of a function that takes
no inputs and generates a constant output:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="m">1</span>
<span class="c1">## function() 1</span>
</pre></div>
</div>
<p>We thus created a <em>function</em> object. However,
as we have not used it at all, it disappeared immediately thereafter.</p>
<p>Any function <strong class="command">f</strong> can be <em>invoked</em>, i.e., evaluated
on <em>concrete</em> data, using the syntax <strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(arg1,</span> <span class="pre">...,</span> <span class="pre">argn)</span></code>.
Here, <code class="docutils literal notranslate"><span class="pre">arg1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">argn</span></code> are expressions passed as <em>arguments</em>
to <strong class="command">f</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="m">1</span><span class="p">)()</span><span class="w">  </span><span class="c1"># invoking f like f(); here, no arguments are expected</span>
<span class="c1">## [1] 1</span>
</pre></div>
</div>
<p>Only now have we obtained a return value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
Calling <strong class="command">typeof</strong> on a function object will report
<code class="docutils literal notranslate"><span class="pre">&quot;closure&quot;</span></code> (user-defined functions),
<code class="docutils literal notranslate"><span class="pre">&quot;builtin&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;primitive&quot;</span></code> (built-in, base ones)
for the reasons that we explain in more detail
in <a class="reference internal" href="210-design.html#sec-closures"><span class="std std-numref">Section 9.4.3</span></a> and <a class="reference internal" href="330-environment.html#sec-lexical-scope"><span class="std std-numref">Section 16.3.2</span></a>. In our case:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="c1">## [1] &quot;closure&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="named-functions">
<h3><span class="section-number">7.1.2. </span>Named functions<a class="headerlink" href="#named-functions" title="Link to this heading">¶</a></h3>
<p>Names can be bound to function objects. This way, we can refer to them
multiple times:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">one</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># one &lt;- (function() 1)</span>
</pre></div>
</div>
<p>We created an object named <strong class="command">one</strong>
(we use bold font to indicate that it is of the type function
for functions are so crucial in R).
We are very familiar with such a notation, as not since yesterday we
are used to writing “<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">1</span></code>”, etc.</p>
<p>Invoking <strong class="command">one</strong>, which can be done by writing
<strong class="command">one</strong><code class="code docutils literal notranslate"><span class="pre">()</span></code>, will generate a return value:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">one</span><span class="p">()</span><span class="w">  </span><span class="c1"># (function() 1)()</span>
<span class="c1">## [1] 1</span>
</pre></div>
</div>
<p>This output can be used in further computations. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">:</span><span class="m">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">one</span><span class="p">()</span><span class="w">  </span><span class="c1"># 0:2 - (function() 1)(), i.e., 0:2 - 1</span>
<span class="c1">## [1] -1  0  1</span>
</pre></div>
</div>
</section>
<section id="passing-arguments-to-functions">
<h3><span class="section-number">7.1.3. </span>Passing arguments to functions<a class="headerlink" href="#passing-arguments-to-functions" title="Link to this heading">¶</a></h3>
<p>Functions with no arguments are kind of boring. Thus, let’s distil
a more highbrowed operation:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">concat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We created a mapping whose aim is to concatenate
two objects using a specialised call to <strong class="command">paste</strong>.
Yours faithfully pleads guilty to multiplying entities needlessly:
it <em>should</em> not be a problem for anyone to write
<strong class="command">paste</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">sep=&quot;&quot;)</span></code> each time.
Yet, ‘tis merely an illustration.</p>
<p>The <strong class="command">concat</strong> function has two <em>parameters</em>, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.
Hence, calling it will require the provision of two <em>arguments</em>,
which we put within round brackets and separate from each other by commas.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="nf">concat</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w">  </span><span class="c1"># i.e., concat(x=&quot;spam&quot;, y=1:5)</span>
<span class="c1">## [1] &quot;spam1&quot; &quot;spam2&quot; &quot;spam3&quot; &quot;spam4&quot; &quot;spam5&quot;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Notice the distinction: <em>parameters</em> (<em>formal arguments</em>)
are abstract, general, or symbolic;
“something, anything that will be put in place of <code class="docutils literal notranslate"><span class="pre">x</span></code> when the function is invoked”. Contrastingly, <em>arguments</em> (<em>actual parameters</em>)
are concrete, specific, and real.</p>
</div>
<p>During the above call, <code class="docutils literal notranslate"><span class="pre">x</span></code> in the function’s body is
precisely <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code> and nothing else.
Also, the <code class="docutils literal notranslate"><span class="pre">u</span></code> object from the caller’s environment
can be accessed via <code class="docutils literal notranslate"><span class="pre">y</span></code> in <strong class="command">concat</strong>.
Most of the time (yet, see <a class="reference internal" href="330-environment.html#sec-eval-fun"><span class="std std-numref">Section 16.3</span></a>),
it is best to think of the function as being fed not with <code class="docutils literal notranslate"><span class="pre">u</span></code> per se
but the value that <code class="docutils literal notranslate"><span class="pre">u</span></code> is bound to, i.e., <code class="docutils literal notranslate"><span class="pre">1:5</span></code>.</p>
<p>Also:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;spam&quot;</span>
<span class="nf">concat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># concat(x=&quot;spam&quot;, y=1:5)</span>
<span class="c1">## [1] &quot;spam1&quot; &quot;spam2&quot; &quot;spam3&quot; &quot;spam4&quot; &quot;spam5&quot;</span>
</pre></div>
</div>
<p>This call is equivalent to <strong class="command">concat</strong><code class="code docutils literal notranslate"><span class="pre">(x=y,</span> <span class="pre">y=x)</span></code>.
The argument <code class="docutils literal notranslate"><span class="pre">x</span></code> is assigned the value of <code class="docutils literal notranslate"><span class="pre">y</span></code> from
the calling environment, <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code>. Let’s stress that
one <code class="docutils literal notranslate"><span class="pre">x</span></code> is not the same as the other <code class="docutils literal notranslate"><span class="pre">x</span></code>; which is which
is unambiguously defined by the context.</p>
<div class="proof proof-type-exercise" id="id8">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.2</span>
        
    </div><div class="proof-content">
<p>Write a function <strong class="command">standardise</strong> that takes a numeric
vector <code class="docutils literal notranslate"><span class="pre">x</span></code> as argument and returns its standardised version,
i.e., from each element in <code class="docutils literal notranslate"><span class="pre">x</span></code>, subtract the sample arithmetic mean
and then divide it by the standard deviation.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="120-numeric.html#sec-rep"><span class="std std-numref">Section 2.1.3</span></a> mentioned that, syntactically speaking,
the following are perfectly valid alternatives to the positionally-matched
call <strong class="command">concat</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;spam&quot;,</span> <span class="pre">u)</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">concat</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
<span class="nf">concat</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
<span class="nf">concat</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
<span class="nf">concat</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
<span class="nf">concat</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
<span class="nf">concat</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, we recommend avoiding the last two
for the sake of the readers’ sanity.
It is best to provide positionally-matched arguments
before the keyword-based ones; see <a class="reference internal" href="320-language.html#sec-sys-call"><span class="std std-numref">Section 15.4.4</span></a>
for more details.</p>
<p>Also, <a class="reference internal" href="220-s3.html#sec-pipe"><span class="std std-numref">Section 10.4</span></a> mentions the (overused) forward pipe
operator, `<strong class="command">|&gt;</strong>`, which will enable us to rewrite
the above as “<code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span> <span class="pre">|&gt;</span> <span class="pre">concat(u)</span></code>”.</p>
</div>
</section>
<section id="grouping-expressions-with-curly-braces">
<h3><span class="section-number">7.1.4. </span>Grouping expressions with curly braces, `<strong class="command">{</strong>`<a class="headerlink" href="#grouping-expressions-with-curly-braces" title="Link to this heading">¶</a></h3>
<p>We have been informed that a function’s body is a <em>single</em> R expression
whose evaluated value is passed to the user as its output.
This may sound restrictive and in contrast with what we have
experienced so far. Seldom are we faced with such simple computing tasks,
and we have already seen R functions performing quite sophisticated
operations.</p>
<p>Grammatically, a single R expression can be arbitrarily complex
(<a class="reference internal" href="320-language.html#chap-language"><span class="std std-numref">Chapter 15</span></a>). We can use curly braces to group many calls
that are to be evaluated one after another. For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;first expression\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;second expression\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;last expression\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">## first expression</span>
<span class="c1">## second expression</span>
<span class="c1">## last expression</span>
</pre></div>
</div>
<p>We used four spaces to visually indent the constituents
for greater readability (some developers prefer tabs over spaces,
others find two or three spaces more urbane, but we do not).
This single (compound) expression can now play a role
of a function’s body.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The last expression evaluated in a curly-braces delimited block
will be considered its output value.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="m">1</span>
<span class="w">    </span><span class="m">2</span>
<span class="w">    </span><span class="m">3</span><span class="w">  </span><span class="c1"># &lt;--- last expression: will be taken as the output value</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p>This code block can also be written more concisely
by replacing newlines with semicolons, albeit with perhaps some
loss in readability:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="m">2</span><span class="p">;</span><span class="w"> </span><span class="m">3</span><span class="p">}</span>
<span class="c1">## [1] 3</span>
</pre></div>
</div>
<p><a class="reference internal" href="210-design.html#sec-syntactic-sugar"><span class="std std-numref">Section 9.3</span></a> will give a few more details
about `<strong class="command">{</strong>`.</p>
</div>
<div class="proof proof-type-example" id="id9">

    <div class="proof-title">
        <span class="proof-type">Example 7.3</span>
        
    </div><div class="proof-content">
<p>Here is a version of our <strong class="command">concat</strong> function that guarantees
a more <a class="reference internal" href="120-numeric.html#chap-numeric"><span class="std std-numref">Chapter 2</span></a>-style missing values’ propagation:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">concat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">z</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA_character_</span>
<span class="w">    </span><span class="n">z</span><span class="w">  </span><span class="c1"># last expression in the block – return value</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example calls:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">concat</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] &quot;a1&quot; &quot;a2&quot; &quot;a3&quot;</span>
<span class="nf">concat</span><span class="p">(</span><span class="kc">NA_character_</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] NA NA NA</span>
<span class="nf">concat</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">))</span>
<span class="c1">## [1] &quot;1a&quot; NA   &quot;3c&quot; &quot;4a&quot; NA   &quot;6c&quot;</span>
</pre></div>
</div>
<p>Let’s appreciate the fact that we could keep the code brief thanks
to <strong class="command">paste</strong>’s and `<strong class="command">|</strong>`’s implementing the recycling rule.</p>
</div></div><div class="proof proof-type-exercise" id="id10">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.4</span>
        
    </div><div class="proof-content">
<p>Write a function <strong class="command">normalise</strong> that takes a numeric
vector <code class="docutils literal notranslate"><span class="pre">x</span></code> and returns its version shifted and scaled
to the [0, 1] interval. To do so, subtract the sample minimum
from each element, and then divide it by the range,
i.e., the difference between the maximum and the minimum.
Avoid computing <strong class="command">min</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> twice.</p>
</div></div><div class="proof proof-type-exercise" id="id11">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.5</span>
        
    </div><div class="proof-content">
<p>Write a function that applies the robust standardisation of a numeric
vector: subtract the median and divide it by the median absolute deviation,
1.4826 times the median of the absolute differences between the
values and their median.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>R is an open-source (free, libre) project distributed under the terms
of the GNU General Public License version 2. Therefore,
we are not only encouraged to run the software for whatever purpose,
but also study and modify its source code without restrictions.
To facilitate this, we can display all function definitions:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span><span class="w">  </span><span class="c1"># the code of the above procedure</span>
<span class="c1">## function(a, b)</span>
<span class="c1">## {</span>
<span class="c1">##     z &lt;- paste(a, b, sep=&quot;&quot;)</span>
<span class="c1">##     z[is.na(a) | is.na(b)] &lt;- NA_character_</span>
<span class="c1">##     z  # last expression in the block – return value</span>
<span class="c1">## }</span>
<span class="nf">print</span><span class="p">(</span><span class="n">union</span><span class="p">)</span><span class="w">  </span><span class="c1"># a built-in function</span>
<span class="c1">## function (x, y)</span>
<span class="c1">## {</span>
<span class="c1">##     u &lt;- as.vector(x)</span>
<span class="c1">##     v &lt;- as.vector(y)</span>
<span class="c1">##     unique(c(u, v))</span>
<span class="c1">## }</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
</pre></div>
</div>
<p>Nevertheless, some functionality might be implemented in compiled
programming languages such as C, C++, or Fortran;
notice a call to <strong class="command">.Internal</strong> in the source code
of <strong class="command">paste</strong>, <strong class="command">.Primitive</strong> in <strong class="command">list</strong>,
or <strong class="command">.Call</strong> in <strong class="command">runif</strong>.
Therefore, we will sometimes have to dig a bit deeper to access
the underlying definition; see
<a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a> for more details.</p>
</div>
</section>
</section>
<section id="functional-programming">
<span id="sec-fun-prog"></span><h2><span class="section-number">7.2. </span>Functional programming<a class="headerlink" href="#functional-programming" title="Link to this heading">¶</a></h2>
<p>R is a <em>functional</em> programming language. As such, it shares several
features with other languages that emphasise the role
of function manipulation in software development
(e.g., Common Lisp, Scheme, OCaml, Haskell, Clojure, F#).
Let’s explore these commonalities now.</p>
<section id="functions-are-objects">
<h3><span class="section-number">7.2.1. </span>Functions are objects<a class="headerlink" href="#functions-are-objects" title="Link to this heading">¶</a></h3>
<p>R functions were given the right to a <em>fair go</em>;
they are what we refer to as <em>first-class citizens</em>.
In other words, our interaction with them is not limited
to their invocation; we treat them as any other language object.</p>
<ul>
<li><p>They can be stored inside list objects,
which can embrace R objects of <em>any</em> kind:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">list</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span><span class="w"> </span><span class="n">NROW</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w">  </span><span class="c1"># a list storing three functions</span>
<span></span><span class="c1">## [[1]]</span>
<span class="c1">## function (x)</span>
<span class="c1">## x</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## function (x)</span>
<span class="c1">## if (length(d &lt;- dim(x))) d[1L] else length(x)</span>
<span class="c1">## &lt;environment: namespace:base&gt;</span>
<span class="c1">##</span>
<span class="c1">## [[3]]</span>
<span class="c1">## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</span>
</pre></div>
</div>
</li>
<li><p>They can be created and then called inside another function’s body:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">euclidean_distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">square</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="n">z</span><span class="o">^</span><span class="m">2</span><span class="w">  </span><span class="c1"># auxiliary/internal/helper function</span>
<span class="w">    </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)))</span><span class="w">     </span><span class="c1"># square root of the sum of squares</span>
<span class="p">}</span>

<span class="nf">euclidean_distance</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">  </span><span class="c1"># example call</span>
<span></span><span class="c1">## [1] 1.4142</span>
</pre></div>
</div>
<p>This is why we tend to classify functions as representatives
of <em>recursive</em> types (compare <strong class="command">is.recursive</strong>).</p>
</li>
<li><p>They can be passed as arguments to other operations:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replaces missing values with a given aggregate</span>
<span class="c1"># of all non-missing elements:</span>
<span class="n">fill_na</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">filler_fun</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">missing_ones</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># otherwise, we&#39;d have to call is.na twice</span>
<span class="w">    </span><span class="n">replacement_value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filler_fun</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">!</span><span class="n">missing_ones</span><span class="p">])</span>
<span class="w">    </span><span class="n">x</span><span class="p">[</span><span class="n">missing_ones</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replacement_value</span>
<span class="w">    </span><span class="n">x</span>
<span class="p">}</span>

<span class="nf">fill_na</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span></span><span class="c1">## [1] 0 3 3 2 3 7 3</span>
<span></span><span class="nf">fill_na</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">),</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
<span></span><span class="c1">## [1] 0.0 2.5 2.5 2.0 3.0 7.0 2.5</span>
</pre></div>
</div>
<p>Procedures like this are called <em>higher-order functions</em>.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More advanced techniques, which we will discuss in the third
part of the book, will let the functions be:</p>
<ul class="simple">
<li><p>returned as other function’s outputs,</p></li>
<li><p>equipped with auxiliary data,</p></li>
<li><p>generated programmatically on the fly,</p></li>
<li><p>modified at runtime.</p></li>
</ul>
</div>
<p>Let’s review the most essential higher-order functions,
including <strong class="command">do.call</strong> and <strong class="command">Map</strong>.</p>
</section>
<section id="calling-on-precomputed-arguments-with-do-call">
<span id="sec-do-call-intro"></span><h3><span class="section-number">7.2.2. </span>Calling on precomputed arguments with <strong class="command">do.call</strong><a class="headerlink" href="#calling-on-precomputed-arguments-with-do-call" title="Link to this heading">¶</a></h3>
<p>Notation like <strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(arg1,</span> <span class="pre">...,</span> <span class="pre">argn)</span></code>
has no monopoly over how we call a function
on a specific sequence of arguments.
The list of actual parameters does not have to be hardcoded.</p>
<p>Here is an alternative.
We can first prepare a number of objects to be passed
as <strong class="command">f</strong>’s inputs, wrap them in a list <code class="docutils literal notranslate"><span class="pre">l</span></code>,
and then invoke <strong class="command">do.call</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">l)</span></code>
to get the same result.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w">      </span><span class="s">&quot;bacon&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;eggs&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;buckwheat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;quinoa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;barley&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;ham&quot;</span><span class="p">,</span><span class="w">       </span><span class="s">&quot;spam&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="nf">do.call</span><span class="p">(</span><span class="n">paste</span><span class="p">,</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w">  </span><span class="c1"># paste(words[[1]], words[[2]], words[[3]])</span>
<span class="c1">## [1] &quot;spam buckwheat ham&quot; &quot;bacon quinoa spam&quot;  &quot;eggs barley spam&quot;</span>
<span class="nf">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w">  </span><span class="c1"># column-bind; returns a matrix (explained later)</span>
<span class="c1">##      [,1]    [,2]        [,3]</span>
<span class="c1">## [1,] &quot;spam&quot;  &quot;buckwheat&quot; &quot;ham&quot;</span>
<span class="c1">## [2,] &quot;bacon&quot; &quot;quinoa&quot;    &quot;spam&quot;</span>
<span class="c1">## [3,] &quot;eggs&quot;  &quot;barley&quot;    &quot;spam&quot;</span>
<span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w">  </span><span class="c1"># row-bind (explained later)</span>
<span class="c1">##      [,1]        [,2]     [,3]</span>
<span class="c1">## [1,] &quot;spam&quot;      &quot;bacon&quot;  &quot;eggs&quot;</span>
<span class="c1">## [2,] &quot;buckwheat&quot; &quot;quinoa&quot; &quot;barley&quot;</span>
<span class="c1">## [3,] &quot;ham&quot;       &quot;spam&quot;   &quot;spam&quot;</span>
</pre></div>
</div>
<p>The length and content of the list passed as the second argument
of <strong class="command">do.call</strong> can be arbitrary (possibly unknown at the time
of writing the code). See <a class="reference internal" href="240-data-frame.html#sec-cbind-data-frame"><span class="std std-numref">Section 12.1.2</span></a> for more use cases,
e.g., ways to concatenate a list of data frames
(perhaps produced by some complex chain of commands)
into a single data frame.</p>
<p>If elements of the list are named, they will be matched
to the corresponding keyword arguments.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="o">=</span><span class="m">101</span><span class="p">))</span>
<span class="n">plot_opts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">)</span>
<span class="nf">do.call</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">log2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;log2(x)&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot_opts</span><span class="p">))</span>
<span class="c1">## (plot display suppressed)</span>
</pre></div>
</div>
<p>Notice that our favourite <code class="docutils literal notranslate"><span class="pre">plot_opts</span></code> can now be reused in further
calls to graphics functions. This is very convenient as it avoids
repetitions.</p>
</section>
<section id="common-higher-order-functions">
<h3><span class="section-number">7.2.3. </span>Common higher-order functions<a class="headerlink" href="#common-higher-order-functions" title="Link to this heading">¶</a></h3>
<p>There is an important class of higher-order functions
that permit us to apply custom operations on consecutive elements
of sequences without relying on loop-like statements, at least explicitly.
They can be found in all functional programming languages
(e.g., Lisp, Haskell, Scala) and have been ported to
various add-on libraries (<strong class="program">functools</strong> in Python,
more recent versions of the C++ Standard Library, etc.)
or frameworks (Apache Spark and the like).
Their presence reflects the obvious truth that certain operations
occur more frequently than others.
In particular:</p>
<ul class="simple">
<li><p><strong class="command">Map</strong> calls a function on each element of a sequence
in order to transform:</p>
<ul>
<li><p>their individual components
(just like <strong class="command">sqrt</strong>, <strong class="command">round</strong>,
or the unary `<strong class="command">!</strong>` operator in R), or</p></li>
<li><p>the corresponding elements of many sequences
so as to vectorise a given operation elementwisely
(compare  the binary `<strong class="command">+</strong>` or <strong class="command">paste</strong>),</p></li>
</ul>
</li>
<li><p><strong class="command">Reduce</strong> (also called accumulate) applies a binary operation to combine consecutive elements in a sequence, e.g., to generate the
aggregates, like, totally (compare <strong class="command">sum</strong>, <strong class="command">prod</strong>,
<strong class="command">all</strong>, <strong class="command">max</strong>) or cumulatively (compare <strong class="command">cumsum</strong>, <strong class="command">cummmin</strong>),</p></li>
<li><p><strong class="command">Filter</strong> creates a subset of a sequence that is comprised
of elements that enjoy a given property
(which we typically achieve in R by means of the `<strong class="command">[</strong>`
operator),</p></li>
<li><p><strong class="command">Find</strong> locates the first element that fulfils some logical condition
(compare  <strong class="command">which</strong>).</p></li>
</ul>
<p>Below we will only focus on the <strong class="command">Map</strong> function.
The inspection of the remaining ones is left as an exercise.
This is because, oftentimes, we can be better off with their more
R-ish versions (e.g., using the subsetting operator, `<strong class="command">[</strong>`).</p>
</section>
<section id="vectorising-functions-with-map">
<span id="sec-map"></span><h3><span class="section-number">7.2.4. </span>Vectorising functions with <strong class="command">Map</strong><a class="headerlink" href="#vectorising-functions-with-map" title="Link to this heading">¶</a></h3>
<p>In data-centric computing, we are frequently faced with tasks that
involve processing each vector element independently, one after another.
Such use cases can benefit from vectorised operations like those discussed
in <a class="reference internal" href="120-numeric.html#chap-numeric"><span class="std std-numref">Chapter 2</span></a>, <a class="reference internal" href="130-logical.html#chap-logical"><span class="std std-numref">Chapter 3</span></a>,
and <a class="reference internal" href="160-character.html#chap-character"><span class="std std-numref">Chapter 6</span></a>.</p>
<p>Unfortunately, most of the functions that we introduced so far
cannot be applied on lists.
For instance, if we try calling <strong class="command">sqrt</strong> on a generic vector,
we will get an error, even if it is a list of numeric sequences only.
One way to compute the square root of all elements would
be to invoke <strong class="command">sqrt</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">unlist</strong><code class="code docutils literal notranslate"><span class="pre">(...))</span></code>.
It is a go-to approach if we want
to treat all the list’s elements as one sequence.
However, this comes at the price of losing the list’s structure.</p>
<p>We have also discussed a few operations that are not vectorised
with respect to all their arguments, even though they could have been
designed this way, e.g., <strong class="command">grepl</strong>.</p>
<p>The <strong class="command">Map</strong> function<a class="footnote-reference brackets" href="#footmapply" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> applies an operation on each element
in a vector or the corresponding elements in a number of vectors.
In many situations,
it may be used as a more elegant alternative
to <strong class="command">for</strong> loops that we will introduce in the next chapter.</p>
<div style="margin-top: 1em"></div><p>First<a class="footnote-reference brackets" href="#footlapply" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, a call to <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">x)</span></code>
yields a list whose <span class="math">\(i\)</span>-th element is equal to
<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x[[i]])</span></code>
(recall that `<strong class="command">[[</strong>` works on atomic vectors too).
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">  </span><span class="c1"># an example named list</span>
<span class="w">    </span><span class="n">x1</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">x2</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.25</span><span class="p">),</span>
<span class="w">    </span><span class="n">x3</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">)</span>
<span class="p">)</span>
<span class="nf">Map</span><span class="p">(</span><span class="n">sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1"># x is named, hence the result will be named as well</span>
<span class="c1">## $x1</span>
<span class="c1">## [1] 1.0000 1.4142 1.7321</span>
<span class="c1">##</span>
<span class="c1">## $x2</span>
<span class="c1">## [1] 0.00000 0.50000 0.70711 0.86603 1.00000</span>
<span class="c1">##</span>
<span class="c1">## $x3</span>
<span class="c1">## [1]  1  0 NA  0  0  1 NA</span>
<span class="nf">Map</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="c1">## $x1</span>
<span class="c1">## [1] 3</span>
<span class="c1">##</span>
<span class="c1">## $x2</span>
<span class="c1">## [1] 5</span>
<span class="c1">##</span>
<span class="c1">## $x3</span>
<span class="c1">## [1] 7</span>
<span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="c1"># compute three aggregates, convert to an atomic vector</span>
<span class="c1">##  x1  x2  x3</span>
<span class="c1">## 2.0 0.5  NA</span>
<span class="nf">Map</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">))</span><span class="w">  </span><span class="c1"># x is atomic now</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 0.4 0.8</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1]  0.5  0.8 -0.1 -0.7</span>
<span class="c1">##</span>
<span class="c1">## [[3]]</span>
<span class="c1">## [1] -0.3  0.0  0.5  1.0 -0.9 -0.7</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p>Next, we can vectorise a given function over several parameters.
A call to, e.g., <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code> breeds a
list whose <span class="math">\(i\)</span>-th element is equal to
<strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x[[i]],</span> <span class="pre">y[[i]],</span> <span class="pre">z[[i]])</span></code>.
Like in the case of, e.g., <strong class="command">paste</strong>,
the recycling rule will be applied if necessary.</p>
<p>For example, the following generates
<strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">6),</span> </code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(11,</span> <span class="pre">13),</span> </code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(21,</span> <span class="pre">29))</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Map</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">21</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">29</span><span class="p">))</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1 2 3 4 5 6</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 11 12 13</span>
<span class="c1">##</span>
<span class="c1">## [[3]]</span>
<span class="c1">## [1] 21 22 23 24 25 26 27 28 29</span>
</pre></div>
</div>
<p>Moreover, we can get
<strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">40,</span> <span class="pre">length.out=10),</span> </code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(11,</span> <span class="pre">40,</span> <span class="pre">length.out=5),</span> </code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(21,</span> <span class="pre">40,</span> <span class="pre">length.out=10),</span> </code><strong class="command">seq</strong><code class="code docutils literal notranslate"><span class="pre">(31,</span> <span class="pre">40,</span> <span class="pre">length.out=5))</span></code> by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Map</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="m">31</span><span class="p">),</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="c1">## [[1]]</span>
<span class="c1">##  [1]  1.0000  5.3333  9.6667 14.0000 18.3333 22.6667 27.0000 31.3333</span>
<span class="c1">##  [9] 35.6667 40.0000</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 11.00 18.25 25.50 32.75 40.00</span>
<span class="c1">##</span>
<span class="c1">## [[3]]</span>
<span class="c1">##  [1] 21.000 23.111 25.222 27.333 29.444 31.556 33.667 35.778 37.889 40.000</span>
<span class="c1">##</span>
<span class="c1">## [[4]]</span>
<span class="c1">## [1] 31.00 33.25 35.50 37.75 40.00</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we have some additional arguments to be passed to
the function applied (which it does not have to be vectorised
over), we can wrap them inside a separate list
and toss it via the <code class="docutils literal notranslate"><span class="pre">MoreArgs</span></code> argument
(à la <strong class="command">do.call</strong>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">MoreArgs</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span><span class="w">  </span><span class="c1"># mean(..., na.rm=TRUE)</span>
<span class="c1">##  x1  x2  x3</span>
<span class="c1">## 2.0 0.5 0.4</span>
</pre></div>
</div>
<p>Alternatively, we can always construct a custom anonymous function:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">unlist</span><span class="p">(</span><span class="nf">Map</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="c1">##  x1  x2  x3</span>
<span class="c1">## 2.0 0.5 0.4</span>
</pre></div>
</div>
</div>
<div class="proof proof-type-exercise" id="id12">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.6</span>
        
    </div><div class="proof-content">
<p>Here is an example list of files
(see <a class="reference external" href="https://github.com/gagolews/teaching-data/tree/master/marek">our teaching data repository</a>) with daily Forex rates:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">file_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;euraud-20200101-20200630.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;eurgbp-20200101-20200630.csv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;eurusd-20200101-20200630.csv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Call <strong class="command">Map</strong> to read them with <strong class="command">scan</strong>.
Determine each series’ minimal, mean, and maximal value.</p>
</div></div><div class="proof proof-type-exercise" id="id13">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.7</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">Filter</strong>
function based on a call to <strong class="command">Map</strong>.</p>
</div></div></section>
</section>
<section id="accessing-third-party-functions">
<h2><span class="section-number">7.3. </span>Accessing third-party functions<a class="headerlink" href="#accessing-third-party-functions" title="Link to this heading">¶</a></h2>
<p>When we indulge in the writing of a software piece,
a few questions naturally arise.
Is the problem we are facing fairly complex?
Has it already been successfully addressed in its entirety?
If not, can it, or its parts, be split into manageable chunks?
Can it be constructed based on some readily available nontrivial components?</p>
<p>A smart developer is independent but knows when to stand on the shoulders to
cry on. Let’s explore a few ways to reuse the existing function libraries.</p>
<section id="using-r-packages">
<span id="sec-packages"></span><h3><span class="section-number">7.3.1. </span>Using R packages<a class="headerlink" href="#using-r-packages" title="Link to this heading">¶</a></h3>
<p>Most contributed R extensions come in the form of
<em>add-on packages</em>, which can include:</p>
<ul class="simple">
<li><p>reusable code (e.g., new functions),</p></li>
<li><p>data (which we can exercise on),</p></li>
<li><p>documentation (manuals, vignettes, etc.);</p></li>
</ul>
<p>see <a class="reference internal" href="210-design.html#sec-own-packages"><span class="std std-numref">Section 9.2.2</span></a> for more
and <em>Writing R Extensions</em> <span id="id4">[<a class="reference internal" href="999-bibliography.html#id15" title="R Development Core Team. (2023).  Writing R Extensions. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-exts.html.">65</a>]</span> for all the details.</p>
<p>Most packages are published in the
moderated repository that is part of the <em>Comprehensive R Archive Network</em>
(<a class="reference external" href="https://cloud.r-project.org/">CRAN</a>).
However, there are also other popular sources such as
<a class="reference external" href="https://bioconductor.org/">Bioconductor</a> which specialises
in bioinformatics.</p>
<p>We call <strong class="command">install.packages</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;pkg&quot;)</span></code>
to fetch a package <strong class="program">pkg</strong> from a repository
(CRAN by default; see, however, the <code class="docutils literal notranslate"><span class="pre">repos</span></code> argument).</p>
<p>A call to <strong class="command">library</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;pkg&quot;)</span></code> loads
an indicated package and makes the exported objects
available to the user (i.e., attaches it to the search path;
see <a class="reference internal" href="330-environment.html#sec-attach"><span class="std std-numref">Section 16.2.6</span></a>).</p>
<p>For instance, in one of the previous chapters,
we have mentioned the <strong class="program">gsl</strong> package:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># call install.packages(&quot;gsl&quot;) first</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;gsl&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># load the package</span>
<span class="nf">poch</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">6</span><span class="p">)</span><span class="w">   </span><span class="c1"># calls gsl_sf_poch() from GNU GSL</span>
<span class="c1">## [1]    1320   17160  240240 3603600</span>
</pre></div>
</div>
<p>Here, <strong class="command">poch</strong> is an object exported by package <strong class="program">gsl</strong>.
If we did not call <strong class="command">library</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;gsl&quot;)</span></code>,
trying to access the former would raise an error.</p>
<p>We could have also accessed the preceding function
without attaching it to the search path using
the <strong class="program">pkg</strong><code class="code docutils literal notranslate"><span class="pre">::object</span></code> syntax,
namely, <strong class="program">gsl</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">poch</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information about any R extension, call
<strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(package=&quot;pkg&quot;)</span></code>.
Also, it is advisable to visit the package’s CRAN entry
at an address like <em>https://CRAN.R-project.org/package=pkg</em>
to access additional information, e.g., vignettes.
Why waste our time and energy by querying a web search engine
that will likely lead us to a dodgy middleman when we
can acquire authoritative knowledge directly from the source?</p>
<p>Moreover, it is worth exploring various
<a class="reference external" href="https://cloud.r-project.org/web/views">CRAN Task Views</a>
that group the packages into topics such as <em>Genetics</em>,
<em>Graphics</em>, and <em>Optimisation</em>.
They are curated by experts in their relevant fields.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Frequently, R packages are written in their respective authors’ free time,
many of whom are volunteers.
Neither get they paid for this, nor do it as part of the so-called
<em>their job</em>. Yes, not everyone is driven by money or fame.</p>
<p>Someday, when we come up with something valuable for the community,
we will become one of them. Before this happens, we can show appreciation
for their generosity by, e.g., spreading the word about their software by
citing it in publications (see <strong class="command">citation</strong><code class="code docutils literal notranslate"><span class="pre">(package=&quot;pkg&quot;)</span></code>),
talking about them during lunchtime, or mentioning them in (un)social media.
We can also help them improve the existing code base by reporting bugs,
polishing documentation, proposing new features, or cleaning up
the redundant fragments of their APIs.</p>
</div>
<section id="default-packages">
<span id="sec-default-packages"></span><h4><span class="section-number">7.3.1.1. </span>Default packages<a class="headerlink" href="#default-packages" title="Link to this heading">¶</a></h4>
<p>The <strong class="program">base</strong> package is omnipresent. It provides us with the most
crucial functions such as the vector addition, <strong class="command">c</strong>, <strong class="command">Map</strong>,
and <strong class="command">library</strong>. Certain other extensions are also loaded by default:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;defaultPackages&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;datasets&quot;  &quot;utils&quot;     &quot;grDevices&quot; &quot;graphics&quot;  &quot;stats&quot;</span>
<span class="c1">## [6] &quot;methods&quot;</span>
</pre></div>
</div>
<p>In this book, we assume that they are always attached
(even though this list can, theoretically, be changed<a class="footnote-reference brackets" href="#footchangedefs" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>).
Due to this, in <a class="reference internal" href="120-numeric.html#sec-numeric-aggregation"><span class="std std-numref">Section 2.4.5</span></a>,
there was no need to call, for example,
<strong class="command">library</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;stats&quot;)</span></code>
before referring to the <strong class="command">var</strong> and <strong class="command">sd</strong> functions.</p>
<p>On a side note, <strong class="program">grDevices</strong> and <strong class="program">graphics</strong>
will be discussed in <a class="reference internal" href="250-graphics.html#chap-graphics"><span class="std std-numref">Chapter 13</span></a>.
<strong class="program">methods</strong> will be mentioned in <a class="reference internal" href="220-s3.html#sec-s4"><span class="std std-numref">Section 10.5</span></a>.
<strong class="program">datasets</strong> brings a few example R objects on which
we can exercise our skills.
The functions from <strong class="program">utils</strong>,
<strong class="program">graphics</strong>, and <strong class="program">stats</strong>
already appeared here and there.</p>
<div class="proof proof-type-exercise" id="id14">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.8</span>
        
    </div><div class="proof-content">
<p>Use the <strong class="command">find</strong> function to determine which packages define
<strong class="command">mean</strong>,
<strong class="command">var</strong>,
<strong class="command">find</strong>, and
<strong class="command">Map</strong>.
Recall from <a class="reference internal" href="110-basics.html#sec-help"><span class="std std-numref">Section 1.4</span></a> where such information
can be found in these objects’ manual pages.</p>
</div></div></section>
<section id="source-vs-binary-packages">
<span id="sec-src-package"></span><h4><span class="section-number">7.3.1.2. </span>Source vs binary packages (*)<a class="headerlink" href="#source-vs-binary-packages" title="Link to this heading">¶</a></h4>
<p>R is an open environment. Therefore, its packages are published primarily
in the source form. This way, anyone can study how they work
and improve them or reuse parts thereof in different projects.</p>
<p>If we call
<strong class="command">install.packages</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;path&quot;,</span> <span class="pre">repos=NULL,</span> <span class="pre">type=&quot;source&quot;)</span></code>,
we should be able to install a package from sources:
<code class="docutils literal notranslate"><span class="pre">path</span></code> can be pinpointing either a directory or a
source tarball (most often as a compressed <code class="file docutils literal notranslate"><span class="pre">pkg_version.tar.gz</span></code> file;
see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;untar&quot;)</span></code>).</p>
<p>Note that <code class="code docutils literal notranslate"><span class="pre">type=&quot;source&quot;</span></code> is the default unless one is
on a W****ws or m**OS box;
see <strong class="command">getOption</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;pkgType&quot;)</span></code>. This is because these two
operating systems require additional build tools, especially if a package
relies on C or C++ code; see <a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a>
and Section C.3 of <span id="id6">[<a class="reference internal" href="999-bibliography.html#id12" title="R Development Core Team. (2023).  R Installation and Administration. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-admin.html.">67</a>]</span>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cran.r-project.org/bin/windows/Rtools"><strong class="program">RTools</strong></a> on W****ws,</p></li>
<li><p><a class="reference external" href="https://developer.apple.com/xcode/resources"><strong class="program">Xcode</strong> Command Line Tools</a>
on m**OS.</p></li>
</ul>
<p>These systems are less developer-orientated. Thus, as a courtesy to their
users, CRAN also distributes the platform-specific binary versions
of the packages (.zip or .tgz files).
<strong class="command">install.packages</strong> will try to fetch them by default.</p>
<div class="proof proof-type-example" id="id15">

    <div class="proof-title">
        <span class="proof-type">Example 7.9</span>
        
    </div><div class="proof-content">
<p>It is very easy to retrieve a package’s source directly from
GitLab and GitHub, which are popular hosting platforms.
The relevant links are, respectively:</p>
<ul class="simple">
<li><p>https://gitlab.com/<em>user</em>/<em>repo</em>/-/archive/<em>branch</em>/<em>repo</em>-<em>branch</em>.zip,</p></li>
<li><p>https://github.com/<em>user</em>/<em>repo</em>/archive/<em>branch</em>.zip.</p></li>
</ul>
<p>For example, to download the contents of
the <em>master</em> branch in the GitHub repository <em>rpackagedemo</em>
owned by <em>gagolews</em>, we can call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tempfile</span><span class="p">()</span><span class="w">  </span><span class="c1"># download destination: a temporary file name</span>
<span class="nf">download.file</span><span class="p">(</span><span class="s">&quot;https://github.com/gagolews/rpackagedemo/archive/master.zip&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">destfile</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, the contents can be extracted with <strong class="command">unzip</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tempdir</span><span class="p">()</span><span class="w">  </span><span class="c1"># temporary directory for extracted files</span>
<span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unzip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">exdir</span><span class="o">=</span><span class="n">t</span><span class="p">))</span><span class="w">  </span><span class="c1"># returns extracted file paths</span>
</pre></div>
</div>
<p>The path where the files were extracted
can be passed to <strong class="command">install.packages</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="nf">dirname</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">repos</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;source&quot;</span><span class="p">)</span>
<span class="nf">file.remove</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">))</span><span class="w">  </span><span class="c1"># clean up</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id16">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.10</span>
        
    </div><div class="proof-content">
<p>Use the <strong class="program">git2r</strong> package to clone the <strong class="command">git</strong>
repository located at <a class="reference external" href="https://github.com/gagolews/rpackagedemo.git">https://github.com/gagolews/rpackagedemo.git</a>
and install the package published therein.</p>
</div></div></section>
<section id="managing-dependencies">
<h4><span class="section-number">7.3.1.3. </span>Managing dependencies (*)<a class="headerlink" href="#managing-dependencies" title="Link to this heading">¶</a></h4>
<p>By calling <strong class="command">update.packages</strong>,
all installed add-on packages may be upgraded to their most recent versions
available on CRAN or other indicated repository.</p>
<p>As a general rule, the more experienced we become,
the less excited we get about the <em>new</em>.
Sure, bug fixes and well-thought-out additional
features are usually welcome. Still, just we wait until someone
updates a package’s API for the <span class="math">\(n\)</span>-th time, <span class="math">\(n \ge 2\)</span>,
breaking our so-far flawless program.</p>
<p>Hence, when designing software projects (see <a class="reference internal" href="210-design.html#chap-design"><span class="std std-numref">Chapter 9</span></a>
for more details), we must ask ourselves the ultimate
question: do we really need to import that package with lots of dependencies
from which we will just use only about 3–5 functions?
Wouldn’t it be better to write our own version of some
functionality (and learn something new, exercise our brain, etc.),
or call a mature terminal-based tool?</p>
<p>Otherwise, as all the historical versions of the packages
are <a class="reference external" href="https://cran.r-project.org/src/contrib/Archive">archived on CRAN</a>,
simple software dependency management can be conducted
by storing different releases of packages in different directories.
This way, we can create an isolated environment for the add-ons.
To fetch the locations where packages are sought (in this very order),
we call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">.libPaths</span><span class="p">()</span>
<span class="c1">## [1] &quot;/home/gagolews/R/x86_64-suse-linux-gnu-library/4.4&quot;</span>
<span class="c1">## [2] &quot;/usr/lib64/R/library&quot;</span>
</pre></div>
</div>
<p>The same function can add new folders to the search
path; see also the environment variable
<code class="docutils literal notranslate"><span class="pre">R_LIBS_USER</span></code> that we can set using <strong class="command">Sys.setenv</strong>.
The <strong class="command">install.packages</strong> function will honour them as target
directories; see its <code class="docutils literal notranslate"><span class="pre">lib</span></code> parameter for more details.
Note that only one version of a package can be loaded at a time, though.</p>
<p>Moreover, the packages may deposit auxiliary data
on the user’s machine. Therefore, it might be worthwhile
to set the following directories (via the corresponding
environment variables) relative to the current project:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tools</span><span class="o">::</span><span class="nf">R_user_dir</span><span class="p">(</span><span class="s">&quot;pkg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1"># R_USER_DATA_DIR</span>
<span class="c1">## [1] &quot;/home/gagolews/.local/share/R/pkg&quot;</span>
<span class="n">tools</span><span class="o">::</span><span class="nf">R_user_dir</span><span class="p">(</span><span class="s">&quot;pkg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;config&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># R_USER_CONFIG_DIR</span>
<span class="c1">## [1] &quot;/home/gagolews/.config/R/pkg&quot;</span>
<span class="n">tools</span><span class="o">::</span><span class="nf">R_user_dir</span><span class="p">(</span><span class="s">&quot;pkg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cache&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1"># R_USER_CACHE_DIR</span>
<span class="c1">## [1] &quot;/home/gagolews/.cache/R/pkg&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="calling-external-programs">
<span id="sec-external-programs"></span><h3><span class="section-number">7.3.2. </span>Calling external programs<a class="headerlink" href="#calling-external-programs" title="Link to this heading">¶</a></h3>
<p>Many tasks can be accomplished by calling external programs.
Such an approach is particularly natural on UNIX-like systems,
which classically follow modular, minimalist design patterns.
There are many tools at a developer’s hand and each tool is specialised
at solving a single, well-defined problem.</p>
<p>Apart from the many
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Unix_commands">standard UNIX commands</a>,
we may consider:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandoc.org/"><strong class="program">pandoc</strong></a> converts documents
between markup formats, e.g., Markdown, HTML, reStructuredText,
and LaTeX and can generate LibreOffice Writer documents, EPUB or
PDF files, or slides;</p></li>
<li><p><strong class="program">jupyter-nbconvert</strong> converts <a class="reference external" href="https://jupyter.org/">Jupyter</a>
notebooks (see <a class="reference internal" href="110-basics.html#sec-jupyter"><span class="std std-numref">Section 1.2.5</span></a>)
to other formats such as LaTeX, HTML, Markdown, etc.;</p></li>
<li><p><strong class="program">convert</strong> (from <a class="reference external" href="https://imagemagick.org/"><strong class="program">ImageMagick</strong></a>)
applies various operations on bitmap graphics
(scaling, cropping, conversion between formats);</p></li>
<li><p><a class="reference external" href="https://graphviz.org/"><strong class="program">graphviz</strong></a>
and <a class="reference external" href="https://plantuml.com/"><strong class="program">PlantUML</strong></a>
draws graphs and diagrams;</p></li>
<li><p><strong class="program">python</strong>, <strong class="program">perl</strong>, … can be called
to perform tasks that can be expressed more easily in languages
other than R.</p></li>
</ul>
<p>The good news is that we are not limited to calling R from the system shell
in the interactive or batch mode; see <a class="reference internal" href="110-basics.html#sec-ide"><span class="std std-numref">Section 1.2</span></a>.
Our environment serves well as a glue language too.</p>
<p>The <strong class="command">system2</strong> function invokes a system command.
Communication between such programs may be done using,
e.g., intermediate text, JSON, CSV, XML, or any other files.
The <code class="docutils literal notranslate"><span class="pre">stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> arguments control the
redirection of the standard I/O streams.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">system2</span><span class="p">(</span><span class="s">&quot;pandoc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-s input.md -o output.html&quot;</span><span class="p">)</span>
<span class="nf">system2</span><span class="p">(</span><span class="s">&quot;bash&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c &#39;for i in `seq 1 2 10`; do echo $i; done&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">## [1] &quot;1&quot; &quot;3&quot; &quot;5&quot; &quot;7&quot; &quot;9&quot;</span>
<span class="nf">system2</span><span class="p">(</span><span class="s">&quot;python3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">input</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;import numpy as np&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;print(repr(np.arange(5)))&quot;</span>
<span class="w">    </span><span class="p">))</span>
<span class="c1">## [1] &quot;array([0, 1, 2, 3, 4])&quot;</span>
</pre></div>
</div>
<p>On a side note, the current working directory can be read and changed
through a call to <strong class="command">getwd</strong> and <strong class="command">setwd</strong>, respectively.
By default, it is the directory where the current R session was started.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Relying on <strong class="command">system2</strong> assumes that the commands
it refers to are available on the target platform. Hence,
it might not be portable unless additional assumptions
are made, e.g., that a user runs a UNIX-like system and
that certain libraries are available. We strongly recommend GNU/Linux
or FreeBSD for both software development
and production use, as they are free, open, developer-friendly,
user-loving, reliable, ethical, and sustainable.
Users of other operating systems are missing out on so many good features.</p>
</div>
</section>
<section id="interfacing-c-c-fortran-python-java-etc">
<h3><span class="section-number">7.3.3. </span>Interfacing C, C++, Fortran, Python, Java, etc. (**)<a class="headerlink" href="#interfacing-c-c-fortran-python-java-etc" title="Link to this heading">¶</a></h3>
<p>Most standalone data processing algorithms are implemented
in compiled, slightly lower-level programming languages.
This usually makes them faster and more reusable in other
environments. For instance, an industry-standard library
might be written in very portable C, C++, or Fortran
and define bindings for easier access from within R, Python, Julia, etc.
It is the case with FFTW, LIBSVM, mlpack, OpenBLAS,
ICU, and GNU GSL, amongst many others.
<a class="reference internal" href="310-compiled.html#chap-compiled"><span class="std std-numref">Chapter 14</span></a> explains basic ways to refer to
such compiled code.</p>
<p>Also, the <strong class="program">rJava</strong> package can dynamically
create JVM objects and access their fields and methods.
Similarly, <strong class="program">reticulate</strong> can be used to
access Python objects, including <strong class="program">numpy</strong> arrays
and <strong class="program">pandas</strong> data frames
(but see also the <strong class="program">rpy2</strong> package for Python).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We should not feel obliged to use R in all parts of a data processing
pipeline. Some activities can be expressed more naturally in other
languages or environments (e.g., parse raw data and create a SQL
database in Python but visualise it in R).</p>
</div>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">7.4. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="proof proof-type-exercise" id="id17">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.11</span>
        
    </div><div class="proof-content">
<p>Answer the following questions.</p>
<ul class="simple">
<li><p>What is the result of
“<code class="code docutils literal notranslate"><span class="pre">{x</span> <span class="pre">&lt;-</span> <span class="pre">&quot;x&quot;;</span> <span class="pre">x</span> <span class="pre">&lt;-</span> </code><strong class="command">function</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span> <span class="pre">x;</span> <span class="pre">x(x)}</span></code>”?</p></li>
<li><p>How to compose a function that returns two objects?</p></li>
<li><p>What is a higher-order function?</p></li>
<li><p>What are the use cases of <strong class="command">do.call</strong>?</p></li>
<li><p>Why a call to <strong class="command">Map</strong> is redundant
in the expression <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">paste</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>?</p></li>
<li><p>What is the difference between
<strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">mean</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">na.rm=TRUE)</span></code>
and <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">mean</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x,</span> <span class="pre">MoreArgs=</span></code><strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(na.rm=TRUE))</span></code>?</p></li>
<li><p>What do we mean when we write <strong class="program">stringx</strong><code class="code docutils literal notranslate"><span class="pre">::</span></code><strong class="command">sprintf</strong>?</p></li>
<li><p>How to get access to the vignettes (tutorials, FAQs, etc.)
of the <strong class="program">data.table</strong> and <strong class="program">dplyr</strong> packages?
Why perhaps 95% of R users would just googleit, and what is suboptimal
about this strategy?</p></li>
<li><p>What is the difference between a source and a binary package?</p></li>
<li><p>How to update the <strong class="program">base</strong> package?</p></li>
<li><p>How to ensure that we will always run an R session with
only specific versions of a set of packages?</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id18">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.12</span>
        
    </div><div class="proof-content">
<p>Write a function that computes the Gini index of
a vector of positive integers <code class="docutils literal notranslate"><span class="pre">x</span></code>,
which, assuming <span class="math">\(x_1\le x_2\le\dots\le x_n\)</span>, is equal to:</p>
<div class="math-wrapper docutils container">
<div class="math">
\[G(x_1,\dots,x_n) = \frac{ \sum_{i=1}^{n} (n-2i+1) x_{i} }{ (n-1) \sum_{i=1}^n x_i }.\]</div>
</div>
</div></div><div class="proof proof-type-exercise" id="id19">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.13</span>
        
    </div><div class="proof-content">
<p>Implement a function <strong class="command">between</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">a,</span> <span class="pre">b)</span></code>
that verifies whether each element in <code class="docutils literal notranslate"><span class="pre">x</span></code> is in the <em>[<code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>]</em>
interval. Return a logical vector of the same length as <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Ensure the function is correctly vectorised with respect to all
the arguments and handles missing data correctly.</p>
</div></div><div class="proof proof-type-exercise" id="id20">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.14</span>
        
    </div><div class="proof-content">
<p>Write your version of the <strong class="command">strrep</strong> function
called <strong class="command">dup</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dup</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">dup</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="c1">## [1] &quot;a&quot;     &quot;bbb&quot;   &quot;ccccc&quot;</span>
<span class="nf">dup</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="c1">## [1] &quot;a&quot;   &quot;aa&quot;  &quot;aaa&quot;</span>
<span class="nf">dup</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
<span class="c1">## [1] &quot;aaaa&quot; &quot;bbbb&quot; &quot;cccc&quot;</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id21">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.15</span>
        
    </div><div class="proof-content">
<p>Given a list <code class="docutils literal notranslate"><span class="pre">x</span></code>, generate its sublist with all the elements
equal to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> removed.</p>
</div></div><div class="proof proof-type-exercise" id="id22">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.16</span>
        
    </div><div class="proof-content">
<p>Implement your version of the <strong class="command">sequence</strong> function.</p>
</div></div><div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.17</span>
        
    </div><div class="proof-content">
<p>Using <strong class="command">Map</strong>, how can we generate window indexes like below?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## [[1]]</span>
<span class="c1">## [1] 1 2 3</span>
<span class="c1">##</span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 2 3 4</span>
<span class="c1">##</span>
<span class="c1">## [[3]]</span>
<span class="c1">## [1] 3 4 5</span>
<span class="c1">##</span>
<span class="c1">## [[4]]</span>
<span class="c1">## [1] 4 5 6</span>
</pre></div>
</div>
<p>Write a function <strong class="command">windows</strong><code class="code docutils literal notranslate"><span class="pre">(k,</span> <span class="pre">n)</span></code> that yields
index windows of length <span class="math">\(k\)</span> with elements between <span class="math">\(1\)</span> and <span class="math">\(n\)</span>
(the above example is for <span class="math">\(k=3\)</span> and <span class="math">\(k=6\)</span>).</p>
</div></div><div class="proof proof-type-exercise" id="id24">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.18</span>
        
    </div><div class="proof-content">
<p>Write a function to extract all <span class="math">\(q\)</span>-grams, <span class="math">\(q \ge 1\)</span>,
from a given character vector. Return a list of
character vectors. For example,
bigrams (2-grams) in <code class="docutils literal notranslate"><span class="pre">&quot;abcd&quot;</span></code> are: <code class="docutils literal notranslate"><span class="pre">&quot;ab&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;bc&quot;</span></code>, “cd”`.</p>
</div></div><div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.19</span>
        
    </div><div class="proof-content">
<p>Implement a function <strong class="command">movstat</strong><code class="code docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">x,</span> <span class="pre">k)</span></code>
that computes, using <strong class="command">Map</strong>, a given aggregate <strong class="command">f</strong>
of each <span class="math">\(k\)</span> consecutive elements in <code class="docutils literal notranslate"><span class="pre">x</span></code>.
For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">movstat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">-25</span><span class="p">)</span><span class="w">  </span><span class="c1"># example data</span>
<span class="nf">movstat</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">           </span><span class="c1"># 3-moving mean</span>
<span class="c1">## [1]  3.0000  6.0000 13.3333  3.3333</span>
<span class="nf">movstat</span><span class="p">(</span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">         </span><span class="c1"># 3-moving median</span>
<span class="c1">## [1]  3.0000  6.0000 13.3333  3.3333</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id26">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.20</span>
        
    </div><div class="proof-content">
<p>Recode a character vector with a small number of distinct values
to a vector where each unique code is assigned a positive integer from
<span class="math">\(1\)</span> to <span class="math">\(k\)</span>. Here are example calls and the corresponding expected results:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">recode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="c1">## [1] 1 1 1 2 2</span>
<span class="nf">recode</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">))</span>
<span class="c1">## [1] 1 3 2 1 2 1</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.21</span>
        
    </div><div class="proof-content">
<p>Implement a function that returns the number of occurrences of
each unique element in a given atomic vector. The return value
should be a numeric vector equipped with the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute.
Hint: use <strong class="command">match</strong> and <strong class="command">tabulate</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">count</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">954</span><span class="p">))</span>
<span class="c1">##   5  42 954</span>
<span class="c1">##   4   2   1</span>
<span class="nf">count</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_character_</span><span class="p">))</span>
<span class="c1">##    w    x    y    z &lt;NA&gt;</span>
<span class="c1">##    1    5    3    1    1</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.22</span>
        
    </div><div class="proof-content">
<p>Extend the built-in <strong class="command">duplicated</strong> function.
For each vector element, indicate which occurrence
of a repeated value is it (starting from the beginning of the vector).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">duplicatedn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">...to.do...</span>
<span class="nf">duplicatedn</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="c1">## [1] 1 2 3 1 2</span>
<span class="nf">duplicatedn</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">))</span>
<span class="c1">##  [1] 1 1 1 2 2 3 1 4 5 3 2</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.23</span>
        
    </div><div class="proof-content">
<p>Based on a call to <strong class="command">Map</strong>, implement your version of
<strong class="command">split</strong> that takes two atomic vectors as arguments.
Then, extend it to handle the second argument
being a list of the form <strong class="command">list</strong><code class="code docutils literal notranslate"><span class="pre">(y1,</span> <span class="pre">y2,</span> <span class="pre">...)</span></code>
representing the product of many levels.
If the <span class="math">\(y\)</span>s are of different lengths, apply the recycling rule.</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.24</span>
        
    </div><div class="proof-content">
<p>Implement <strong class="command">my_unsplit</strong> being your version of
<strong class="command">unsplit</strong>. For any <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> of the same lengths, ensure
that <strong class="command">my_unsplit</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">split</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">g),</span> <span class="pre">g)</span></code> is
equal to <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</div></div><div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.25</span>
        
    </div><div class="proof-content">
<p>Write a function that takes as arguments:
(a) an integer <span class="math">\(n\)</span>,
(b) a numeric vector <code class="docutils literal notranslate"><span class="pre">x</span></code> of length <span class="math">\(k\)</span> and no duplicated elements,
(c) a vector of probabilities <code class="docutils literal notranslate"><span class="pre">p</span></code> of length <span class="math">\(k\)</span>.
Verify that <span class="math">\(p_i\ge 0\)</span> for all <span class="math">\(i\)</span> and <span class="math">\(\sum_{i=1}^k p_i \simeq 1\)</span>.
Based on a random number generator from the uniform distribution on
the unit interval, generate <span class="math">\(n\)</span> independent realisations
of a random variable <span class="math">\(X\)</span> such that <span class="math">\(\Pr(X=x_i)=p_i\)</span> for <span class="math">\(i=1,\dots,k\)</span>.
To obtain a single value:</p>
<ol class="arabic simple">
<li><p>generate <span class="math">\(u\in[0, 1]\)</span>,</p></li>
<li><p>find <span class="math">\(m\in\{1,\dots,k\}\)</span> such that
<span class="math">\(u\in\left(\sum_{j=1}^{m-1} p_{j}, \sum_{j=1}^m p_{j}\right]\)</span>,</p></li>
<li><p>the result is then <span class="math">\(x_m\)</span>.</p></li>
</ol>
</div></div><div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.26</span>
        
    </div><div class="proof-content">
<p>Write a function that takes as arguments:
(a) an increasingly sorted vector <code class="docutils literal notranslate"><span class="pre">x</span></code> of length <span class="math">\(n\)</span>,
(b) any vector <code class="docutils literal notranslate"><span class="pre">y</span></code> of length <span class="math">\(n\)</span>,
(c) a vector <code class="docutils literal notranslate"><span class="pre">z</span></code> of length <span class="math">\(k\)</span> and elements in <span class="math">\([x_1,x_n)\)</span>.
Let <span class="math">\(f\)</span> be the piecewise linear spline that interpolates the points
<span class="math">\((x_1,y_1),\dots,(x_n,y_n)\)</span>.
Return a vector <code class="docutils literal notranslate"><span class="pre">w</span></code> of length <span class="math">\(k\)</span> such that <span class="math">\(w_i=f(z_i)\)</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 7.27</span>
        
    </div><div class="proof-content">
<p>(*) Write functions <strong class="command">dpareto</strong>, <strong class="command">ppareto</strong>,
<strong class="command">qpareto</strong>, and <strong class="command">rpareto</strong>
that implement the functions related to the Pareto distribution;
compare <a class="reference internal" href="120-numeric.html#sec-probability-distributions"><span class="std std-numref">Section 2.3.4</span></a>.</p>
</div></div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footmapply" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>Yes, the author is aware that <strong class="command">Map</strong> was implemented
using the slightly more primitive <strong class="command">mapply</strong>
but we are not fond of the latter function’s having
the <code class="docutils literal notranslate"><span class="pre">SIMPLIFY</span></code> argument set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default.</p>
</aside>
<aside class="footnote brackets" id="footlapply" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>This use case scenario  can also be programmed
using <strong class="command">lapply</strong>;
<strong class="command">lapply</strong><code class="code docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">f,</span> <span class="pre">...)</span></code>
is equivalent to <strong class="command">Map</strong><code class="code docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">x,</span> <span class="pre">MoreArgs=list(...))</span></code>.</p>
</aside>
<aside class="footnote brackets" id="footchangedefs" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">3</a><span class="fn-bracket">]</span></span>
<p>(*) R is greatly configurable:
we can have custom <code class="file docutils literal notranslate"><span class="pre">~/.Renviron</span></code> and <code class="file docutils literal notranslate"><span class="pre">~/.Rprofile</span></code> files
that are processed on R’s startup; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Startup&quot;)</span></code>.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="180-flow.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">8. </span>Flow of execution</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="160-character.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">6. </span>Character vectors</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2022–2024 by <a href="https://www.gagolewski.com/">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2024-08-21T13:40:11+0200.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            In this chapter
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">7. Functions</a><ul>
<li><a class="reference internal" href="#creating-and-invoking-functions">7.1. Creating and invoking functions</a><ul>
<li><a class="reference internal" href="#anonymous-functions">7.1.1. Anonymous functions</a></li>
<li><a class="reference internal" href="#named-functions">7.1.2. Named functions</a></li>
<li><a class="reference internal" href="#passing-arguments-to-functions">7.1.3. Passing arguments to functions</a></li>
<li><a class="reference internal" href="#grouping-expressions-with-curly-braces">7.1.4. Grouping expressions with curly braces, `<strong class="command">{</strong>`</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-programming">7.2. Functional programming</a><ul>
<li><a class="reference internal" href="#functions-are-objects">7.2.1. Functions are objects</a></li>
<li><a class="reference internal" href="#calling-on-precomputed-arguments-with-do-call">7.2.2. Calling on precomputed arguments with <strong class="command">do.call</strong></a></li>
<li><a class="reference internal" href="#common-higher-order-functions">7.2.3. Common higher-order functions</a></li>
<li><a class="reference internal" href="#vectorising-functions-with-map">7.2.4. Vectorising functions with <strong class="command">Map</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-third-party-functions">7.3. Accessing third-party functions</a><ul>
<li><a class="reference internal" href="#using-r-packages">7.3.1. Using R packages</a><ul>
<li><a class="reference internal" href="#default-packages">7.3.1.1. Default packages</a></li>
<li><a class="reference internal" href="#source-vs-binary-packages">7.3.1.2. Source vs binary packages (*)</a></li>
<li><a class="reference internal" href="#managing-dependencies">7.3.1.3. Managing dependencies (*)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-external-programs">7.3.2. Calling external programs</a></li>
<li><a class="reference internal" href="#interfacing-c-c-fortran-python-java-etc">7.3.3. Interfacing C, C++, Fortran, Python, Java, etc. (**)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">7.4. Exercises</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4805ff4d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    </body>
</html>